var EJS=function(n){window.EJS_MODULES=n;var t={},s=[];function e(o){if(t[o])return t[o].exports;s.push(o);var i=t[o]={i:o,l:!1,exports:{}};return n[o].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return window.aba=function(){return s.sort(function(e,t){return t<e?1:-1})},Array.isArray,e.m=n,e.c=t,e.d=function(t,n,s){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:s})},e.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var o,s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(o in t)e.d(s,o,function(e){return t[e]}.bind(null,o));return s},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.p="",e(e.s=396)}([function(e){e.exports=function(e,t,n){console.warn(e),e&&e.response&&0===e.response.status?t.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;"><a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS/Errors">'+n.localization("CORS Error")+"</a></strong>":t.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+n.localization("Network Error")+"</strong>"}},null,null,null,null,null,function(e){!function(l){"use strict";function s(){}function i(n){var e=this,t=window;this.update=s,this.requestAnimationFrame=n||t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame,this.tickFunction=function(){e.update(),e.startTicker()},this.startTicker=function(){e.requestAnimationFrame.apply(t,[e.tickFunction])}}function a(){}function t(e,t){this.listener=e,this.gamepadGetter=t,this.knownGamepads=[]}function n(e){this.listener=e,window.addEventListener("gamepadconnected",function(t){e._connect(t.gamepad)}),window.addEventListener("gamepaddisconnected",function(t){e._disconnect(t.gamepad)})}function e(e){this.updateStrategy=e||new i,this.gamepads=[],this.listeners={},this.platform=o,this.deadzone=.03,this.maximizeThreshold=.97}var r,o={getType:function(){return"null"},isSupported:function(){return!1},update:s};i.prototype.start=function(e){this.update=e||s,this.startTicker()},a.prototype.update=s,a.prototype.start=function(e){this.update=e||s},t.factory=function(s){var n=o,e=window&&window.navigator;return e&&(void 0!==e.getGamepads?n=new t(s,function(){return e.getGamepads()}):void 0!==e.webkitGamepads?n=new t(s,function(){return e.webkitGamepads()}):void 0!==e.webkitGetGamepads&&(n=new t(s,function(){return e.webkitGetGamepads()}))),n},t.getType=function(){return"WebKit"},t.prototype.getType=function(){return t.getType()},t.prototype.isSupported=function(){return!0},t.prototype.update=function(){for(var t,n=Array.prototype.slice.call(this.gamepadGetter(),0),e=this.knownGamepads.length-1;0<=e;e--)t=this.knownGamepads[e],n.indexOf(t)<0&&(this.knownGamepads.splice(e,1),this.listener._disconnect(t));for(e=0;e<n.length;e++)(t=n[e])&&this.knownGamepads.indexOf(t)<0&&(this.knownGamepads.push(t),this.listener._connect(t))},n.factory=function(t){var e=o;return e=window&&void 0!==window.addEventListener?new n(t):e},n.getType=function(){return"Firefox"},n.prototype.getType=function(){return n.getType()},n.prototype.isSupported=function(){return-1!==(window&&window.navigator).userAgent.indexOf("Firefox")},n.prototype.update=s,e.UpdateStrategies={AnimFrameUpdateStrategy:i,ManualUpdateStrategy:a},e.PlatformFactories=[n.factory,t.factory],e.Type={N64:"n64",PLAYSTATION:"playstation",LOGITECH:"logitech",XBOX:"xbox",ECKA:"ecka",UNKNOWN:"unknown"},e.Event={CONNECTED:"connected",UNSUPPORTED:"unsupported",DISCONNECTED:"disconnected",TICK:"tick",BUTTON_DOWN:"button-down",BUTTON_UP:"button-up",AXIS_CHANGED:"axis-changed"},e.StandardButtons=["BUTTON_1","BUTTON_2","BUTTON_3","BUTTON_4","LEFT_TOP_SHOULDER","RIGHT_TOP_SHOULDER","LEFT_BOTTOM_SHOULDER","RIGHT_BOTTOM_SHOULDER","SELECT_BACK","START_FORWARD","LEFT_STICK","RIGHT_STICK","DPAD_UP","DPAD_DOWN","DPAD_LEFT","DPAD_RIGHT","HOME"],e.StandardAxes=["LEFT_STICK_X","LEFT_STICK_Y","RIGHT_STICK_X","RIGHT_STICK_Y"];function c(e,t,n){return t<e.length?e[t]:n+(t-e.length+1)}function d(){return 0}e.StandardMapping={env:{},buttons:{byButton:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]},axes:{byAxis:[0,1,2,3]}},e.Mappings=[{env:{platform:n.getType(),type:e.Type.N64},buttons:{byButton:[2,1,3,0,4,5,-1,-1,8,9,-1,-1,12,13,14,15,-1]},axes:{byAxis:[1,2,-1,-1]}},{env:{platform:t.getType(),type:e.Type.N64},buttons:{byButton:[2,1,3,0,4,5,-1,-1,8,9,-1,-1,12,13,14,15,-1]},axes:{byAxis:[0,1,-1,-1]}},{env:{platform:n.getType(),type:e.Type.XBOX},buttons:{byButton:[0,1,2,3,4,5,15,16,9,8,6,7,11,12,13,14,10]},axes:{byAxis:[0,1,2,3]}},{env:{platform:n.getType(),type:e.Type.PLAYSTATION},buttons:{byButton:[14,13,15,12,10,11,8,9,0,3,1,2,4,6,7,5,16]},axes:{byAxis:[0,1,2,3]}},{env:{platform:t.getType(),type:e.Type.LOGITECH},buttons:{byButton:[1,2,0,3,4,5,6,7,8,9,10,11,11,12,13,14,10]},axes:{byAxis:[0,1,2,3]}},{env:{platform:n.getType(),type:e.Type.LOGITECH},buttons:{byButton:[0,1,2,3,4,5,-1,-1,6,7,8,9,11,12,13,14,10],byAxis:[-1,-1,-1,-1,-1,-1,[2,0,1],[2,0,-1]]},axes:{byAxis:[0,1,3,4]}},{env:{platform:t.getType(),type:e.Type.ECKA},buttons:{byButton:[2,1,3,0,4,5,6,7,8,9,10,11,11,12,13,14,10],byAxis:[-1,-1,-1,-1,-1,-1,[2,0,1],[2,0,-1]]},axes:{byAxis:[0,1,3,4]}},{env:{platform:t.getType(),type:e.Type.UNKNOWN},buttons:{byButton:[0,1,2,3,4,5,-1,-1,6,7,8,9,11,12,13,14,15,16,17,10]},axes:{byAxis:[0,1,2,5]}}],e.prototype.init=function(){var t=e.resolvePlatform(this),n=this;return this.platform=t,this.updateStrategy.start(function(){n._update()}),this.buttonState=[],this.extraButtonState=[],t.isSupported()},e.prototype.bind=function(e,t){return void 0===this.listeners[e]&&(this.listeners[e]=[]),this.listeners[e].push(t),this},e.prototype.unbind=function(e,n){if(void 0!==e){if(void 0!==n){if(void 0===this.listeners[e])return!1;for(var t=0;t<this.listeners[e].length;t++)if(this.listeners[e][t]===n)return this.listeners[e].splice(t,1),!0;return!1}this.listeners[e]=[]}else this.listeners={}},e.prototype.count=function(){return this.gamepads.length},e.prototype._fire=function(t,e){if(void 0!==this.listeners[t]){for(var s,n=0;n<this.listeners[t].length;n++)this.listeners[t][n].apply(this.listeners[t][n],[e]);s=this,e.gamepad&&e.gamepad.extra_buttons&&e.gamepad.extra_buttons.forEach(function(t,n){s.extraButtonState[e.gamepad.index]||(s.extraButtonState[e.gamepad.index]=[]),s.extraButtonState[e.gamepad.index][n]=t})}},e.getNullPlatform=function(){return Object.create(o)},e.resolvePlatform=function(s){for(var t=o,n=0;!t.isSupported()&&n<e.PlatformFactories.length;n++)t=e.PlatformFactories[n](s);return t},e.prototype._connect=function(t){var n,s,o=this._resolveMapping(t);for(t.state={},t.lastState={},t.updater=[],this.buttonState[t.index]||(this.buttonState[t.index]=[]),this.extraButtonState[t.index]||(this.extraButtonState[t.index]=[]),s=o.buttons.byButton.length,n=0;n<s;n++)this._addButtonUpdater(t,o,n);for(s=o.axes.byAxis.length,n=0;n<s;n++)this._addAxisUpdater(t,o,n);if(this.gamepads[t.index]=t,!this.gamepads[t.index].extra_buttons)for(this.gamepads[t.index].extra_buttons=[],n=t.buttons.length;n<16;n++)this.extraButtonState[t.index][n]?this.gamepads[t.index].extra_buttons[n]=this.extraButtonState[t.index][n]:this.gamepads[t.index].extra_buttons[n]={pressed:!1,value:0};this._fire(e.Event.CONNECTED,t)},e.prototype._addButtonUpdater=function(t,a,o){var n=c(e.StandardButtons,o,"EXTRA_BUTTON_"),r=this._createButtonGetter(t,a.buttons,o),s=this,i={gamepad:t,control:n,index:o,gamepadIndex:t.index};t.state[n]=0,t.lastState[n]=0,null==this.buttonState[t.index][n]&&(this.buttonState[t.index][n]=0),t.updater.push(function(){var o=r(),a=t.lastState[n],c=.5<o,l=.5<a;t.state[n]=o,c&&!l?s._fire(e.Event.BUTTON_DOWN,Object.create(i)):(!c&&l||s.buttonState[t.index][n]!=o)&&s._fire(e.Event.BUTTON_UP,Object.create(i)),0!==o&&1!==o&&o!==a&&s._fireAxisChangedEvent(t,n,o),t.lastState[n]=o,s.buttonState[t.index][n]=o})},e.prototype._addAxisUpdater=function(t,i,o){var n=c(e.StandardAxes,o,"EXTRA_AXIS_"),a=this._createAxisGetter(t,i.axes,o),s=this;t.state[n]=0,t.lastState[n]=0,null==this.buttonState[t.index][n]&&(this.buttonState[t.index][n]=0),t.updater.push(function(){var e=a(),o=s.buttonState[t.index][n];(t.state[n]=e)!==o&&s._fireAxisChangedEvent(t,n,e),t.lastState[n]=e,s.buttonState[t.index][n]=e})},e.prototype._fireAxisChangedEvent=function(t,n,s){this._fire(e.Event.AXIS_CHANGED,{gamepad:t,axis:n,value:s})},e.prototype._createButtonGetter=(r=function(){return 0},function(i,s,t){var e,n,o,c,a=r,l=this;return-1!==(e=s.byButton[t])?"number"==typeof e&&e<i.buttons.length&&(a=function(){var t=i.buttons[e];return"number"==typeof t?t:"number"==typeof t.value?t.value:0}):s.byAxis&&t<s.byAxis.length&&(s=e=s.byAxis[t],"[object Array]"===Object.prototype.toString.call(s)&&3==e.length&&e[0]<i.axes.length&&(c=a=function(){var t=i.axes[e[0]];return l._applyDeadzoneMaximize(t)},o=e[1],n=e[2],t=r,o<n?t=function(){var e=n-o;return(e=(c()-o)/e)<0?0:e}:n<o&&(t=function(){var e=o-n;return 1<(e=(c()-n)/e)?0:1-e}),a=t)),a}),e.prototype._createAxisGetter=function(t,s,o){var e,n=d,i=this;return n=-1!==(e=s.byAxis[o])&&"number"==typeof e&&e<t.axes.length?function(){var n=t.axes[e];return i._applyDeadzoneMaximize(n)}:n},e.prototype._disconnect=function(n){var t,s=[];for(void 0!==this.gamepads[n.index]&&delete this.gamepads[n.index],t=0;t<this.gamepads.length;t++)void 0!==this.gamepads[t]&&(s[t]=this.gamepads[t]);this.gamepads=s,this._fire(e.Event.DISCONNECTED,n)},e.prototype._resolveControllerType=function(t){return-1!==(t=t.toLowerCase().replace(/\s+/g," ").replace(/^\s+|\s+$/g,"")).indexOf("playstation")?e.Type.PLAYSTATION:-1!==t.indexOf("logitech")||-1!==t.indexOf("wireless gamepad")?e.Type.LOGITECH:-1!==t.indexOf("xbox")||-1!==t.indexOf("360")?e.Type.XBOX:-1!==t.indexOf("79-6-generic")&&-1!==t.indexOf("joystick")||-1!==t.indexOf("vendor: 0079 product: 0006")&&-1!==t.indexOf("generic usb joystick")?e.Type.N64:"usb joystick (vendor: 0e8f product: 0002)"===t?e.Type.ECKA:e.Type.UNKNOWN},e.prototype._resolveMapping=function(i){for(var t,o=e.Mappings,n=null,a={platform:this.platform.getType(),type:this._resolveControllerType(i.id)},s=0;!n&&s<o.length;s++)t=o[s],e.envMatchesFilter(t.env,a)&&(n=t);return n||e.StandardMapping},e.envMatchesFilter=function(t,s){var e,n=!0;for(e in t)t[e]!==s[e]&&(n=!1);return n},e.prototype._update=function(){this.platform.update(),this.gamepads.forEach(function(e){e&&e.updater.forEach(function(e){e()})}),0<this.gamepads.length&&this._fire(e.Event.TICK,this.gamepads)},e.prototype._applyDeadzoneMaximize=function(e,t,n){return t=void 0!==t?t:this.deadzone,n=void 0!==n?n:this.maximizeThreshold,0<=e?e<t?e=0:n<e&&(e=1):-t<e?e=0:e<-n&&(e=-1),e},l.Gamepad=e}(e.exports||window)},null,null,null,null,function(t){function e(e,t){try{e=new URL(e)}catch(e){}return e&&!["http:","https:"].includes(e.protocol)?new Promise(async function(s,o){if("HEAD"===t.method)s({headers:{}});else{try{var n=await fetch(e);if(t.type&&"arraybuffer"===t.type.toLowerCase())n=await n.arrayBuffer();else{n=await n.text();try{n=JSON.parse(n)}catch(e){}}}catch(e){o(e)}s({data:n,headers:{}})}}):new Promise(function(s,o){var n=new XMLHttpRequest;n.onload=function(){if(n.readyState===n.DONE){var e=n.response;try{e=JSON.parse(e)}catch(e){}s({data:e,headers:{"content-length":n.getResponseHeader("content-length"),"content-type":n.getResponseHeader("content-type"),"last-modified":n.getResponseHeader("last-modified")}})}},n.responseType=t.type,n.onerror=o,n.open(t.method,e,!0),n.send()})}t.exports={a:{get:async function(n,t){return t=t&&t.responseType?t&&t.responseType:"text",e(n,{method:"GET",type:t})},head:async function(n,t){return t=t&&t.responseType?t&&t.responseType:"text",e(n,{method:"HEAD",type:t})}}}},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,function(t){var e=function(){return this}();try{e=e||new Function("return this")()}catch(t){"object"==typeof window&&(e=window)}t.exports=e},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,function(e){e=e.exports={};function l(){throw new Error("setTimeout has not been defined")}function c(){throw new Error("clearTimeout has not been defined")}function d(e){if(n===setTimeout)return setTimeout(e,0);if((n===l||!n)&&setTimeout)return(n=setTimeout)(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}try{n="function"==typeof setTimeout?setTimeout:l}catch(e){n=l}try{s="function"==typeof clearTimeout?clearTimeout:c}catch(e){s=c}var e,n,s,i,t=[],a=!1,r=-1;function m(){a&&i&&(a=!1,i.length?t=i.concat(t):r=-1,t.length&&u())}function u(){if(!a){var e,n=d(m);a=!0;for(e=t.length;e;){for(i=t,t=[];++r<e;)i&&i[r].run();r=-1,e=t.length}i=null,a=!1,function(e){if(s===clearTimeout)return clearTimeout(e);if((s===c||!s)&&clearTimeout)return(s=clearTimeout)(e);try{s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}(n)}}function h(e,t){this.fun=e,this.array=t}function o(){}e.nextTick=function(s){var e,n=new Array(arguments.length-1);if(1<arguments.length)for(e=1;e<arguments.length;e++)n[e-1]=arguments[e];t.push(new h(s,n)),1!==t.length||a||d(u)},h.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=o,e.addListener=o,e.once=o,e.off=o,e.removeListener=o,e.removeAllListeners=o,e.emit=o,e.prependListener=o,e.prependOnceListener=o,e.listeners=function(){return[]},e.binding=function(){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},function(t){function e(n){if(n){var t,s=n;for(t in e.prototype)s[t]=e.prototype[t];return s}}(t.exports=e).prototype.on=e.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},e.prototype.once=function(t,n){function e(){this.off(t,e),n.apply(this,arguments)}return e.fn=n,this.on(t,e),this},e.prototype.off=e.prototype.removeListener=e.prototype.removeAllListeners=e.prototype.removeEventListener=function(n,s){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var e,o,t=this._callbacks["$"+n];if(!t)return this;if(1==arguments.length)return delete this._callbacks["$"+n],this;for(e=0;e<t.length;e++)if((o=t[e])===s||o.fn===s){t.splice(e,1);break}return this},e.prototype.emit=function(s){this._callbacks=this._callbacks||{};var t,n,o=[].slice.call(arguments,1),e=this._callbacks["$"+s];if(e)for(t=0,n=(e=e.slice(0)).length;t<n;++t)e[t].apply(this,o);return this},e.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},e.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(g,e,s){var c,p=s(382),f=s(151),i=s(384),m=s(385),d=s(386),h=("undefined"!=typeof ArrayBuffer&&(c=s(387)),"undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent)),u="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),l=h||u,a=(e.protocol=3,e.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6}),o=p(a),n={type:"error",data:"parser error"},t=s(388);function r(e,s,o){for(var n=new Array(e.length),i=m(e.length,o),t=0;t<e.length;t++)!function(e,t,o){s(t,function(t,s){n[e]=s,o(t,n)})}(t,e[t],i)}e.encodePacket=function(n,o,m,c){if("function"==typeof o&&(c=o,o=!1),"function"==typeof m&&(c=m,m=null),u=void 0===n.data?void 0:n.data.buffer||n.data,"undefined"!=typeof ArrayBuffer&&u instanceof ArrayBuffer){if(s=n,i=c,!o)return e.encodeBase64Packet(s,i);var s,i,u,h,f,r=s.data,j=new Uint8Array(r),p=new Uint8Array(1+r.byteLength);p[0]=a[s.type];for(h=0;h<j.length;h++)p[h+1]=j[h];return i(p.buffer)}if(void 0!==t&&u instanceof t){if(r=n,s=o,i=c,!s)return e.encodeBase64Packet(r,i);if(l){var g=r,v=s,b=i;return v?(f=new FileReader,f.onload=function(){e.encodePacket({type:g.type,data:f.result},v,!0,b)},f.readAsArrayBuffer(g.data)):e.encodeBase64Packet(g,b)}return(s=new Uint8Array(1))[0]=a[r.type],i(new t([s.buffer,r.data]))}return u&&u.base64?c("b"+e.packets[n.type]+n.data.data):(o=a[n.type],void 0!==n.data&&(o+=m?d.encode(String(n.data),{strict:!1}):String(n.data)),c(""+o))},e.encodeBase64Packet=function(n,l){if(o="b"+e.packets[n.type],void 0!==t&&n.data instanceof t)return(a=new FileReader).onload=function(){var e=a.result.split(",")[1];l(o+e)},a.readAsDataURL(n.data);try{i=String.fromCharCode.apply(null,new Uint8Array(n.data))}catch(e){for(var o,i,a,r=new Uint8Array(n.data),c=new Array(r.length),s=0;s<r.length;s++)c[s]=r[s];i=String.fromCharCode.apply(null,c)}return o+=btoa(i),l(o)},e.decodePacket=function(s,c,r){if(void 0===s)return n;if("string"==typeof s){if("b"===s.charAt(0))return e.decodeBase64Packet(s.substr(1),c);if(r&&!1===(s=function(e){try{e=d.decode(e,{strict:!1})}catch(e){return!1}return e}(s)))return n;var a=s.charAt(0);return Number(a)==a&&o[a]?1<s.length?{type:o[a],data:s.substring(1)}:{type:o[a]}:n}return a=new Uint8Array(s)[0],r=i(s,1),t&&"blob"===c&&(r=new t([r])),{type:o[a],data:r}},e.decodeBase64Packet=function(e,s){var n=o[e.charAt(0)];return c?(e=c.decode(e.substr(1)),{type:n,data:e="blob"===s&&t?new t([e]):e}):{type:n,data:{base64:!0,data:e.substr(1)}}},e.encodePayload=function(n,s,o){"function"==typeof s&&(o=s,s=null);var i=f(n);return s&&i?t&&!l?e.encodePayloadAsBlob(n,o):e.encodePayloadAsArrayBuffer(n,o):n.length?void r(n,function(t,n){e.encodePacket(t,!!i&&s,!1,function(e){n(null,e.length+":"+e)})},function(t,e){return o(e.join(""))}):o("0:")},e.decodePayload=function(i,r,t){if("string"!=typeof i)return e.decodePayloadAsBinary(i,r,t);if("function"==typeof r&&(t=r,r=null),""===i)return t(n,0,1);for(var s,c,l,o="",a=0,d=i.length;a<d;a++)if(l=i.charAt(a),":"===l){if(""===o||o!=(c=Number(o)))return t(n,0,1);if(o!=(s=i.substr(a+1,c)).length)return t(n,0,1);if(s.length){if(s=e.decodePacket(s,r,!1),n.type===s.type&&n.data===s.data)return t(n,0,1);if(!1===t(s,a+c,d))return}a+=c,o=""}else o+=l;return""!==o?t(n,0,1):void 0},e.encodePayloadAsArrayBuffer=function(t,n){if(!t.length)return n(new ArrayBuffer(0));r(t,function(t,n){e.encodePacket(t,!0,!0,function(e){return n(null,e)})},function(i,s){var o=s.reduce(function(e,t){return e+(e="string"==typeof t?t.length:t.byteLength).toString().length+e+2},0),e=new Uint8Array(o),t=0;return s.forEach(function(o){var n,s,a,r="string"==typeof o,i=o;if(r){for(s=new Uint8Array(o.length),n=0;n<o.length;n++)s[n]=o.charCodeAt(n);i=s.buffer}e[t++]=r?0:1;for(a=i.byteLength.toString(),n=0;n<a.length;n++)e[t++]=parseInt(a[n]);for(e[t++]=255,s=new Uint8Array(i),n=0;n<s.length;n++)e[t++]=s[n]}),n(e.buffer)})},e.encodePayloadAsBlob=function(n,s){r(n,function(n,s){e.encodePacket(n,!0,!0,function(e){if(o=new Uint8Array(1),o[0]=1,"string"==typeof e){for(a=new Uint8Array(e.length),n=0;n<e.length;n++)a[n]=e.charCodeAt(n);e=a.buffer,o[0]=0}for(var o,a,i=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),r=new Uint8Array(i.length+1),n=0;n<i.length;n++)r[n]=parseInt(i[n]);r[i.length]=255,t&&(o=new t([o.buffer,r.buffer,e]),s(null,o))})},function(n,e){return s(new t(e))})},e.decodePayloadAsBinary=function(m,c,d){"function"==typeof c&&(d=c,c=null);for(t=m,r=[];0<t.byteLength;){for(var t,r,h,l=new Uint8Array(t),f=0===l[0],s="",o=1;255!==l[o];o++){if(310<s.length)return d(n,0,1);s+=l[o]}var t=i(t,2+s.length),s=parseInt(s),a=i(t,0,s);if(f)try{a=String.fromCharCode.apply(null,new Uint8Array(a))}catch(e){for(var u=new Uint8Array(a),a="",o=0;o<u.length;o++)a+=String.fromCharCode(u[o])}r.push(a),t=i(t,s)}h=r.length,r.forEach(function(t,n){d(e.decodePacket(t,c,!0),n,h)})}},function(c,e,t){var a=t(373),r=t(105),o=t(148),s=t(74)("socket.io-client"),n=(c.exports=e=i,e.managers={});function i(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var e=a(e),c=e.source,i=e.id,r=e.path,r=n[i]&&r in n[i].nsps,r=t.forceNew||t["force new connection"]||!1===t.multiplex||r?(s("ignoring socket cache for %s",c),o(c,t)):(n[i]||(s("new io instance for %s",c),n[i]=o(c,t)),n[i]);return e.query&&!t.query&&(t.query=e.query),r.socket(e.path,t)}e.protocol=r.protocol,e.connect=i,e.Manager=t(148),e.Socket=t(154)},null,null,null,null,function(t,n,s){var e;!function(){"use strict";void 0!==(e="function"==typeof(e=function(){function e(e){throw e}function t(){}function n(e,t){for(o in void 0===t&&"function"==typeof e&&(t=e),"[object Object]"!=Object.prototype.toString.call(e)&&(e={}),s)this[o]=(void 0!==e[o]?e:s)[o];this.dbName=this.storePrefix+this.storeName,this.dbVersion=parseInt(this.dbVersion,10)||1,t&&(this.onStoreReady=t);var o,n="object"==typeof window?window:self,t=this.implementationPreference.filter(function(e){return e in n});this.implementation=t[0],this.idb=n[this.implementation],this.keyRange=n.IDBKeyRange||n.webkitIDBKeyRange||n.mozIDBKeyRange,this.consts={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange",NEXT:"next",NEXT_NO_DUPLICATE:"nextunique",PREV:"prev",PREV_NO_DUPLICATE:"prevunique"},this.openDB()}var s={storeName:"Store",storePrefix:"IDBWrapper-",dbVersion:1,keyPath:"id",autoIncrement:!0,onStoreReady:function(){},onError:e,indexes:[],implementationPreference:["indexedDB","webkitIndexedDB","mozIndexedDB","shimIndexedDB"]},o={constructor:n,version:"1.7.2",db:null,dbName:null,dbVersion:null,store:null,storeName:null,storePrefix:null,keyPath:null,autoIncrement:null,indexes:null,implementationPreference:null,implementation:"",onStoreReady:null,onError:null,_insertIdCount:0,openDB:function(){var t=this.idb.open(this.dbName,this.dbVersion),e=!1;t.onerror=function(t){var e;("error"in(e=t).target?"VersionError"==e.target.error.name:"errorCode"in e.target&&12==e.target.errorCode)?this.onError(new Error("The version number provided is lower than the existing one.")):(t=t.target.error||(e="IndexedDB unknown error occurred when opening DB "+this.dbName+" version "+this.dbVersion,"errorCode"in t.target&&(e+=" with error code "+t.target.errorCode),new Error(e)),this.onError(t))}.bind(this),t.onsuccess=function(n){var t;e||(this.db?this.onStoreReady():(this.db=n.target.result,"string"!=typeof this.db.version?this.db.objectStoreNames.contains(this.storeName)?(n=this.db.transaction([this.storeName],this.consts.READ_ONLY),this.store=n.objectStore(this.storeName),t=Array.prototype.slice.call(this.getIndexList()),this.indexes.forEach(function(s){var o,n=s.name;if(!n)return e=!0,void this.onError(new Error("Cannot create index: No index name given."));this.normalizeIndexData(s),this.hasIndex(n)?(o=this.store.index(n),this.indexComplies(o,s)||(e=!0,this.onError(new Error('Cannot modify index "'+n+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),t.splice(t.indexOf(n),1)):(e=!0,this.onError(new Error('Cannot create new index "'+n+'" for current version. Please bump version number to '+(this.dbVersion+1)+".")))},this),t.length&&(e=!0,this.onError(new Error('Cannot delete index(es) "'+t.toString()+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),e||this.onStoreReady()):this.onError(new Error("Object store couldn't be created.")):this.onError(new Error("The IndexedDB implementation in this browser is outdated. Please upgrade your browser."))))}.bind(this),t.onupgradeneeded=function(t){this.db=t.target.result,this.db.objectStoreNames.contains(this.storeName)?this.store=t.target.transaction.objectStore(this.storeName):(t={autoIncrement:this.autoIncrement},null!==this.keyPath&&(t.keyPath=this.keyPath),this.store=this.db.createObjectStore(this.storeName,t));var n=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(t){var o,s=t.name;s||(e=!0,this.onError(new Error("Cannot create index: No index name given."))),this.normalizeIndexData(t),this.hasIndex(s)?(o=this.store.index(s),this.indexComplies(o,t)||(this.store.deleteIndex(s),this.store.createIndex(s,t.keyPath,{unique:t.unique,multiEntry:t.multiEntry})),n.splice(n.indexOf(s),1)):this.store.createIndex(s,t.keyPath,{unique:t.unique,multiEntry:t.multiEntry})},this),n.length&&n.forEach(function(e){this.store.deleteIndex(e)},this)}.bind(this)},deleteDatabase:function(n,e){var t;this.idb.deleteDatabase?(this.db.close(),(t=this.idb.deleteDatabase(this.dbName)).onsuccess=n,t.onerror=e):e(new Error("Browser does not support IndexedDB deleteDatabase!"))},put:function(c,n,i,s){null!==this.keyPath&&(s=i,i=n,n=c),s=s||e,i=i||t;var a=!1,r=null,o=this.db.transaction([this.storeName],this.consts.READ_WRITE);return o.oncomplete=function(){(a?i:s)(r)},o.onabort=s,o.onerror=s,(n=null!==this.keyPath?(this._addIdPropertyIfNeeded(n),o.objectStore(this.storeName).put(n)):o.objectStore(this.storeName).put(n,c)).onsuccess=function(e){a=!0,r=e.target.result},n.onerror=s,o},get:function(o,i,n){n=n||e,i=i||t;var a=!1,r=null,s=this.db.transaction([this.storeName],this.consts.READ_ONLY),o=(s.oncomplete=function(){(a?i:n)(r)},s.onabort=n,s.onerror=n,s.objectStore(this.storeName).get(o));return o.onsuccess=function(e){a=!0,r=e.target.result},o.onerror=n,s},remove:function(o,i,n){n=n||e,i=i||t;var a=!1,r=null,s=this.db.transaction([this.storeName],this.consts.READ_WRITE),o=(s.oncomplete=function(){(a?i:n)(r)},s.onabort=n,s.onerror=n,s.objectStore(this.storeName).delete(o));return o.onsuccess=function(e){a=!0,r=e.target.result},o.onerror=n,s},batch:function(o,a,s){if(s=s||e,a=a||t,"[object Array]"!=Object.prototype.toString.call(o))s(new Error("dataArray argument must be of type Array."));else if(0===o.length)return a(!0);function c(){0!=--l||i||(r=i=!0)}var l=o.length,i=!1,r=!1,n=this.db.transaction([this.storeName],this.consts.READ_WRITE);return n.oncomplete=function(){(r?a:s)(r)},n.onabort=s,n.onerror=s,o.forEach(function(e){function r(e){n.abort(),i||(i=!0,s(e,o,a))}var t,o=e.type,a=e.key,e=e.value;"remove"==o?((t=n.objectStore(this.storeName).delete(a)).onsuccess=c,t.onerror=r):"put"==o&&((t=null!==this.keyPath?(this._addIdPropertyIfNeeded(e),n.objectStore(this.storeName).put(e)):n.objectStore(this.storeName).put(e,a)).onsuccess=c,t.onerror=r)},this),n},putBatch:function(e,t,n){return e=e.map(function(e){return{type:"put",value:e}}),this.batch(e,t,n)},upsertBatch:function(i,o,a,n){"function"==typeof o&&(n=a=o,o={}),n=n||e,a=a||t,o=o||{},"[object Array]"!=Object.prototype.toString.call(i)&&n(new Error("dataArray argument must be of type Array."));function h(e){i[u++][l]=e.target.result,0!=--d||r||(c=r=!0)}var l=o.keyField||this.keyPath,d=i.length,r=!1,c=!1,u=0,s=this.db.transaction([this.storeName],this.consts.READ_WRITE);return s.oncomplete=function(){c?a(i):n(!1)},s.onabort=n,s.onerror=n,i.forEach(function(e){var t=e.key,e=null!==this.keyPath?(this._addIdPropertyIfNeeded(e),s.objectStore(this.storeName).put(e)):s.objectStore(this.storeName).put(e,t);e.onsuccess=h,e.onerror=function(e){s.abort(),r||(r=!0,n(e))}},this),s},removeBatch:function(e,t,n){return e=e.map(function(e){return{type:"remove",key:e}}),this.batch(e,t,n)},getBatch:function(o,i,n,a){if(n=n||e,i=i||t,a=a||"sparse","[object Array]"!=Object.prototype.toString.call(o))n(new Error("keyArray argument must be of type Array."));else if(0===o.length)return i([]);function d(e){e.target.result||"dense"==a?r.push(e.target.result):"sparse"==a&&r.length++,0==--u&&(l=!0,c=r)}var r=[],u=o.length,l=!1,c=null,s=this.db.transaction([this.storeName],this.consts.READ_ONLY);return s.oncomplete=function(){(l?i:n)(c)},s.onabort=n,s.onerror=n,o.forEach(function(e){e=s.objectStore(this.storeName).get(e),e.onsuccess=d,e.onerror=function(e){n(c=e),s.abort()}},this),s},getAll:function(n,s){s=s||e,n=n||t;var o=this.db.transaction([this.storeName],this.consts.READ_ONLY),i=o.objectStore(this.storeName);return i.getAll?this._getAllNative(o,i,n,s):this._getAllCursor(o,i,n,s),o},_getAllNative:function(e,o,i,t){var n=!1,s=null,e=(e.oncomplete=function(){(n?i:t)(s)},e.onabort=t,e.onerror=t,o.getAll());e.onsuccess=function(e){n=!0,s=e.target.result},e.onerror=t},_getAllCursor:function(e,i,a,t){var n=[],s=!1,o=null,e=(e.oncomplete=function(){(s?a:t)(o)},e.onabort=t,e.onerror=t,i.openCursor());e.onsuccess=function(e){e=e.target.result,e?(n.push(e.value),e.continue()):(s=!0,o=n)},e.onError=t},clear:function(o,n){n=n||e,o=o||t;var i=!1,a=null,s=this.db.transaction([this.storeName],this.consts.READ_WRITE),r=(s.oncomplete=function(){(i?o:n)(a)},s.onabort=n,s.onerror=n,s.objectStore(this.storeName).clear());return r.onsuccess=function(e){i=!0,a=e.target.result},r.onerror=n,s},_addIdPropertyIfNeeded:function(e){void 0===e[this.keyPath]&&(e[this.keyPath]=this._insertIdCount+++Date.now())},getIndexList:function(){return this.store.indexNames},hasIndex:function(e){return this.store.indexNames.contains(e)},normalizeIndexData:function(e){e.keyPath=e.keyPath||e.name,e.unique=!!e.unique,e.multiEntry=!!e.multiEntry},indexComplies:function(t,e){return["keyPath","unique","multiEntry"].every(function(s){if("multiEntry"==s&&void 0===t[s]&&!1===e[s])return!0;if("keyPath"!=s||"[object Array]"!=Object.prototype.toString.call(e[s]))return e[s]==t[s];var i,a,o=e.keyPath,n=t.keyPath;if("string"==typeof n)return o.toString()==n;if("function"!=typeof n.contains&&"function"!=typeof n.indexOf)return!1;if(n.length!==o.length)return!1;for(i=0,a=o.length;i<a;i++)if(!(n.contains&&n.contains(o[i])||n.indexOf(-1!==o[i])))return!1;return!0})},iterate:function(a,t){var r="desc"==(t=i({index:null,order:"ASC",autoContinue:!0,filterDuplicates:!1,keyRange:null,writeAccess:!1,onEnd:null,onError:e,limit:1/0,offset:0,allowItemRejection:!1},t||{})).order.toLowerCase()?"PREV":"NEXT",o=(t.filterDuplicates&&(r+="_NO_DUPLICATE"),!1),n=this.db.transaction([this.storeName],this.consts[t.writeAccess?"READ_WRITE":"READ_ONLY"]),s=n.objectStore(this.storeName),c=(t.index&&(s=s.index(t.index)),0),s=(n.oncomplete=function(){o?t.onEnd?t.onEnd():a(null):t.onError(null)},n.onabort=t.onError,n.onerror=t.onError,s.openCursor(t.keyRange,this.consts[r]));return s.onerror=t.onError,s.onsuccess=function(e){var s,e=e.target.result;e?t.offset?(e.advance(t.offset),t.offset=0):(s=a(e.value,e,n),t.allowItemRejection&&!1===s||c++,t.autoContinue&&(c+t.offset<t.limit?e.continue():o=!0)):o=!0},n},query:function(s,e){var t=[],n=0;return(e=e||{}).autoContinue=!0,e.writeAccess=!1,e.allowItemRejection=!!e.filter,e.onEnd=function(){s(t,n)},this.iterate(function(s){n++;var o=!e.filter||e.filter(s);return!1!==o&&t.push(s),o},e)},count:function(c,n){var o=(n=i({index:null,keyRange:null},n||{})).onError||e,a=!1,r=null,s=this.db.transaction([this.storeName],this.consts.READ_ONLY),t=(s.oncomplete=function(){(a?c:o)(r)},s.onabort=o,s.onerror=o,s.objectStore(this.storeName)),t=(t=n.index?t.index(n.index):t).count(n.keyRange);return t.onsuccess=function(e){a=!0,r=e.target.result},t.onError=o,s},makeKeyRange:function(e){var t,n=void 0!==e.lower,s=void 0!==e.upper;switch(!0){case void 0!==e.only:t=this.keyRange.only(e.only);break;case n&&s:t=this.keyRange.bound(e.lower,e.upper,e.excludeLower,e.excludeUpper);break;case n:t=this.keyRange.lowerBound(e.lower,e.excludeLower);break;case s:t=this.keyRange.upperBound(e.upper,e.excludeUpper);break;default:throw new Error('Cannot create KeyRange. Provide one or both of "lower" or "upper" value, or an "only" value.')}return t}},a={};function i(t,s){var e,n;for(e in s)(n=s[e])!==a[e]&&n!==t[e]&&(t[e]=n);return t}return n.prototype=o,n.version=o.version,n})?e.call(n,s,n,t):e)&&(t.exports=e)}()},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,function(t,e){!function a(e,t,s){function o(n,c){if(!t[n]){if(!e[n]){var r="function"==typeof require&&require;if(!c&&r)return r(n,!0);if(i)return i(n,!0);throw c=new Error("Cannot find module '"+n+"'"),c.code="MODULE_NOT_FOUND",c}r=t[n]={exports:{}},e[n][0].call(r.exports,function(t){return o(e[n][1][t]||t)},r,r.exports,a,e,t,s)}return t[n].exports}for(var i="function"==typeof require&&require,n=0;n<s.length;n++)o(s[n]);return o}({1:[function(t){e.Buffer=t("buffer").Buffer},{buffer:3}],2:[function(c,l,o){"use strict";o.byteLength=function(e){var e=i(e),t=e[0],e=e[1];return 3*(t+e)/4-e},o.toByteArray=function(n){for(var s,o=i(n),l=o[0],o=o[1],r=new a(3*(l+o)/4-o),c=0,d=0<o?l-4:l,t=0;t<d;t+=4)s=e[n.charCodeAt(t)]<<18|e[n.charCodeAt(t+1)]<<12|e[n.charCodeAt(t+2)]<<6|e[n.charCodeAt(t+3)],r[c++]=s>>16&255,r[c++]=s>>8&255,r[c++]=255&s;return 2===o&&(s=e[n.charCodeAt(t)]<<2|e[n.charCodeAt(t+1)]>>4,r[c++]=255&s),1===o&&(s=e[n.charCodeAt(t)]<<10|e[n.charCodeAt(t+1)]<<4|e[n.charCodeAt(t+2)]>>2,r[c++]=s>>8&255,r[c++]=255&s),r},o.fromByteArray=function(n){for(var e,s=n.length,a=s%3,i=[],o=0,r=s-a;o<r;o+=16383)i.push(function(s,i,a){for(var e,o=[],n=i;n<a;n+=3)e=(s[n]<<16&16711680)+(s[n+1]<<8&65280)+(255&s[n+2]),o.push(t[(e=e)>>18&63]+t[e>>12&63]+t[e>>6&63]+t[63&e]);return o.join("")}(n,o,r<o+16383?r:o+16383));return 1==a?(e=n[s-1],i.push(t[e>>2]+t[e<<4&63]+"==")):2==a&&(e=(n[s-2]<<8)+n[s-1],i.push(t[e>>10]+t[e>>4&63]+t[e<<2&63]+"=")),i.join("")};for(var t=[],e=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,r=s.length;n<r;++n)t[n]=s[n],e[s.charCodeAt(n)]=n;function i(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");return e=e.indexOf("="),[e=-1===e?t:e,e===t?0:4-e%4]}e["-".charCodeAt(0)]=62,e["_".charCodeAt(0)]=63},{}],3:[function(t,n,e){!function(){!function(){"use strict";var u,x,g=t("base64-js"),c=t("ieee754"),d=(e.Buffer=n,e.SlowBuffer=function(e){return n.alloc(+(e=+e!=e?0:e))},e.INSPECT_MAX_BYTES=50,2147483647);function i(e){if(d<e)throw new RangeError('The value "'+e+'" is invalid for option "size"');return e=new Uint8Array(e),e.__proto__=n.prototype,e}function n(e,t,n){if("number"!=typeof e)return A(e,t,n);if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return p(e)}function A(e,d,u){if("string"==typeof e){var s,o,c,l,h,a=e,t=d;if(!n.isEncoding(t="string"==typeof t&&""!==t?t:"utf8"))throw new TypeError("Unknown encoding: "+t);return o=0|C(a,t),c=i(o),c=(a=c.write(a,t))!==o?c.slice(0,a):c}if(ArrayBuffer.isView(e))return f(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(r(e,ArrayBuffer)||e&&r(e.buffer,ArrayBuffer)){if(t=e,o=d,a=u,o<0||t.byteLength<o)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<o+(a||0))throw new RangeError('"length" is outside of buffer bounds');return(t=void 0===o&&void 0===a?new Uint8Array(t):void 0===a?new Uint8Array(t,o):new Uint8Array(t,o,a)).__proto__=n.prototype,t}if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');if(c=e.valueOf&&e.valueOf(),null!=c&&c!==e)return n.from(c,d,u);if(l=n.isBuffer(s=e)?(0!==(h=i(l=0|m(s.length))).length&&s.copy(h,0,0,l),h):void 0!==s.length?"number"!=typeof s.length||v(s.length)?i(0):f(s):"Buffer"===s.type&&Array.isArray(s.data)?f(s.data):void 0,l)return l;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return n.from(e[Symbol.toPrimitive]("string"),d,u);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function k(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function p(e){return k(e),i(e<0?0:0|m(e))}function f(t){for(var n=t.length<0?0:0|m(t.length),s=i(n),e=0;e<n;e+=1)s[e]=255&t[e];return s}function m(e){if(d<=e)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+d.toString(16)+" bytes");return 0|e}function C(e,s){if(n.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||r(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var o,t=e.length,i=2<arguments.length&&!0===arguments[2];if(!i&&0===t)return 0;for(o=!1;;)switch(s){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":return h(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*t;case"hex":return t>>>1;case"base64":return E(e).length;default:if(o)return i?-1:h(e).length;s=(""+s).toLowerCase(),o=!0}}function a(e,t,n){var s=e[t];e[t]=e[n],e[n]=s}function y(s,t,e,i,o){if(0===s.length)return-1;if("string"==typeof e?(i=e,e=0):2147483647<e?e=2147483647:e<-2147483648&&(e=-2147483648),(e=(e=v(e=+e)?o?0:s.length-1:e)<0?s.length+e:e)>=s.length){if(o)return-1;e=s.length-1}else if(e<0){if(!o)return-1;e=0}if("string"==typeof t&&(t=n.from(t,i)),n.isBuffer(t))return 0===t.length?-1:j(s,t,e,i,o);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?(o?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(s,t,e):j(s,[t],e,i,o);throw new TypeError("val must be string, number or Buffer")}function j(d,l,o,n,h){var e,t,s,u,r=1,a=d.length,i=l.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(d.length<2||l.length<2)return-1;a/=r=2,i/=2,o/=2}function c(e,t){return 1===r?e[t]:e.readUInt16BE(t*r)}if(h)for(t=-1,e=o;e<a;e++)if(c(d,e)===c(l,-1===t?0:e-t)){if(e-(t=-1===t?e:t)+1===i)return t*r}else-1!==t&&(e-=e-t),t=-1;else for(e=o=a<o+i?a-i:o;0<=e;e--){for(u=!0,s=0;s<i;s++)if(c(d,e+s)!==c(l,s)){u=!1;break}if(u)return e}return-1}function S(e,t,n,s){return l(function(t){for(var n=[],e=0;e<t.length;++e)n.push(255&t.charCodeAt(e));return n}(t),e,n,s)}function b(i,g,c){c=Math.min(i.length,c);for(r=[],t=g;t<c;){var t,n,s,a,r,d,h,m,f,p,o=i[t],e=null,l=239<o?4:223<o?3:191<o?2:1;if(t+l<=c)switch(l){case 1:o<128&&(e=o);break;case 2:128==(192&(s=i[t+1]))&&127<(n=(31&o)<<6|63&s)&&(e=n);break;case 3:s=i[t+1],a=i[t+2],128==(192&s)&&128==(192&a)&&2047<(n=(15&o)<<12|(63&s)<<6|63&a)&&(n<55296||57343<n)&&(e=n);break;case 4:s=i[t+1],a=i[t+2],m=i[t+3],128==(192&s)&&128==(192&a)&&128==(192&m)&&65535<(n=(15&o)<<18|(63&s)<<12|(63&a)<<6|63&m)&&n<1114112&&(e=n)}null===e?(e=65533,l=1):65535<e&&(e-=65536,r.push(e>>>10&1023|55296),e=56320|1023&e),r.push(e),t+=l}if(d=r,f=d.length,f<=u)return String.fromCharCode.apply(String,d);for(p="",h=0;h<f;)p+=String.fromCharCode.apply(String,d.slice(h,h+=u));return p}e.kMaxLength=d,(n.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(n.prototype,"parent",{enumerable:!0,get:function(){if(n.isBuffer(this))return this.buffer}}),Object.defineProperty(n.prototype,"offset",{enumerable:!0,get:function(){if(n.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&n[Symbol.species]===n&&Object.defineProperty(n,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),n.poolSize=8192,n.from=A,n.prototype.__proto__=Uint8Array.prototype,n.__proto__=Uint8Array,n.alloc=function(e,t,n){return t=t,n=n,k(e=e),!(e<=0)&&void 0!==t?"string"==typeof n?i(e).fill(t,n):i(e).fill(t):i(e)},n.allocUnsafe=p,n.allocUnsafeSlow=p,n.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==n.prototype},n.compare=function(e,t){if(r(e,Uint8Array)&&(e=n.from(e,e.offset,e.byteLength)),r(t,Uint8Array)&&(t=n.from(t,t.offset,t.byteLength)),!n.isBuffer(e)||!n.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var o=e.length,i=t.length,s=0,a=Math.min(o,i);s<a;++s)if(e[s]!==t[s]){o=e[s],i=t[s];break}return o<i?-1:i<o?1:0},n.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},n.concat=function(s,o){if(!Array.isArray(s))throw new TypeError('"list" argument must be an Array of Buffers');if(0===s.length)return n.alloc(0);if(void 0===o)for(e=o=0;e<s.length;++e)o+=s[e].length;for(var t,i=n.allocUnsafe(o),a=0,e=0;e<s.length;++e){if(t=s[e],r(t,Uint8Array)&&(t=n.from(t)),!n.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(i,a),a+=t.length}return i},n.byteLength=C,n.prototype._isBuffer=!0,n.prototype.swap16=function(){var e,t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(e=0;e<t;e+=2)a(this,e,e+1);return this},n.prototype.swap32=function(){var e,t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(e=0;e<t;e+=4)a(this,e,e+3),a(this,e+1,e+2);return this},n.prototype.swap64=function(){var e,t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(e=0;e<t;e+=8)a(this,e,e+7),a(this,e+1,e+6),a(this,e+2,e+5),a(this,e+3,e+4);return this},n.prototype.toLocaleString=n.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?b(this,0,e):function(s,e,t){if(u=!1,(e=void 0===e||e<0?0:e)>this.length)return"";if((t=void 0===t||t>this.length?this.length:t)<=0)return"";if((t>>>=0)<=(e>>>=0))return"";for(s=s||"utf8";;)switch(s){case"hex":var w=this,n=e,o=t,l=w.length;(!o||o<0||l<o)&&(o=l);for(h="",c=n=!n||n<0?0:n;c<o;++c)h+=function(e){return e<16?"0"+e.toString(16):e.toString(16)}(w[c]);return h;case"utf8":case"utf-8":return b(this,e,t);case"ascii":for(var C=this,l=e,j=t,O="",j=Math.min(C.length,j),r=l;r<j;++r)O+=String.fromCharCode(127&C[r]);return O;case"latin1":case"binary":for(var _=this,n=e,v=t,y="",v=Math.min(_.length,v),a=n;a<v;++a)y+=String.fromCharCode(_[a]);return y;case"base64":return i=this,p=t,0===(f=e)&&p===i.length?g.fromByteArray(i):g.fromByteArray(i.slice(f,p));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":for(var c,u,h,p,i=e,f=t,m=this.slice(i,f),x="",d=0;d<m.length;d+=2)x+=String.fromCharCode(m[d]+256*m[d+1]);return x;default:if(u)throw new TypeError("Unknown encoding: "+s);s=(s+"").toLowerCase(),u=!0}}.apply(this,arguments)},n.prototype.equals=function(e){if(n.isBuffer(e))return this===e||0===n.compare(this,e);throw new TypeError("Argument must be a Buffer")},n.prototype.inspect=function(){var t="",n=e.INSPECT_MAX_BYTES,t=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim();return this.length>n&&(t+=" ... "),"<Buffer "+t+">"},n.prototype.compare=function(e,t,s,o,i){if(r(e,Uint8Array)&&(e=n.from(e,e.offset,e.byteLength)),!n.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===s&&(s=e?e.length:0),void 0===o&&(o=0),void 0===i&&(i=this.length),(t=void 0===t?0:t)<0||s>e.length||o<0||i>this.length)throw new RangeError("out of range index");if(i<=o&&s<=t)return 0;if(i<=o)return-1;if(s<=t)return 1;if(this===e)return 0;for(var c=(i>>>=0)-(o>>>=0),l=(s>>>=0)-(t>>>=0),h=Math.min(c,l),d=this.slice(o,i),u=e.slice(t,s),a=0;a<h;++a)if(d[a]!==u[a]){c=d[a],l=u[a];break}return c<l?-1:l<c?1:0},n.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},n.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},n.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},n.prototype.write=function(a,t,e,n){if(void 0===t)n="utf8",e=this.length,t=0;else if(void 0===e&&"string"==typeof t)n=t,e=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(e)?(e>>>=0,void 0===n&&(n="utf8")):(n=e,e=void 0)}if(p=this.length-t,(void 0===e||p<e)&&(e=p),0<a.length&&(e<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n=n||"utf8";for(f=!1;;)switch(n){case"hex":var o,r,d,u,m,f,p,b,j,y=this,g=a,c=t,s=e,i=(c=Number(c)||0,y.length-c);(!s||(s=Number(s))>i)&&(s=i),(i=g.length)/2<s&&(s=i/2);for(o=0;o<s;++o){if(m=parseInt(g.substr(2*o,2),16),v(m))return o;y[c+o]=m}return o;case"utf8":case"utf-8":return i=t,u=e,l(h(a,(d=this).length-i),d,i,u);case"ascii":return S(this,a,t,e);case"latin1":case"binary":return S(this,a,t,e);case"base64":return d=this,u=t,r=e,l(E(a),d,u,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return r=t,b=e,l(function(n,i){for(var s,o,e=[],t=0;t<n.length&&!((i-=2)<0);++t)o=(s=n.charCodeAt(t))>>8,e.push(s%256),e.push(o);return e}(a,(j=this).length-r),j,r,b);default:if(f)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),f=!0}},n.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},u=4096;function s(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(n<e+t)throw new RangeError("Trying to access beyond buffer length")}function o(e,t,s,o,i,a){if(!n.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(i<t||t<a)throw new RangeError('"value" argument is out of bounds');if(s+o>e.length)throw new RangeError("Index out of range")}function _(t,s,e,n){if(e+n>t.length)throw new RangeError("Index out of range");if(e<0)throw new RangeError("Index out of range")}function w(n,t,e,s,o){return t=+t,e>>>=0,o||_(n,0,e,4),c.write(n,t,e,s,23,4),e+4}function O(n,t,e,s,o){return t=+t,e>>>=0,o||_(n,0,e,8),c.write(n,t,e,s,52,8),e+8}n.prototype.slice=function(s,e){var t=this.length,t=((s=~~s)<0?(s+=t)<0&&(s=0):t<s&&(s=t),(e=void 0===e?t:~~e)<0?(e+=t)<0&&(e=0):t<e&&(e=t),e<s&&(e=s),this.subarray(s,e));return t.__proto__=n.prototype,t},n.prototype.readUIntLE=function(e,t,a){e>>>=0,t>>>=0,a||s(e,t,this.length);for(var n=this[e],o=1,i=0;++i<t&&(o*=256);)n+=this[e+i]*o;return n},n.prototype.readUIntBE=function(t,e,i){t>>>=0,e>>>=0,i||s(t,e,this.length);for(var n=this[t+--e],o=1;0<e&&(o*=256);)n+=this[t+--e]*o;return n},n.prototype.readUInt8=function(e,t){return e>>>=0,t||s(e,1,this.length),this[e]},n.prototype.readUInt16LE=function(e,t){return e>>>=0,t||s(e,2,this.length),this[e]|this[e+1]<<8},n.prototype.readUInt16BE=function(e,t){return e>>>=0,t||s(e,2,this.length),this[e]<<8|this[e+1]},n.prototype.readUInt32LE=function(e,t){return e>>>=0,t||s(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},n.prototype.readUInt32BE=function(e,t){return e>>>=0,t||s(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},n.prototype.readIntLE=function(e,t,a){e>>>=0,t>>>=0,a||s(e,t,this.length);for(var n=this[e],o=1,i=0;++i<t&&(o*=256);)n+=this[e+i]*o;return n>=(o*=128)&&(n-=Math.pow(2,8*t)),n},n.prototype.readIntBE=function(e,t,a){e>>>=0,t>>>=0,a||s(e,t,this.length);for(var o=t,i=1,n=this[e+--o];0<o&&(i*=256);)n+=this[e+--o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},n.prototype.readInt8=function(e,t){return e>>>=0,t||s(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},n.prototype.readInt16LE=function(t,e){return t>>>=0,e||s(t,2,this.length),e=this[t]|this[t+1]<<8,32768&e?4294901760|e:e},n.prototype.readInt16BE=function(t,e){return t>>>=0,e||s(t,2,this.length),e=this[t+1]|this[t]<<8,32768&e?4294901760|e:e},n.prototype.readInt32LE=function(e,t){return e>>>=0,t||s(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},n.prototype.readInt32BE=function(e,t){return e>>>=0,t||s(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},n.prototype.readFloatLE=function(e,t){return e>>>=0,t||s(e,4,this.length),c.read(this,e,!0,23,4)},n.prototype.readFloatBE=function(e,t){return e>>>=0,t||s(e,4,this.length),c.read(this,e,!1,23,4)},n.prototype.readDoubleLE=function(e,t){return e>>>=0,t||s(e,8,this.length),c.read(this,e,!0,52,8)},n.prototype.readDoubleBE=function(e,t){return e>>>=0,t||s(e,8,this.length),c.read(this,e,!1,52,8)},n.prototype.writeUIntLE=function(e,t,n,a){e=+e,t>>>=0,n>>>=0,a||o(this,e,t,n,Math.pow(2,8*n)-1,0);var s=1,i=0;for(this[t]=255&e;++i<n&&(s*=256);)this[t+i]=e/s&255;return t+n},n.prototype.writeUIntBE=function(e,t,n,a){e=+e,t>>>=0,n>>>=0,a||o(this,e,t,n,Math.pow(2,8*n)-1,0);var s=n-1,i=1;for(this[t+s]=255&e;0<=--s&&(i*=256);)this[t+s]=e/i&255;return t+n},n.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||o(this,e,t,1,255,0),this[t]=255&e,t+1},n.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||o(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},n.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||o(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},n.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||o(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},n.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||o(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},n.prototype.writeIntLE=function(e,t,n,s){e=+e,t>>>=0,s||o(this,e,t,n,(s=Math.pow(2,8*n-1))-1,-s);var i=0,r=1,a=0;for(this[t]=255&e;++i<n&&(r*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/r>>0)-a&255;return t+n},n.prototype.writeIntBE=function(e,t,n,i){e=+e,t>>>=0,i||o(this,e,t,n,(i=Math.pow(2,8*n-1))-1,-i);var s=n-1,r=1,a=0;for(this[t+s]=255&e;0<=--s&&(r*=256);)e<0&&0===a&&0!==this[t+s+1]&&(a=1),this[t+s]=(e/r>>0)-a&255;return t+n},n.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||o(this,e,t,1,127,-128),this[t]=255&(e=e<0?255+e+1:e),t+1},n.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||o(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},n.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||o(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},n.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||o(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},n.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||o(this,e,t,4,2147483647,-2147483648),this[t]=(e=e<0?4294967295+e+1:e)>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},n.prototype.writeFloatLE=function(e,t,n){return w(this,e,t,!0,n)},n.prototype.writeFloatBE=function(e,t,n){return w(this,e,t,!1,n)},n.prototype.writeDoubleLE=function(e,t,n){return O(this,e,t,!0,n)},n.prototype.writeDoubleBE=function(e,t,n){return O(this,e,t,!1,n)},n.prototype.copy=function(o,s,t,e){if(!n.isBuffer(o))throw new TypeError("argument should be a Buffer");if(t=t||0,e||0===e||(e=this.length),s>=o.length&&(s=o.length),(e=0<e&&e<t?t:e)===t)return 0;if(0===o.length||0===this.length)return 0;if((s=s||0)<0)throw new RangeError("targetStart out of bounds");if(t<0||t>=this.length)throw new RangeError("Index out of range");if(e<0)throw new RangeError("sourceEnd out of bounds");e>this.length&&(e=this.length);var i,a=(e=o.length-s<e-t?o.length-s+t:e)-t;if(this===o&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(s,t,e);else if(this===o&&t<s&&s<e)for(i=a-1;0<=i;--i)o[i+s]=this[i+t];else Uint8Array.prototype.set.call(o,this.subarray(t,e),s);return a},n.prototype.fill=function(e,s,t,o){if("string"==typeof e){if("string"==typeof s?(o=s,s=0,t=this.length):"string"==typeof t&&(o=t,t=this.length),void 0!==o&&"string"!=typeof o)throw new TypeError("encoding must be a string");if("string"==typeof o&&!n.isEncoding(o))throw new TypeError("Unknown encoding: "+o);1===e.length&&(a=e.charCodeAt(0),("utf8"===o&&a<128||"latin1"===o)&&(e=a))}else"number"==typeof e&&(e&=255);if(s<0||this.length<s||this.length<t)throw new RangeError("Out of range index");if(t<=s)return this;if(s>>>=0,t=void 0===t?this.length:t>>>0,"number"==typeof(e=e||0))for(i=s;i<t;++i)this[i]=e;else{var i,a,r=n.isBuffer(e)?e:n.from(e,o),c=r.length;if(0===c)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<t-s;++i)this[i+s]=r[i%c]}return this},x=/[^+/0-9A-Za-z-_]/g;function h(a,t){t=t||1/0;for(var e,i=a.length,s=null,n=[],o=0;o<i;++o){if(55295<(e=a.charCodeAt(o))&&e<57344){if(!s){if(56319<e){-1<(t-=3)&&n.push(239,191,189);continue}if(o+1===i){-1<(t-=3)&&n.push(239,191,189);continue}s=e;continue}if(e<56320){-1<(t-=3)&&n.push(239,191,189),s=e;continue}e=65536+(s-55296<<10|e-56320)}else s&&-1<(t-=3)&&n.push(239,191,189);if(s=null,e<128){if(--t<0)break;n.push(e)}else if(e<2048){if((t-=2)<0)break;n.push(e>>6|192,63&e|128)}else if(e<65536){if((t-=3)<0)break;n.push(e>>12|224,e>>6&63|128,63&e|128)}else{if(!(e<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;n.push(e>>18|240,e>>12&63|128,e>>6&63|128,63&e|128)}}return n}function E(e){return g.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(x,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function l(t,n,s,o){for(var e=0;e<o&&!(e+s>=n.length||e>=t.length);++e)n[e+s]=t[e];return e}function r(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function v(e){return e!=e}}.call(this)}.call(this,t("buffer").Buffer)},{"base64-js":2,buffer:3,ieee754:4}],4:[function(t,n,e){e.read=function(r,a,h,i,n){var t,o,u=8*n-i-1,l=(1<<u)-1,d=l>>1,e=-7,s=h?n-1:0,c=h?-1:1,n=r[a+s];for(s+=c,t=n&(1<<-e)-1,n>>=-e,e+=u;0<e;t=256*t+r[a+s],s+=c,e-=8);for(o=t&(1<<-e)-1,t>>=-e,e+=i;0<e;o=256*o+r[a+s],s+=c,e-=8);if(0===t)t=1-d;else{if(t===l)return o?NaN:1/0*(n?-1:1);o+=Math.pow(2,i),t-=d}return(n?-1:1)*o*Math.pow(2,t-i)},e.write=function(d,t,u,n,s,r){var e,o,c=8*r-s-1,l=(1<<c)-1,i=l>>1,m=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,a=n?0:r-1,h=n?1:-1,r=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,e=l):(e=Math.floor(Math.log(t)/Math.LN2),t*(n=Math.pow(2,-e))<1&&(e--,n*=2),2<=(t+=1<=e+i?m/n:m*Math.pow(2,1-i))*n&&(e++,n/=2),l<=e+i?(o=0,e=l):1<=e+i?(o=(t*n-1)*Math.pow(2,s),e+=i):(o=t*Math.pow(2,i-1)*Math.pow(2,s),e=0));8<=s;d[u+a]=255&o,a+=h,o/=256,s-=8);for(e=e<<s|o,c+=s;0<c;d[u+a]=255&e,a+=h,e/=256,c-=8);d[u+a-h]|=128*r}},{}]},{},[1])},function(e,n,t){e.exports=t(77)},function(t,e){e.encode=function(n){var e,t="";for(e in n)n.hasOwnProperty(e)&&(t.length&&(t+="&"),t+=encodeURIComponent(e)+"="+encodeURIComponent(n[e]));return t},e.decode=function(o){for(var t,n={},s=o.split("&"),e=0,i=s.length;e<i;e++)t=s[e].split("="),n[decodeURIComponent(t[0])]=decodeURIComponent(t[1]);return n}},function(e){e.exports=function(e,n){function t(){}t.prototype=n.prototype,e.prototype=new t,e.prototype.constructor=e}},function(n,e,t){!function(s){function o(){var t;try{t=e.storage.debug}catch(e){}return t=!t&&void 0!==s&&"env"in s?s.env.DEBUG:t}(e=n.exports=t(389)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(n){var s,o,t=this.useColors;n[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+n[0]+(t?"%c ":" ")+"+"+e.humanize(this.diff),t&&(t="color: "+this.color,n.splice(1,0,t,"color: inherit"),n[o=s=0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(s++,"%c"===e&&(o=s))}),n.splice(o,0,t))},e.save=function(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(e){}},e.load=o,e.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},e.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},e.enable(o())}.call(this,t(49))},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,function(s){var e=36e5,t=864e5;function n(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}s.exports=function(i,o){o=o||{};var a,s=typeof i;if(!("string"==s&&0<i.length)){if("number"==s&&!1===isNaN(i))return o.long?n(s=i,t,"day")||n(s,e,"hour")||n(s,6e4,"minute")||n(s,1e3,"second")||s+" ms":t<=(o=i)?Math.round(o/t)+"d":e<=o?Math.round(o/e)+"h":6e4<=o?Math.round(o/6e4)+"m":1e3<=o?Math.round(o/1e3)+"s":o+"ms";throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(i))}if(s=i,!(100<(s=String(s)).length)&&(s=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(s),s))switch(a=parseFloat(s[1]),(s[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"days":case"day":case"d":return a*t;case"hours":case"hour":case"hrs":case"hr":case"h":return a*e;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*a;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*a;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}},function(h,e,n){var c,s=n(375)("socket.io-parser"),u=n(50),i=n(377),d=n(147);function r(){}e.protocol=4,e.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],e.CONNECT=0,e.DISCONNECT=1,e.EVENT=2,e.ACK=3,e.ERROR=4,e.BINARY_EVENT=5,e.BINARY_ACK=6,e.Encoder=r,e.Decoder=t,c=e.ERROR+'"encode error"';function l(t){var o,n=""+t.type;if(e.BINARY_EVENT!==t.type&&e.BINARY_ACK!==t.type||(n+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(n+=t.nsp+","),null!=t.id&&(n+=t.id),null!=t.data){if(o=function(e){try{return JSON.stringify(e)}catch(e){return!1}}(t.data),!1===o)return c;n+=o}return s("encoded %j as %s",t,n),n}function t(){this.reconstructor=null}function o(e){this.reconPack=e,this.buffers=[]}function a(t){return{type:e.ERROR,data:"parser error: "+t}}r.prototype.encode=function(t,n){var o;s("encoding packet %j",t),e.BINARY_EVENT===t.type||e.BINARY_ACK===t.type?(o=n,i.removeBlobs(t,function(e){var e=i.deconstructPacket(e),t=l(e.packet),e=e.buffers;e.unshift(t),o(e)})):n([l(t)])},u(t.prototype),t.prototype.add=function(n){var t;if("string"==typeof n)t=function(o){var i,r,c,t=0,n={type:Number(o.charAt(0))};if(null==e.types[n.type])return a("unknown packet type "+n.type);if(e.BINARY_EVENT===n.type||e.BINARY_ACK===n.type){for(r="";"-"!==o.charAt(++t)&&(r+=o.charAt(t),t!=o.length););if(r!=Number(r)||"-"!==o.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(r)}if("/"===o.charAt(t+1))for(n.nsp="";++t&&","!==(c=o.charAt(t))&&(n.nsp+=c,t!==o.length););else n.nsp="/";if(i=o.charAt(t+1),""!==i&&Number(i)==i){for(n.id="";++t;){if(null==(c=o.charAt(t))||Number(c)!=c){--t;break}if(n.id+=o.charAt(t),t===o.length)break}n.id=Number(n.id)}if(o.charAt(++t)){if(i=function(e){try{return JSON.parse(e)}catch(e){return!1}}(o.substr(t)),!1===i||n.type!==e.ERROR&&!Array.isArray(i))return a("invalid payload");n.data=i}return s("decoded %s as %j",o,n),n}(n),e.BINARY_EVENT===t.type||e.BINARY_ACK===t.type?(this.reconstructor=new o(t),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",t)):this.emit("decoded",t);else{if(!d(n)&&!n.base64)throw new Error("Unknown type: "+n);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(n))&&(this.reconstructor=null,this.emit("decoded",t))}},t.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},o.prototype.takeBinaryData=function(e){return this.buffers.push(e),this.buffers.length===this.reconPack.attachments?(e=i.reconstructPacket(this.reconPack,this.buffers),this.finishedReconstruction(),e):null},o.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(e,s,t){var n=t(380);e.exports=function(e){var t=e.xdomain,s=e.xscheme,e=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||n))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!s&&e)return new XDomainRequest}catch(e){}if(!t)try{return new self[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(e){}}},function(n,o,t){var s=t(51);function e(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.isReactNative=e.isReactNative,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}t(50)((n.exports=e).prototype),e.prototype.onError=function(e,t){return e=new Error(e),e.type="TransportError",e.description=t,this.emit("error",e),this},e.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},e.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},e.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},e.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},e.prototype.onData=function(e){e=s.decodePacket(e,this.socket.binaryType),this.onPacket(e)},e.prototype.onPacket=function(e){this.emit("packet",e)},e.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(e,t,n){!function(s){var n;void 0!==(n="function"==typeof(n=function(){"use strict";function i(t,n,s){var e=new XMLHttpRequest;e.open("GET",t),e.responseType="blob",e.onload=function(){o(e.response,n,s)},e.onerror=function(){console.error("could not download file")},e.send()}function a(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(e){}return 200<=e.status&&e.status<=299}function n(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var t="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof s&&s.global===s?s:void 0,o=t.saveAs||("object"!=typeof window||window!==t?function(){}:"download"in HTMLAnchorElement.prototype?function(s,o,c){var r=t.URL||t.webkitURL,e=document.createElement("a");o=o||s.name||"download",e.download=o,e.rel="noopener","string"==typeof s?(e.href=s,e.origin===location.origin?n(e):a(e.href)?i(s,o,c):n(e,e.target="_blank")):(e.href=r.createObjectURL(s),setTimeout(function(){r.revokeObjectURL(e.href)},4e4),setTimeout(function(){n(e)},0))}:"msSaveOrOpenBlob"in navigator?function(e,o,c){var t,s,r;o=o||e.name||"download","string"!=typeof e?navigator.msSaveOrOpenBlob((s=e,void 0===(t=c)?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(s.type)?new Blob(["\ufeff",s],{type:s.type}):s),o):a(e)?i(e,o,c):((r=document.createElement("a")).href=e,r.target="_blank",setTimeout(function(){n(r)}))}:function(n,o,a,e){if((e=e||open("","_blank"))&&(e.document.title=e.document.body.innerText="downloading..."),"string"==typeof n)return i(n,o,a);var s,r,c,o="application/octet-stream"===n.type,a=/constructor/i.test(t.HTMLElement)||t.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);(l||o&&a)&&"object"==typeof FileReader?((r=new FileReader).onloadend=function(){var t=r.result,t=l?t:t.replace(/^data:[^;]*;/,"data:attachment/file;");e?e.location.href=t:location=t,e=null},r.readAsDataURL(n)):(c=t.URL||t.webkitURL,s=c.createObjectURL(n),e?e.location=s:location.href=s,e=null,setTimeout(function(){c.revokeObjectURL(s)},4e4))});t.saveAs=o.saveAs=o,e.exports=o})?n.apply(t,[]):n)&&(e.exports=n)}.call(this,n(31))},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,function(e){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e){!function(t){e.exports=t}.call(this,{})},function(e){var t=/^(?:(?![^:@]+:[^:@/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#/]*\.[^?#/.]+(?:[?#]|$)))*\/?)?([^?#/]*))(?:\?([^#]*))?(?:#(.*))?)/,n=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var r=e,o=e.indexOf("["),i=e.indexOf("]");-1!=o&&-1!=i&&(e=e.substring(0,o)+e.substring(o,i).replace(/:/g,";")+e.substring(i,e.length));for(var c=t.exec(e||""),s={},a=14;a--;)s[n[a]]=c[a]||"";return-1!=o&&-1!=i&&(s.source=r,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s}},null,function(e,n,t){!function(t){e.exports=function(e){return n&&t.isBuffer(e)||s&&(e instanceof ArrayBuffer||o(e))};var n="function"==typeof t&&"function"==typeof t.isBuffer,s="function"==typeof ArrayBuffer,o=function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer}}.call(this,t(73).Buffer)},function(h,m,n){var c=n(378),l=n(154),r=n(50),u=n(105),s=n(155),o=n(156),t=n(74)("socket.io-client:manager"),i=n(153),d=n(394),a=Object.prototype.hasOwnProperty;function e(n,t){if(!(this instanceof e))return new e(n,t);n&&"object"==typeof n&&(t=n,n=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new d({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=n,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[],n=t.parser||u,this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}(h.exports=e).prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)a.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},e.prototype.updateSocketIds=function(){for(var e in this.nsps)a.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},e.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},r(e.prototype),e.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},e.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},e.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},e.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},e.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},e.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},e.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},e.prototype.open=e.prototype.connect=function(o){if(t("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;t("opening %s",this.uri),this.engine=c(this.uri,this.opts);var n,a,i=this.engine,e=this,r=(this.readyState="opening",this.skipReconnect=!1,s(i,"open",function(){e.onopen(),o&&o()})),l=s(i,"error",function(n){var s;t("connect_error"),e.cleanup(),e.readyState="closed",e.emitAll("connect_error",n),o?((s=new Error("Connection error")).data=n,o(s)):e.maybeReconnectOnOpen()});return!1!==this._timeout&&(n=this._timeout,t("connect attempt will timeout after %d",n),a=setTimeout(function(){t("connect attempt timed out after %d",n),r.destroy(),i.close(),i.emit("error","timeout"),e.emitAll("connect_timeout",n)},n),this.subs.push({destroy:function(){clearTimeout(a)}})),this.subs.push(r),this.subs.push(l),this},e.prototype.onopen=function(){t("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(s(e,"data",o(this,"ondata"))),this.subs.push(s(e,"ping",o(this,"onping"))),this.subs.push(s(e,"pong",o(this,"onpong"))),this.subs.push(s(e,"error",o(this,"onerror"))),this.subs.push(s(e,"close",o(this,"onclose"))),this.subs.push(s(this.decoder,"decoded",o(this,"ondecoded")))},e.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},e.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},e.prototype.ondata=function(e){this.decoder.add(e)},e.prototype.ondecoded=function(e){this.emit("packet",e)},e.prototype.onerror=function(e){t("error",e),this.emitAll("error",e)},e.prototype.socket=function(t,o){var n,e=this.nsps[t];function s(){~i(n.connecting,e)||n.connecting.push(e)}return e||(e=new l(this,t,o),this.nsps[t]=e,n=this,e.on("connecting",s),e.on("connect",function(){e.id=n.generateId(t)}),this.autoConnect&&s()),e},e.prototype.destroy=function(e){e=i(this.connecting,e),~e&&this.connecting.splice(e,1),this.connecting.length||this.close()},e.prototype.packet=function(e){t("writing packet %j",e);var n=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),n.encoding?n.packetBuffer.push(e):(n.encoding=!0,this.encoder.encode(e,function(s){for(var t=0;t<s.length;t++)n.engine.write(s[t],e.options);n.encoding=!1,n.processPacketQueue()}))},e.prototype.processPacketQueue=function(){var e;0<this.packetBuffer.length&&!this.encoding&&(e=this.packetBuffer.shift(),this.packet(e))},e.prototype.cleanup=function(){t("cleanup");for(var n=this.subs.length,e=0;e<n;e++)this.subs.shift().destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},e.prototype.close=e.prototype.disconnect=function(){t("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},e.prototype.onclose=function(e){t("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},e.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var n,s,e=this;this.backoff.attempts>=this._reconnectionAttempts?(t("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1):(n=this.backoff.duration(),t("will wait %dms before reconnect attempt",n),this.reconnecting=!0,s=setTimeout(function(){e.skipReconnect||(t("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open(function(n){n?(t("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",n.data)):(t("reconnect success"),e.onreconnect())}))},n),this.subs.push({destroy:function(){clearTimeout(s)}}))},e.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},function(i,t,e){var n=e(106),s=e(381),o=e(390),e=e(391);t.polling=function(e){var t,i,a=!1,r=!1,c=!1!==e.jsonp;if("undefined"!=typeof location&&(t="https:"===location.protocol,i=(i=location.port)||(t?443:80),a=e.hostname!==location.hostname||i!==e.port,r=e.secure!==t),e.xdomain=a,e.xscheme=r,"open"in new n(e)&&!e.forceJSONP)return new s(e);if(c)return new o(e);throw new Error("JSONP disabled")},t.websocket=e},function(i,d,n){var s=n(107),l=n(75),o=n(51),r=n(76),a=n(152),e=n(77)("engine.io-client:polling"),c=(i.exports=t,null!=new(n(106))({xdomain:!1}).responseType);function t(e){var t=e&&e.forceBase64;c&&!t||(this.supportsBinary=!1),s.call(this,e)}r(t,s),t.prototype.name="polling",t.prototype.doOpen=function(){this.poll()},t.prototype.pause=function(s){var t,o=this;function n(){e("paused"),o.readyState="paused",s()}this.readyState="pausing",this.polling||!this.writable?(t=0,this.polling&&(e("we are currently polling - waiting to pause"),t++,this.once("pollComplete",function(){e("pre-pause polling complete"),--t||n()})),this.writable||(e("we are currently writing - waiting to pause"),t++,this.once("drain",function(){e("pre-pause writing complete"),--t||n()}))):n()},t.prototype.poll=function(){e("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},t.prototype.onData=function(n){var t=this;e("polling got data %s",n),o.decodePayload(n,this.socket.binaryType,function(e){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():e('ignoring poll - transport state "%s"',this.readyState))},t.prototype.doClose=function(){var n=this;function t(){e("writing close packet"),n.write([{type:"close"}])}"open"===this.readyState?(e("transport open - closing"),t()):(e("transport not open - deferring close"),this.once("open",t))},t.prototype.write=function(t){function n(){e.writable=!0,e.emit("drain")}var e=this;this.writable=!1,o.encodePayload(t,this.supportsBinary,function(t){e.doWrite(t,n)})},t.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=a()),this.supportsBinary||e.sid||(e.b64=1),e=l.encode(e),this.port&&("https"==t&&443!==Number(this.port)||"http"==t&&80!==Number(this.port))&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e}},function(e,n,t){!function(t){var n=Object.prototype.toString,s="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===n.call(Blob),o="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===n.call(File);e.exports=function n(e){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(var a,i=0,r=e.length;i<r;i++)if(n(e[i]))return!0;return!1}if("function"==typeof t&&t.isBuffer&&t.isBuffer(e)||"function"==typeof ArrayBuffer&&e instanceof ArrayBuffer||s&&e instanceof Blob||o&&e instanceof File)return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return n(e.toJSON(),!0);for(a in e)if(Object.prototype.hasOwnProperty.call(e,a)&&n(e[a]))return!0;return!1}}.call(this,t(73).Buffer)},function(c){"use strict";var a,r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),t=64,o={},i=0,e=0;function n(e){for(var n="";n=r[e%t]+n,0<(e=Math.floor(e/t)););return n}function s(){var e=n(+new Date);return e!==a?(i=0,a=e):e+"."+n(i++)}for(;e<t;e++)o[r[e]]=e;s.encode=n,s.decode=function(s){var n=0;for(e=0;e<s.length;e++)n=n*t+o[s.charAt(e)];return n},c.exports=s},function(e){var t=[].indexOf;e.exports=function(n,s){if(t)return n.indexOf(s);for(var e=0;e<n.length;++e)if(n[e]===s)return e;return-1}},function(h,m,s){var t=s(105),c=s(50),i=s(393),a=s(155),r=s(156),n=s(74)("socket.io-client:socket"),d=s(75),l=s(151),u=(h.exports=e,{connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1}),o=c.prototype.emit;function e(t,n,e){this.io=t,this.nsp=n,(this.json=this).ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},e&&e.query&&(this.query=e.query),this.io.autoConnect&&this.open()}c(e.prototype),e.prototype.subEvents=function(){var e;this.subs||(e=this.io,this.subs=[a(e,"open",r(this,"onopen")),a(e,"packet",r(this,"onpacket")),a(e,"close",r(this,"onclose"))])},e.prototype.open=e.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting")),this},e.prototype.send=function(){var e=i(arguments);return e.unshift("message"),this.emit.apply(this,e),this},e.prototype.emit=function(a){if(u.hasOwnProperty(a))return o.apply(this,arguments),this;var e=i(arguments),s={type:(void 0!==this.flags.binary?this.flags.binary:l(e))?t.BINARY_EVENT:t.EVENT,data:e,options:{}};return s.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof e[e.length-1]&&(n("emitting packet with ack id %d",this.ids),this.acks[this.ids]=e.pop(),s.id=this.ids++),this.connected?this.packet(s):this.sendBuffer.push(s),this.flags={},this},e.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},e.prototype.onopen=function(){var e;n("transport is open - connecting"),"/"!==this.nsp&&(this.query?(e="object"==typeof this.query?d.encode(this.query):this.query,n("sending connect packet with query %s",e),this.packet({type:t.CONNECT,query:e})):this.packet({type:t.CONNECT}))},e.prototype.onclose=function(e){n("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},e.prototype.onpacket=function(e){var n=e.nsp===this.nsp,s=e.type===t.ERROR&&"/"===e.nsp;if(n||s)switch(e.type){case t.CONNECT:this.onconnect();break;case t.EVENT:case t.BINARY_EVENT:this.onevent(e);break;case t.ACK:case t.BINARY_ACK:this.onack(e);break;case t.DISCONNECT:this.ondisconnect();break;case t.ERROR:this.emit("error",e.data)}},e.prototype.onevent=function(t){var e=t.data||[];n("emitting event %j",e),null!=t.id&&(n("attaching ack callback to event"),e.push(this.ack(t.id))),this.connected?o.apply(this,e):this.receiveBuffer.push(e)},e.prototype.ack=function(s){var o=this,e=!1;return function(){var a;e||(e=!0,a=i(arguments),n("sending ack %j",a),o.packet({type:l(a)?t.BINARY_ACK:t.ACK,id:s,data:a}))}},e.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(n("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):n("bad ack %s",e.id)},e.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},e.prototype.emitBuffered=function(){for(var e=0;e<this.receiveBuffer.length;e++)o.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},e.prototype.ondisconnect=function(){n("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},e.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},e.prototype.close=e.prototype.disconnect=function(){return this.connected&&(n("performing disconnect (%s)",this.nsp),this.packet({type:t.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},e.prototype.compress=function(e){return this.flags.compress=e,this},e.prototype.binary=function(e){return this.flags.binary=e,this}},function(e){e.exports=function(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}}},function(t){var e=[].slice;t.exports=function(n,t){if("function"!=typeof(t="string"==typeof t?n[t]:t))throw new Error("bind() requires a function");var s=e.call(arguments,2);return function(){return t.apply(n,s.concat(e.call(arguments)))}}},function(e,n){var t;!function(){"use strict";var o={}.hasOwnProperty;function s(){for(var e,n,i,t=[],a=0;a<arguments.length;a++)if(e=arguments[a],e)if(n=typeof e,"string"==n||"number"==n)t.push(this&&this[e]||e);else if(Array.isArray(e))t.push(s.apply(this,e));else if("object"==n)for(i in e)o.call(e,i)&&e[i]&&t.push(this&&this[i]||i);return t.join(" ")}e.exports?e.exports=s.default=s:void 0!==(t=function(){return s}.apply(n,[]))&&(e.exports=t)}()},function(e){e.exports={"ejs-wrapper":"ejs--de6433374cb30211f10e148b320b2f",ejs:"ejs--7a5f920ceffb2913f6dbda780573cf","ejs--full-ui":"ejs--f3a002bba9836fe4ebfed357a45521","controls-tabs":"ejs--008adea3c1ef33a8fc94892a1e97e6",overlay:"ejs--85a95eb6bf74a40ab61b91a91e5bff","key-setting-popup":"ejs--d169a219343bc32dd4aecc3f6b7f25","loading-info":"ejs--782e3572812f983b3a150eec177391",p1:"ejs--c426dd1d179aa351e6cec47e1d9438",p2:"ejs--31e7e81db48819ee35ec6f50378a2e",p3:"ejs--20d4eb2646d396f558a645dc0574f1",p4:"ejs--4de05306c8b099bdeb4585571ac095",ejs__contextmenu:"ejs--c7957d8666bb6b8fc7c3e9c021aaf8",ad:"ejs--cbcfe0a1421cadac9a04c81d6431d6","close-ad":"ejs--f3a1903d935f6cf720d4a0498db62a","start-game":"ejs--73f9b4e94a7a1fe74e11107d5ab2ef",pulse:"ejs--9bd947b3e6427453595f083d740a7c",ejs__control:"ejs--8732295ca5c4902a060d34706a8146","ejs__tab-focus":"ejs--a83b6c705e103e81a7762d0ed5e64b","ejs__control--pressed":"ejs--b1238136ec472a92297159882cf4b8","icon--pressed":"ejs--ec731619062226d943da67f5d83009","icon--not-pressed":"ejs--dc7068585e3d84fe0e676864c1439e","label--pressed":"ejs--0c6561f9155750b0aeeed6da5da7bf","label--not-pressed":"ejs--13d64e30c1333cc99391af48ddabaa","ejs--video":"ejs--d5f430a99a1619b3434bf58e34a99c",ejs__controls:"ejs--1acedc5ed6816abe96dd27d910fd74",ejs__progress:"ejs--f1aa376719b564cae0e653157cde14",ejs__time:"ejs--90d2780f99bcc76fdb6b0378a7238e",ejs__menu:"ejs--c7bfb2d1b75a40fdaaf90624bea9e7",ejs__volume:"ejs--36ceeeec0df37a9cf4bbe05fa204ec","ejs--hide-controls":"ejs--1b8cb7f2294b1eb5de5238daea3513","ejs--fullscreen-enabled":"ejs--19409fe2057ab935a7e46abb5b4f49",ejs__tooltip:"ejs--74c6d4176d27e37a19d2e9e61de8f4",ejs__menu__container:"ejs--013213afedeeb6878089b1ca1b4e47","ejs-popup":"ejs--c2532bfe04554193cc42b3be753700","ejs__control--forward":"ejs--0b4cdb4057d1a4623e60836ccc6275","ejs__control--back":"ejs--a7ad9de0cb0ca672b6703c50de7db9",ejs__menu__value:"ejs--f91e90fe7cabc875aff9a431bf5389","ejs__tooltip--visible":"ejs--6ea27aa07e60d1d6e4c9782740028a","ejs--menu-open":"ejs--da54136ccf8c6b0b16d98e8b8e8b88","ejs__video-wrapper":"ejs--057800d021995e1347ec07cb748672",portrait:"ejs--64f1256f556fb94454b930cb3ea7f2","game-started":"ejs--7da7949f602347007818e6d192eb23",ejs__progress__buffer:"ejs--f8d706413436fd119cf01aaf5a9d9d","ejs--audio":"ejs--bd0222e58d71b0a304d6037dfcffd5","ejs--loading":"ejs--2521e1257996f264de36e77cc9c5ee",ejs__dialogs:"ejs--d31688f864f56d6426ebbf2217d6ee",ejs__dialog:"ejs--5e71fd80268afbb1d588e40b993508",ejs__cache__container:"ejs--1e0f0672f67d0e96592314c9ed78b0",ejs__loading__container:"ejs--d7e6a6a8f38bfaa256fe5d709a8258","ejs__load-state__container":"ejs--b183f581b5336c4908ad258d3e1cc7",ejs__screenRecord__container:"ejs--b183f581b5336cashrqd258d3e1cc7",ejs__netplay__container:"ejs--158ea9dd34e3e7af2d837f8b05babb",ejs__gamepad__container:"ejs--3f0897a8158ba363a0ee0afe4da7c5","dialog-container":"ejs--38cc09882a55e98c76168dbe838aa0","dialog-title":"ejs--b373c9d5029d49324fb8ac3ece96c1","dialog-content":"ejs--a5e2629abb9a5bcbc8b2c1307922d2","dialog-buttons":"ejs--580e3c22e63f8a1eb29694fd0b141b","btn-cancel":"ejs--ad20569e1449d7b8e99e6465960456","btn-reset":"ejs--ad20569e1449d7b8e99e6465963825","btn-clear":"ejs--ad20569e1449d7b8e99e6468571053",tabs:"ejs--8e7922427f460a31935084b7acfb1a",active:"ejs--68d337c212ec6a5bc43125440d422b","tabs-content":"ejs--31eb28817642bb1bfe0a2c422108bb","tabs-panel":"ejs--f932566a0af5314da834324c901978","button-container":"ejs--c233fb69cbef43078bc39e9d1efac8","btn-submit":"ejs--bdb54e9fc47f9805b506b746e897bf","btn-create-room":"ejs--67d03ee7480b871ad6507d6319a839","btn-quit":"ejs--c2d931157456c1d438d40a2f66af2c",set:"ejs--6604c83041a275a78837c452a71dd8","btn-join-room":"ejs--99150e15f962c63c689cadc81ef40d","netplay-player-name":"ejs--71527b6509aa48afce3ce1a11c02f0","netplay-player-name-input":"ejs--7ad35768e3f6b9faf97db01d5b60ae","netplay-player-name-set":"ejs--9c403e5e107a3e4374ba244b636400","netplay-roomlist":"ejs--d6a46533fa6e510a571af5c28b440a","netplay-create-room":"ejs--57ca9b3853cc7de731483cfcc95a59","netplay-room-name-input":"ejs--0885d5e25e19127b6b516014426a1b","netplay-room-password-input":"ejs--25023d28756fdb9dfbbfb6dccb8677","netplay-create-room-set":"ejs--75b3a8d35aacc6424ed7422fdeaaaa","netplay-room":"ejs--eefdf28d69ed2d20f197308981bb61","cheats-add":"ejs--9e670880bb57e824400fa00f09aaad","cheats-list":"ejs--2b4e3c245b7b25dfdac5e09155a68e","cheat-code-input":"ejs--572b0b3a0345a6b01b01a15a02842c","cheat-name-input":"ejs--a7d7f80c8999469c991ea452a85dd9",ejs__widgets:"ejs--952c974392296e7f643d51db380157",ejs__widget:"ejs--0d7e216cf12ae73705b5d5bb0452fc",ejs__widget_controls_toggle:"ejs--666d4296310579687cf3cf3d2cf951",ejs__widget_netplay:"ejs--c0a5e71f6613caab66d6ae15a5a00f","virtual-gamepad":"ejs--2440e3b831017ff8327c939e2a4413",top:"ejs--b8d8b771d0bbb94e2bbd03054f53fd",left:"ejs--c83d70cb63c933edc073c7fe92e32b",buttons:"ejs--6e7015634623fd6a82e6a7d3488c84",center:"ejs--49fa47c86a131e4ca8fb268bfdde89",right:"ejs--7d2b19f77fd0ccabf94dc1ca39ae18",touch:"ejs--d708d9d486f1eca73a593d5c09f8ad",modal:"ejs--eefec939452eb92fad035932d0f47c",modal__overlay:"ejs--f1f43b27384834c8c22c6f81d0c5ae",modal__container:"ejs--c4ee33766a01ed0356c3ec07898e96",modal__header:"ejs--a073f32023da1ced805c5f95a4e81c",modal__footer:"ejs--ed44f59bb8cd49177586b140658c6c",modal__title:"ejs--81470ba5e6a6d68014839ad4d9a977",modal__close:"ejs--c3c85789c2a7f56d8b26dba75b7e1f",modal__content:"ejs--db44f5520e6f4fd0dd34b478bb9ee8",modal__btn:"ejs--319bcec5dee9444e1a2a53d6503b7c","modal__btn-primary":"ejs--eaf3c1cba25d415d92ac48d7db34dd",modal__errmsg:"ejs--940087708c06b6129ce2bfa45f1d89","micromodal-slide":"ejs--bef295f3125e9ba83d4f3677264bae","is-open":"ejs--60c17e0d149099f207b06f27edae6a",mmfadeIn:"ejs--9d7aa2bd5ee276be085e5b2a0bbc2e",mmslideIn:"ejs--8b069266f76099cc6bc220f6ea56cc",mmfadeOut:"ejs--184b7558ffeb569c1790654537477b",mmslideOut:"ejs--379a464ad0e66ea5fc601e5f2fd73e","ejs-switch":"ejs--4c3e63d4005bd8a0468e9c74a35f62","ejs-delete-cheat":"ejs--90bcdd71cd0d2307e9ee0dffa916da","icon--exit-fullscreen":"ejs--2b3dd6e2e26c0f0dc4ac5779dedd5e","ejs--fullscreen-fallback":"ejs--412041671de21945d3e028b6ae84c9","ejs--no-transition":"ejs--33643265135cf89e6c0a0d9866d6f1","ejs__sr-only":"ejs--6f0e996cd15e5fb6be0256918531d7","ejs-fade-in":"ejs--7cadf43f3d9eb17c7e3c36de84973b"}},function(n,t){var e;function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e=function(){function o(){}function n(t,e){return this.identifier=e.identifier,this.position=e.position,this.frontPosition=e.frontPosition,this.collection=t,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1},this.config(e),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=n.id,n.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}function t(n,s){var e=this;return e.nipples=[],e.idles=[],e.actives=[],e.ids=[],e.pressureIntervals={},e.manager=n,e.id=t.id,t.id+=1,e.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1},e.config(s),"static"!==e.options.mode&&"semi"!==e.options.mode||(e.options.multitouch=!1),e.options.multitouch||(e.options.maxNumberOfNipples=1),e.updateBox(),e.prepareNipples(),e.bindings(),e.begin(),e.nipples}function s(s){var n,t=this;return t.ids={},t.index=0,t.collections=[],t.config(s),t.prepareCollections(),e.bindEvt(window,"resize",function(){clearTimeout(n),n=setTimeout(function(){var n,s=e.getScroll();t.collections.forEach(function(e){e.forEach(function(e){n=e.el.getBoundingClientRect(),e.position={x:s.x+n.left,y:s.y+n.top}})})},100)}),t.collections}var i,u=!!("ontouchstart"in window),l=!!window.PointerEvent,d=!!window.MSPointerEvent,c={start:"mousedown",move:"mousemove",end:"mouseup"},a={},e=(l?i={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:d?i={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:u?(i={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},a=c):i=c,{distance:function(t,e){var n=e.x-t.x,e=e.y-t.y;return Math.sqrt(n*n+e*e)},angle:function(n,t){var s=t.x-n.x,t=t.y-n.y;return e.degrees(Math.atan2(t,s))},findCoord:function(s,o,t){var n={x:0,y:0};return t=e.radians(t),n.x=s.x-o*Math.cos(t),n.y=s.y-o*Math.sin(t),n},radians:function(e){return e*(Math.PI/180)},degrees:function(e){return e*(180/Math.PI)},bindEvt:function(e,i,s){for(var t,o=i.split(/[ ,]+/g),n=0;n<o.length;n+=1)t=o[n],e.addEventListener?e.addEventListener(t,s,!1):e.attachEvent&&e.attachEvent(t,s)},unbindEvt:function(e,i,s){for(var t,o=i.split(/[ ,]+/g),n=0;n<o.length;n+=1)t=o[n],e.removeEventListener?e.removeEventListener(t,s):e.detachEvent&&e.detachEvent(t,s)},trigger:function(t,e,n){e=new CustomEvent(e,n),t.dispatchEvent(e)},prepareEvent:function(e){return e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e},getScroll:function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},applyPosition:function(t,e){e.top||e.right||e.bottom||e.left?(t.style.top=e.top,t.style.right=e.right,t.style.bottom=e.bottom,t.style.left=e.left):(t.style.left=e.x+"px",t.style.top=e.y+"px")},getTransitionStyle:function(r,n,i){t=e.configStylePropertyObject(r);for(s in t)if(t.hasOwnProperty(s))if("string"==typeof n)t[s]=n+" "+i;else{for(var t,s,a="",o=0,c=n.length;o<c;o+=1)a+=n[o]+" "+i+", ";t[s]=a.slice(0,-2)}return t},getVendorStyle:function(s,o){var n,t=e.configStylePropertyObject(s);for(n in t)t.hasOwnProperty(n)&&(t[n]=o);return t},configStylePropertyObject:function(e){var t={};return t[e]="",["webkit","Moz","o"].forEach(function(n){t[n+e.charAt(0).toUpperCase()+e.slice(1)]=""}),t},extend:function(n,e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n},safeExtend:function(t,s){var e,n={};for(e in t)t.hasOwnProperty(e)&&s.hasOwnProperty(e)?n[e]=s[e]:t.hasOwnProperty(e)&&(n[e]=t[e]);return n},map:function(e,n){if(e.length)for(var t=0,s=e.length;t<s;t+=1)n(e[t]);else n(e)}}),r=(o.prototype.on=function(o,i){var t,n,e=this,s=o.split(/[ ,]+/g);e._handlers_=e._handlers_||{};for(n=0;n<s.length;n+=1)t=s[n],e._handlers_[t]=e._handlers_[t]||[],e._handlers_[t].push(i);return e},o.prototype.off=function(t,n){var e=this;return e._handlers_=e._handlers_||{},void 0===t?e._handlers_={}:void 0===n?e._handlers_[t]=null:e._handlers_[t]&&0<=e._handlers_[t].indexOf(n)&&e._handlers_[t].splice(e._handlers_[t].indexOf(n),1),e},o.prototype.trigger=function(o,i){var t,n,e=this,s=o.split(/[ ,]+/g);e._handlers_=e._handlers_||{};for(n=0;n<s.length;n+=1)t=s[n],e._handlers_[t]&&e._handlers_[t].length&&e._handlers_[t].forEach(function(n){n.call(e,{type:t,target:e},i)})},o.prototype.config=function(t){this.options=this.defaults||{},t&&(this.options=e.safeExtend(this.options,t))},o.prototype.bindEvt=function(s,t){var n=this;return n._domHandlers_=n._domHandlers_||{},n._domHandlers_[t]=function(){"function"==typeof n["on"+t]?n["on"+t].apply(n,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},e.bindEvt(s,i[t],n._domHandlers_[t]),a[t]&&e.bindEvt(s,a[t],n._domHandlers_[t]),n},o.prototype.unbindEvt=function(s,t){var n=this;return n._domHandlers_=n._domHandlers_||{},e.unbindEvt(s,i[t],n._domHandlers_[t]),a[t]&&e.unbindEvt(s,a[t],n._domHandlers_[t]),delete n._domHandlers_[t],this},n.prototype=new o,(n.constructor=n).id=0,n.prototype.buildEl=function(){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},n.prototype.stylize=function(){if(this.options.dataOnly)return this;var n=this.options.fadeTime+"ms",s=e.getVendorStyle("borderRadius","50%"),n=e.getTransitionStyle("transition","opacity",n),t={};return t.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},t.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},t.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5"},e.extend(t.el,n),e.extend(t.back,s),e.extend(t.front,s),this.applyStyles(t),this},n.prototype.applyStyles=function(t){for(var e in this.ui)if(this.ui.hasOwnProperty(e))for(var n in t[e])this.ui[e].style[n]=t[e][n];return this},n.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},n.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},n.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},n.prototype.show=function(t){var e=this;return e.options.dataOnly||(clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.addToDom(),e.restCallback(),setTimeout(function(){e.ui.el.style.opacity=1},0),e.showTimeout=setTimeout(function(){e.trigger("shown",e.instance),"function"==typeof t&&t.call(this)},e.options.fadeTime)),e},n.prototype.hide=function(t){var e=this;return e.options.dataOnly||(e.ui.el.style.opacity=e.options.restOpacity,clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.removeTimeout=setTimeout(function(){var n="dynamic"===e.options.mode?"none":"block";e.ui.el.style.display=n,"function"==typeof t&&t.call(e),e.trigger("hidden",e.instance)},e.options.fadeTime),e.options.restJoystick&&e.restPosition()),e},n.prototype.restPosition=function(s){var t=this,n=(t.frontPosition={x:0,y:0},t.options.fadeTime+"ms"),o={},n=(o.front=e.getTransitionStyle("transition",["top","left"],n),{front:{}});n.front={left:t.frontPosition.x+"px",top:t.frontPosition.y+"px"},t.applyStyles(o),t.applyStyles(n),t.restTimeout=setTimeout(function(){"function"==typeof s&&s.call(t),t.restCallback()},t.options.fadeTime)},n.prototype.restCallback=function(){var t={};t.front=e.getTransitionStyle("transition","none",""),this.applyStyles(t),this.trigger("rested",this.instance)},n.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},n.prototype.computeDirection=function(e){var t,s,o,a,r,c,n=e.angle.radian,i=Math.PI/4,l=Math.PI/2;if(i<n&&n<3*i&&!e.lockX?o="up":-i<n&&n<=i&&!e.lockY?o="left":3*-i<n&&n<=-i&&!e.lockX?o="down":e.lockY||(o="right"),e.lockY||(r=-l<n&&n<l?"left":"right"),e.lockX||(c=0<n?"up":"down"),e.force>this.options.threshold){a={};for(s in this.direction)this.direction.hasOwnProperty(s)&&(a[s]=this.direction[s]);t={};for(s in this.direction={x:r,y:c,angle:o},e.direction=this.direction,a)a[s]===this.direction[s]&&(t[s]=!0);if(t.x&&t.y&&t.angle)return e;t.x&&t.y||this.trigger("plain",e),t.x||this.trigger("plain:"+r,e),t.y||this.trigger("plain:"+c,e),t.angle||this.trigger("dir dir:"+o,e)}return e},t.prototype=new o,(t.constructor=t).id=0,t.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(n){if(void 0===n)return t[0];for(var e=0,s=t.length;e<s;e+=1)if(t[e].identifier===n)return t[e];return!1}},t.prototype.bindings=function(){this.bindEvt(this.options.zone,"start"),this.options.zone.style.touchAction="none",this.options.zone.style.msTouchAction="none"},t.prototype.begin=function(){var e=this.options;"static"===e.mode&&((e=this.createNipple(e.position,this.manager.getIdentifier())).add(),this.idles.push(e))},t.prototype.createNipple=function(s,l){var r,i=this,a=e.getScroll(),c={},o=i.options,t=(s.x&&s.y?c={x:s.x-(a.x+i.box.left),y:s.y-(a.y+i.box.top)}:(s.top||s.right||s.bottom||s.left)&&((t=document.createElement("DIV")).style.display="hidden",t.style.top=s.top,t.style.right=s.right,t.style.bottom=s.bottom,t.style.left=s.left,t.style.position="absolute",o.zone.appendChild(t),r=t.getBoundingClientRect(),o.zone.removeChild(t),c=s,s={x:r.left+a.x,y:r.top+a.y}),new n(i,{color:o.color,size:o.size,threshold:o.threshold,fadeTime:o.fadeTime,dataOnly:o.dataOnly,restJoystick:o.restJoystick,restOpacity:o.restOpacity,mode:o.mode,identifier:l,position:s,zone:o.zone,frontPosition:{x:0,y:0}}));return o.dataOnly||(e.applyPosition(t.ui.el,c),e.applyPosition(t.ui.front,t.frontPosition)),i.nipples.push(t),i.trigger("added "+t.identifier+":added",t),i.manager.trigger("added "+t.identifier+":added",t),i.bindNipple(t),t},t.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},t.prototype.bindNipple=function(e){function t(e,t){s=e.type+" "+t.id+":"+e.type,n.trigger(s,t)}var s,n=this;e.on("destroyed",n.onDestroyed.bind(n)),e.on("shown hidden rested dir plain",t),e.on("dir:up dir:right dir:down dir:left",t),e.on("plain:up plain:right plain:down plain:left",t)},t.prototype.pressureFn=function(t,n,s){var e=this,o=0;clearInterval(e.pressureIntervals[s]),e.pressureIntervals[s]=setInterval(function(){var s=t.force||t.pressure||t.webkitForce||0;s!==o&&(n.trigger("pressure",s),e.trigger("pressure "+n.identifier+":pressure",s),o=s)}.bind(e),100)},t.prototype.onstart=function(n){var t=this,s=t.options;return n=e.prepareEvent(n),t.updateBox(),e.map(n,function(e){t.actives.length<s.maxNumberOfNipples&&t.processOnStart(e)}),t.manager.bindDocument(),!1},t.prototype.processOnStart=function(s){function r(e){e.trigger("start",e),t.trigger("start "+e.id+":start",e),e.show(),0<c&&t.pressureFn(s,e,e.identifier),t.processOnMove(s)}var t=this,i=t.options,o=t.manager.getIdentifier(s),c=s.force||s.pressure||s.webkitForce||0,a={x:s.pageX,y:s.pageY},n=t.getOrCreate(o,a);if(n.identifier!==o&&t.manager.removeIdentifier(n.identifier),n.identifier=o,0<=(o=t.idles.indexOf(n))&&t.idles.splice(o,1),t.actives.push(n),t.ids.push(n.identifier),"semi"!==i.mode)r(n);else{if(!(e.distance(a,n.position)<=i.catchDistance))return n.destroy(),void t.processOnStart(s);r(n)}return n},t.prototype.getOrCreate=function(t,n){var s,e=this,o=e.options;return/(semi|static)/.test(o.mode)?(s=e.idles[0])?(e.idles.splice(0,1),s):"semi"===o.mode?e.createNipple(n,t):(console.warn("Coudln't find the needed nipple."),!1):e.createNipple(n,t)},t.prototype.processOnMove=function(s){var i=this,a=i.options,t=i.manager.getIdentifier(s),n=i.nipples.get(t);if(!n)return console.error("Found zombie joystick with ID "+t),void i.manager.removeIdentifier(t);n.identifier=t;var t=n.options.size/2,o={x:s.pageX,y:s.pageY},c=e.distance(o,n.position),r=e.angle(o,n.position),d=e.radians(r),u=c/t,t=(o=t<c?e.findCoord(n.position,c=t,r):o).x-n.position.x,l=o.y-n.position.y,t=(a.lockX&&(l=0),a.lockY&&(t=0),n.frontPosition={x:t,y:l},a.dataOnly||e.applyPosition(n.ui.front,n.frontPosition),{identifier:n.identifier,position:o,force:u,pressure:s.force||s.pressure||s.webkitForce||0,distance:c,angle:{radian:d,degree:r},instance:n,lockX:a.lockX,lockY:a.lockY});(t=n.computeDirection(t)).angle={radian:e.radians(180-r),degree:180-r},n.trigger("move",t),i.trigger("move "+n.id+":move",t)},t.prototype.processOnEnd=function(n){var t=this,s=t.options,n=t.manager.getIdentifier(n),e=t.nipples.get(n),n=t.manager.removeIdentifier(e.identifier);e&&(s.dataOnly||e.hide(function(){"dynamic"===s.mode&&(e.trigger("removed",e),t.trigger("removed "+e.id+":removed",e),t.manager.trigger("removed "+e.id+":removed",e),e.destroy())}),clearInterval(t.pressureIntervals[e.identifier]),e.resetDirection(),e.trigger("end",e),t.trigger("end "+e.id+":end",e),0<=t.ids.indexOf(e.identifier)&&t.ids.splice(t.ids.indexOf(e.identifier),1),0<=t.actives.indexOf(e)&&t.actives.splice(t.actives.indexOf(e),1),/(semi|static)/.test(s.mode)?t.idles.push(e):0<=t.nipples.indexOf(e)&&t.nipples.splice(t.nipples.indexOf(e),1),t.manager.unbindDocument(),/(semi|static)/.test(s.mode)&&(t.manager.ids[n.id]=n.identifier))},t.prototype.onDestroyed=function(n,t){var e=this;0<=e.nipples.indexOf(t)&&e.nipples.splice(e.nipples.indexOf(t),1),0<=e.actives.indexOf(t)&&e.actives.splice(e.actives.indexOf(t),1),0<=e.idles.indexOf(t)&&e.idles.splice(e.idles.indexOf(t),1),0<=e.ids.indexOf(t.identifier)&&e.ids.splice(e.ids.indexOf(t.identifier),1),e.manager.removeIdentifier(t.identifier),e.manager.unbindDocument()},t.prototype.destroy=function(){var t,e=this;for(t in e.unbindEvt(e.options.zone,"start"),e.nipples.forEach(function(e){e.destroy()}),e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()},s.prototype=new o,(s.constructor=s).prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(n){var t;return e.collections.every(function(e){return!(t=e.get(n))}),t}},s.prototype.create=function(e){return this.createCollection(e)},s.prototype.createCollection=function(e){return e=new t(this,e),this.bindCollection(e),this.collections.push(e),e},s.prototype.bindCollection=function(e){function t(e,t){s=e.type+" "+t.id+":"+e.type,n.trigger(s,t)}var s,n=this;e.on("destroyed",n.onDestroyed.bind(n)),e.on("shown hidden rested dir plain",t),e.on("dir:up dir:right dir:down dir:left",t),e.on("plain:up plain:right plain:down plain:left",t)},s.prototype.bindDocument=function(){this.binded||(this.bindEvt(document,"move").bindEvt(document,"end"),this.binded=!0)},s.prototype.unbindDocument=function(e){Object.keys(this.ids).length&&!0!==e||(this.unbindEvt(document,"move").unbindEvt(document,"end"),this.binded=!1)},s.prototype.getIdentifier=function(t){var e;return t?void 0===(e=void 0===t.identifier?t.pointerId:t.identifier)&&(e=this.latest||0):e=this.index,void 0===this.ids[e]&&(this.ids[e]=this.index,this.index+=1),this.latest=e,this.ids[e]},s.prototype.removeIdentifier=function(n){var e,t={};for(e in this.ids)if(this.ids[e]===n){t.id=e,t.identifier=this.ids[e],delete this.ids[e];break}return t},s.prototype.onmove=function(e){return this.onAny("move",e),!1},s.prototype.onend=function(e){return this.onAny("end",e),!1},s.prototype.oncancel=function(e){return this.onAny("end",e),!1},s.prototype.onAny=function(o,t){var n,s=this,i="processOn"+o.charAt(0).toUpperCase()+o.slice(1);return t=e.prepareEvent(t),e.map(t,function(t){n=s.getIdentifier(t),e.map(s.collections,function(e,n,t){0<=t.ids.indexOf(n)&&(t[i](e),e._found_=!0)}.bind(null,t,n)),t._found_||s.removeIdentifier(n)}),!1},s.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach(function(e){e.destroy()}),e.off()},s.prototype.onDestroyed=function(t,e){if(this.collections.indexOf(e)<0)return!1;this.collections.splice(this.collections.indexOf(e),1)},new s);return{create:function(e){return r.create(e)},factory:r}},"object"==s(t)&&void 0!==n?n.exports=e():void 0!==(t="function"==typeof(e=e)?e.apply(t,[]):e)&&(n.exports=t)},function(t,n,e){!function(s,i,n){var o;function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(){"use strict";function b(e){return function(t){return new c(!0).update(t)[e]()}}function w(n){var e=require("crypto"),t=require("buffer").Buffer;return function(s){if("string"==typeof s)return e.createHash("md5").update(s,"utf8").digest("hex");if(null==s)throw p;return s.constructor===ArrayBuffer&&(s=new Uint8Array(s)),Array.isArray(s)||ArrayBuffer.isView(s)||s.constructor===t?e.createHash("md5").update(new t(s)).digest("hex"):n(s)}}var f,g,y,p="input is invalid type",u="object"===("undefined"==typeof window?"undefined":t(window)),l=u?window:{},u=!(u=!l.JS_MD5_NO_WINDOW&&u)&&"object"===("undefined"==typeof self?"undefined":t(self)),v=!l.JS_MD5_NO_NODE_JS&&"object"===(void 0===s?"undefined":t(s))&&s.versions&&s.versions.node,u=(v?l=i:u&&(l=self),!l.JS_MD5_NO_COMMON_JS&&"object"===t(n)&&n.exports),_=e(144),h=!l.JS_MD5_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,a="0123456789abcdef".split(""),O=[128,32768,8388608,-2147483648],d=[0,8,16,24],j=["hex","array","digest","buffer","arrayBuffer","base64"],m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),r=[];h&&(g=new ArrayBuffer(68),y=new Uint8Array(g),r=new Uint32Array(g)),!l.JS_MD5_NO_NODE_JS&&Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),!h||!l.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return"object"===t(e)&&e.buffer&&e.buffer.constructor===ArrayBuffer});function c(e){e?(r[0]=r[16]=r[1]=r[2]=r[3]=r[4]=r[5]=r[6]=r[7]=r[8]=r[9]=r[10]=r[11]=r[12]=r[13]=r[14]=r[15]=0,this.blocks=r,this.buffer8=y):h?(e=new ArrayBuffer(68),this.buffer8=new Uint8Array(e),this.blocks=new Uint32Array(e)):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}c.prototype.update=function(i){if(!this.finalized){if(c=t(i),"string"!==c){if("object"!==c)throw p;if(null===i)throw p;if(h&&i.constructor===ArrayBuffer)i=new Uint8Array(i);else if(!(Array.isArray(i)||h&&ArrayBuffer.isView(i)))throw p;l=!0}for(var e,s,c,l,o=0,r=i.length,n=this.blocks,a=this.buffer8;o<r;){if(this.hashed&&(this.hashed=!1,n[0]=n[16],n[16]=n[1]=n[2]=n[3]=n[4]=n[5]=n[6]=n[7]=n[8]=n[9]=n[10]=n[11]=n[12]=n[13]=n[14]=n[15]=0),l)if(h)for(e=this.start;o<r&&e<64;++o)a[e++]=i[o];else for(e=this.start;o<r&&e<64;++o)n[e>>2]|=i[o]<<d[3&e++];else if(h)for(e=this.start;o<r&&e<64;++o)(s=i.charCodeAt(o))<128?a[e++]=s:(s<2048?a[e++]=192|s>>6:(s<55296||57344<=s?a[e++]=224|s>>12:(s=65536+((1023&s)<<10|1023&i.charCodeAt(++o)),a[e++]=240|s>>18,a[e++]=128|s>>12&63),a[e++]=128|s>>6&63),a[e++]=128|63&s);else for(e=this.start;o<r&&e<64;++o)(s=i.charCodeAt(o))<128?n[e>>2]|=s<<d[3&e++]:(s<2048?n[e>>2]|=(192|s>>6)<<d[3&e++]:(s<55296||57344<=s?n[e>>2]|=(224|s>>12)<<d[3&e++]:(s=65536+((1023&s)<<10|1023&i.charCodeAt(++o)),n[e>>2]|=(240|s>>18)<<d[3&e++],n[e>>2]|=(128|s>>12&63)<<d[3&e++]),n[e>>2]|=(128|s>>6&63)<<d[3&e++]),n[e>>2]|=(128|63&s)<<d[3&e++]);this.lastByteIndex=e,this.bytes+=e-this.start,64<=e?(this.start=e-64,this.hash(),this.hashed=!0):this.start=e}return 4294967295<this.bytes&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},c.prototype.finalize=function(){var e,t;this.finalized||(this.finalized=!0,(e=this.blocks)[(t=this.lastByteIndex)>>2]|=O[3&t],56<=t&&(this.hashed||this.hash(),e[0]=e[16],e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.bytes<<3,e[15]=this.hBytes<<3|this.bytes>>>29,this.hash())},c.prototype.hash=function(){var t,n,s,i,a,o=this.blocks,e=this.first?((e=((t=((t=o[0]-680876937)<<7|t>>>25)-271733879<<0)^(n=((n=(-271733879^(s=((s=(-1732584194^2004318071&t)+o[1]-117830708)<<12|s>>>20)+t<<0)&(-271733879^t))+o[2]-1126478375)<<17|n>>>15)+s<<0)&(s^t))+o[3]-1316259209)<<22|e>>>10)+n<<0:(t=this.h0,e=this.h1,n=this.h2,((e+=((t=((t+=((s=this.h3)^e&(n^s))+o[0]-680876936)<<7|t>>>25)+e<<0)^(n=((n+=(e^(s=((s+=(n^t&(e^n))+o[1]-389564586)<<12|s>>>20)+t<<0)&(t^e))+o[2]+606105819)<<17|n>>>15)+s<<0)&(s^t))+o[3]-1044525330)<<22|e>>>10)+n<<0),e=((e+=((t=((t+=(s^e&(n^s))+o[4]-176418897)<<7|t>>>25)+e<<0)^(n=((n+=(e^(s=((s+=(n^t&(e^n))+o[5]+1200080426)<<12|s>>>20)+t<<0)&(t^e))+o[6]-1473231341)<<17|n>>>15)+s<<0)&(s^t))+o[7]-45705983)<<22|e>>>10)+n<<0,e=((e+=((t=((t+=(s^e&(n^s))+o[8]+1770035416)<<7|t>>>25)+e<<0)^(n=((n+=(e^(s=((s+=(n^t&(e^n))+o[9]-1958414417)<<12|s>>>20)+t<<0)&(t^e))+o[10]-42063)<<17|n>>>15)+s<<0)&(s^t))+o[11]-1990404162)<<22|e>>>10)+n<<0,e=((e+=((t=((t+=(s^e&(n^s))+o[12]+1804603682)<<7|t>>>25)+e<<0)^(n=((n+=(e^(s=((s+=(n^t&(e^n))+o[13]-40341101)<<12|s>>>20)+t<<0)&(t^e))+o[14]-1502002290)<<17|n>>>15)+s<<0)&(s^t))+o[15]+1236535329)<<22|e>>>10)+n<<0,e=((e+=((s=((s+=(e^n&((t=((t+=(n^s&(e^n))+o[1]-165796510)<<5|t>>>27)+e<<0)^e))+o[6]-1069501632)<<9|s>>>23)+t<<0)^t&((n=((n+=(t^e&(s^t))+o[11]+643717713)<<14|n>>>18)+s<<0)^s))+o[0]-373897302)<<20|e>>>12)+n<<0,e=((e+=((s=((s+=(e^n&((t=((t+=(n^s&(e^n))+o[5]-701558691)<<5|t>>>27)+e<<0)^e))+o[10]+38016083)<<9|s>>>23)+t<<0)^t&((n=((n+=(t^e&(s^t))+o[15]-660478335)<<14|n>>>18)+s<<0)^s))+o[4]-405537848)<<20|e>>>12)+n<<0,e=((e+=((s=((s+=(e^n&((t=((t+=(n^s&(e^n))+o[9]+568446438)<<5|t>>>27)+e<<0)^e))+o[14]-1019803690)<<9|s>>>23)+t<<0)^t&((n=((n+=(t^e&(s^t))+o[3]-187363961)<<14|n>>>18)+s<<0)^s))+o[8]+1163531501)<<20|e>>>12)+n<<0,e=((e+=((s=((s+=(e^n&((t=((t+=(n^s&(e^n))+o[13]-1444681467)<<5|t>>>27)+e<<0)^e))+o[2]-51403784)<<9|s>>>23)+t<<0)^t&((n=((n+=(t^e&(s^t))+o[7]+1735328473)<<14|n>>>18)+s<<0)^s))+o[12]-1926607734)<<20|e>>>12)+n<<0,e=((e+=((a=(s=((s+=((i=e^n)^(t=((t+=(i^s)+o[5]-378558)<<4|t>>>28)+e<<0))+o[8]-2022574463)<<11|s>>>21)+t<<0)^t)^(n=((n+=(a^e)+o[11]+1839030562)<<16|n>>>16)+s<<0))+o[14]-35309556)<<23|e>>>9)+n<<0,e=((e+=((a=(s=((s+=((i=e^n)^(t=((t+=(i^s)+o[1]-1530992060)<<4|t>>>28)+e<<0))+o[4]+1272893353)<<11|s>>>21)+t<<0)^t)^(n=((n+=(a^e)+o[7]-155497632)<<16|n>>>16)+s<<0))+o[10]-1094730640)<<23|e>>>9)+n<<0,e=((e+=((a=(s=((s+=((i=e^n)^(t=((t+=(i^s)+o[13]+681279174)<<4|t>>>28)+e<<0))+o[0]-358537222)<<11|s>>>21)+t<<0)^t)^(n=((n+=(a^e)+o[3]-722521979)<<16|n>>>16)+s<<0))+o[6]+76029189)<<23|e>>>9)+n<<0,e=((e+=((a=(s=((s+=((i=e^n)^(t=((t+=(i^s)+o[9]-640364487)<<4|t>>>28)+e<<0))+o[12]-421815835)<<11|s>>>21)+t<<0)^t)^(n=((n+=(a^e)+o[15]+530742520)<<16|n>>>16)+s<<0))+o[2]-995338651)<<23|e>>>9)+n<<0,e=((e+=((s=((s+=(e^((t=((t+=(n^(e|~s))+o[0]-198630844)<<6|t>>>26)+e<<0)|~n))+o[7]+1126891415)<<10|s>>>22)+t<<0)^((n=((n+=(t^(s|~e))+o[14]-1416354905)<<15|n>>>17)+s<<0)|~t))+o[5]-57434055)<<21|e>>>11)+n<<0,e=((e+=((s=((s+=(e^((t=((t+=(n^(e|~s))+o[12]+1700485571)<<6|t>>>26)+e<<0)|~n))+o[3]-1894986606)<<10|s>>>22)+t<<0)^((n=((n+=(t^(s|~e))+o[10]-1051523)<<15|n>>>17)+s<<0)|~t))+o[1]-2054922799)<<21|e>>>11)+n<<0,e=((e+=((s=((s+=(e^((t=((t+=(n^(e|~s))+o[8]+1873313359)<<6|t>>>26)+e<<0)|~n))+o[15]-30611744)<<10|s>>>22)+t<<0)^((n=((n+=(t^(s|~e))+o[6]-1560198380)<<15|n>>>17)+s<<0)|~t))+o[13]+1309151649)<<21|e>>>11)+n<<0,e=((e+=((s=((s+=(e^((t=((t+=(n^(e|~s))+o[4]-145523070)<<6|t>>>26)+e<<0)|~n))+o[11]-1120210379)<<10|s>>>22)+t<<0)^((n=((n+=(t^(s|~e))+o[2]+718787259)<<15|n>>>17)+s<<0)|~t))+o[9]-343485551)<<21|e>>>11)+n<<0;this.first?(this.h0=t+1732584193<<0,this.h1=e-271733879<<0,this.h2=n-1732584194<<0,this.h3=s+271733878<<0,this.first=!1):(this.h0=this.h0+t<<0,this.h1=this.h1+e<<0,this.h2=this.h2+n<<0,this.h3=this.h3+s<<0)},c.prototype.toString=c.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,s=this.h3;return a[e>>4&15]+a[15&e]+a[e>>12&15]+a[e>>8&15]+a[e>>20&15]+a[e>>16&15]+a[e>>28&15]+a[e>>24&15]+a[t>>4&15]+a[15&t]+a[t>>12&15]+a[t>>8&15]+a[t>>20&15]+a[t>>16&15]+a[t>>28&15]+a[t>>24&15]+a[n>>4&15]+a[15&n]+a[n>>12&15]+a[n>>8&15]+a[n>>20&15]+a[n>>16&15]+a[n>>28&15]+a[n>>24&15]+a[s>>4&15]+a[15&s]+a[s>>12&15]+a[s>>8&15]+a[s>>20&15]+a[s>>16&15]+a[s>>28&15]+a[s>>24&15]},c.prototype.array=c.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,s=this.h3;return[255&e,e>>8&255,e>>16&255,e>>24&255,255&t,t>>8&255,t>>16&255,t>>24&255,255&n,n>>8&255,n>>16&255,n>>24&255,255&s,s>>8&255,s>>16&255,s>>24&255]},c.prototype.buffer=c.prototype.arrayBuffer=function(){this.finalize();var t=new ArrayBuffer(16),e=new Uint32Array(t);return e[0]=this.h0,e[1]=this.h1,e[2]=this.h2,e[3]=this.h3,t},c.prototype.base64=function(){for(var e,s,o,i="",n=this.array(),t=0;t<15;)e=n[t++],s=n[t++],o=n[t++],i+=m[e>>>2]+m[63&(e<<4|s>>>4)]+m[63&(s<<2|o>>>6)]+m[63&o];return e=n[t],i+(m[e>>>2]+m[e<<4&63]+"==")},f=function(){var t,n,e=b("hex");(e=v?w(e):e).create=function(){return new c},e.update=function(t){return e.create().update(t)};for(t=0;t<j.length;++t)n=j[t],e[n]=b(n);return e}(),u?n.exports=f:(l.md5=f,!_||void 0!==(o=function(){return f}.call(f,e,f,n))&&(n.exports=o))}()}.call(this,e(49),e(31),e(143)(t))},function(n,t,e){"use strict";!function(v,s,o){p=e(52),r=e.n(p);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(){var e=this,s=new _,t=(e.chunks={},e.users={},e.readAsArrayBuffer=function(t,i,a){var o={file:t,earlyCallback:function(e){i(n(e,{currentPosition:-1}))},extra:a||{userid:0}};t.extra&&Object.keys(t.extra).length&&Object.keys(t.extra).forEach(function(e){o.extra[e]=t.extra[e]}),s.readAsArrayBuffer(e,o)},e.getNextChunk=function(s,a,o){void 0!==s.currentPosition&&(i=s.currentPosition,s=s.uuid);var t,i,r=e.chunks[s];if(r){if(t=r[i=void 0!==o?(e.users[o+""]||(e.users[o+""]={fileUUID:s,userid:o,currentPosition:-1}),void 0!==i&&(e.users[o+""].currentPosition=i),e.users[o+""].currentPosition++,e.users[o+""].currentPosition):(void 0!==i&&(e.chunks[s].currentPosition=i),e.chunks[s].currentPosition++,e.chunks[s].currentPosition)],!t)return delete e.chunks[s],void e.convertToArrayBuffer({chunkMissing:!0,currentPosition:i,uuid:s},a);t=n(t),void 0!==o&&(t.remoteUserId=o+""),t.start&&e.onBegin(t),t.end&&e.onEnd(t),e.onProgress(t),e.convertToArrayBuffer(t,function(e){t.currentPosition!=t.maxChunks?a(e,!1):a(e,!0)})}},new j(e));function n(e,t){if(null==e||"object"!=i(e))return e;if(e.constructor!=Object&&e.constructor!=Array)return e;if(e.constructor==Date||e.constructor==RegExp||e.constructor==Function||e.constructor==String||e.constructor==Number||e.constructor==Boolean)return new e.constructor(e);for(var s in t=t||new e.constructor,e)t[s]=void 0===t[s]?n(e[s],null):t[s];return t}e.addChunk=function(n,s){n&&t.receive(n,function(t){e.convertToArrayBuffer({readyForNextChunk:!0,currentPosition:t.currentPosition,uuid:t.uuid},s)})},e.chunkMissing=function(e){delete t.chunks[e.uuid],delete t.chunksWaiters[e.uuid]},e.onBegin=function(){},e.onEnd=function(){},e.onProgress=function(){},e.convertToObject=h.ConvertToObject,e.convertToArrayBuffer=h.ConvertToArrayBuffer,e.setMultipleUsers=function(){}}function _(){this.readAsArrayBuffer=function(m,s){var e,t,n,o,i,a,r,l,d,u,h,f,c=s.earlyCallback;delete s.earlyCallback,d=(d=function(e){m.chunks[e.uuid]||(m.chunks[e.uuid]={currentPosition:-1}),s.extra=s.extra||{userid:0},e.userid=s.userid||s.extra.userid||0,e.extra=s.extra,(m.chunks[e.uuid][e.currentPosition]=e).end&&c&&(c(e.uuid),c=null),200<e.maxChunks&&200==e.currentPosition&&c&&(c(e.uuid),c=null)})||function(e){postMessage(e)},(e=(i=s).file).uuid||(e.uuid=(100*Math.random()).toString().replace(/\./g,"")),t=i.chunkSize||15e3,i.extra&&i.extra.chunkSize&&(t=i.extra.chunkSize),o=0,i=t,n=Math.floor(Math.min(1e8,i)/t)*t,l=Math.ceil(e.size/t),e.maxChunks=l,h=[],d({currentPosition:a=0,uuid:e.uuid,maxChunks:l,size:e.size,name:e.name,type:e.type,lastModifiedDate:(e.lastModifiedDate||new Date).toString(),start:!0}),(u=new FileReader).onloadend=function(m){if(m.target.readyState==FileReader.DONE){e.name;var s,c,i=m.target.result;f=Math.ceil(i.byteLength/t);for(s=0;s<f;s++)c=s*t,h[a]=i.slice(c,Math.min(c+t,i.byteLength)),d({uuid:e.uuid,buffer:h[a],currentPosition:a,maxChunks:l,size:e.size,name:e.name,lastModifiedDate:(e.lastModifiedDate||new Date).toString(),type:e.type}),a++;(++o+1)*n<e.size?(r=e.slice(o*n,(o+1)*n),u.readAsArrayBuffer(r)):o*n<e.size?(r=e.slice(o*n,e.size),u.readAsArrayBuffer(r)):(e.url=URL.createObjectURL(e),d({currentPosition:a,uuid:e.uuid,maxChunks:l,size:e.size,name:e.name,lastModifiedDate:(e.lastModifiedDate||new Date).toString(),url:URL.createObjectURL(e),type:e.type,end:!0}))}},a+=1,r=e.slice(o*n,(o+1)*n),u.readAsArrayBuffer(r)}}function y(){var e=this,t=function(){};function n(o,a,s){o=o||function(){};var i,n=document.createElement("input"),s=(n.type="file",a&&(n.multiple=!0),s&&(n.webkitdirectory=!0),n.accept=e.accept,n.onclick=function(){n.clickStarted=!0},document.body.onfocus=function(){setTimeout(function(){n.clickStarted&&(n.clickStarted=!1,n.value||t())},500)},n.onchange=function(){if(a){if(!n.files.length)return void console.error("No file selected.");var e=[];return Array.from(n.files).forEach(function(t){t.url=t.webkitRelativePath,e.push(t)}),void o(e)}n.files[0]?(o(n.files[0]),n.parentNode.removeChild(n)):console.error("No file selected.")},n.style.display="none",(document.body||document.documentElement).appendChild(n),n);"function"==typeof s.click?s.click():"function"==typeof s.change?s.change():(void 0!==document.createEvent("Event")&&"function"==typeof(i=document.createEvent("Event")).initEvent&&"function"==typeof s.dispatchEvent?i.initEvent("click",!0,!0):i=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}),s.dispatchEvent(i))}e.selectSingleFile=function(s,e){e&&(t=e),n(s)},e.selectMultipleFiles=function(s,e){e&&(t=e),n(s,!0)},e.selectDirectory=function(s,e){e&&(t=e),n(s,!0,!0)},e.accept="*.*"}function j(t){var e=this;e.chunks={},e.chunksWaiters={},e.receive=function r(n,a){var s,o,i;n.uuid?(n.start&&!e.chunks[n.uuid]&&(e.chunks[n.uuid]={},t.onBegin&&t.onBegin(n)),!n.end&&n.buffer&&(e.chunks[n.uuid][n.currentPosition]=n.buffer),n.end&&(o=e.chunks[n.uuid],i=[],Object.keys(o).forEach(function(e){i.push(o[e])}),(s=f(s=new Blob(i,{type:n.type}),n)).url=URL.createObjectURL(s),s.uuid=n.uuid,s.size||console.error("Something went wrong. Blob Size is 0."),t.onEnd&&t.onEnd(s),delete e.chunks[n.uuid],delete e.chunksWaiters[n.uuid]),n.buffer&&t.onProgress&&t.onProgress(n),n.end||(a(n),e.chunksWaiters[n.uuid]=function(){setTimeout(function t(){n.buffer&&e.chunks[n.uuid]&&(n.currentPosition==n.maxChunks||e.chunks[n.uuid][n.currentPosition]||(a(n),setTimeout(t,5e3)))},5e3)},e.chunksWaiters[n.uuid]())):t.convertToObject(n,function(e){r(e)})}}h={ConvertToArrayBuffer:function(e,t){b.pack(e,function(e){t(e.buffer)})},ConvertToObject:function(e,t){b.unpack(e,t)}};function f(e,t){if(e=e||{},!t)return e;for(var n in t)try{e[n]=t[n]}catch(e){}return e}function a(t,e){var s,i,r,p,b,j,y,_,o=0,h=t.getUint8(e,!1),g=(e+=d,h!==n.ARRAY&&h!==n.OBJECT||(f=t.getUint16(e,!1),e+=l),r=t.getUint32(e,!1),e+=u,c[h]),m=null===g?0:window[g+"Array"].BYTES_PER_ELEMENT;switch(h){case n.NULL:case n.UNDEFINED:s=null;break;case n.STRING:for(var f=r/m,w=[],o=0;o<f;o++)j=t.getUint16(e,!1),e+=m,w.push(String.fromCharCode(j));s=w.join("");break;case n.NUMBER:s=t.getFloat64(e,!1),e+=m;break;case n.BOOLEAN:s=1===t.getUint8(e,!1),e+=m;break;case n.INT8ARRAY:case n.INT16ARRAY:case n.INT32ARRAY:case n.UINT8ARRAY:case n.UINT16ARRAY:case n.UINT32ARRAY:case n.FLOAT32ARRAY:case n.FLOAT64ARRAY:case n.ARRAYBUFFER:i=t.buffer.slice(e,e+r),e+=r,s=h===n.ARRAYBUFFER?i:new window[g+"Array"](i);break;case n.BLOB:s=window.Blob?(e=(_=a(t,(y=a(t,e)).cursor)).cursor,new Blob([_.value],{type:y.value})):(i=t.buffer.slice(e,e+r),e+=r,new v(i));break;case n.ARRAY:for(s=[],o=0;o<f;o++)e=(i=a(t,e)).cursor,s.push(i.value);break;case n.OBJECT:for(s={},o=0;o<f;o++)b=a(t,e),p=a(t,b.cursor),e=p.cursor,s[b.value]=p.value;break;default:throw"TypeError: Type not supported."}return{value:s,cursor:e}}function m(e,o){for(var i=e.length,t=[],a=0,s=0,n=0;n<e.length;n++)!function(n){g(e[n],function(e){if(t[n]=e,s+=e[0].header_size+e[0].byte_length,++a===i){for(var r=[],c=0;c<t.length;c++)r=r.concat(t[c]);o(r,s)}})}(n)}var r,h,p,d=Uint8Array.BYTES_PER_ELEMENT,l=Uint16Array.BYTES_PER_ELEMENT,u=Uint32Array.BYTES_PER_ELEMENT,n={NULL:0,UNDEFINED:1,STRING:2,NUMBER:3,BOOLEAN:4,ARRAY:5,OBJECT:6,INT8ARRAY:7,INT16ARRAY:8,INT32ARRAY:9,UINT8ARRAY:10,UINT16ARRAY:11,UINT32ARRAY:12,FLOAT32ARRAY:13,FLOAT64ARRAY:14,ARRAYBUFFER:15,BLOB:16,FILE:16,BUFFER:17},c=[null,null,"Uint16","Float64","Uint8",null,null,"Int8","Int16","Int32","Uint8","Uint16","Uint32","Float32","Float64","Uint8","Uint8","Uint8"],g=function(e,a){var h,f,p,b,r=d+u,s=0,o=0,j=e,t=function(t){if(e=void 0,void 0===t)e=n.UNDEFINED;else if(null===t)e=n.NULL;else{var e,s=t.constructor.name,o=t.constructor.toString().match(/\w+/g)[1];if(void 0!==s&&void 0!==n[s.toUpperCase()])e=n[s.toUpperCase()];else if(void 0!==o&&void 0!==n[o.toUpperCase()])e=n[o.toUpperCase()];else switch(i(t)){case"string":e=n.STRING;break;case"number":e=n.NUMBER;break;case"boolean":e=n.BOOLEAN;break;case"object":t instanceof Array?e=n.ARRAY:t instanceof Int8Array?e=n.INT8ARRAY:t instanceof Int16Array?e=n.INT16ARRAY:t instanceof Int32Array?e=n.INT32ARRAY:t instanceof Uint8Array?e=n.UINT8ARRAY:t instanceof Uint16Array?e=n.UINT16ARRAY:t instanceof Uint32Array?e=n.UINT32ARRAY:t instanceof Float32Array?e=n.FLOAT32ARRAY:t instanceof Float64Array?e=n.FLOAT64ARRAY:t instanceof ArrayBuffer?e=n.ARRAYBUFFER:t instanceof Blob?e=n.BLOB:t instanceof v?e=n.BUFFER:t instanceof Object&&(e=n.OBJECT)}}return e}(e),g=null==c[t]?0:window[c[t]+"Array"].BYTES_PER_ELEMENT;switch(t){case n.UNDEFINED:case n.NULL:break;case n.NUMBER:case n.BOOLEAN:s=g;break;case n.STRING:s+=(o=e.length)*g;break;case n.INT8ARRAY:case n.INT16ARRAY:case n.INT32ARRAY:case n.UINT8ARRAY:case n.UINT16ARRAY:case n.UINT32ARRAY:case n.FLOAT32ARRAY:case n.FLOAT64ARRAY:s+=(o=e.length)*g;break;case n.ARRAY:return void m(e,function(n,s){a([{type:t,length:e.length,header_size:r+l,byte_length:s,value:null}].concat(n))});case n.OBJECT:p=[];for(f in e)e.hasOwnProperty(f)&&(p.push(f),p.push(e[f]),o++);return void m(p,function(e,n){a([{type:t,length:o,header_size:r+l,byte_length:n,value:null}].concat(e))});case n.ARRAYBUFFER:s+=e.byteLength;break;case n.BLOB:return b=e.type,h=new FileReader,h.onload=function(e){m([b,e.target.result],function(e,n){a([{type:t,length:o,header_size:r,byte_length:n,value:null}].concat(e))})},h.onerror=function(e){throw"FileReader Error: "+e},void h.readAsArrayBuffer(e);case n.BUFFER:s+=e.length;break;default:throw'TypeError: Type "'+e.constructor.name+'" not supported.'}a([{type:t,length:o,header_size:r,byte_length:s,value:j}].concat([]))},b={pack:function(e,t){try{g(e,function(e){t(function(s){for(var e=0,o=0,h=0,g=new ArrayBuffer(s[0].byte_length+s[0].header_size),t=new DataView(g),o=0;o<s.length;o++){s[o].header_size;var i=s[o].type,f=s[o].length,r=s[o].value,a=s[o].byte_length,m=c[i],p=null===m?0:window[m+"Array"].BYTES_PER_ELEMENT;switch(i===n.BUFFER?t.setUint8(e,n.BLOB,!1):t.setUint8(e,i,!1),e+=d,i!==n.ARRAY&&i!==n.OBJECT||(t.setUint16(e,f,!1),e+=l),t.setUint32(e,a,!1),e+=u,i){case n.NULL:case n.UNDEFINED:break;case n.STRING:for(h=0;h<f;h++,e+=p)t.setUint16(e,r.charCodeAt(h),!1);break;case n.NUMBER:case n.BOOLEAN:t["set"+m](e,r,!1),e+=p;break;case n.INT8ARRAY:case n.INT16ARRAY:case n.INT32ARRAY:case n.UINT8ARRAY:case n.UINT16ARRAY:case n.UINT32ARRAY:case n.FLOAT32ARRAY:case n.FLOAT64ARRAY:new Uint8Array(t.buffer,e,a).set(new Uint8Array(r.buffer)),e+=a;break;case n.ARRAYBUFFER:case n.BUFFER:new Uint8Array(t.buffer,e,a).set(new Uint8Array(r)),e+=a;break;case n.BLOB:case n.ARRAY:case n.OBJECT:break;default:throw"TypeError: Unexpected type found."}}return t}(e))})}catch(e){throw e}},unpack:function(e,t){try{t(function(e){return e=e instanceof DataView?e:new DataView(e),a(e,0).value}(e))}catch(e){throw e}}};t.a=function(eS,Q){function V(e,i){function o(e){return!e.audio&&!e.video&&!e.screen&&e.data}var n,s,t="",t=(t=(t=(t=(t+="?userid="+e.userid)+("&sessionid="+e.sessionid))+("&msgEvent="+e.socketMessageEvent))+("&socketCustomEvent="+e.socketCustomEvent))+("&autoCloseEntireSession="+!!e.autoCloseEntireSession);!0===e.session.broadcast&&(t+="&oneToMany=true"),t+="&maxParticipantsAllowed="+e.maxParticipantsAllowed,e.enableScalableBroadcast&&(t=t+"&enableScalableBroadcast=true"+("&maxRelayLimitPerUser="+(e.maxRelayLimitPerUser||2))),t+="&extra="+JSON.stringify(e.extra||{}),e.socketCustomParameters&&(t+=e.socketCustomParameters);try{r.a.sockets={}}catch(e){}if(e.socketURL||(e.socketURL="/"),"/"!=e.socketURL.substr(e.socketURL.length-1,1))throw'"socketURL" MUST end with a slash.';e.enableLogs&&("/"==e.socketURL?console.info("socket.io url is: ",location.origin+"/"):console.info("socket.io url is: ",e.socketURL));try{e.socket=r()(e.socketURL+t)}catch(n){e.socket=r.a.connect(e.socketURL+t,e.socketOptions)}n=e.multiPeersHandler;function a(t,n){e.peersBackup[t]||(e.peersBackup[t]={userid:t,extra:{}}),e.peersBackup[t].extra=n}e.socket.on("extra-data-updated",function(t,n){e.peers[t]&&(e.peers[t].extra=n,e.onExtraDataUpdated({userid:t,extra:n}),a(t,n))}),e.socket.on(e.socketMessageEvent,function c(t){if(t.remoteUserId==e.userid)if(e.peers[t.sender]&&e.peers[t.sender].extra!=t.message.extra&&(e.peers[t.sender].extra=t.extra,e.onExtraDataUpdated({userid:t.sender,extra:t.extra}),a(t.sender,t.extra)),t.message.streamSyncNeeded&&e.peers[t.sender]){{var i,r,s=e.streamEvents[t.message.streamid];if(s&&s.stream){if(i=t.message.action,"ended"===i||"inactive"===i||"stream-removed"===i)return e.peersBackup[s.userid]&&(s.extra=e.peersBackup[s.userid].extra),void e.onstreamended(s);r="both"!=t.message.type?t.message.type:null,"function"==typeof s.stream[i]&&s.stream[i](r)}}}else if("dropPeerConnection"!==t.message){if(t.message.allParticipants)return-1===t.message.allParticipants.indexOf(t.sender)&&t.message.allParticipants.push(t.sender),void t.message.allParticipants.forEach(function(t){n[e.peers[t]?"renegotiatePeer":"createNewPeer"](t,{localPeerSdpConstraints:{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:o(e.session)})});if(t.message.newParticipant)t.message.newParticipant==e.userid||e.peers[t.message.newParticipant]||n.createNewPeer(t.message.newParticipant,t.message.userPreferences||{localPeerSdpConstraints:{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:o(e.session)});else if(t.message.readyForOffer&&(e.attachStreams.length&&(e.waitingForLocalMedia=!1),e.waitingForLocalMedia))setTimeout(function(){c(t)},1);else if(t.message.newParticipationRequest&&t.sender!==e.userid)e.peers[t.sender]&&e.deletePeer(t.sender),s={extra:t.extra||{},localPeerSdpConstraints:t.message.remotePeerSdpConstraints||{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:t.message.localPeerSdpConstraints||{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:void 0!==t.message.isOneWay?t.message.isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:void 0!==t.message.isDataOnly?t.message.isDataOnly:o(e.session),dontGetRemoteStream:void 0!==t.message.isOneWay?t.message.isOneWay:!!e.session.oneway||"one-way"===e.direction,dontAttachLocalStream:!!t.message.dontGetRemoteStream,connectionDescription:t,successCallback:function(){}},e.onNewParticipant(t.sender,s);else{if(t.message.changedUUID&&e.peers[t.message.oldUUID]&&(e.peers[t.message.newUUID]=e.peers[t.message.oldUUID],delete e.peers[t.message.oldUUID]),t.message.userLeft)return n.onUserLeft(t.sender),void(t.message.autoCloseEntireSession&&e.leave());n.addNegotiatedMessage(t.message,t.sender)}}else e.deletePeer(t.sender)}),s=!1,e.socket.resetProps=function(){s=!1},e.socket.on("connect",function(){s||(s=!0,e.enableLogs&&console.info("socket.io connection is opened."),setTimeout(function(){e.socket.emit("extra-data-updated",e.extra)},1e3),i&&i(e.socket))}),e.socket.on("disconnect",function(){e.enableLogs&&console.warn("socket.io connection is closed"),e.close()}),e.socket.on("user-disconnected",function(t){t!==e.userid&&(e.onUserStatusChanged({userid:t,status:"offline",extra:e.peers[t]&&e.peers[t].extra||{}}),e.deletePeer(t))}),e.socket.on("user-connected",function(t){t!==e.userid&&e.onUserStatusChanged({userid:t,status:"online",extra:e.peers[t]&&e.peers[t].extra||{}})}),e.socket.on("closed-entire-session",function(t,n){e.leave(),e.onEntireSessionClosed({sessionid:t,userid:t,extra:n})}),e.socket.on("userid-already-taken",function(t,n){e.onUserIdAlreadyTaken(t,n)}),e.socket.on("logs",function(t){e.enableLogs&&console.debug("server-logs",t)}),e.socket.on("number-of-broadcast-viewers-updated",function(t){e.onNumberOfBroadcastViewersUpdated(t)}),e.socket.on("set-isInitiator-true",function(t){t==e.sessionid&&(e.isInitiator=!0)})}function eA(e){var o,t=this,n=["getAllParticipants","getLength","selectFirst","streams","send","forEach"];function s(){e.fbr=new w,e.fbr.onProgress=function(t){e.onFileProgress(t)},e.fbr.onBegin=function(t){e.onFileStart(t)},e.fbr.onEnd=function(t){e.onFileEnd(t)}}e.peers={getLength:function(){var e,t=0;for(e in this)-1==n.indexOf(e)&&t++;return t},selectFirst:function(){var e,t;for(e in this)-1==n.indexOf(e)&&(t=this[e]);return t},getAllParticipants:function(s){var e,t=[];for(e in this)-1==n.indexOf(e)&&e!=s&&t.push(e);return t},forEach:function(t){this.getAllParticipants().forEach(function(n){t(e.peers[n])})},send:function(n,s){var i,o=this;if(!Z(n.size)&&!Z(n.type)){if(e.enableFileSharing)return void t.shareFile(n,s);"string"!=typeof n&&(n=JSON.stringify(n))}if("text"===n.type||n instanceof ArrayBuffer||n instanceof DataView){if("text"===n.type&&(n=JSON.stringify(n)),s&&(i=e.peers[s],i))return i.channels.length?void i.channels.forEach(function(e){e.send(n)}):(e.peers[s].createDataChannel(),e.renegotiate(s),void setTimeout(function(){o.send(n,s)},3e3));this.getAllParticipants().forEach(function(t){if(!o[t].channels.length)return e.peers[t].createDataChannel(),e.renegotiate(t),void setTimeout(function(){o[t].channels.forEach(function(e){e.send(n)})},3e3);o[t].channels.forEach(function(e){e.send(n)})})}else eC.send({text:n,channel:this,connection:e,remoteUserId:s})}},this.uuid=e.userid,this.getLocalConfig=function(i,n,o){return{streamsToShare:(o=o||{}).streamsToShare||{},rtcMultiConnection:e,connectionDescription:o.connectionDescription,userid:n,localPeerSdpConstraints:o.localPeerSdpConstraints,remotePeerSdpConstraints:o.remotePeerSdpConstraints,dontGetRemoteStream:!!o.dontGetRemoteStream,dontAttachLocalStream:!!o.dontAttachLocalStream,renegotiatingPeer:!!o.renegotiatingPeer,peerRef:o.peerRef,channels:o.channels||[],onLocalSdp:function(e){t.onNegotiationNeeded(e,n)},onLocalCandidate:function(s){(s=e8.processCandidates(e,s))&&t.onNegotiationNeeded(s,n)},remoteSdp:i,onDataChannelMessage:function(o){var i;!e.fbr&&e.enableFileSharing&&s(),"string"!=typeof o&&e.enableFileSharing?(i=this,o instanceof ArrayBuffer||o instanceof DataView?e.fbr.convertToObject(o,function(e){i.onDataChannelMessage(e)}):o.readyForNextChunk?e.fbr.getNextChunk(o,function(t){e.peers[n].channels.forEach(function(e){e.send(t)})},n):o.chunkMissing?e.fbr.chunkMissing(o):e.fbr.addChunk(o,function(t){e.peers[n].peer.channel.send(t)})):t.onDataChannelMessage(o,n)},onDataChannelError:function(e){t.onDataChannelError(e,n)},onDataChannelOpened:function(e){t.onDataChannelOpened(e,n)},onDataChannelClosed:function(e){t.onDataChannelClosed(e,n)},onRemoteStream:function(s){e.peers[n]&&e.peers[n].streams.push(s),t.onGettingRemoteMedia(s,n)},onRemoteStreamRemoved:function(e){t.onRemovingRemoteMedia(e,n)},onPeerStateChanged:function(e){t.onPeerStateChanged(e),"new"===e.iceConnectionState&&t.onNegotiationStarted(n,e),"connected"===e.iceConnectionState&&t.onNegotiationCompleted(n,e),-1!==e.iceConnectionState.search(/closed|failed/gi)&&(t.onUserLeft(n),t.disconnectWith(n))}}},this.createNewPeer=function(n,t){if(!(e.maxParticipantsAllowed<=e.getAllParticipants().length)){if(t=t||{},e.isInitiator&&e.session.audio&&"two-way"===e.session.audio&&!t.streamsToShare&&(t.isOneWay=!1,t.isDataOnly=!1,t.session=e.session),!t.isOneWay&&!t.isDataOnly)return t.isOneWay=!0,void this.onNegotiationNeeded({enableMedia:!0,userPreferences:t},n);t=e.setUserPreferences(t,n),t=this.getLocalConfig(null,n,t),e.peers[n]=new ei(t)}},this.createAnsweringPeer=function(t,n,s){s=e.setUserPreferences(s||{},n),t=this.getLocalConfig(t,n,s),e.peers[n]=new ei(t)},this.renegotiatePeer=function(t,n,s){e.peers[t]?((n=n||{}).renegotiatingPeer=!0,n.peerRef=e.peers[t].peer,n.channels=e.peers[t].channels,s=this.getLocalConfig(s,t,n),e.peers[t]=new ei(s)):e.enableLogs&&console.error("Peer ("+t+") does not exist. Renegotiation skipped.")},this.replaceTrack=function(s,t,o){if(!e.peers[t])throw"This peer ("+t+") does not exist.";var n=e.peers[t].peer;n.getSenders&&"function"==typeof n.getSenders&&n.getSenders().length?n.getSenders().forEach(function(n){o&&"video"===n.track.kind&&(e.peers[t].peer.lastVideoTrack=n.track,n.replaceTrack(s)),o||"audio"!==n.track.kind||(e.peers[t].peer.lastAudioTrack=n.track,n.replaceTrack(s))}):(console.warn("RTPSender.replaceTrack is NOT supported."),this.renegotiatePeer(t))},this.onNegotiationNeeded=function(){},this.addNegotiatedMessage=function(n,s){return n.type&&n.sdp?("answer"==n.type&&e.peers[s]&&e.peers[s].addRemoteSdp(n),"offer"==n.type&&(n.renegotiatingPeer?this.renegotiatePeer(s,null,n):this.createAnsweringPeer(n,s)),void(e.enableLogs&&console.log("Remote peer's sdp:",n.sdp))):n.candidate?(e.peers[s]&&e.peers[s].addRemoteCandidate(n),void(e.enableLogs&&console.log("Remote peer's candidate pairs:",n.candidate))):(n.enableMedia&&(e.session=n.userPreferences.session||e.session,e.session.oneway&&e.attachStreams.length&&(e.attachStreams=[]),n.userPreferences.isDataOnly&&e.attachStreams.length&&(e.attachStreams.length=[]),o={},e.attachStreams.forEach(function(e){o[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),n.userPreferences.streamsToShare=o,t.onNegotiationNeeded({readyForOffer:!0,userPreferences:n.userPreferences},s)),void(n.readyForOffer&&e.onReadyForOffer(s,n.userPreferences)));var o},this.onGettingRemoteMedia=function(){},this.onRemovingRemoteMedia=function(){},this.onGettingLocalMedia=function(){},this.onLocalMediaError=function(t,n){e.onMediaError(t,n)},this.shareFile=function(n,t){s(),e.fbr.readAsArrayBuffer(n,function(s){var n=e.getAllParticipants();(n=t?[t]:n).forEach(function(t){e.fbr.getNextChunk(s,function(n){e.peers[t].channels.forEach(function(e){e.send(n)})},t)})},{userid:e.userid,chunkSize:"Firefox"===DetectRTC.browser.name?15e3:e.chunkSize||0})},o=new eO(e),this.onDataChannelMessage=function(n,t){o.receive(JSON.parse(n),t,e.peers[t]?e.peers[t].extra:{})},this.onDataChannelClosed=function(t,n){t.userid=n,t.extra=e.peers[n]?e.peers[n].extra:{},e.onclose(t)},this.onDataChannelError=function(n,t){n.userid=t,event.extra=e.peers[t]?e.peers[t].extra:{},e.onerror(n)},this.onDataChannelOpened=function(n,t){e.peers[t].channels.length?e.peers[t].channels=[n]:(e.peers[t].channels.push(n),e.onopen({userid:t,extra:e.peers[t]?e.peers[t].extra:{},channel:n}))},this.onPeerStateChanged=function(t){e.onPeerStateChanged(t)},this.onNegotiationStarted=function(){},this.onNegotiationCompleted=function(){},this.getRemoteStreams=function(t){return t=t||e.peers.getAllParticipants()[0],e.peers[t]?e.peers[t].streams:[]}}function e5(n,e,t){"undefined"!=typeof CustomEvent&&(e=new CustomEvent(e,{arguments:t,__exposedProps__:t}),n.dispatchEvent(e))}function ej(t,e){e.stream&&e.stream&&e.stream.addEventListener&&(e.stream.addEventListener("mute",function(n){(n=t.streamEvents[e.streamid]).session={audio:"audio"===n.muteType,video:"video"===n.muteType},t.onmute(n)},!1),e.stream.addEventListener("unmute",function(n){(n=t.streamEvents[e.streamid]).session={audio:"audio"===n.unmuteType,video:"video"===n.unmuteType},t.onunmute(n)},!1))}function D(){if(window.crypto&&window.crypto.getRandomValues&&-1===navigator.userAgent.indexOf("Safari")){for(var t=window.crypto.getRandomValues(new Uint32Array(3)),n="",e=0,s=t.length;e<s;e++)n+=t[e].toString(36);return n}return(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"")}function eu(t,a,n){if(n.autoCreateMediaElement){var s,o,i=!1,e=(p(t,"video").length||t.isVideo||t.isScreen||(i=!0),"Firefox"===DetectRTC.browser.name&&(n.session.video||n.session.screen)&&(i=!1),document.createElement(i?"audio":"video"));e.srcObject=t;try{e.setAttributeNode(document.createAttribute("autoplay")),e.setAttributeNode(document.createAttribute("playsinline")),e.setAttributeNode(document.createAttribute("controls"))}catch(t){e.setAttribute("autoplay",!0),e.setAttribute("playsinline",!0),e.setAttribute("controls",!0)}"Firefox"===DetectRTC.browser.name&&(o="ended","oninactive"in e&&(o="inactive"),e.addEventListener(o,function(){var e,s;currentUserMediaRequest.remove(t.idInstance),"local"===t.type&&(o="ended","oninactive"in t&&(o="inactive"),v.onSyncNeeded(t.streamid,o),n.attachStreams.forEach(function(e,s){t.streamid===e.streamid&&delete n.attachStreams[s]}),e=[],n.attachStreams.forEach(function(t){t&&e.push(t)}),n.attachStreams=e,(s=n.streamEvents[t.streamid])?n.onstreamended(s):this.parentNode&&this.parentNode.removeChild(this))},!1)),i=e.play(),void 0!==i?(s=!1,setTimeout(function(){s||(s=!0,a(e))},1e3),i.then(function(){s||(s=!0,a(e))}).catch(function(){s||(s=!0,a(e))})):a(e)}else a({})}function e_(e,t){window.removeEventListener(e,t),window.addEventListener(e,t,!1)}function ey(t){var e=[];return t.forEach(function(t){t&&e.push(t)}),e}function S(e){return!e.audio&&!e.video&&!e.screen&&e.data}function Z(e){return void 0===e}(l=void 0!==s?s:null)&&"undefined"==typeof window&&void 0!==s&&(s.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},s.console||(s.console={}),void 0===s.console.debug&&(s.console.debug=s.console.info=s.console.error=s.console.log=s.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(l.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return e},document.addEventListener=document.removeEventListener=l.addEventListener=l.removeEventListener=function(){},l.HTMLVideoElement=l.HTMLMediaElement=function(){}),void 0===r.a&&(l.io=function(){return{on:function(t,e){e=e||function(){},"connect"===t&&e()},emit:function(t,n,e){e=e||function(){},"open-room"!==t&&"join-room"!==t||e(!0,n.sessionid,null)}}}),"undefined"==typeof location&&(l.location={protocol:"file:",href:"",hash:"",origin:"self"}),"undefined"==typeof screen&&(l.screen={width:0,height:0}),"undefined"==typeof URL&&(l.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),l.window=s);var E,l="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",a=("object"===(void 0===o?"undefined":i(o))&&"object"===i(o.versions)&&o.versions.node&&!o.browser&&(E=o.versions.node.toString().replace("v",""),l="Nodejs/"+E+" (NodeOS) AppleWebKit/"+E+" (KHTML, like Gecko) Nodejs/"+E+" Nodejs/"+E),E=void 0!==s?s:window,"undefined"==typeof window&&("undefined"==typeof window&&void 0!==s&&(s.navigator={userAgent:l,getUserMedia:function(){}},E.window=s),"undefined"==typeof location&&(E.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(E.screen={width:0,height:0})),window.navigator),l=(void 0!==a?(void 0!==a.webkitGetUserMedia&&(a.getUserMedia=a.webkitGetUserMedia),void 0!==a.mozGetUserMedia&&(a.getUserMedia=a.mozGetUserMedia)):a={getUserMedia:function(){},userAgent:l},!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(a.userAgent||"")),e9=!(-1===a.userAgent.indexOf("Edge")||!a.msSaveOrOpenBlob&&!a.msSaveBlob),e7=!!window.opera||0<=a.userAgent.indexOf(" OPR/"),eE=void 0!==window.InstallTrigger,er=/^((?!chrome|android).)*safari/i.test(a.userAgent),ec=!!window.chrome&&!e7,ek="undefined"!=typeof document&&!!document.documentMode&&!e9;function e6(s,e){var o=0,t=!1,n=window.setInterval(function(){s()&&(window.clearInterval(n),e(t)),50<o++&&(window.clearInterval(n),e(t=!0))},10)}var g,v,j,O,C,A,M,z,P,eo,_={Android:function(){return a.userAgent.match(/Android/i)},BlackBerry:function(){return a.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return a.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return a.userAgent.match(/Opera Mini/i)},Windows:function(){return a.userAgent.match(/IEMobile/i)},any:function(){return _.Android()||_.BlackBerry()||_.iOS()||_.Opera()||_.Windows()},getOsName:function(){var e="Unknown OS";return _.Android()&&(e="Android"),_.BlackBerry()&&(e="BlackBerry"),_.iOS()&&(e="iOS"),_.Opera()&&(e="Opera Mini"),e=_.Windows()?"Windows":e}},m="Unknown OS",h="Unknown OS Version",b=((d=function(){for(var e,s,i=a.appVersion,n=a.userAgent,t="-",r=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],o=0;s=r[o];o++)if(s.r.test(n)){t=s.s;break}switch(e="-",/Windows/.test(t)&&(/Windows (.*)/.test(t)&&(e=/Windows (.*)/.exec(t)[1]),t="Windows"),t){case"Mac OS X":/Mac OS X (10[._\d]+)/.test(n)&&(e=/Mac OS X (10[._\d]+)/.exec(n)[1]);break;case"Android":/Android ([._\d]+)/.test(n)&&(e=/Android ([._\d]+)/.exec(n)[1]);break;case"iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(n)&&(e=(e=/OS (\d+)_(\d+)_?(\d+)?/.exec(i))[1]+"."+e[2]+"."+(0|e[3]))}return{osName:t,osVersion:e}}())&&d.osName&&"-"!=d.osName?(m=d.osName,h=d.osVersion):_.any()&&"Android"==(m=_.getOsName())&&(h=!!(d=(b=(b||a.userAgent).toLowerCase()).match(/android\s([0-9.]*)/))&&d[1]),"object"===(void 0===o?"undefined":i(o))&&"object"===i(o.versions)&&o.versions.node),es=("Unknown OS"===m&&b&&(m="Nodejs",h=o.versions.node.toString().replace("v","")),!1),en=!1,em=(["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){"undefined"!=typeof document&&"function"==typeof document.createElement&&(!es&&e in document.createElement("canvas")&&(es=!0),!en&&e in document.createElement("video")&&(en=!0))}),/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/),eM=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,eF=/[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7}/,B=[],T=[],L=[],N=[],e4=(a.mediaDevices&&a.mediaDevices.enumerateDevices&&(a.enumerateDevices=function(e){var t=a.mediaDevices.enumerateDevices();t&&t.then?a.mediaDevices.enumerateDevices().then(e).catch(function(){e([])}):e([])}),!1),K=((void 0!==x&&"getSources"in x||a.mediaDevices&&a.mediaDevices.enumerateDevices)&&(e4=!0),!1),q=!1,Y=!1,R=!1,$=!1,n=window.DetectRTC||{},e8;n.browser=function(){a.appVersion;var n,i,e=a.userAgent,s=a.appName,t=""+parseFloat(a.appVersion),o=parseInt(a.appVersion,10);if(er&&!ec&&-1!==e.indexOf("CriOS")&&(ec=!(er=!1)),e7){s="Opera";try{o=(t=a.userAgent.split("OPR/")[1].split(" ")[0]).split(".")[0]}catch(e){t="0.0.0.0",o=0}}else ek?(t=0<(n=e.indexOf("rv:"))?e.substring(n+3):(n=e.indexOf("MSIE"),e.substring(n+5)),s="IE"):ec?(n=e.indexOf("Chrome"),s="Chrome",t=e.substring(n+7)):er?(n=e.indexOf("Safari"),s="Safari",t=e.substring(n+7),-1!==(n=e.indexOf("Version"))&&(t=e.substring(n+8)),-1!==a.userAgent.indexOf("Version/")&&(t=a.userAgent.split("Version/")[1].split(" ")[0])):eE?(n=e.indexOf("Firefox"),s="Firefox",t=e.substring(n+8)):(i=e.lastIndexOf(" ")+1)<(n=e.lastIndexOf("/"))&&(s=e.substring(i,n),t=e.substring(n+1),s.toLowerCase()===s.toUpperCase()&&(s=a.appName));return e9&&(s="Edge",t=a.userAgent.split("Edge/")[1]),-1!==(i=t.search(/[; )]/))&&(t=t.substring(0,i)),o=parseInt(""+t,10),isNaN(o)&&(t=""+parseFloat(a.appVersion),o=parseInt(a.appVersion,10)),{fullVersion:t,version:o,name:s,isPrivateBrowsing:!1}}();try{if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){g=!1},function(){g=!0});else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){try{(eo=window.indexedDB.open("test")).onerror=function(){return!0}}catch(e){g=!0}void 0===g&&e6(function(){return"done"===eo.readyState},function(e){e||(g=!eo.result)})}else if(function(){var e=window.navigator.userAgent.toLowerCase();if(0!==e.indexOf("msie")||0!==e.indexOf("trident"))return e=/(?:msie|rv:)\s?([\d.]+)/.exec(e),e&&10<=parseInt(e[1],10)}()){g=!1;try{window.indexedDB||(g=!0)}catch(e){g=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(e){g=!0}void 0===g&&(g=!1,window.localStorage.removeItem("test"))}}catch(e){g=!1}e6(function(){return void 0!==g},function(){var e=g;n.browser.isPrivateBrowsing=!!e}),n.browser["is"+n.browser.name]=!0,n.osName=m,n.osVersion=h,"object"===(void 0===o?"undefined":i(o))&&"object"===i(o.versions)&&o.versions["node-webkit"];var el=!1,d=(["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(e){el||e in window&&(el=!0)}),n.isWebRTCSupported=el,n.isORTCSupported="undefined"!=typeof RTCIceGatherer,!1),I=((n.browser.isChrome&&35<=n.browser.version||n.browser.isFirefox&&34<=n.browser.version||n.browser.isEdge&&17<=n.browser.version||"Android"===n.osName&&n.browser.isChrome)&&(d=!0),/^(https:|chrome-extension:)$/g.test(location.protocol||"")||("undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(n.browser.isChrome||n.browser.isEdge||n.browser.isOpera)||n.browser.isFirefox)&&(d=!1),n.isScreenCapturingSupported=d,{isSupported:!1,isCreateMediaStreamSourceSupported:!1}),b=(["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(e){I.isSupported||e in window&&(I.isSupported=!0,window[e]&&"createMediaStreamSource"in window[e].prototype&&(I.isCreateMediaStreamSourceSupported=!0))}),n.isAudioContextSupported=I.isSupported,n.isCreateMediaStreamSourceSupported=I.isCreateMediaStreamSourceSupported,!1),m=(n.browser.isChrome&&31<n.browser.version&&(b=!0),n.isRtpDataChannelsSupported=b,!1),h=((n.browser.isFirefox&&28<n.browser.version||n.browser.isChrome&&25<n.browser.version||n.browser.isOpera&&11<=n.browser.version)&&(m=!0),n.isSctpDataChannelsSupported=m,n.isMobileDevice=l,!1),k=((a.getUserMedia||a.mediaDevices&&a.mediaDevices.getUserMedia)&&(h=!0),n.browser.isChrome&&46<=n.browser.version&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(h="Requires HTTPs"),"Nodejs"===n.osName&&(h=!1),n.isGetUserMediaSupported=h,d="",screen.width&&(d+=(screen.width||"")+" x "+(screen.height||"")),n.displayResolution=d,n.displayAspectRatio=((b=screen.width)/(l=function n(t,e){return 0==e?t:n(e,t%e)}(b,m=screen.height))/(m/l)).toFixed(2),n.isCanvasSupportsStreamCapturing=es,n.isVideoSupportsStreamCapturing=en,"Chrome"==n.browser.name&&53<=n.browser.version&&(n.isCanvasSupportsStreamCapturing||(n.isCanvasSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"),n.isVideoSupportsStreamCapturing||(n.isVideoSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features")),n.DetectLocalIPAddress=function(c,s){if(n.isWebRTCSupported){var e,t,o,r,i=!0,a=!0;if("undefined"!=typeof document&&"function"==typeof document.getElementById){if(r={},!(o=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection)){if(t=document.getElementById("iframe"),!t)return;t=t.contentWindow,o=t.RTCPeerConnection||t.mozRTCPeerConnection||t.webkitRTCPeerConnection}if(o){if(t=null,e=new o({iceServers:[{urls:"stun:stun.l.google.com:19302"}]},t="Chrome"===n.browser&&n.browser.version<58?{optional:[{RtpDataChannels:!0}]}:t),s&&(e.addStream?e.addStream(s):e.addTrack&&s.getTracks()[0]&&e.addTrack(s.getTracks()[0],s)),e.onicecandidate=function(e){e.candidate&&l(e.candidate.candidate)},!s)try{e.createDataChannel("sctp",{})}catch(e){}n.isPromisesSupported?e.createOffer().then(function(t){e.setLocalDescription(t).then(d)}):e.createOffer(function(t){e.setLocalDescription(t,d,function(){})},function(){})}}function l(e){var t=eM.exec(e);t&&(t=t[1],e.match(em),void 0===r[t]&&((e=t).match(em)?c("Local: "+e,i=!1,a):e.match(eF)?c("Public: "+e,i,a=!1):c("Public: "+e,i,a)),r[t]=!0)}function d(){e.localDescription.sdp.split("\n").forEach(function(e){0===e.indexOf("a=candidate:")&&l(e)})}}},n.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,n.isWebSocketsBlocked=!n.isWebSocketsSupported,"Nodejs"===n.osName&&(n.isWebSocketsSupported=!0,n.isWebSocketsBlocked=!1),n.checkWebSocketsSupport=function(t){t=t||function(){};try{var s,e=new WebSocket("wss://echo.websocket.org:443/");e.onopen=function(){n.isWebSocketsBlocked=!1,s=(new Date).getTime(),e.send("ping")},e.onmessage=function(){n.WebsocketLatency=(new Date).getTime()-s+"ms",t(),e.close(),e=null},e.onerror=function(){n.isWebSocketsBlocked=!0,t()}}catch(e){n.isWebSocketsBlocked=!0,t()}},n.load=function(s){var t,e=s=s||function(){};e4?(!a.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(a.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!a.enumerateDevices&&a.enumerateDevices&&(a.enumerateDevices=a.enumerateDevices.bind(a)),a.enumerateDevices?(B=[],T=[],L=[],$=R=Y=q=K=!(N=[]),t={},a.enumerateDevices(function(s){s.forEach(function(o){var s,e={};for(s in o)try{"function"!=typeof o[s]&&(e[s]=o[s])}catch(e){}t[e.deviceId+e.label+e.kind]||("audio"===e.kind&&(e.kind="audioinput"),"video"===e.kind&&(e.kind="videoinput"),e.deviceId||(e.deviceId=e.id),e.id||(e.id=e.deviceId),e.label?("videoinput"!==e.kind||$||($=!0),"audioinput"!==e.kind||R||(R=!0)):(e.isCustomLabel=!0,"videoinput"===e.kind?e.label="Camera "+(N.length+1):"audioinput"===e.kind?e.label="Microphone "+(T.length+1):"audiooutput"===e.kind?e.label="Speaker "+(L.length+1):e.label="Please invoke getUserMedia once.",void 0!==n&&n.browser.isChrome&&46<=n.browser.version&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(e.label="HTTPs is required to get label of this "+e.kind+" device.")),"audioinput"===e.kind&&(K=!0,-1===T.indexOf(e)&&T.push(e)),"audiooutput"===e.kind&&(q=!0,-1===L.indexOf(e)&&L.push(e)),"videoinput"===e.kind&&(Y=!0,-1===N.indexOf(e)&&N.push(e)),B.push(e),t[e.deviceId+e.label+e.kind]=e)}),void 0!==n&&(n.MediaDevices=B,n.hasMicrophone=K,n.hasSpeakers=q,n.hasWebcam=Y,n.isWebsiteHasWebcamPermissions=$,n.isWebsiteHasMicrophonePermissions=R,n.audioInputDevices=T,n.audioOutputDevices=L,n.videoInputDevices=N),e&&e()})):e&&e()):e&&e()},n.MediaDevices=void 0!==B?B:[],n.hasMicrophone=K,n.hasSpeakers=q,n.hasWebcam=Y,n.isWebsiteHasWebcamPermissions=$,n.isWebsiteHasMicrophonePermissions=R,n.audioInputDevices=T,n.audioOutputDevices=L,n.videoInputDevices=N,h=!1,"undefined"!=typeof document&&"function"==typeof document.createElement&&"setSinkId"in document.createElement("video")&&(h=!0),n.isSetSinkIdSupported=h,d=!1,n.browser.isFirefox&&"undefined"!=typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(d=!0):n.browser.isChrome&&"undefined"!=typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(d=!0),n.isRTPSenderReplaceTracksSupported=d,b=!1,n.browser.isFirefox&&38<n.browser.version&&(b=!0),n.isRemoteStreamProcessingSupported=b,m=!1,void 0!==x&&"applyConstraints"in x.prototype&&(m=!0),n.isApplyConstraintsSupported=m,l=!1,n.browser.isFirefox&&43<=n.browser.version&&(l=!0),n.isMultiMonitorScreenCapturingSupported=l,n.isPromisesSupported=!!("Promise"in window),n.version="1.3.7",void 0===n&&(window.DetectRTC={}),void 0===(h=window.MediaStream)&&"undefined"!=typeof webkitMediaStream&&(h=webkitMediaStream),n.MediaStream=void 0!==h&&"function"==typeof h&&Object.keys(h.prototype),n.MediaStreamTrack=void 0!==x&&Object.keys(x.prototype),d=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,n.RTCPeerConnection=void 0!==d&&Object.keys(d.prototype),window.DetectRTC=n,"function"==typeof define&&e(144)&&define("DetectRTC",[],function(){return n}),"undefined"!=typeof cordova&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Crosswalk")&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),window.addEventListener||(window.addEventListener=function(e,t,n){e.attachEvent&&e.attachEvent("on"+t,n)}),window.attachEventListener=function(e,t,n,s){e.addEventListener(t,n,s)},window.MediaStream);function u(e,t){return!(e.session.audio&&"two-way"===e.session.audio||("Firefox"!==DetectRTC.browser.name||!1===t)&&("Chrome"!==DetectRTC.browser.name||DetectRTC.browser.version<50||!0!==typeof t&&(void 0!==t||!e.session.audio||!e.session.screen||e.session.video)))}function G(e){return"Firefox"===DetectRTC.browser.name||"Chrome"===DetectRTC.browser.name&&{mandatory:{chromeMediaSource:e.mandatory.chromeMediaSource,chromeMediaSourceId:e.mandatory.chromeMediaSourceId}}}function p(e,t){return e&&e.getTracks?e.getTracks().filter(function(e){return e.kind===(t||"audio")}):[]}function e1(){var e;"undefined"!=typeof cordova&&void 0!==cordova.plugins&&void 0!==cordova.plugins.iosrtc&&(e=cordova.plugins.iosrtc,window.webkitRTCPeerConnection=e.RTCPeerConnection,window.RTCSessionDescription=e.RTCSessionDescription,window.RTCIceCandidate=e.RTCIceCandidate,window.MediaStream=e.MediaStream,window.MediaStreamTrack=e.MediaStreamTrack,navigator.getUserMedia=navigator.webkitGetUserMedia=e.getUserMedia,e.debug.enable("iosrtc*"),"function"==typeof e.selectAudioOutput&&e.selectAudioOutput(window.iOSDefaultAudioOutputDevice||"speaker"),e.registerGlobals())}void 0===(k=void 0===k&&"undefined"!=typeof webkitMediaStream?webkitMediaStream:k)||"stop"in k.prototype||(k.prototype.stop=function(){this.getTracks().forEach(function(e){e.stop()})}),window.iOSDefaultAudioOutputDevice=window.iOSDefaultAudioOutputDevice||"speaker",document.addEventListener("deviceready",e1,!1),e1(),M={};function X(e){return{OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo}}void 0!==window.RTCPeerConnection?j=window.RTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?j=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection&&(j=webkitRTCPeerConnection);var ev=window.RTCSessionDescription||window.mozRTCSessionDescription,ew=window.RTCIceCandidate||window.mozRTCIceCandidate,x=window.MediaStreamTrack;function ei(n){if(void 0!==window.RTCPeerConnection?j=window.RTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?j=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection&&(j=webkitRTCPeerConnection),ev=window.RTCSessionDescription||window.mozRTCSessionDescription,ew=window.RTCIceCandidate||window.mozRTCIceCandidate,x=window.MediaStreamTrack,!j)throw"WebRTC 1.0 (RTCPeerConnection) API are NOT available in this browser.";t=n.rtcMultiConnection,s=(this.extra=(n.remoteSdp||t).extra,this.userid=n.userid,this.streams=[],this.channels=n.channels||[],this.connectionDescription=n.connectionDescription,this.addStream=function(e){t.addStream(e,s.userid)},this.removeStream=function(e){t.removeStream(e,s.userid)},this),n.remoteSdp&&(this.connectionDescription=n.remoteSdp.connectionDescription);var e,t,s,o,i,a,l={},c=(M.sdpConstraints=X({OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}),!!n.renegotiatingPeer),r=(n.remoteSdp&&(c=!!n.remoteSdp.renegotiatingPeer),[]);if(t.attachStreams.forEach(function(e){e&&r.push(e)}),c)e=n.peerRef;else{i="all",!t.candidates.turn&&!t.candidates.relay||t.candidates.stun||t.candidates.reflexive||t.candidates.host||(i="relay");try{o={iceServers:t.iceServers,iceTransportPolicy:t.iceTransportPolicy||i},void 0!==t.iceCandidatePoolSize&&(o.iceCandidatePoolSize=t.iceCandidatePoolSize),void 0!==t.bundlePolicy&&(o.bundlePolicy=t.bundlePolicy),void 0!==t.rtcpMuxPolicy&&(o.rtcpMuxPolicy=t.rtcpMuxPolicy),"Chrome"===DetectRTC.browser.name&&(o.sdpSemantics=t.sdpSemantics||"unified-plan"),t.iceServers&&t.iceServers.length||(o=null,t.optionalArgument=null),e=new j(o,t.optionalArgument)}catch(n){try{o={iceServers:t.iceServers},e=new j(o)}catch(t){e=new j}}}!e.getRemoteStreams&&e.getReceivers&&(e.getRemoteStreams=function(){var t=new k;return e.getReceivers().forEach(function(e){t.addTrack(e.track)}),[t]}),!e.getLocalStreams&&e.getSenders&&(e.getLocalStreams=function(){var t=new k;return e.getSenders().forEach(function(e){t.addTrack(e.track)}),[t]}),e.onicecandidate=function(o){o.candidate?t.trickleIce&&n.onLocalCandidate({candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex}):t.trickleIce||(o=e.localDescription,n.onLocalSdp({type:o.type,sdp:o.sdp,remotePeerSdpConstraints:n.remotePeerSdpConstraints||!1,renegotiatingPeer:!!n.renegotiatingPeer||!1,connectionDescription:s.connectionDescription,dontGetRemoteStream:!!n.dontGetRemoteStream,extra:t?t.extra:{},streamsToShare:a}))},r.forEach(function(o){n.remoteSdp&&n.remoteSdp.remotePeerSdpConstraints&&n.remoteSdp.remotePeerSdpConstraints.dontGetRemoteStream||n.dontAttachLocalStream||(o=t.beforeAddingStream(o,s))&&(e.getLocalStreams().forEach(function(e){o&&e.id==o.id&&(o=null)}),o&&o.getTracks&&o.getTracks().forEach(function(t){try{e.addTrack(t,o)}catch(e){}}))}),e.oniceconnectionstatechange=e.onsignalingstatechange=function(){var o=s.extra;t.peers[s.userid]&&(o=t.peers[s.userid].extra||o),e&&(n.onPeerStateChanged({iceConnectionState:e.iceConnectionState,iceGatheringState:e.iceGatheringState,signalingState:e.signalingState,extra:o,userid:s.userid}),e&&e.iceConnectionState&&-1!==e.iceConnectionState.search(/closed|failed/gi)&&s.streams instanceof Array&&s.streams.forEach(function(e){e=t.streamEvents[e.id]||{streamid:e.id,stream:e,type:"remote"},t.onstreamended(e)}))};var i={OfferToReceiveAudio:!!r.length,OfferToReceiveVideo:!!r.length},d=(n.localPeerSdpConstraints&&(i=n.localPeerSdpConstraints),M.sdpConstraints=X(i),{}),o=(e.ontrack=function(t){var s;t&&"track"===t.type&&(t.stream=t.streams[t.streams.length-1],t.stream.id||(t.stream.id=t.track.id),d[t.stream.id]&&"Safari"!==DetectRTC.browser.name?t.track&&(t.track.onended=function(){e.onremovestream(t)}):(d[t.stream.id]=t.stream.id,s={},n.remoteSdp&&n.remoteSdp.streamsToShare?s=n.remoteSdp.streamsToShare:n.streamsToShare&&(s=n.streamsToShare),(s=s[t.stream.id])?(t.stream.isAudio=s.isAudio,t.stream.isVideo=s.isVideo,t.stream.isScreen=s.isScreen):(t.stream.isVideo=!!p(t.stream,"video").length,t.stream.isAudio=!t.stream.isVideo,t.stream.isScreen=!1),t.stream.streamid=t.stream.id,l[t.stream.id]=t.stream,n.onRemoteStream(t.stream),t.stream.getTracks().forEach(function(n){n.onended=function(){e.onremovestream(t)}}),t.stream.onremovetrack=function(){e.onremovestream(t)}))},e.onremovestream=function(e){e.stream.streamid=e.stream.id,l[e.stream.id]&&delete l[e.stream.id],n.onRemoteStreamRemoved(e.stream)},"function"!=typeof e.removeStream&&(e.removeStream=function(t){t.getTracks().forEach(function(n){e.removeTrack(n,t)})}),this.addRemoteCandidate=function(t){e.addIceCandidate(new ew(t))},this.addRemoteSdp=function(n,s){s=s||function(){},"Safari"!==DetectRTC.browser.name&&(n.sdp=t.processSdp(n.sdp)),e.setRemoteDescription(new ev(n)).then(s,function(e){t.enableLogs&&console.error("setRemoteDescription failed","\n",e,"\n",n.sdp),s()}).catch(function(e){t.enableLogs&&console.error("setRemoteDescription failed","\n",e,"\n",n.sdp),s()})},!0);function u(t){t.binaryType="arraybuffer",t.onmessage=function(e){n.onDataChannelMessage(e.data)},t.onopen=function(){n.onDataChannelOpened(t)},t.onerror=function(e){n.onDataChannelError(e)},t.onclose=function(e){n.onDataChannelClosed(e)},t.internalSend=t.send,t.send=function(e){"open"===t.readyState&&t.internalSend(e)},e.channel=t}n.remoteSdp&&(o=!1),this.createDataChannel=function(){u(e.createDataChannel("sctp",{}))},!0!==t.session.data||c||(o?this.createDataChannel():e.ondatachannel=function(e){u(e.channel)}),this.enableDisableVideoEncoding=function(s){var t,n;e.getSenders().forEach(function(e){t||"video"!==e.track.kind||(t=e)}),t&&t.getParameters&&((n=t.getParameters()).encodings[1]&&(n.encodings[1].active=!!s),n.encodings[2]&&(n.encodings[2].active=!!s),t.setParameters(n))},n.remoteSdp&&(n.remoteSdp.remotePeerSdpConstraints&&(i=n.remoteSdp.remotePeerSdpConstraints),M.sdpConstraints=X(i),this.addRemoteSdp(n.remoteSdp,function(){h("createAnswer")})),"two-way"!=t.session.audio&&"two-way"!=t.session.video&&"two-way"!=t.session.screen||(M.sdpConstraints=X({OfferToReceiveAudio:"two-way"==t.session.audio||n.remoteSdp&&n.remoteSdp.remotePeerSdpConstraints&&n.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio,OfferToReceiveVideo:"two-way"==t.session.video||"two-way"==t.session.screen||n.remoteSdp&&n.remoteSdp.remotePeerSdpConstraints&&n.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio})),a={};function h(o){e[o](M.sdpConstraints).then(function(o){"Safari"!==DetectRTC.browser.name&&(o.sdp=t.processSdp(o.sdp)),e.setLocalDescription(o).then(function(){t.trickleIce&&(n.onLocalSdp({type:o.type,sdp:o.sdp,remotePeerSdpConstraints:n.remotePeerSdpConstraints||!1,renegotiatingPeer:!!n.renegotiatingPeer||!1,connectionDescription:s.connectionDescription,dontGetRemoteStream:!!n.dontGetRemoteStream,extra:t?t.extra:{},streamsToShare:a}),t.onSettingLocalDescription(s))},function(e){t.enableLogs&&console.error("setLocalDescription error",e)})},function(e){t.enableLogs&&console.error("sdp-error",e)})}e.getLocalStreams().forEach(function(e){a[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),o&&h("createOffer"),e.nativeClose=e.close,e.close=function(){if(e){try{e.nativeClose!==e.close&&e.nativeClose()}catch(e){}e=null,s.peer=null}},this.peer=e}O={removeVPX:function(e){var t=e3(e);return e=ee(e,"vp9",t,!0),ee(e,"vp8",t,!0)},disableNACK:function(e){if(e&&"string"==typeof e)return(e=(e=(e=e.replace("a=rtcp-fb:126 nack\r\n","")).replace("a=rtcp-fb:126 nack pli\r\n","a=rtcp-fb:126 pli\r\n")).replace("a=rtcp-fb:97 nack\r\n","")).replace("a=rtcp-fb:97 nack pli\r\n","a=rtcp-fb:97 pli\r\n");throw"Invalid arguments."},prioritize:function(t,e){if(e&&e.getSenders&&e.getSenders().length){if(!t||"string"!=typeof t)throw"Invalid arguments.";e.getSenders().forEach(function(s){for(var e=s.getParameters(),n=0;n<e.codecs.length;n++)if(e.codecs[n].mimeType==t){e.codecs.unshift(e.codecs.splice(n,1));break}s.setParameters(e)})}},removeNonG722:function(e){return e.replace(/m=audio ([0-9]+) RTP\/SAVPF ([0-9 ]*)/g,"m=audio $1 RTP/SAVPF 9")},setApplicationSpecificBandwidth:function(e,t,n){return e=e,n=n,!(t=t)||void 0!==P&&P||(n&&(t.screen?t.screen<300&&console.warn("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):console.warn("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),t.screen&&n&&(e=(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")).replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.screen+"\r\n")),(t.audio||t.video)&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")),t.audio&&(e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+t.audio+"\r\n")),t.screen?e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.screen+"\r\n"):t.video&&(e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.video+"\r\n"))),e},setVideoBitrates:function(o,i){var n,a,s=void 0,i=(s=i||{}).min,s=s.max,t=o.split("\r\n"),e=H(t,"a=rtpmap","VP8/90000");return(a=e?et(t[e]):a)?((e=H(t,"a=rtpmap","rtx/90000"))&&(n=et(t[e])),e&&null!==(e=H(t,"a=fmtp:"+n.toString()))&&(n="\r\n",t[e]=t[e].concat(n+="a=fmtp:"+a+" x-google-min-bitrate="+(i||"228")+"; x-google-max-bitrate="+(s||"228")),o=t.join("\r\n")),o):o},setOpusAttributes:function(o,n){var t,e=void 0,n=(e=n||{},o.split("\r\n")),s=H(n,"a=rtpmap","opus/48000");return(t=s?et(n[s]):t)?null===(s=H(n,"a=fmtp:"+t.toString()))?o:(t="",t=(t+="; stereo="+(void 0!==e.stereo?e.stereo:"1"))+("; sprop-stereo="+(void 0!==e["sprop-stereo"]?e["sprop-stereo"]:"1")),void 0!==e.maxaveragebitrate&&(t+="; maxaveragebitrate="+(e.maxaveragebitrate||1048576)),void 0!==e.maxplaybackrate&&(t+="; maxplaybackrate="+(e.maxplaybackrate||1048576)),void 0!==e.cbr&&(t+="; cbr="+(void 0!==e.cbr?e.cbr:"1")),void 0!==e.useinbandfec&&(t+="; useinbandfec="+e.useinbandfec),void 0!==e.usedtx&&(t+="; usedtx="+e.usedtx),void 0!==e.maxptime&&(t+="\r\na=maxptime:"+e.maxptime),n[s]=n[s].concat(t),n.join("\r\n")):o},preferVP9:function(e){return e0(e,"vp9")},preferCodec:e0,forceStereoAudio:function(s){for(var o,t=s.split("\r\n"),n=null,e=0;e<t.length;e++)if(-1!==t[e].search("opus/48000")){o=extractSdp(t[e],/:(\d+) opus\/48000/i);break}for(e=0;e<t.length;e++)if(-1!==t[e].search("a=fmtp")&&extractSdp(t[e],/a=fmtp:(\d+)/)===o){n=e;break}return null===n?s:(t[n]=t[n].concat("; stereo=1; sprop-stereo=1"),t.join("\r\n"))}};function e0(n,t){var e=e3(n);return!e.videoCodecNumbers||"vp8"===t&&e.vp8LineNumber===e.videoCodecNumbers[0]||"vp9"===t&&e.vp9LineNumber===e.videoCodecNumbers[0]||"h264"===t&&e.h264LineNumber===e.videoCodecNumbers[0]?n:ee(n,t,e)}function ee(s,t,e,i){if(n="","vp8"===t){if(!e.vp8LineNumber)return s;n=e.vp8LineNumber}if("vp9"===t){if(!e.vp9LineNumber)return s;n=e.vp9LineNumber}if("h264"===t){if(!e.h264LineNumber)return s;n=e.h264LineNumber}var n,t=e.videoCodecNumbersOriginal.split("SAVPF")[0]+"SAVPF ",o=i?[]:[n];return e.videoCodecNumbers.forEach(function(e){e!==n&&o.push(e)}),t+=o.join(" "),s.replace(e.videoCodecNumbersOriginal,t)}function e3(t){var e={};return t.split("\n").forEach(function(t){0===t.indexOf("m=video")&&(e.videoCodecNumbers=[],t.split("SAVPF")[1].split(" ").forEach(function(n){(n=n.trim())&&n.length&&(e.videoCodecNumbers.push(n),e.videoCodecNumbersOriginal=t)})),-1===t.indexOf("VP8/90000")||e.vp8LineNumber||(e.vp8LineNumber=t.replace("a=rtpmap:","").split(" ")[0]),-1===t.indexOf("VP9/90000")||e.vp9LineNumber||(e.vp9LineNumber=t.replace("a=rtpmap:","").split(" ")[0]),-1===t.indexOf("H264/90000")||e.h264LineNumber||(e.h264LineNumber=t.replace("a=rtpmap:","").split(" ")[0])}),e}function H(s,r,o){for(var t=s,i=r,n=o,a=t.length,e=0;e<a;++e)if(0===t[e].indexOf(i)&&(!n||-1!==t[e].toLowerCase().indexOf(n.toLowerCase())))return e;return null}function et(e){var t=new RegExp("a=rtpmap:(d+) w+/d+"),e=e.match(t);return e&&2===e.length?e[1]:null}window.BandwidthHandler=O,e8={processCandidates:function(n,s){var t=s.candidate,e=n.candidates,o=e.stun,i=e.turn;if(Z(e.reflexive)||(o=e.reflexive),Z(e.relay)||(i=e.relay),(e.host||!t.match(/typ host/g))&&(i||!t.match(/typ relay/g))&&(o||!t.match(/typ srflx/g))&&(e=n.iceProtocols,(e.udp||!t.match(/ udp /g))&&(e.tcp||!t.match(/ tcp /g))))return n.enableLogs&&console.debug("Your candidate pairs:",t),{candidate:t,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex}}},b=function(){return[{urls:["stun:webrtcweb.com:7788"],username:"muazkh",credential:"muazkh"},{urls:["turn:webrtcweb.com:7788","turn:webrtcweb.com:8877","turn:webrtcweb.com:4455"],username:"muazkh",credential:"muazkh"},{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun.l.google.com:19302?transport=udp"]}]};function ea(e){if(!0!==currentUserMediaRequest.mutex){currentUserMediaRequest.mutex=!0;var n,s,o,t=JSON.stringify(e.localMediaConstraints);if(currentUserMediaRequest.streams[t])i(currentUserMediaRequest.streams[t].stream,!0);else{if(/BB10|BlackBerry/i.test(navigator.userAgent||"")||void 0===navigator.mediaDevices||"function"!=typeof navigator.mediaDevices.getUserMedia)return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,void navigator.getUserMedia(e.localMediaConstraints,function(e){e.streamid=e.streamid||e.id||D(),e.idInstance=t,i(e)},function(t){e.onLocalMediaError(t,e.localMediaConstraints)});void 0===navigator.mediaDevices&&(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,o=function(){},navigator.mediaDevices={getUserMedia:function(e){return navigator.getUserMedia(e,function(e){e(stream),n=stream},function(e){o(e),s=e}),{then:function(e){if(!n)return{then:function(e){s?e(s):o=e}};e(n)}}}}),navigator.mediaDevices.getUserMedia(e.localMediaConstraints).then(function(e){e.streamid=e.streamid||e.id||D(),e.idInstance=t,i(e)}).catch(function(t){e.onLocalMediaError(t,e.localMediaConstraints)})}}else currentUserMediaRequest.queueRequests.push(e);function i(s,i){n=e.localMediaConstraints,o=s,n.mandatory&&n.mandatory.chromeMediaSource||n.mozMediaSource||n.mediaSource?o.isScreen=!0:n.video?o.isVideo=!0:n.audio&&(o.isAudio=!0);var o,n="ended";"oninactive"in s&&(n="inactive"),s.addEventListener(n,function(){delete currentUserMediaRequest.streams[t],currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.indexOf(e)&&(delete currentUserMediaRequest.queueRequests[currentUserMediaRequest.queueRequests.indexOf(e)],currentUserMediaRequest.queueRequests=ey(currentUserMediaRequest.queueRequests))},!1),currentUserMediaRequest.streams[t]={stream:s},currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.length&&ea(currentUserMediaRequest.queueRequests.shift()),e.onGettingLocalMedia(s,i)}}window.currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[],remove:function(t){this.mutex=!1;var e=this.streams[t];e&&(e=e.stream.currentUserMediaRequestOptions,this.queueRequests.indexOf(e)&&(delete this.queueRequests[this.queueRequests.indexOf(e)],this.queueRequests=ey(this.queueRequests)),this.streams[t].stream=null,delete this.streams[t])}},v={setHandlers:function(e,t,n){var s;e&&e.addEventListener&&(void 0!==t&&1!=t||(s="ended","oninactive"in e&&(s="inactive"),e.addEventListener(s,function(){v.onSyncNeeded(this.streamid,s)},!1)),e.mute=function(s,o){s=ep(s),void 0!==o&&(t=o),void 0!==s&&"audio"!=s||p(e,"audio").forEach(function(t){t.enabled=!1,n.streamEvents[e.streamid].isAudioMuted=!0}),void 0!==s&&"video"!=s||p(e,"video").forEach(function(e){e.enabled=!1}),void 0!==t&&1!=t||v.onSyncNeeded(e.streamid,"mute",s),n.streamEvents[e.streamid].muteType=s||"both",e5(e,"mute",s)},e.unmute=function(s,i){var o;s=ep(s),void 0!==i&&(t=i),n.streamEvents[e.streamid].mediaElement&&((o=n.streamEvents[e.streamid].mediaElement).volume=0,function o(t,n,s,e){n<=(e=(e||0)+1)||setTimeout(function(){s(),o(t,n,s,e)},t)}(200,5,function(){try{o.volume+=.2}catch(e){o.volume=1}})),void 0!==s&&"audio"!=s||p(e,"audio").forEach(function(t){t.enabled=!0,n.streamEvents[e.streamid].isAudioMuted=!1}),void 0!==s&&"video"!=s||(p(e,"video").forEach(function(e){e.enabled=!0}),void 0!==s&&"video"==s&&n.streamEvents[e.streamid].isAudioMuted&&function s(t){t=t||0,++t<100&&n.streamEvents[e.streamid].isAudioMuted&&(e.mute("audio"),setTimeout(function(){s(t)},50))}()),void 0!==t&&1!=t||v.onSyncNeeded(e.streamid,"unmute",s),n.streamEvents[e.streamid].unmuteType=s||"both",e5(e,"unmute",s)})},onSyncNeeded:function(){}};function ep(e){if(e)return"string"==typeof e||void 0===e?e:e.audio&&e.video?null:e.audio?"audio":e.video?"video":void 0}window.addEventListener("message",function(e){if(e.origin==window.location.origin){if(e=e.data,"PermissionDeniedError"==e){if(C="PermissionDeniedError",z)return void z("PermissionDeniedError");throw new Error("PermissionDeniedError")}"rtcmulticonnection-extension-loaded"==e&&(C="desktop"),e.sourceId&&z&&z(A=e.sourceId,!0===e.canRequestAudioTrack)}}),C="screen";function eT(e){if(e){if("desktop"==C)return e(!0);window.postMessage("are-you-there","*"),setTimeout(function(){e("screen"!=C)},2e3)}}P=void 0!==window.InstallTrigger,window.opera||navigator.userAgent.indexOf(" OPR/");function ex(t,e){if(P)return e("not-chrome");2!=arguments.length&&(e=t,t="ajhifddimkapgcifgcodmmfdlknahffk");var n=document.createElement("img");n.src="chrome-extension://"+t+"/icon.png",n.onload=function(){C="screen",window.postMessage("are-you-there","*"),setTimeout(function(){e("screen"==C?"installed-disabled":"installed-enabled")},2e3)},n.onerror=function(){e("not-installed")}}function eO(t){var e={};return{receive:function(s,a,r){var n,i,o=s.uuid;e[o]||(e[o]=[]),e[o].push(s.message),s.last&&(i=e[o].join(""),n={data:i=s.isobject?JSON.parse(i):i,userid:a,extra:r,latency:(new Date).getTime()-s.sendingTime},t.autoTranslateText?(n.original=n.data,t.Translator.TranslateText(n.data,function(e){n.data=e,t.onmessage(n)})):t.onmessage(n),delete e[o])}}}window.chrome;var t,c,F,J,eb,eC={send:function(e){var n=e.connection,i=e.channel,a=e.remoteUserId,e=e.text,t=n.chunkSize||1e3,s="",o=!1,r=("string"!=typeof e&&(o=!0,e=JSON.stringify(e)),D()),c=(new Date).getTime();!function u(d,l){var e={type:"text",uuid:r,sendingTime:c};d&&(l=d,e.packets=parseInt(l.length/t)),l.length>t?e.message=l.slice(0,t):(e.message=l,e.last=!0,e.isobject=o),i.send(e,a),(s=l.slice(e.message.length)).length&&setTimeout(function(){u(null,s)},n.chunkInterval||100)}(e)}},m={handle:function(t){var e={};t.onFileStart=function(n){var s=document.createElement("div");if(s.title=n.name,s.innerHTML="<label>0%</label> <progress></progress>",n.remoteUserId&&(s.innerHTML+=" (Sharing with:"+n.remoteUserId+")"),t.filesContainer||(t.filesContainer=document.body||document.documentElement),t.filesContainer.insertBefore(s,t.filesContainer.firstChild),!n.remoteUserId)return e[n.uuid]={div:s,progress:s.querySelector("progress"),label:s.querySelector("label")},void(e[n.uuid].progress.max=n.maxChunks);e[n.uuid]||(e[n.uuid]={}),e[n.uuid][n.remoteUserId]={div:s,progress:s.querySelector("progress"),label:s.querySelector("label")},e[n.uuid][n.remoteUserId].progress.max=n.maxChunks},t.onFileProgress=function(t){var n=e[t.uuid];!n||t.remoteUserId&&!(n=e[t.uuid][t.remoteUserId])||(n.progress.value=t.currentPosition||t.maxChunks||n.progress.max,t=n.progress,n=n.label,-1!==t.position&&(t=+t.position.toFixed(2).split(".")[1]||100,n.innerHTML=t+"%"))},t.onFileEnd=function(t){var n=e[t.uuid];n?t.remoteUserId&&!(n=e[t.uuid][t.remoteUserId])||(n=n.div,-1!=t.type.indexOf("image")?n.innerHTML='<a href="'+t.url+'" download="'+t.name+'">Download <strong style="color:red;">'+t.name+'</strong> </a><br /><img src="'+t.url+'" title="'+t.name+'" style="max-width: 80%;">':n.innerHTML='<a href="'+t.url+'" download="'+t.name+'">Download <strong style="color:red;">'+t.name+'</strong> </a><br /><iframe src="'+t.url+'" title="'+t.name+'" style="width: 80%;border: 0;height: inherit;margin-top:1em;"></iframe>'):console.error("No such progress-helper element exist.",t)}}},l={handle:function(e){e.autoTranslateText=!1,e.language="en",e.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",e.Translator={TranslateText:function(n,o){var s=document.createElement("script"),n=(s.type="text/javascript",encodeURIComponent(n)),t="method"+e.token(),t=(window[t]=function(e){e.data&&e.data.translations[0]&&o?o(e.data.translations[0].translatedText):e.error&&"Daily Limit Exceeded"===e.error.message?console.error('Text translation failed. Error message: "Daily Limit Exceeded."'):e.error?console.error(e.error.message):console.error(e)},"https://www.googleapis.com/language/translate/v2?key="+e.googKey+"&target="+(e.language||"en-US")+"&callback=window."+t+"&q="+n);s.src=t,document.getElementsByTagName("head")[0].appendChild(s)},getListOfLanguages:function(n){var t=new XMLHttpRequest,s=(t.onreadystatechange=function(){var e;t.readyState==XMLHttpRequest.DONE&&((e=JSON.parse(t.responseText))&&e.data&&e.data.languages?n(e.data.languages):e.error&&"Daily Limit Exceeded"===e.error.message?console.error('Text translation failed. Error message: "Daily Limit Exceeded."'):e.error?console.error(e.error.message):console.error(e))},"https://www.googleapis.com/language/translate/v2/languages?key="+e.googKey+"&target=en");t.open("GET",s,!0),t.send(null)}}}};function W(e){if(t.socketAutoReConnect=!0,t.socket)e&&e(t.socket);else{if(void 0===V)if("undefined"!=typeof FirebaseConnection)window.SocketConnection=FirebaseConnection;else{if("undefined"==typeof PubNubConnection)throw"SocketConnection.js seems missed.";window.SocketConnection=PubNubConnection}new V(t,function(){e&&e(t.socket)})}}function eg(e,n){t.socket.emit("join-room",{sessionid:t.sessionid,session:t.session,mediaConstraints:t.mediaConstraints,sdpConstraints:t.sdpConstraints,streams:ef(),extra:t.extra,password:void 0!==t.password&&"object"!==i(t.password)?t.password:""},function(s,o){if(!0===s){if(t.enableLogs&&console.log("isRoomJoined: ",s," roomid: ",t.sessionid),t.peers[t.sessionid])return;c.onNegotiationNeeded(e)}!1===s&&t.enableLogs&&console.warn("isRoomJoined: ",o," roomid: ",t.sessionid),n(s,t.sessionid,o)})}function U(e){t.enableLogs&&console.log("Sending open-room signal to socket.io"),t.waitingForLocalMedia=!1,t.socket.emit("open-room",{sessionid:t.sessionid,session:t.session,mediaConstraints:t.mediaConstraints,sdpConstraints:t.sdpConstraints,streams:ef(),extra:t.extra,identifier:t.publicRoomIdentifier,password:void 0!==t.password&&"object"!==i(t.password)?t.password:""},function(n,s){!0===n&&(t.enableLogs&&console.log("isRoomOpened: ",n," roomid: ",t.sessionid),e(n,t.sessionid)),!1===n&&(t.enableLogs&&console.warn("isRoomOpened: ",s," roomid: ",t.sessionid),e(n,t.sessionid,s))})}function ef(){try{return t.streamEvents.selectAll("local").map(function(e){return{streamid:e.streamid,tracks:e.stream.getTracks().length}})}catch(e){return[]}}function eh(s,n){var e,o;t.dontCaptureUserMedia||s.isDataOnly?n():(o={},s.localPeerSdpConstraints.OfferToReceiveAudio&&(o.audio=t.mediaConstraints.audio),s.localPeerSdpConstraints.OfferToReceiveVideo&&(o.video=t.mediaConstraints.video),(e=s.session||t.session).oneway&&"two-way"!==e.audio&&"two-way"!==e.video&&"two-way"!==e.screen?n():((e=e.oneway&&e.audio&&"two-way"===e.audio?{audio:!0}:e).audio||e.video||e.screen)&&(e.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:u(t)}).then(function(s){s.isScreen=!0,c.onGettingLocalMedia(s),!e.audio&&!e.video||u(t)?n(s):t.invokeGetUserMedia(null,n)},function(){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):t.getScreenConstraints(function(o,s){t.invokeGetUserMedia({audio:!!u(t)&&G(s),video:s,isScreen:!0},!e.audio&&!e.video||u(t)?n:t.invokeGetUserMedia(null,n))}):(e.audio||e.video)&&t.invokeGetUserMedia(null,n,e)))}function e2(n,e){n?(e.audio&&p(n,"audio").forEach(function(t){t.applyConstraints(e.audio)}),e.video&&p(n,"video").forEach(function(t){t.applyConstraints(e.video)})):t.enableLogs&&console.error("No stream to applyConstraints.")}function ed(e,n,s){n?c.replaceTrack(e,n,s):t.peers.getAllParticipants().forEach(function(t){c.replaceTrack(e,t,s)})}Q=Q||{useDefaultDevices:!0},(t=this).channel=t.sessionid=(eS||location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""))+"",c=new eA(t),J={},c.onGettingLocalMedia=function(e,n){if(n=n||function(){},J[e.streamid])n();else{J[e.streamid]=!0;try{e.type="local"}catch(e){}t.setStreamEndHandler(e),eu(e,function(i){i.id=e.streamid,i.muted=!0,i.volume=0,-1===t.attachStreams.indexOf(e)&&t.attachStreams.push(e),void 0!==v&&v.setHandlers(e,!0,t),t.streamEvents[e.streamid]={stream:e,type:"local",mediaElement:i,userid:t.userid,extra:t.extra,streamid:e.streamid,isAudioMuted:!0};try{var s=t,o=t.streamEvents[e.streamid];if(o.stream&&p(o.stream,"audio").length){if(!s||!o)throw"Both arguments are required.";if(s.onspeaking&&s.onsilence){if("undefined"==typeof hark)throw"hark.js not found.";hark(o.stream,{onspeaking:function(){s.onspeaking(o)},onsilence:function(){s.onsilence(o)},onvolumechange:function(e,t){s.onvolumechange&&s.onvolumechange(f({volume:e,threshold:t},o))}})}}ej(t,t.streamEvents[e.streamid]),t.onstream(t.streamEvents[e.streamid])}catch(e){}n()},t)}},c.onGettingRemoteMedia=function(e,n){try{e.type="remote"}catch(e){}t.setStreamEndHandler(e,"remote-stream"),eu(e,function(s){s.id=e.streamid,void 0!==v&&v.setHandlers(e,!1,t),t.streamEvents[e.streamid]={stream:e,type:"remote",userid:n,extra:t.peers[n]?t.peers[n].extra:{},mediaElement:s,streamid:e.streamid},ej(t,t.streamEvents[e.streamid]),t.onstream(t.streamEvents[e.streamid])},t)},c.onRemovingRemoteMedia=function(e,s){var n=(n=t.streamEvents[e.streamid])||{stream:e,type:"remote",userid:s,extra:t.peers[s]?t.peers[s].extra:{},streamid:e.streamid,mediaElement:t.streamEvents[e.streamid]?t.streamEvents[e.streamid].mediaElement:null};t.peersBackup[n.userid]&&(n.extra=t.peersBackup[n.userid].extra),t.onstreamended(n),delete t.streamEvents[e.streamid]},c.onNegotiationNeeded=function(e,s,n){n=n||function(){};var o={remoteUserId:s=s||e.remoteUserId,message:e=e||"",sender:t.userid};e.remoteUserId&&e.message&&e.sender&&(o=e),W(function(){t.socket.emit(t.socketMessageEvent,o,n)})},c.onUserLeft=function(e){t.deletePeer(e)},c.disconnectWith=function(e,n){t.socket&&t.socket.emit("disconnect-with",e,n||function(){}),t.deletePeer(e)},t.socketOptions={transport:"polling"},t.openOrJoin=function(n,e){e=e||function(){},t.checkPresence(n,function(n,s){var o,i,a,r;n?(t.sessionid=s,n=!!t.session.oneway,o=S(t.session),i={OfferToReceiveAudio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:t.sdpConstraints.mandatory.OfferToReceiveVideo},a={OfferToReceiveAudio:n?!!t.session.audio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:n?!!t.session.video||!!t.session.screen:t.sdpConstraints.mandatory.OfferToReceiveVideo},eh((r={remoteUserId:t.sessionid,message:{newParticipationRequest:!0,isOneWay:n,isDataOnly:o,localPeerSdpConstraints:a,remotePeerSdpConstraints:i},sender:t.userid}).message,function(){eg(r,e)})):(t.waitingForLocalMedia=!0,t.isInitiator=!0,t.sessionid=s||t.sessionid,S(t.session)?U(e):t.captureUserMedia(function(){U(e)}))})},t.waitingForLocalMedia=!1,t.open=function(n,e){e=e||function(){},t.waitingForLocalMedia=!0,t.isInitiator=!0,t.sessionid=n||t.sessionid,W(function(){S(t.session)?U(e):t.captureUserMedia(function(){U(e)})})},t.peersBackup={},t.deletePeer=function(e){if(e&&t.peers[e]){var n={userid:e,extra:t.peers[e]?t.peers[e].extra:{}};if(t.peersBackup[n.userid]&&(n.extra=t.peersBackup[n.userid].extra),t.onleave(n),t.peers[e]){if(t.peers[e].streams.forEach(function(e){e.stop()}),n=t.peers[e].peer,n&&"closed"!==n.iceConnectionState)try{n.close()}catch(e){}t.peers[e]&&(t.peers[e].peer=null,delete t.peers[e])}}},t.rejoin=function(e){var n;!t.isInitiator&&e&&Object.keys(e).length&&(n={},t.peers[e.remoteUserId]&&(n=t.peers[e.remoteUserId].extra,t.deletePeer(e.remoteUserId)),e&&e.remoteUserId&&(t.join(e.remoteUserId),t.onReConnecting({userid:e.remoteUserId,extra:n})))},t.join=function(e,n){t.sessionid=!!e&&(e.sessionid||e.remoteUserId||e)||t.sessionid,t.sessionid+="";var o=!1,i=!1,s=!1,a=!1,c=((e&&e.session||!e||"string"==typeof e)&&(s=!!(e=e&&e.session||t.session).oneway,a=S(e),i={OfferToReceiveAudio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:t.sdpConstraints.mandatory.OfferToReceiveVideo},o={OfferToReceiveAudio:s?!!t.session.audio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:s?!!t.session.video||!!t.session.screen:t.sdpConstraints.mandatory.OfferToReceiveVideo}),function(){}),r=("function"==typeof(n=n||{})&&(c=n,n={}),void 0!==n.localPeerSdpConstraints&&(o=n.localPeerSdpConstraints),void 0!==n.remotePeerSdpConstraints&&(i=n.remotePeerSdpConstraints),void 0!==n.isOneWay&&(s=n.isOneWay),void 0!==n.isDataOnly&&(a=n.isDataOnly),{remoteUserId:t.sessionid,message:{newParticipationRequest:!0,isOneWay:s,isDataOnly:a,localPeerSdpConstraints:o,remotePeerSdpConstraints:i},sender:t.userid});return eh(r.message,function(){W(function(){eg(r,c)})}),r},t.publicRoomIdentifier="",t.getUserMedia=t.captureUserMedia=function(n,s){n=n||function(){};var e=s||t.session;t.dontCaptureUserMedia||S(e)?n():(e.audio||e.video||e.screen)&&(e.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:u(t)}).then(function(i){if(i.isScreen=!0,c.onGettingLocalMedia(i),!e.audio&&!e.video||u(t))n(i);else{var o,a={};for(o in e)"screen"!==o&&(a[o]=e[o]);t.invokeGetUserMedia(s,n,a)}},function(){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):t.getScreenConstraints(function(o,i){if(o)throw o;t.invokeGetUserMedia({audio:!!u(t)&&G(i),video:i,isScreen:!0},function(a){if(!e.audio&&!e.video||u(t))n(a);else{var o,i={};for(o in e)"screen"!==o&&(i[o]=e[o]);t.invokeGetUserMedia(s,n,i)}})}):(e.audio||e.video)&&t.invokeGetUserMedia(s,n,e))},t.onbeforeunload=function(n,e){t.closeBeforeUnload&&(t.peers.getAllParticipants().forEach(function(e){c.onNegotiationNeeded({userLeft:!0},e),t.peers[e]&&t.peers[e].peer&&t.peers[e].peer.close(),delete t.peers[e]}),e||t.closeSocket(),t.isInitiator=!1)},window.ignoreBeforeUnload?t.closeBeforeUnload=!1:(t.closeBeforeUnload=!0,window.addEventListener("beforeunload",t.onbeforeunload,!1)),t.userid=D(),t.changeUserId=function(n,e){e=e||function(){},t.userid=n||D(),t.socket.emit("changed-uuid",t.userid,e)},t.extra={},t.attachStreams=[],t.session={audio:!0,video:!0},t.enableFileSharing=!1,t.bandwidth={screen:!1,audio:!1,video:!1},t.codecs={audio:"opus",video:"VP9"},t.processSdp=function(e){return function(){var t,e=!1;try{if("undefined"==typeof RTCRtpTransceiver)return;if(!("currentDirection"in RTCRtpTransceiver.prototype))return;t=new j;try{t.addTransceiver("audio"),e=!0}catch(e){}t.close()}catch(t){e=!1}return e&&function(){e=!1;try{t=new j({sdpSemantics:"unified-plan"});try{var t,n=t.getConfiguration(),e="unified-plan"==n.sdpSemantics||(n.sdpSemantics,!1)}catch(t){e=!1}}catch(t){e=!1}return e}()}()||"Safari"!==DetectRTC.browser.name&&("VP8"===t.codecs.video.toUpperCase()&&(e=O.preferCodec(e,"vp8")),"VP9"===t.codecs.video.toUpperCase()&&(e=O.preferCodec(e,"vp9")),"H264"===t.codecs.video.toUpperCase()&&(e=O.preferCodec(e,"h264")),"G722"===t.codecs.audio&&(e=O.removeNonG722(e)),"Firefox"!==DetectRTC.browser.name&&((t.bandwidth.video||t.bandwidth.screen)&&(e=O.setApplicationSpecificBandwidth(e,t.bandwidth,!!t.session.screen)),t.bandwidth.video&&(e=O.setVideoBitrates(e,{min:8*t.bandwidth.video*1024,max:8*t.bandwidth.video*1024})),t.bandwidth.audio&&(e=O.setOpusAttributes(e,{maxaveragebitrate:8*t.bandwidth.audio*1024,maxplaybackrate:8*t.bandwidth.audio*1024,stereo:1,maxptime:3})))),e},void 0!==O&&(t.BandwidthHandler=t.CodecsHandler=O),t.mediaConstraints={audio:{mandatory:{},optional:t.bandwidth.audio?[{bandwidth:8*t.bandwidth.audio*1024||1048576}]:[]},video:{mandatory:{},optional:t.bandwidth.video?[{bandwidth:8*t.bandwidth.video*1024||1048576},{facingMode:"user"}]:[{facingMode:"user"}]}},"Firefox"===DetectRTC.browser.name&&(t.mediaConstraints={audio:!0,video:!0}),Q.useDefaultDevices||DetectRTC.isMobileDevice||DetectRTC.load(function(){if(DetectRTC.MediaDevices.forEach(function(s){"audioinput"===s.kind&&!1!==t.mediaConstraints.audio&&(e=s),"videoinput"===s.kind&&!1!==t.mediaConstraints.video&&(n=s)}),e){if("Firefox"===DetectRTC.browser.name)return void(!0!==t.mediaConstraints.audio?t.mediaConstraints.audio.deviceId=e.id:t.mediaConstraints.audio={deviceId:e.id});1==t.mediaConstraints.audio&&(t.mediaConstraints.audio={mandatory:{},optional:[]}),t.mediaConstraints.audio.optional||(t.mediaConstraints.audio.optional=[]);var e,n,s=[{sourceId:e.id}];t.mediaConstraints.audio.optional=s.concat(t.mediaConstraints.audio.optional)}n&&("Firefox"===DetectRTC.browser.name?!0!==t.mediaConstraints.video?t.mediaConstraints.video.deviceId=n.id:t.mediaConstraints.video={deviceId:n.id}:(1==t.mediaConstraints.video&&(t.mediaConstraints.video={mandatory:{},optional:[]}),t.mediaConstraints.video.optional||(t.mediaConstraints.video.optional=[]),s=[{sourceId:n.id}],t.mediaConstraints.video.optional=s.concat(t.mediaConstraints.video.optional)))}),t.sdpConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},optional:[{VoiceActivityDetection:!1}]},t.sdpSemantics=null,t.iceCandidatePoolSize=null,t.bundlePolicy=null,t.rtcpMuxPolicy=null,t.iceTransportPolicy=null,t.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300},{googIPv6:!0},{googDscp:!0},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85},{googSuspendBelowMinBitrate:!0},{googCpuOveruseDetection:!0}],mandatory:{}},t.iceServers=b(t),t.candidates={host:!0,stun:!0,turn:!0},t.iceProtocols={tcp:!0,udp:!0},t.onopen=function(e){t.enableLogs&&console.info("Data connection has been opened between you & ",e.userid)},t.onclose=function(e){t.enableLogs&&console.warn("Data connection has been closed between you & ",e.userid)},t.onerror=function(e){t.enableLogs&&console.error(e.userid,"data-error",e)},t.onmessage=function(e){t.enableLogs&&console.debug("data-message",e.userid,e.data)},t.send=function(e,n){t.peers.send(e,n)},t.close=t.disconnect=t.leave=function(){t.onbeforeunload(!1,!0)},t.closeEntireSession=function(e){e=e||function(){},t.socket.emit("close-entire-session",function n(){t.getAllParticipants().length?setTimeout(n,100):(t.onEntireSessionClosed({sessionid:t.sessionid,userid:t.userid,extra:t.extra}),t.changeUserId(null,function(){t.close(),e()}))})},t.onEntireSessionClosed=function(e){t.enableLogs&&console.info("Entire session is closed: ",e.sessionid,e.extra)},t.onstream=function(n){var e=t.videosContainer,e=(e.insertBefore(n.mediaElement,e.firstChild),n.mediaElement.play());void 0===e?setTimeout(function(){n.mediaElement.play()},2e3):e.catch(function(){}).then(function(){setTimeout(function(){n.mediaElement.play()},2e3)})},t.onstreamended=function(e){e.mediaElement||(e.mediaElement=document.getElementById(e.streamid)),e.mediaElement&&e.mediaElement.parentNode&&e.mediaElement.parentNode.removeChild(e.mediaElement)},t.direction="many-to-many",t.removeStream=function(n,s){var e;t.attachStreams.forEach(function(t){t.id===n&&(e=t)}),e?(t.peers.getAllParticipants().forEach(function(n){if(!s||n===s){n=t.peers[n];try{n.peer.removeStream(e)}catch(e){}}}),t.renegotiate()):console.warn("No such stream exist.",n)},t.addStream=function(e,s){if(e.getTracks)return-1===t.attachStreams.indexOf(e)&&(e.streamid||(e.streamid=e.id),t.attachStreams.push(e)),void t.renegotiate(s);function n(n){e.streamCallback&&e.streamCallback(n),t.renegotiate(s)}S(e)?t.renegotiate(s):(e.audio||e.video||e.screen)&&(e.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:u(t)}).then(function(s){s.isScreen=!0,c.onGettingLocalMedia(s),!e.audio&&!e.video||u(t)?n(s):t.invokeGetUserMedia(null,function(e){n(e)})},function(){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):t.getScreenConstraints(function(s,o){if(s)return"PermissionDeniedError"===s?(e.streamCallback&&e.streamCallback(null),void(t.enableLogs&&console.error("User rejected to share his screen."))):alert(s);t.invokeGetUserMedia({audio:!!u(t)&&G(o),video:o,isScreen:!0},function(s){!e.audio&&!e.video||u(t)?n(s):t.invokeGetUserMedia(null,function(e){n(e)})})}):(e.audio||e.video)&&t.invokeGetUserMedia(null,n))},t.invokeGetUserMedia=function(e,s,n){n=n||t.session,ea({onGettingLocalMedia:function(t){var n=e.video;n&&(n.mediaSource||n.mozMediaSource||n.mandatory&&n.mandatory.chromeMediaSource)&&(t.isScreen=!0),t.isScreen||(t.isVideo=!!p(t,"video").length,t.isAudio=!t.isVideo&&p(t,"audio").length),c.onGettingLocalMedia(t,function(){"function"==typeof s&&s(t)})},onLocalMediaError:function(e,t){c.onLocalMediaError(e,t)},localMediaConstraints:(e=e||t.mediaConstraints)||{audio:!!n.audio&&e.audio,video:!!n.video&&e.video}})},t.applyConstraints=function(n,e){var s;x&&x.prototype.applyConstraints?e?e2(s=t.streamEvents[e]?t.streamEvents[e].stream:s,n):t.attachStreams.forEach(function(e){e2(e,n)}):alert("track.applyConstraints is NOT supported in your browser.")},t.replaceTrack=function(e,s,o){if(e=e||{},j.prototype.getSenders)if(e instanceof x)ed(e,s,o);else{if(e instanceof k)return p(e,"video").length&&ed(p(e,"video")[0],s,!0),void(p(e,"audio").length&&ed(p(e,"audio")[0],s,!1));if(S(e))throw"connection.replaceTrack requires audio and/or video and/or screen.";(e.audio||e.video||e.screen)&&(e.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:u(t)}).then(function(s){s.isScreen=!0,c.onGettingLocalMedia(s),!e.audio&&!e.video||u(t)?n(s):t.invokeGetUserMedia(null,n)},function(){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):t.getScreenConstraints(function(s,o){if(s)return alert(s);t.invokeGetUserMedia({audio:!!u(t)&&G(o),video:o,isScreen:!0},!e.audio&&!e.video||u(t)?n:t.invokeGetUserMedia(null,n))}):(e.audio||e.video)&&t.invokeGetUserMedia(null,n))}else t.addStream(e);function n(n){t.replaceTrack(n,s,o||e.video||e.screen)}},t.resetTrack=function(e,n){(e="string"==typeof(e=e||t.getAllParticipants())?[e]:e).forEach(function(s){var e=t.peers[s].peer;void 0!==n&&!0!==n||!e.lastVideoTrack||t.replaceTrack(e.lastVideoTrack,s,!0),void 0!==n&&!1!==n||!e.lastAudioTrack||t.replaceTrack(e.lastAudioTrack,s,!1)})},t.renegotiate=function(e){e?c.renegotiatePeer(e):t.peers.getAllParticipants().forEach(function(e){c.renegotiatePeer(e)})},t.setStreamEndHandler=function(e,n){var s;e&&e.addEventListener&&(n=!!n,!e.alreadySetEndHandler)&&(e.alreadySetEndHandler=!0,s="ended","oninactive"in e&&(s="inactive"),e.addEventListener(s,function(){e.idInstance&&currentUserMediaRequest.remove(e.idInstance),n||(o=[],t.attachStreams.forEach(function(t){t.id!=e.id&&o.push(t)}),t.attachStreams=o);var o,i,s=(s=t.streamEvents[e.streamid])||{stream:e,streamid:e.streamid,type:n?"remote":"local",userid:t.userid,extra:t.extra,mediaElement:t.streamEvents[e.streamid]?t.streamEvents[e.streamid].mediaElement:null};n&&t.peers[s.userid]&&(i=t.peers[s.userid].peer,o=[],i.getRemoteStreams().forEach(function(t){t.id!=e.id&&o.push(t)}),t.peers[s.userid].streams=o),s.userid===t.userid&&"remote"===s.type||(t.peersBackup[s.userid]&&(s.extra=t.peersBackup[s.userid].extra),t.onstreamended(s),delete t.streamEvents[e.streamid])},!1))},t.onMediaError=function(e,n){t.enableLogs&&console.error(e,n)},t.autoCloseEntireSession=!1,t.filesContainer=t.videosContainer=document.body||document.documentElement,t.isInitiator=!1,t.shareFile=c.shareFile,m.handle(t),l.handle(t),t.token=D,t.onNewParticipant=function(e,n){t.acceptParticipationRequest(e,n)},t.acceptParticipationRequest=function(t,e){e.successCallback&&(e.successCallback(),delete e.successCallback),c.createNewPeer(t,e)},void 0!==v&&(t.StreamsHandler=v),t.onleave=function(){},t.invokeSelectFileDialog=function(t){var e=new y;e.accept="*.*",e.selectSingleFile(t)},t.onmute=function(e){var t;e&&e.mediaElement&&("both"===e.muteType||"video"===e.muteType?(e.mediaElement.src=null,void 0!==(t=e.mediaElement.pause())?t.then(function(){e.mediaElement.poster=e.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"}):e.mediaElement.poster=e.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"):"audio"===e.muteType&&(e.mediaElement.muted=!0))},t.onunmute=function(e){e&&e.mediaElement&&e.stream&&("both"===e.unmuteType||"video"===e.unmuteType?(e.mediaElement.poster=null,e.mediaElement.srcObject=e.stream,e.mediaElement.play()):"audio"===e.unmuteType&&(e.mediaElement.muted=!1))},t.onExtraDataUpdated=function(e){e.status="online",t.onUserStatusChanged(e,!0)},t.getAllParticipants=function(e){return t.peers.getAllParticipants(e)},void 0!==v&&(v.onSyncNeeded=function(e,n,s){t.peers.getAllParticipants().forEach(function(t){c.onNegotiationNeeded({streamid:e,action:n,streamSyncNeeded:!0,type:s||"both"},t)})}),t.connectSocket=function(e){W(e)},t.closeSocket=function(){try{r.a.sockets={}}catch(e){}t.socket&&("function"==typeof t.socket.disconnect&&t.socket.disconnect(),"function"==typeof t.socket.resetProps&&t.socket.resetProps(),t.socket=null)},t.getSocket=function(e){return!e&&t.enableLogs&&console.warn("getSocket.callback paramter is required."),e=e||function(){},t.socket?e(t.socket):W(function(){e(t.socket)}),t.socket},t.getRemoteStreams=c.getRemoteStreams,eb=["selectFirst","selectAll","forEach"],t.streamEvents={selectFirst:function(e){return t.streamEvents.selectAll(e)[0]},selectAll:function(e){"video"==(e="audio"==(e="screen"==(e="remote"==(e="local"==(e=e||{local:!0,remote:!0,isScreen:!0,isAudio:!0,isVideo:!0})?{local:!0}:e)?{remote:!0}:e)?{isScreen:!0}:e)?{isAudio:!0}:e)&&(e={isVideo:!0});var n=[];return Object.keys(t.streamEvents).forEach(function(s){var o=t.streamEvents[s];-1===eb.indexOf(s)&&(s=!0,e.local&&"local"===o.type&&(s=!1),e.remote&&"remote"===o.type&&(s=!1),e.isScreen&&o.stream.isScreen&&(s=!1),e.isVideo&&o.stream.isVideo&&(s=!1),e.isAudio&&o.stream.isAudio&&(s=!1),!1===(s=!(e.userid&&o.userid===e.userid)&&s)&&n.push(o))}),n}},t.socketURL="/",t.socketMessageEvent="RTCMultiConnection-Message",t.socketCustomEvent="RTCMultiConnection-Custom-Message",t.DetectRTC=DetectRTC,t.setCustomSocketEvent=function(e){e&&(t.socketCustomEvent=e),t.socket&&t.socket.emit("set-custom-socket-event-listener",t.socketCustomEvent)},t.getNumberOfBroadcastViewers=function(e,n){t.socket&&e&&n&&t.socket.emit("get-number-of-users-in-specific-broadcast",e,n)},t.onNumberOfBroadcastViewersUpdated=function(e){t.enableLogs&&t.isInitiator&&console.info("Number of broadcast (",e.broadcastId,") viewers",e.numberOfBroadcastViewers)},t.onUserStatusChanged=function(e,n){t.enableLogs&&!n&&console.info(e.userid,e.status)},t.getUserMediaHandler=ea,t.multiPeersHandler=c,t.enableLogs=!0,t.setCustomSocketHandler=function(e){void 0!==V&&(V=e)},t.chunkSize=4e4,t.maxParticipantsAllowed=1e3,t.disconnectWith=c.disconnectWith,t.checkPresence=function(e,n){e=e||t.sessionid,"SSEConnection"!==V.name?t.socket?t.socket.emit("check-presence",e+"",function(e,s,o){t.enableLogs&&console.log("checkPresence.isRoomExist: ",e," roomid: ",s),n(e,s,o)}):t.connectSocket(function(){t.checkPresence(e,n)}):SSEConnection.checkPresence(e,function(e,s,o){if(!t.socket)return e||(t.userid=s),void t.connectSocket(function(){n(e,s,o)});n(e,s)})},t.onReadyForOffer=function(e,n){t.multiPeersHandler.createNewPeer(e,n)},t.setUserPreferences=function(e){return t.dontAttachStream&&(e.dontAttachLocalStream=!0),t.dontGetRemoteStream&&(e.dontGetRemoteStream=!0),e},t.updateExtraData=function(){t.socket.emit("extra-data-updated",t.extra)},t.enableScalableBroadcast=!1,t.maxRelayLimitPerUser=3,t.dontCaptureUserMedia=!1,t.dontAttachStream=!1,t.dontGetRemoteStream=!1,t.onReConnecting=function(e){t.enableLogs&&console.info("ReConnecting with",e.userid,"...")},t.beforeAddingStream=function(e){return e},t.beforeRemovingStream=function(e){return e},t.checkIfChromeExtensionAvailable=eT,"undefined"!=typeof isFirefoxExtensionAvailable&&(t.checkIfChromeExtensionAvailable=isFirefoxExtensionAvailable),t.getChromeExtensionStatus=ex,t.getScreenConstraints=function(o,e){u(t,e)&&(e=!0);var n,s=function(n,e){n||(e=t.modifyScreenConstraints(e),o(n,e))};P?s(null,{mozMediaSource:"window",mediaSource:"window"}):(n={mandatory:{chromeMediaSource:C,maxWidth:1920<screen.width?screen.width:1920,maxHeight:1080<screen.height?screen.height:1080},optional:[]},"desktop"!=C||A?("desktop"==C&&(n.mandatory.chromeMediaSourceId=A),s(null,n)):e?(e=function(e,t){n.mandatory.chromeMediaSourceId=e,t&&(n.canRequestAudioTrack=!0),s("PermissionDeniedError"==e?e:null,n)},A?e(A):(z=e,window.postMessage("audio-plus-tab","*"))):(e=function(e){n.mandatory.chromeMediaSourceId=e,s("PermissionDeniedError"==e?e:null,n)},A?e(A):(z=e,window.postMessage("get-sourceId","*"))))},t.modifyScreenConstraints=function(e){return e},t.onPeerStateChanged=function(e){t.enableLogs&&-1!==e.iceConnectionState.search(/closed|failed/gi)&&console.error("Peer connection is closed between you & ",e.userid,e.extra,"state:",e.iceConnectionState)},t.isOnline=!0,e_("online",function(){t.isOnline=!0}),e_("offline",function(){t.isOnline=!1}),t.isLowBandwidth=!1,navigator&&navigator.connection&&navigator.connection.type&&(t.isLowBandwidth=-1!==navigator.connection.type.toString().toLowerCase().search(/wifi|cell/g),t.isLowBandwidth)&&(t.bandwidth={audio:!1,video:!1,screen:!1},t.mediaConstraints.audio&&t.mediaConstraints.audio.optional&&t.mediaConstraints.audio.optional.length&&(F=[],t.mediaConstraints.audio.optional.forEach(function(e){void 0===e.bandwidth&&F.push(e)}),t.mediaConstraints.audio.optional=F),t.mediaConstraints.video&&t.mediaConstraints.video.optional&&t.mediaConstraints.video.optional.length&&(F=[],t.mediaConstraints.video.optional.forEach(function(e){void 0===e.bandwidth&&F.push(e)}),t.mediaConstraints.video.optional=F)),t.getExtraData=function(e,n){if(!e)throw"remoteUserId is required.";if(!n)return t.peers[e]?t.peers[e].extra:t.peersBackup[e]?t.peersBackup[e].extra:{};t.socket.emit("get-remote-user-extra-data",e,function(e,t,s){n(e,t,s)})},Q.autoOpenOrJoin&&t.openOrJoin(t.sessionid),t.onUserIdAlreadyTaken=function(e){t.close(),t.closeSocket(),t.isInitiator=!1,t.userid=t.token(),t.join(t.sessionid),t.enableLogs&&console.warn("Userid already taken.",e,"Your new userid:",t.userid)},t.trickleIce=!0,t.version="3.6.5",t.onSettingLocalDescription=function(e){t.enableLogs&&console.info("Set local description for remote user",e.userid)},t.resetScreen=function(){A=null,DetectRTC&&DetectRTC.screen&&delete DetectRTC.screen.sourceId,currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[]}},t.autoCreateMediaElement=!0,t.password=null,t.setPassword=function(n,e){e=e||function(){},t.socket?t.socket.emit("set-password",n,e):(t.password=n,e(!0,t.sessionid,null))},t.errors={ROOM_NOT_AVAILABLE:"Room not available",INVALID_PASSWORD:"Invalid password",USERID_NOT_AVAILABLE:"User ID does not exist",ROOM_PERMISSION_DENIED:"Room permission denied",ROOM_FULL:"Room full",DID_NOT_JOIN_ANY_ROOM:"Did not join any room yet",INVALID_SOCKET:"Invalid socket",PUBLIC_IDENTIFIER_MISSING:"publicRoomIdentifier is required",INVALID_ADMIN_CREDENTIAL:"Invalid username or password attempted"}}}.call(this,e(73).Buffer,e(31),e(49))},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,function(e){e.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var n,i,o=e[1]||"",s=(n=e[3])?t&&"function"==typeof btoa?(i="/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */",s=n.sources.map(function(e){return"/*# sourceURL="+n.sourceRoot+e+" */"}),[o].concat(s).concat([i]).join("\n")):[o].join("\n"):o;return e[2]?"@media "+e[2]+"{"+s+"}":s}).join("")},e.i=function(s,o){"string"==typeof s&&(s=[[null,s,""]]);for(var t,i,a={},n=0;n<this.length;n++)i=this[n][0],"number"==typeof i&&(a[i]=!0);for(n=0;n<s.length;n++)t=s[n],"number"==typeof t[0]&&a[t[0]]||(o&&!t[2]?t[2]=o:o&&(t[2]="("+t[2]+") and ("+o+")"),e.push(t))},e}},null,function(e){e.exports=function(t){if(e="undefined"!=typeof window&&window.location,!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var e,n=e.protocol+"//"+e.host,s=n+e.pathname.replace(/\/[^/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,e){return e=e.trim().replace(/^"(.*)"$/,function(t,e){return e}).replace(/^'(.*)'$/,function(t,e){return e}),/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(e)?t:(t=0===e.indexOf("//")?e:0===e.indexOf("/")?n+e:s+e.replace(/^\.\//,""),"url("+JSON.stringify(t)+")")})}},function(c,o){"use strict";o.byteLength=function(e){var e=i(e),t=e[0],e=e[1];return 3*(t+e)/4-e},o.toByteArray=function(n){for(var s,o=i(n),l=o[0],o=o[1],a=new r(3*(l+o)/4-o),c=0,d=0<o?l-4:l,t=0;t<d;t+=4)s=e[n.charCodeAt(t)]<<18|e[n.charCodeAt(t+1)]<<12|e[n.charCodeAt(t+2)]<<6|e[n.charCodeAt(t+3)],a[c++]=s>>16&255,a[c++]=s>>8&255,a[c++]=255&s;return 2===o&&(s=e[n.charCodeAt(t)]<<2|e[n.charCodeAt(t+1)]>>4,a[c++]=255&s),1===o&&(s=e[n.charCodeAt(t)]<<10|e[n.charCodeAt(t+1)]<<4|e[n.charCodeAt(t+2)]>>2,a[c++]=s>>8&255,a[c++]=255&s),a},o.fromByteArray=function(n){for(var e,s=n.length,a=s%3,i=[],o=0,r=s-a;o<r;o+=16383)i.push(function(s,i,a){for(var e,o=[],n=i;n<a;n+=3)e=(s[n]<<16&16711680)+(s[n+1]<<8&65280)+(255&s[n+2]),o.push(t[(e=e)>>18&63]+t[e>>12&63]+t[e>>6&63]+t[63&e]);return o.join("")}(n,o,r<o+16383?r:o+16383));return 1==a?(e=n[s-1],i.push(t[e>>2]+t[e<<4&63]+"==")):2==a&&(e=(n[s-2]<<8)+n[s-1],i.push(t[e>>10]+t[e>>4&63]+t[e<<2&63]+"=")),i.join("")};for(var t=[],e=[],r="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,a=s.length;n<a;++n)t[n]=s[n],e[s.charCodeAt(n)]=n;function i(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");return e=e.indexOf("="),[e=-1===e?t:e,e===t?0:4-e%4]}e["-".charCodeAt(0)]=62,e["_".charCodeAt(0)]=63},function(t,e){e.read=function(r,a,h,i,n){var t,o,u=8*n-i-1,l=(1<<u)-1,d=l>>1,e=-7,s=h?n-1:0,c=h?-1:1,n=r[a+s];for(s+=c,t=n&(1<<-e)-1,n>>=-e,e+=u;0<e;t=256*t+r[a+s],s+=c,e-=8);for(o=t&(1<<-e)-1,t>>=-e,e+=i;0<e;o=256*o+r[a+s],s+=c,e-=8);if(0===t)t=1-d;else{if(t===l)return o?NaN:1/0*(n?-1:1);o+=Math.pow(2,i),t-=d}return(n?-1:1)*o*Math.pow(2,t-i)},e.write=function(d,t,u,n,s,r){var e,o,c=8*r-s-1,l=(1<<c)-1,i=l>>1,m=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,a=n?0:r-1,h=n?1:-1,r=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,e=l):(e=Math.floor(Math.log(t)/Math.LN2),t*(n=Math.pow(2,-e))<1&&(e--,n*=2),2<=(t+=1<=e+i?m/n:m*Math.pow(2,1-i))*n&&(e++,n/=2),l<=e+i?(o=0,e=l):1<=e+i?(o=(t*n-1)*Math.pow(2,s),e+=i):(o=t*Math.pow(2,i-1)*Math.pow(2,s),e=0));8<=s;d[u+a]=255&o,a+=h,o/=256,s-=8);for(e=e<<s|o,c+=s;0<c;d[u+a]=255&e,a+=h,e/=256,c-=8);d[u+a-h]|=128*r}},function(e){var t={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==t.call(e)}},function(n,o,e){var s=e(145),t=e(74)("socket.io-client:url");n.exports=function(e,o){var n=e,e=(o=o||"undefined"!=typeof location&&location,"string"==typeof(e=e??o.protocol+"//"+o.host)&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?o.protocol+e:o.host+e),/^(https?|wss?):\/\//.test(e)||(t("protocol-less url %s",e),e=void 0!==o?o.protocol+"//"+e:"https://"+e),t("parse %s",e),n=s(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/",-1!==n.host.indexOf(":")?"["+n.host+"]":n.host);return n.id=n.protocol+"://"+e+":"+n.port,n.href=n.protocol+"://"+e+(o&&o.port===n.port?"":":"+n.port),n}},function(n,e,s){function t(n){var s;function t(){if(t.enabled){var n,i,a,o=t,r=+new Date,c=r-(s||r);o.diff=c,o.prev=s,o.curr=r,s=r;for(n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];n[0]=e.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O"),a=0,n[0]=n[0].replace(/%([a-zA-Z%])/g,function(t,s){if("%%"===t)return t;a++;var i,s=e.formatters[s];return"function"==typeof s&&(i=n[a],t=s.call(o,i),n.splice(a,1),a--),t}),e.formatArgs.call(o,n),(t.log||e.log||console.log.bind(console)).apply(o,n)}}return t.namespace=n,t.enabled=e.enabled(n),t.useColors=e.useColors(),t.color=function(n){var s,t=0;for(s in n)t=(t<<5)-t+n.charCodeAt(s),t|=0;return e.colors[Math.abs(t)%e.colors.length]}(n),t.destroy=o,"function"==typeof e.init&&e.init(t),e.instances.push(t),t}function o(){var t=e.instances.indexOf(this);return-1!==t&&(e.instances.splice(t,1),!0)}(e=n.exports=t.debug=t.default=t).coerce=function(e){return e instanceof Error?e.stack||e.message:e},e.disable=function(){e.enable("")},e.enable=function(n){e.save(n),e.names=[],e.skips=[];for(var o,s=("string"==typeof n?n:"").split(/[\s,]+/),i=s.length,t=0;t<i;t++)s[t]&&("-"===(n=s[t].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+n.substr(1)+"$")):e.names.push(new RegExp("^"+n+"$")));for(t=0;t<e.instances.length;t++)o=e.instances[t],o.enabled=e.enabled(o.namespace)},e.enabled=function(n){if("*"===n[n.length-1])return!0;for(var t=0,s=e.skips.length;t<s;t++)if(e.skips[t].test(n))return!1;for(t=0,s=e.names.length;t<s;t++)if(e.names[t].test(n))return!0;return!1},e.humanize=s(104),e.instances=[],e.names=[],e.skips=[],e.formatters={}},function(e,n,t){e.exports=t(77)},function(n,e,s){function t(n){var s;function t(){if(t.enabled){var n,i,a,o=t,r=+new Date,c=r-(s||r);o.diff=c,o.prev=s,o.curr=r,s=r;for(n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];n[0]=e.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O"),a=0,n[0]=n[0].replace(/%([a-zA-Z%])/g,function(t,s){if("%%"===t)return t;a++;var i,s=e.formatters[s];return"function"==typeof s&&(i=n[a],t=s.call(o,i),n.splice(a,1),a--),t}),e.formatArgs.call(o,n),(t.log||e.log||console.log.bind(console)).apply(o,n)}}return t.namespace=n,t.enabled=e.enabled(n),t.useColors=e.useColors(),t.color=function(n){var s,t=0;for(s in n)t=(t<<5)-t+n.charCodeAt(s),t|=0;return e.colors[Math.abs(t)%e.colors.length]}(n),t.destroy=o,"function"==typeof e.init&&e.init(t),e.instances.push(t),t}function o(){var t=e.instances.indexOf(this);return-1!==t&&(e.instances.splice(t,1),!0)}(e=n.exports=t.debug=t.default=t).coerce=function(e){return e instanceof Error?e.stack||e.message:e},e.disable=function(){e.enable("")},e.enable=function(n){e.save(n),e.names=[],e.skips=[];for(var o,s=("string"==typeof n?n:"").split(/[\s,]+/),i=s.length,t=0;t<i;t++)s[t]&&("-"===(n=s[t].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+n.substr(1)+"$")):e.names.push(new RegExp("^"+n+"$")));for(t=0;t<e.instances.length;t++)o=e.instances[t],o.enabled=e.enabled(o.namespace)},e.enabled=function(n){if("*"===n[n.length-1])return!0;for(var t=0,s=e.skips.length;t<s;t++)if(e.skips[t].test(n))return!1;for(t=0,s=e.names.length;t<s;t++)if(e.names[t].test(n))return!0;return!1},e.humanize=s(104),e.instances=[],e.names=[],e.skips=[],e.formatters={}},function(i,t,e){var n=e(147),e=Object.prototype.toString,s="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===e.call(Blob),o="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===e.call(File);t.deconstructPacket=function(e){var t=[],s=e.data;return e.data=function r(e,o){if(!e)return e;if(n(e))return a={_placeholder:!0,num:o.length},o.push(e),a;if(Array.isArray(e)){for(var i,a,t=new Array(e.length),s=0;s<e.length;s++)t[s]=r(e[s],o);return t}if("object"!=typeof e||e instanceof Date)return e;for(i in t={},e)t[i]=r(e[i],o);return t}(s,t),e.attachments=t.length,{packet:e,buffers:t}},t.reconstructPacket=function(e,t){return e.data=function s(e,n){if(!e)return e;if(e&&e._placeholder)return n[e.num];if(Array.isArray(e))for(var o,t=0;t<e.length;t++)e[t]=s(e[t],n);else if("object"==typeof e)for(o in e)e[o]=s(e[o],n);return e}(e.data,t),e.attachments=void 0,e},t.removeBlobs=function(a,i){var t=0,e=a;!function c(a,h,l){if(!a)return a;if(s&&a instanceof Blob||o&&a instanceof File){t++;var r,u,d=new FileReader;d.onload=function(){l?l[h]=this.result:e=this.result,--t||i(e)},d.readAsArrayBuffer(a)}else if(Array.isArray(a))for(r=0;r<a.length;r++)c(a[r],r,a);else if("object"==typeof a&&!n(a))for(u in a)c(a[u],u,a)}(e),t||i(e)}},function(e,n,t){e.exports=t(379),e.exports.parser=t(51)},function(o,d,n){var a=n(149),l=n(50),t=n(77)("engine.io-client:socket"),r=n(153),i=n(51),s=n(145),c=n(75);function e(n,t){if(!(this instanceof e))return new e(n,t);t=t||{},n&&"object"==typeof n&&(t=n,n=null),n?(n=s(n),t.hostname=n.host,t.secure="https"===n.protocol||"wss"===n.protocol,t.port=n.port,n.query&&(t.query=n.query)):t.host&&(t.hostname=s(t.host).host),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=c.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),"undefined"!=typeof self&&!this.isReactNative||(t.extraHeaders&&0<Object.keys(t.extraHeaders).length&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}(o.exports=e).priorWebsocketSuccess=!1,l(e.prototype),e.protocol=i.protocol,(e.Socket=e).Transport=n(107),e.transports=n(149),e.parser=n(51),e.prototype.createTransport=function(n){t('creating transport "%s"',n);var s=function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(this.query),e=(s.EIO=4,s.transport=n,this.transportOptions[n]||{});return this.id&&(s.sid=this.id),new a[n]({query:s,socket:this,agent:e.agent||this.agent,hostname:e.hostname||this.hostname,port:e.port||this.port,secure:e.secure||this.secure,path:e.path||this.path,forceJSONP:e.forceJSONP||this.forceJSONP,jsonp:e.jsonp||this.jsonp,forceBase64:e.forceBase64||this.forceBase64,enablesXDR:e.enablesXDR||this.enablesXDR,timestampRequests:e.timestampRequests||this.timestampRequests,timestampParam:e.timestampParam||this.timestampParam,policyPort:e.policyPort||this.policyPort,pfx:e.pfx||this.pfx,key:e.key||this.key,passphrase:e.passphrase||this.passphrase,cert:e.cert||this.cert,ca:e.ca||this.ca,ciphers:e.ciphers||this.ciphers,rejectUnauthorized:e.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:e.perMessageDeflate||this.perMessageDeflate,extraHeaders:e.extraHeaders||this.extraHeaders,forceNode:e.forceNode||this.forceNode,localAddress:e.localAddress||this.localAddress,requestTimeout:e.requestTimeout||this.requestTimeout,protocols:e.protocols||void 0,isReactNative:this.isReactNative})},e.prototype.open=function(){var t,n;if(this.rememberUpgrade&&e.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length)return n=this,void setTimeout(function(){n.emit("error","No transports available")},0);t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(e){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)},e.prototype.setTransport=function(n){t("setting transport %s",n.name);var e=this;this.transport&&(t("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),(this.transport=n).on("drain",function(){e.onDrain()}).on("packet",function(t){e.onPacket(t)}).on("error",function(t){e.onError(t)}).on("close",function(){e.onClose("transport close")})},e.prototype.probe=function(i){t('probing transport "%s"',i);var n=this.createTransport(i,{probe:1}),o=!1,s=this;function r(){var a;s.onlyBinaryUpgrades&&(a=!this.supportsBinary&&s.transport.supportsBinary,o=o||a),o||(t('probe transport "%s" opened',i),n.send([{type:"ping",data:"probe"}]),n.once("packet",function(a){o||("pong"===a.type&&"probe"===a.data?(t('probe transport "%s" pong',i),s.upgrading=!0,s.emit("upgrading",n),n&&(e.priorWebsocketSuccess="websocket"===n.name,t('pausing current transport "%s"',s.transport.name),s.transport.pause(function(){o||"closed"!==s.readyState&&(t("changing transport and sending upgrade packet"),h(),s.setTransport(n),n.send([{type:"upgrade"}]),s.emit("upgrade",n),n=null,s.upgrading=!1,s.flush())}))):(t('probe transport "%s" failed',i),(a=new Error("probe error")).transport=n.name,s.emit("upgradeError",a)))}))}function c(){o||(o=!0,h(),n.close(),n=null)}function a(e){var o=new Error("probe error: "+e);o.transport=n.name,c(),t('probe transport "%s" failed because of error: %s',i,e),s.emit("upgradeError",o)}function l(){a("transport closed")}function d(){a("socket closed")}function u(e){n&&e.name!==n.name&&(t('"%s" works - aborting "%s"',e.name,n.name),c())}function h(){n.removeListener("open",r),n.removeListener("error",a),n.removeListener("close",l),s.removeListener("close",d),s.removeListener("upgrading",u)}e.priorWebsocketSuccess=!1,n.once("open",r),n.once("error",a),n.once("close",l),this.once("close",d),this.once("upgrading",u),n.open()},e.prototype.onOpen=function(){if(t("socket open"),this.readyState="open",e.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){t("starting upgrade probes");for(var n=0,s=this.upgrades.length;n<s;n++)this.probe(this.upgrades[n])}},e.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(t('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var n=new Error("server error");n.code=e.data,this.onError(n);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else t('packet received with socket readyState "%s"',this.readyState)},e.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},e.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout(function(){"closed"!==e.readyState&&e.onClose("ping timeout")},t||e.pingInterval+e.pingTimeout)},e.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){t("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},e.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},e.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),(this.prevBufferLen=0)===this.writeBuffer.length?this.emit("drain"):this.flush()},e.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(t("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},e.prototype.write=e.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},e.prototype.sendPacket=function(s,t,e,n){"function"==typeof t&&(n=t,t=void 0),"function"==typeof e&&(n=e,e=null),"closing"!==this.readyState&&"closed"!==this.readyState&&((e=e||{}).compress=!1!==e.compress,this.emit("packetCreate",s={type:s,data:t,options:e}),this.writeBuffer.push(s),n&&this.once("flush",n),this.flush())},e.prototype.close=function(){var e;function s(){e.onClose("forced close"),t("socket closing - telling transport to close"),e.transport.close()}function n(){e.removeListener("upgrade",n),e.removeListener("upgradeError",n),s()}function o(){e.once("upgrade",n),e.once("upgradeError",n)}return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",(e=this).writeBuffer.length?this.once("drain",function(){(this.upgrading?o:s)()}):(this.upgrading?o:s)()),this},e.prototype.onError=function(n){t("socket error %j",n),e.priorWebsocketSuccess=!1,this.emit("error",n),this.onClose("transport error",n)},e.prototype.onClose=function(e,n){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(t('socket close with reason: "%s"',e),clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,n),this.writeBuffer=[],this.prevBufferLen=0)},e.prototype.filterUpgrades=function(t){for(var n=[],e=0,s=t.length;e<s;e++)~r(this.transports,t[e])&&n.push(t[e]);return n}},function(e){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}},function(o,u,t){var l=t(106),r=t(150),d=t(50),c=t(76),s=t(77)("engine.io-client:polling-xhr");function a(){}function n(e){var t,n;r.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,"undefined"!=typeof location&&(t="https:"===location.protocol,n=(n=location.port)||(t?443:80),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||n!==e.port,this.xs=e.secure!==t)}function e(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function i(){for(var t in e.requests)e.requests.hasOwnProperty(t)&&e.requests[t].abort()}o.exports=n,o.exports.Request=e,c(n,r),n.prototype.supportsBinary=!0,n.prototype.request=function(t){return(t=t||{}).uri=this.uri(),t.xd=this.xd,t.xs=this.xs,t.agent=this.agent||!1,t.supportsBinary=this.supportsBinary,t.enablesXDR=this.enablesXDR,t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,t.requestTimeout=this.requestTimeout,t.extraHeaders=this.extraHeaders,new e(t)},n.prototype.doWrite=function(e,t){var e=this.request({method:"POST",data:e,isBinary:"string"!=typeof e&&void 0!==e}),n=this;e.on("success",t),e.on("error",function(e){n.onError("xhr post error",e)}),this.sendXhr=e},n.prototype.doPoll=function(){s("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},d(e.prototype),e.prototype.create=function(){var i,n={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR},t=(n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.xhr=new l(n)),o=this;try{s("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(i in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(i)&&t.setRequestHeader(i,this.extraHeaders[i])}catch(e){}if("POST"===this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=!0),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){o.onLoad()},t.onerror=function(){o.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState)try{var e=t.getResponseHeader("Content-Type");o.supportsBinary&&"application/octet-stream"===e&&(t.responseType="arraybuffer")}catch(e){}4===t.readyState&&(200===t.status||1223===t.status?o.onLoad():setTimeout(function(){o.onError(t.status)},0))},s("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout(function(){o.onError(e)},0)}"undefined"!=typeof document&&(this.index=e.requestsCount++,e.requests[this.index]=this)},e.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},e.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},e.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},e.prototype.cleanup=function(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=a:this.xhr.onreadystatechange=a,t)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete e.requests[this.index],this.xhr=null}},e.prototype.onLoad=function(){var e,t;try{try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e="application/octet-stream"===t&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},e.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},e.prototype.abort=function(){this.cleanup()},e.requestsCount=0,e.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",i):"function"==typeof addEventListener&&(t="onpagehide"in self?"pagehide":"unload",addEventListener(t,i,!1)))},function(e){e.exports=Object.keys||function(t){var e,n=[],s=Object.prototype.hasOwnProperty;for(e in t)s.call(t,e)&&n.push(e);return n}},function(){},function(e){e.exports=function(s,t,e){if(n=s.byteLength,t=t||0,e=e||n,s.slice)return s.slice(t,e);if(t<0&&(t+=n),e<0&&(e+=n),n<e&&(e=n),n<=t||e<=t||0===n)return new ArrayBuffer(0);for(var n,r=new Uint8Array(s),i=new Uint8Array(e-t),o=t,a=0;o<e;o++,a++)i[a]=r[o];return i.buffer}},function(e){function t(){}e.exports=function(i,n,s){var o=!1;return s=s||t,0===(e.count=i)?n():e;function e(t,i){if(e.count<=0)throw new Error("after called too many times");--e.count,t?(o=!0,n(t),n=s):0!==e.count||o||n(null,i)}}},function(c){var e,s,o,t=String.fromCharCode;function a(s){for(var e,o,n=[],t=0,i=s.length;t<i;)55296<=(e=s.charCodeAt(t++))&&e<=56319&&t<i?56320==(64512&(o=s.charCodeAt(t++)))?n.push(((1023&e)<<10)+(1023&o)+65536):(n.push(e),t--):n.push(e);return n}function r(e,t){if(!(55296<=e&&e<=57343))return 1;if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value")}function i(e,n){return t(e>>n&63|128)}function n(){if(o<=e)throw Error("Invalid byte index");var t=255&s[e];if(e++,128==(192&t))return 63&t;throw Error("Invalid continuation byte")}c.exports={version:"2.1.2",encode:function(d,n){for(var c=!1!==(n=n||{}).strict,s=a(d),l=s.length,o=-1,e="";++o<l;)e+=function(e,s){if(0==(4294967168&e))return t(e);var n="";return 0==(4294965248&e)?n=t(e>>6&31|192):0==(4294901760&e)?(r(e,s)||(e=65533),n=t(e>>12&15|224),n+=i(e,6)):0==(4292870144&e)&&(n=t(e>>18&7|240),n=(n+=i(e,12))+i(e,6)),n+t(63&e|128)}(s[o],c);return e},decode:function(p,u){h=!1!==(u=u||{}).strict,s=a(p),o=s.length,e=0;for(l=[];!1!==(f=function(a){var t,i;if(o<e)throw Error("Invalid byte index");if(e==o)return!1;if(t=255&s[e],e++,0==(128&t))return t;if(192==(224&t)){if(128<=(i=(31&t)<<6|n()))return i;throw Error("Invalid continuation byte")}if(224==(240&t)){if(2048<=(i=(15&t)<<12|n()<<6|n()))return r(i,a)?i:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&65536<=(i=(7&t)<<18|n()<<12|n()<<6|n())&&i<=1114111)return i;throw Error("Invalid UTF-8 detected")}(h));)l.push(f);for(var i,l,h,f,d=l,g=d.length,m=-1,c="";++m<g;)65535<(i=d[m])&&(c+=t((i-=65536)>>>10&1023|55296),i=56320|1023&i),c+=t(i);return c}}},function(t,e){!function(){"use strict";for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),s=0;s<t.length;s++)n[t.charCodeAt(s)]=s;e.encode=function(i){for(var s=new Uint8Array(i),o=s.length,e="",n=0;n<o;n+=3)e=(e=(e=(e+=t[s[n]>>2])+t[(3&s[n])<<4|s[n+1]>>4])+t[(15&s[n+1])<<2|s[n+2]>>6])+t[63&s[n+2]];return o%3==2?e=e.substring(0,e.length-1)+"=":o%3==1&&(e=e.substring(0,e.length-2)+"=="),e},e.decode=function(e){for(var i,r,c,l,s=.75*e.length,d=e.length,o=0,s=("="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--),new ArrayBuffer(s)),a=new Uint8Array(s),t=0;t<d;t+=4)l=n[e.charCodeAt(t)],i=n[e.charCodeAt(t+1)],r=n[e.charCodeAt(t+2)],c=n[e.charCodeAt(t+3)],a[o++]=l<<2|i>>4,a[o++]=(15&i)<<4|r>>2,a[o++]=(3&r)<<6|63&c;return s}}()},function(r){var e=void 0!==e?e:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder,s=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),i=s&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),a=e&&e.prototype.append&&e.prototype.getBlob;function t(e){return e.map(function(e){var t,n;return e.buffer instanceof ArrayBuffer?(t=e.buffer,e.byteLength!==t.byteLength&&((n=new Uint8Array(e.byteLength)).set(new Uint8Array(t,e.byteOffset,e.byteLength)),t=n.buffer),t):e})}function n(o,n){n=n||{};var s=new e;return t(o).forEach(function(e){s.append(e)}),n.type?s.getBlob(n.type):s.getBlob()}function o(e,n){return new Blob(t(e),n||{})}"undefined"!=typeof Blob&&(n.prototype=Blob.prototype,o.prototype=Blob.prototype),r.exports=s?i?Blob:o:a?n:void 0},function(n,e,s){function t(n){var s;function t(){if(t.enabled){var n,i,a,o=t,r=+new Date,c=r-(s||r);o.diff=c,o.prev=s,o.curr=r,s=r;for(n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];n[0]=e.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O"),a=0,n[0]=n[0].replace(/%([a-zA-Z%])/g,function(t,s){if("%%"===t)return t;a++;var i,s=e.formatters[s];return"function"==typeof s&&(i=n[a],t=s.call(o,i),n.splice(a,1),a--),t}),e.formatArgs.call(o,n),(t.log||e.log||console.log.bind(console)).apply(o,n)}}return t.namespace=n,t.enabled=e.enabled(n),t.useColors=e.useColors(),t.color=function(n){var s,t=0;for(s in n)t=(t<<5)-t+n.charCodeAt(s),t|=0;return e.colors[Math.abs(t)%e.colors.length]}(n),t.destroy=o,"function"==typeof e.init&&e.init(t),e.instances.push(t),t}function o(){var t=e.instances.indexOf(this);return-1!==t&&(e.instances.splice(t,1),!0)}(e=n.exports=t.debug=t.default=t).coerce=function(e){return e instanceof Error?e.stack||e.message:e},e.disable=function(){e.enable("")},e.enable=function(n){e.save(n),e.names=[],e.skips=[];for(var o,s=("string"==typeof n?n:"").split(/[\s,]+/),i=s.length,t=0;t<i;t++)s[t]&&("-"===(n=s[t].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+n.substr(1)+"$")):e.names.push(new RegExp("^"+n+"$")));for(t=0;t<e.instances.length;t++)o=e.instances[t],o.enabled=e.enabled(o.namespace)},e.enabled=function(n){if("*"===n[n.length-1])return!0;for(var t=0,s=e.skips.length;t<s;t++)if(e.skips[t].test(n))return!1;for(t=0,s=e.names.length;t<s;t++)if(e.names[t].test(n))return!0;return!1},e.humanize=s(104),e.instances=[],e.names=[],e.skips=[],e.formatters={}},function(t,n,e){!function(i){var s,a,r,o=e(150),c=e(76);t.exports=n,a=/\n/g,r=/\\n/g;function l(){}function n(e){o.call(this,e),this.query=this.query||{},s||(e="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i?i:{},s=e.___eio=e.___eio||[]),this.index=s.length;var t=this;s.push(function(e){t.onData(e)}),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",function(){t.script&&(t.script.onerror=l)},!1)}c(n,o),n.prototype.supportsBinary=!1,n.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),o.prototype.doClose.call(this)},n.prototype.doPoll=function(){var n=this,e=document.createElement("script"),t=(this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){n.onError("jsonp poll error",e)},document.getElementsByTagName("script")[0]);t?t.parentNode.insertBefore(e,t):(document.head||document.body).appendChild(e),this.script=e,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},n.prototype.doWrite=function(o,d){var e,n,s,c,t=this;function i(){l(),d()}function l(){if(t.iframe)try{t.form.removeChild(t.iframe)}catch(e){t.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+t.iframeId+'">';n=document.createElement(e)}catch(e){(n=document.createElement("iframe")).name=t.iframeId,n.src="javascript:0"}n.id=t.iframeId,t.form.appendChild(n),t.iframe=n}this.form||(e=document.createElement("form"),s=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index,e.className="socketio",e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.target=c,e.method="POST",e.setAttribute("accept-charset","utf-8"),s.name="d",e.appendChild(s),document.body.appendChild(e),this.form=e,this.area=s),this.form.action=this.uri(),l(),o=o.replace(r,"\\\n"),this.area.value=o.replace(a,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===t.iframe.readyState&&i()}:this.iframe.onload=i}}.call(this,e(31))},function(t,n,e){!function(r){var s,o,i,a=e(107),h=e(51),c=e(75),l=e(76),d=e(152),u=e(77)("engine.io-client:websocket");if("undefined"!=typeof WebSocket)o=WebSocket;else if("undefined"!=typeof self)o=self.WebSocket||self.MozWebSocket;else try{i=e(392)}catch(e){}s=o||i;function n(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=o&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(s=i),a.call(this,e)}l(t.exports=n,a),n.prototype.name="websocket",n.prototype.supportsBinary=!0,n.prototype.doOpen=function(){if(this.check()){var t=this.uri(),n=this.protocols,e={agent:this.agent,perMessageDeflate:this.perMessageDeflate};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(e.headers=this.extraHeaders),this.localAddress&&(e.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?n?new s(t,n):new s(t):new s(t,n,e)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},n.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},n.prototype.write=function(n){e=this,this.writable=!1;for(var e,s=n.length,t=0,o=s;t<o;t++)!function(t){h.encodePacket(t,e.supportsBinary,function(n){var o;e.usingBrowserWebSocket||(o={},t.options&&(o.compress=t.options.compress),e.perMessageDeflate&&("string"==typeof n?r.byteLength(n):n.length)<e.perMessageDeflate.threshold&&(o.compress=!1));try{e.usingBrowserWebSocket?e.ws.send(n):e.ws.send(n,o)}catch(e){u("websocket closed before onclose event")}--s||(e.emit("flush"),setTimeout(function(){e.writable=!0,e.emit("drain")},0))})}(n[t])},n.prototype.onClose=function(){a.prototype.onClose.call(this)},n.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},n.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"==t&&443!==Number(this.port)||"ws"==t&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=d()),this.supportsBinary||(e.b64=1),(e=c.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e},n.prototype.check=function(){return!(!s||"__initialize"in s&&this.name===n.prototype.name)}}.call(this,e(73).Buffer)},null,function(e){e.exports=function(n,t){for(var s=[],e=(t=t||0)||0;e<n.length;e++)s[e-t]=n[e];return s}},function(t){function e(e){this.ms=(e=e||{}).min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=0<e.jitter&&e.jitter<=1?e.jitter:0,this.attempts=0}(t.exports=e).prototype.duration=function(){var t,n,e=this.ms*Math.pow(this.factor,this.attempts++);return this.jitter&&(t=Math.random(),n=Math.floor(t*this.jitter*e),e=0==(1&Math.floor(10*t))?e-n:e+n),0|Math.min(e,this.max)},e.prototype.reset=function(){this.attempts=0},e.prototype.setMin=function(e){this.ms=e},e.prototype.setMax=function(e){this.max=e},e.prototype.setJitter=function(e){this.jitter=e}},null,function(eB,eh,v){"use strict";for(eR in window.EJS_RESET_VARS=[],window)window.EJS_RESET_VARS.push(eR);v.r(eh);function T(e){return null!=e?e.constructor:null}function E(e,t){return Boolean(e&&t&&e instanceof t)}function ec(e){return null==e}function ej(e){return T(e)===Object}function ei(e){return T(e)===String}function e_(e){return Array.isArray(e)}function ek(e){return E(e,NodeList)}function e1(e){return ec(e)||(ei(e)||e_(e)||ek(e))&&!e.length||ej(e)&&!Object.keys(e).length}var ea={volume:.5,muted:!1,i18n:{restart:"Restart",play:"Play",pause:"Pause",played:"Played",volume:"Volume",mute:"Mute (F9)",unmute:"Unmute (F9)",enterFullscreen:"Enter fullscreen",exitFullscreen:"Exit fullscreen",settings:"Settings",saveState:"Save State (Shift + F2)",loadState:"Load State (Shift + F4)",screenRecord:"Start Screen Recording",netplay:"Netplay",gamepad:"Control Settings",cheat:"Cheats",menuBack:"Go back to previous menu",normal:"Normal",all:"All",reset:"Reset",disabled:"Disabled",enabled:"Enabled",playNow:"Play Now"},listeners:{play:null,pause:null,restart:null,rewind:null,mute:null,volume:null,fullscreen:null},events:["ready"],selectors:{editable:"input, textarea, select, [contenteditable]",container:".ejs",controls:{container:null,wrapper:".jes__controls"},buttons:{play:'[data-btn="play"]',pause:'[data-btn="pause"]',mute:'[data-btn="mute"]',fullscreen:'[data-btn="fullscreen"]',settings:'[data-btn="settings"]',saveState:'[data-btn="save-state"]',loadState:'[data-btn="load-state"]',screenRecord:'[data-btn="screen-record"]',gamepad:'[data-btn="gamepad"]',netplay:'[data-btn="netplay"]',cheat:'[data-btn="cheat"]'},inputs:{volume:'[data-range="volume"]'}},classNames:{type:"ejs--video",video:"ejs__video-wrapper",poster:"ejs__poster",posterEnabled:"ejs__poster-enabled",control:"ejs__control",controlPressed:"ejs__control--pressed",playing:"ejs--playing",paused:"ejs--paused",stopped:"ejs--stopped",loading:"ejs--loading",hover:"ejs--hover",tooltip:"ejs__tooltip",hidden:"ejs__sr-only",hideControls:"ejs--hide-controls",isIos:"ejs--is-ios",isTouch:"ejs--is-touch",uiSupported:"ejs--full-ui",noTransition:"ejs--no-transition",menu:{value:"ejs__menu__value",badge:"ejs__badge",open:"ejs--menu-open"},fullscreen:{enabled:"ejs--fullscreen-enabled",fallback:"ejs--fullscreen-fallback"},tabFocus:"ejs__tab-focus"}},A=v(0),g=v(157),eS=v.n(g),s={nullOrUndefined:ec,object:ej,number:function(e){return T(e)===Number&&!Number.isNaN(e)},string:ei,boolean:function(e){return T(e)===Boolean},function:function(e){return T(e)===Function},array:e_,weakMap:function(e){return E(e,WeakMap)},nodeList:ek,element:function(e){return E(e,Element)},textNode:function(e){return T(e)===Text},event:function(e){return E(e,Event)},keyboardEvent:function(e){return E(e,KeyboardEvent)},cue:function(e){return E(e,window.TextTrackCue)||E(e,window.VTTCue)},track:function(e){return E(e,TextTrack)||!ec(e)&&ei(e.kind)},url:function(e){if(E(e,window.URL))return!0;var t=e;e.startsWith("http://")&&e.startsWith("https://")||(t="http://".concat(e));try{return!e1(new URL(t).hostname)}catch(e){return!1}},empty:e1},eM=function(){var e,t=!1;try{e=Object.defineProperty({},"passive",{get:function(){return t=!0,null}}),window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch(e){}return t}();function R(e,t,n){var o,i=this,a=3<arguments.length&&void 0!==arguments[3]&&arguments[3],c=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],r=5<arguments.length&&void 0!==arguments[5]&&arguments[5];e&&"addEventListener"in e&&!s.empty(t)&&s.function(n)&&(t=t.split(" "),o=eM?{passive:c,capture:r}:r,t.forEach(function(t){i&&i.eventListeners&&a&&i.eventListeners.push({element:e,type:t,callback:n,options:o}),e[a?"addEventListener":"removeEventListener"](t,n,o)}))}function r(e){R.call(this,e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",2<arguments.length?arguments[2]:void 0,!0,!(3<arguments.length&&void 0!==arguments[3])||arguments[3],4<arguments.length&&void 0!==arguments[4]&&arguments[4])}function eo(e){R.call(this,e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",2<arguments.length?arguments[2]:void 0,!1,!(3<arguments.length&&void 0!==arguments[3])||arguments[3],4<arguments.length&&void 0!==arguments[4]&&arguments[4])}function es(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",o=2<arguments.length?arguments[2]:void 0,n=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],s=4<arguments.length&&void 0!==arguments[4]&&arguments[4];R.call(this,e,t,function c(){eo(e,t,c,n,s);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];o.apply(this,r)},!0,n,s)}function p(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};s.element(t)&&!s.empty(e)&&(e=new CustomEvent(e,{bubbles:n,detail:Object.assign({},o,{emulator:this})}),t.dispatchEvent(e))}g=v(158),eC=v.n(g);function ex(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(r,a){var e,s,t=[],n=!0,o=!1,i=void 0;try{for(e=r[Symbol.iterator]();!(n=(s=e.next()).done)&&(t.push(s.value),!a||t.length!==a);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==e.return||e.return()}finally{if(o)throw i}}return t}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ey(e,t){e=e.length?e:[e],Array.from(e).reverse().forEach(function(n,e){var e=0<e?t.cloneNode(!0):t,s=n.parentNode,o=n.nextSibling;e.appendChild(n),o?s.insertBefore(e,o):s.appendChild(e)})}function eu(e,t){s.element(e)&&!s.empty(t)&&Object.entries(t).filter(function(e){return e=ex(e,2)[1],!s.nullOrUndefined(e)}).forEach(function(t){var t=ex(t,2),n=t[0],t=t[1];return e.setAttribute(n,t)})}function c(e,t,n){return e=document.createElement(e),s.object(t)&&eu(e,t),s.string(n)&&(e.innerText=n),e}function e9(e){s.nodeList(e)||s.array(e)?Array.from(e).forEach(e9):s.element(e)&&s.element(e.parentNode)&&e.parentNode.removeChild(e)}function V(t,o){if(!s.string(t)||s.empty(t))return{};var e={},n=o;return t.split(",").forEach(function(t){var o=t.trim(),i=o.replace(".",""),t=o.replace(/[[\]]/g,"").split("="),a=t[0],r=1<t.length?t[1].replace(/["']/g,""):"";switch(o.charAt(0)){case".":s.object(n)&&s.string(n.class)&&(n.class+=" ".concat(i)),e.class=i;break;case"#":e.id=o.replace("#","");break;case"[":e[a]=r}}),e}function a(e,t){s.element(e)&&((t=s.boolean(t=t)?t:!e.hidden)?e.setAttribute("hidden",""):e.removeAttribute("hidden"))}function h(e,t,n){return s.nodeList(e)?Array.from(e).map(function(e){return h(e,t,n)}):!!s.element(e)&&(e.classList[void 0!==n?n?"add":"remove":"toggle"](t),e.classList.contains(t))}function Q(e,t){return s.element(e)&&e.classList.contains(t)}function ee(n,t){var e={Element};return(e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector||function(){return Array.from(document.querySelectorAll(t)).includes(this)}).call(n,t)}function M(e){return this.elements.container.querySelectorAll(e)}function u(e){return this.elements.container.querySelector(e)}function J(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];s.element(e)&&(e.focus(),t&&h(e,this.config.classNames.tabFocus))}function n(e){return eS.a.bind(eC.a)(e)}e5=document.createElement("span"),g={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},j=Object.keys(g).find(function(e){return void 0!==e5.style[e]}),q=!!s.string(j)&&g[j];function eA(e){setTimeout(function(){try{a(e,!0),e.offsetHeight,a(e,!1)}catch(e){}},0)}y={isEdge:"Netscape"===navigator.appName&&-1<navigator.appVersion.indexOf("Edge"),isIE:!!document.documentMode,isWebkit:"WebkitAppearance"in document.documentElement.style&&!/Edge/.test(navigator.userAgent),isIPhone:/(iPhone|iPod)/gi.test(navigator.platform),isIos:/(iPad|iPhone|iPod)/gi.test(navigator.platform),info:function(){var e=/(MSIE|(?!Gecko.+)Firefox|(?!AppleWebKit.+Chrome.+)Safari|(?!AppleWebKit.+)Chrome|AppleWebKit(?!.+Chrome|.+Safari)|Gecko(?!.+Firefox))(?: |\/)([\d.apre]+)/.exec(navigator.userAgent);return{name:e[1].toLowerCase(),version:e[2]}}},w={rangeInput:((g=document.createElement("input")).type="range")===g.type,touch:"ontouchstart"in document.documentElement,transitions:!1!==q,reducedMotion:"matchMedia"in window&&window.matchMedia("(prefers-reduced-motion)").matches,webgl:function(){if(t={DETECTED:!1},!t.DETECTED&&(s=document.createElement("canvas"),s&&s.getContext))for(var e,t,n,s,i=["webgl2","experimental-webgl2","webgl","experimental-webgl"],o=0,a=i.length;o<a;++o)if(n=i[o],e=s.getContext(n),e){t.WEBGL_CONTEXT=n,t.WEBGL_VERSION=e.getParameter(e.VERSION),t.WEBGL_VENDOR=e.getParameter(e.VENDOR),t.WEBGL_SL_VERSION=e.getParameter(e.SHADING_LANGUAGE_VERSION),t.MAX_TEXTURE_SIZE=e.getParameter(e.MAX_TEXTURE_SIZE),n=e.getExtension("WEBGL_debug_renderer_info"),n&&(t.WEBGL_VENDOR=e.getParameter(n.UNMASKED_VENDOR_WEBGL),t.WEBGL_RENDERER=e.getParameter(n.UNMASKED_RENDERER_WEBGL)),t.DETECTED=!0;break}return t}(),wasm:"undefined"!=typeof WebAssembly&&s.object(WebAssembly),audioContext:"undefined"!=typeof AudioContext};function e6(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _(){for(var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length,n=new Array(1<i?i-1:0),o=1;o<i;o++)n[o-1]=arguments[o];return n.length?(t=n.shift(),s.object(t)?(Object.keys(t).forEach(function(n){s.object(t[n])?(Object.keys(e).includes(n)||Object.assign(e,e6({},n,{})),_(e[n],t[n])):Object.assign(e,e6({},n,t[n]))}),_.apply(void 0,[e].concat(n))):e):e}function H(e,t,n){return e=0<arguments.length&&void 0!==e?e:"",t=1<arguments.length&&void 0!==t?t:"",n=2<arguments.length&&void 0!==n?n:"",e.replace(new RegExp(t.toString().replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1"),"g"),n.toString())}N=function(){var e,o,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return s.empty(t)||s.empty(n)?"":(o=n.i18n,e=t.split(".").reduce(function(e,t){return e&&e[t]},o),s.empty(e)?"":(t={"{seektime}":n.seekTime,"{title}":n.title},Object.entries(t).forEach(function(t){var n=2,t=function(e){if(Array.isArray(e))return e}(t=t)||function(r,a){var e,s,t=[],n=!0,o=!1,i=void 0;try{for(e=r[Symbol.iterator]();!(n=(s=e.next()).done)&&(t.push(s.value),!a||t.length!==a);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==e.return||e.return()}finally{if(o)throw i}}return t}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}(),n=t[0],t=t[1];e=H(e,n,t)}),e))};function ef(s,n){for(var e,t=0;t<n.length;t++)e=n[t],e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(s,e.key,e)}j=[{key:"supported",get:function(){try{return"localStorage"in window&&(window.localStorage.getItem("___test")||window.localStorage.setItem("___test","___test"),!0)}catch(e){return!1}}}],ef((g=W).prototype,[{key:"get",value:function(t){if(!W.supported||!this.enabled)return null;var e=window.localStorage.getItem(this.key);return s.empty(e)?null:(e=JSON.parse(e),s.string(t)&&t.length?e[t]:e)}},{key:"set",value:function(t){var e;W.supported&&this.enabled&&s.object(t)&&(e=this.get(),_(e=s.empty(e)?{}:e,t),window.localStorage.setItem(this.key,JSON.stringify(e)))}}]),ef(g,j),ed=W;function W(t,e){if(!(this instanceof W))throw new TypeError("Cannot call a class as a function");this.enabled=!0,this.key=e}var i,l,b,y,w,S,z,N,q,eR,eC,e5,ed,g=v(108),e8=v.n(g),m=v(6),j=v(159),eI=v.n(j),ez={"2xScaleHQ.glslp":'shaders = 1\n\nshader0 = "2xScaleHQ.glsl"\nfilter_linear0 = false\nscale_type_0 = source\n',"4xScaleHQ.glslp":'shaders = 1\n\nshader0 = "4xScaleHQ.glsl"\nfilter_linear0 = false\nscale_type_0 = source\n',"crt-easymode.glslp":"shaders = 1\n\nshader0 = crt-easymode.glsl\nfilter_linear0 = false\nscale_type_0 = source\n","crt-aperture.glslp":"shaders = 1\n\nshader0 = crt-aperture.glsl\nfilter_linear0 = false\n","crt-geom.glslp":"shaders = 1\n\nshader0 = crt-geom.glsl\nfilter_linear0 = false\nscale_type_0 = source\n","2xScaleHQ.glsl":"/*\n2xGLSLHqFilter shader\n\nCopyright (C) 2005 guest(r) - guest.r@gmail.com\n\nThis program is free software; you can redistribute it and/or\nmodify it under the terms of the GNU General Public License\nas published by the Free Software Foundation; either version 2\nof the License, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program; if not, write to the Free Software\nFoundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.\n*/\n\n#if defined(VERTEX)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING out\n#define COMPAT_ATTRIBUTE in\n#define COMPAT_TEXTURE texture\n#else\n#define COMPAT_VARYING varying \n#define COMPAT_ATTRIBUTE attribute \n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nCOMPAT_ATTRIBUTE vec4 VertexCoord;\nCOMPAT_ATTRIBUTE vec4 COLOR;\nCOMPAT_ATTRIBUTE vec4 TexCoord;\nCOMPAT_VARYING vec4 COL0;\nCOMPAT_VARYING vec4 TEX0;\nCOMPAT_VARYING vec4 t1;\nCOMPAT_VARYING vec4 t2;\nCOMPAT_VARYING vec4 t3;\nCOMPAT_VARYING vec4 t4;\n\nvec4 _oPosition1; \nuniform mat4 MVPMatrix;\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\n\n// compatibility #defines\n#define vTexCoord TEX0.xy\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define OutSize vec4(OutputSize, 1.0 / OutputSize)\n\nvoid main()\n{\ngl_Position = MVPMatrix * VertexCoord;\nTEX0.xy = TexCoord.xy;\nfloat x = 0.5 * SourceSize.z;\nfloat y = 0.5 * SourceSize.w;\nvec2 dg1 = vec2( x, y);\nvec2 dg2 = vec2(-x, y);\nvec2 dx = vec2(x, 0.0);\nvec2 dy = vec2(0.0, y);\nt1 = vec4(vTexCoord - dg1, vTexCoord - dy);\nt2 = vec4(vTexCoord - dg2, vTexCoord + dx);\nt3 = vec4(vTexCoord + dg1, vTexCoord + dy);\nt4 = vec4(vTexCoord + dg2, vTexCoord - dx);\n}\n\n#elif defined(FRAGMENT)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING in\n#define COMPAT_TEXTURE texture\nout vec4 FragColor;\n#else\n#define COMPAT_VARYING varying\n#define FragColor gl_FragColor\n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\nuniform sampler2D Texture;\nCOMPAT_VARYING vec4 TEX0;\nCOMPAT_VARYING vec4 t1;\nCOMPAT_VARYING vec4 t2;\nCOMPAT_VARYING vec4 t3;\nCOMPAT_VARYING vec4 t4;\n\n// compatibility #defines\n#define Source Texture\n#define vTexCoord TEX0.xy\n\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define OutSize vec4(OutputSize, 1.0 / OutputSize)\n\nfloat mx = 0.325;      // start smoothing wt.\nfloat k = -0.250;      // wt. decrease factor\nfloat max_w = 0.25;    // max filter weight\nfloat min_w =-0.05;    // min filter weight\nfloat lum_add = 0.25;  // affects smoothing\nvec3 dt = vec3(1.0);\n\nvoid main()\n{\nvec3 c00 = COMPAT_TEXTURE(Source, t1.xy).xyz; \nvec3 c10 = COMPAT_TEXTURE(Source, t1.zw).xyz; \nvec3 c20 = COMPAT_TEXTURE(Source, t2.xy).xyz; \nvec3 c01 = COMPAT_TEXTURE(Source, t4.zw).xyz; \nvec3 c11 = COMPAT_TEXTURE(Source, vTexCoord).xyz; \nvec3 c21 = COMPAT_TEXTURE(Source, t2.zw).xyz; \nvec3 c02 = COMPAT_TEXTURE(Source, t4.xy).xyz; \nvec3 c12 = COMPAT_TEXTURE(Source, t3.zw).xyz; \nvec3 c22 = COMPAT_TEXTURE(Source, t3.xy).xyz; \n\nfloat md1 = dot(abs(c00 - c22), dt);\nfloat md2 = dot(abs(c02 - c20), dt);\n\nfloat w1 = dot(abs(c22 - c11), dt) * md2;\nfloat w2 = dot(abs(c02 - c11), dt) * md1;\nfloat w3 = dot(abs(c00 - c11), dt) * md2;\nfloat w4 = dot(abs(c20 - c11), dt) * md1;\n\nfloat t1 = w1 + w3;\nfloat t2 = w2 + w4;\nfloat ww = max(t1, t2) + 0.0001;\n\nc11 = (w1 * c00 + w2 * c20 + w3 * c22 + w4 * c02 + ww * c11) / (t1 + t2 + ww);\n\nfloat lc1 = k / (0.12 * dot(c10 + c12 + c11, dt) + lum_add);\nfloat lc2 = k / (0.12 * dot(c01 + c21 + c11, dt) + lum_add);\n\nw1 = clamp(lc1 * dot(abs(c11 - c10), dt) + mx, min_w, max_w);\nw2 = clamp(lc2 * dot(abs(c11 - c21), dt) + mx, min_w, max_w);\nw3 = clamp(lc1 * dot(abs(c11 - c12), dt) + mx, min_w, max_w);\nw4 = clamp(lc2 * dot(abs(c11 - c01), dt) + mx, min_w, max_w);\nFragColor = vec4(w1 * c10 + w2 * c21 + w3 * c12 + w4 * c01 + (1.0 - w1 - w2 - w3 - w4) * c11, 1.0);\n} \n#endif\n","4xScaleHQ.glsl":"/*\n4xGLSLHqFilter shader\n\nCopyright (C) 2005 guest(r) - guest.r@gmail.com\n\nThis program is free software; you can redistribute it and/or\nmodify it under the terms of the GNU General Public License\nas published by the Free Software Foundation; either version 2\nof the License, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program; if not, write to the Free Software\nFoundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.\n*/\n\n#if defined(VERTEX)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING out\n#define COMPAT_ATTRIBUTE in\n#define COMPAT_TEXTURE texture\n#else\n#define COMPAT_VARYING varying \n#define COMPAT_ATTRIBUTE attribute \n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nCOMPAT_ATTRIBUTE vec4 VertexCoord;\nCOMPAT_ATTRIBUTE vec4 COLOR;\nCOMPAT_ATTRIBUTE vec4 TexCoord;\nCOMPAT_VARYING vec4 COL0;\nCOMPAT_VARYING vec4 TEX0;\nCOMPAT_VARYING vec4 t1;\nCOMPAT_VARYING vec4 t2;\nCOMPAT_VARYING vec4 t3;\nCOMPAT_VARYING vec4 t4;\nCOMPAT_VARYING vec4 t5;\nCOMPAT_VARYING vec4 t6;\n\nvec4 _oPosition1; \nuniform mat4 MVPMatrix;\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\n\n// compatibility #defines\n#define vTexCoord TEX0.xy\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define OutSize vec4(OutputSize, 1.0 / OutputSize)\n\nvoid main()\n{\ngl_Position = MVPMatrix * VertexCoord;\nTEX0.xy = TexCoord.xy;\nfloat x = 0.5 * SourceSize.z;\nfloat y = 0.5 * SourceSize.w;\nvec2 dg1 = vec2( x, y);\nvec2 dg2 = vec2(-x, y);\nvec2 sd1 = dg1 * 0.5;\nvec2 sd2 = dg2 * 0.5;\nvec2 ddx = vec2(x, 0.0);\nvec2 ddy = vec2(0.0, y);\nt1 = vec4(vTexCoord - sd1, vTexCoord - ddy);\nt2 = vec4(vTexCoord - sd2, vTexCoord + ddx);\nt3 = vec4(vTexCoord + sd1, vTexCoord + ddy);\nt4 = vec4(vTexCoord + sd2, vTexCoord - ddx);\nt5 = vec4(vTexCoord - dg1, vTexCoord - dg2);\nt6 = vec4(vTexCoord + dg1, vTexCoord + dg2);\n}\n\n#elif defined(FRAGMENT)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING in\n#define COMPAT_TEXTURE texture\nout vec4 FragColor;\n#else\n#define COMPAT_VARYING varying\n#define FragColor gl_FragColor\n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\nuniform sampler2D Texture;\nCOMPAT_VARYING vec4 TEX0;\nCOMPAT_VARYING vec4 t1;\nCOMPAT_VARYING vec4 t2;\nCOMPAT_VARYING vec4 t3;\nCOMPAT_VARYING vec4 t4;\nCOMPAT_VARYING vec4 t5;\nCOMPAT_VARYING vec4 t6;\n\n// compatibility #defines\n#define Source Texture\n#define vTexCoord TEX0.xy\n\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define OutSize vec4(OutputSize, 1.0 / OutputSize)\n\nfloat mx = 1.0;      // start smoothing wt.\nfloat k = -1.10;      // wt. decrease factor\nfloat max_w = 0.75;    // max filter weight\nfloat min_w = 0.03;    // min filter weight\nfloat lum_add = 0.33;  // affects smoothing\nvec3 dt = vec3(1.0);\n\nvoid main()\n{\nvec3 c  = COMPAT_TEXTURE(Source, vTexCoord).xyz;\nvec3 i1 = COMPAT_TEXTURE(Source, t1.xy).xyz; \nvec3 i2 = COMPAT_TEXTURE(Source, t2.xy).xyz; \nvec3 i3 = COMPAT_TEXTURE(Source, t3.xy).xyz; \nvec3 i4 = COMPAT_TEXTURE(Source, t4.xy).xyz; \nvec3 o1 = COMPAT_TEXTURE(Source, t5.xy).xyz; \nvec3 o3 = COMPAT_TEXTURE(Source, t6.xy).xyz; \nvec3 o2 = COMPAT_TEXTURE(Source, t5.zw).xyz;\nvec3 o4 = COMPAT_TEXTURE(Source, t6.zw).xyz;\nvec3 s1 = COMPAT_TEXTURE(Source, t1.zw).xyz; \nvec3 s2 = COMPAT_TEXTURE(Source, t2.zw).xyz; \nvec3 s3 = COMPAT_TEXTURE(Source, t3.zw).xyz; \nvec3 s4 = COMPAT_TEXTURE(Source, t4.zw).xyz; \n\nfloat ko1=dot(abs(o1-c),dt);\nfloat ko2=dot(abs(o2-c),dt);\nfloat ko3=dot(abs(o3-c),dt);\nfloat ko4=dot(abs(o4-c),dt);\n\nfloat k1=min(dot(abs(i1-i3),dt),max(ko1,ko3));\nfloat k2=min(dot(abs(i2-i4),dt),max(ko2,ko4));\n\nfloat w1 = k2; if(ko3<ko1) w1*=ko3/ko1;\nfloat w2 = k1; if(ko4<ko2) w2*=ko4/ko2;\nfloat w3 = k2; if(ko1<ko3) w3*=ko1/ko3;\nfloat w4 = k1; if(ko2<ko4) w4*=ko2/ko4;\n\nc=(w1*o1+w2*o2+w3*o3+w4*o4+0.001*c)/(w1+w2+w3+w4+0.001);\nw1 = k*dot(abs(i1-c)+abs(i3-c),dt)/(0.125*dot(i1+i3,dt)+lum_add);\nw2 = k*dot(abs(i2-c)+abs(i4-c),dt)/(0.125*dot(i2+i4,dt)+lum_add);\nw3 = k*dot(abs(s1-c)+abs(s3-c),dt)/(0.125*dot(s1+s3,dt)+lum_add);\nw4 = k*dot(abs(s2-c)+abs(s4-c),dt)/(0.125*dot(s2+s4,dt)+lum_add);\n\nw1 = clamp(w1+mx,min_w,max_w); \nw2 = clamp(w2+mx,min_w,max_w);\nw3 = clamp(w3+mx,min_w,max_w); \nw4 = clamp(w4+mx,min_w,max_w);\n\nFragColor = vec4((w1*(i1+i3)+w2*(i2+i4)+w3*(s1+s3)+w4*(s2+s4)+c)/(2.0*(w1+w2+w3+w4)+1.0), 1.0);\n} \n#endif\n","crt-easymode.glsl":"#if defined(VERTEX)\n\n    #if __VERSION__ >= 130\n    #define COMPAT_VARYING out\n    #define COMPAT_ATTRIBUTE in\n    #define COMPAT_TEXTURE texture\n    #else\n    #define COMPAT_VARYING varying\n    #define COMPAT_ATTRIBUTE attribute\n    #define COMPAT_TEXTURE texture2D\n    #endif\n    \n    #ifdef GL_ES\n    #define COMPAT_PRECISION mediump\n    #else\n    #define COMPAT_PRECISION\n    #endif\n    COMPAT_VARYING     float _frame_rotation;\n    struct input_dummy {\n    vec2 _video_size;\n    vec2 _texture_size;\n    vec2 _output_dummy_size;\n    float _frame_count;\n    float _frame_direction;\n    float _frame_rotation;\n    };\n    vec4 _oPosition1;\n    vec4 _r0005;\n    COMPAT_ATTRIBUTE vec4 VertexCoord;\n    COMPAT_ATTRIBUTE vec4 TexCoord;\n    COMPAT_VARYING vec4 TEX0;\n    \n    uniform mat4 MVPMatrix;\n    uniform int FrameDirection;\n    uniform int FrameCount;\n    uniform COMPAT_PRECISION vec2 OutputSize;\n    uniform COMPAT_PRECISION vec2 TextureSize;\n    uniform COMPAT_PRECISION vec2 InputSize;\n    void main()\n    {\n    vec2 _oTex;\n    _r0005 = VertexCoord.x*MVPMatrix[0];\n    _r0005 = _r0005 + VertexCoord.y*MVPMatrix[1];\n    _r0005 = _r0005 + VertexCoord.z*MVPMatrix[2];\n    _r0005 = _r0005 + VertexCoord.w*MVPMatrix[3];\n    _oPosition1 = _r0005;\n    _oTex = TexCoord.xy;\n    gl_Position = _r0005;\n    TEX0.xy = TexCoord.xy;\n    }\n    #elif defined(FRAGMENT)\n    \n    #if __VERSION__ >= 130\n    #define COMPAT_VARYING in\n    #define COMPAT_TEXTURE texture\n    out vec4 FragColor;\n    #else\n    #define COMPAT_VARYING varying\n    #define FragColor gl_FragColor\n    #define COMPAT_TEXTURE texture2D\n    #endif\n    \n    #ifdef GL_ES\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    #else\n    precision mediump float;\n    #endif\n    #define COMPAT_PRECISION mediump\n    #else\n    #define COMPAT_PRECISION\n    #endif\n    COMPAT_VARYING     float _frame_rotation;\n    struct input_dummy {\n    vec2 _video_size;\n    vec2 _texture_size;\n    vec2 _output_dummy_size;\n    float _frame_count;\n    float _frame_direction;\n    float _frame_rotation;\n    };\n    vec4 _ret_0;\n    float _TMP30;\n    float _TMP29;\n    float _TMP28;\n    float _TMP13;\n    float _TMP32;\n    float _TMP11;\n    float _TMP10;\n    float _TMP31;\n    float _TMP9;\n    float _TMP8;\n    float _TMP15;\n    float _TMP14;\n    float _TMP33;\n    vec4 _TMP34;\n    vec4 _TMP27;\n    vec4 _TMP25;\n    vec4 _TMP23;\n    vec4 _TMP21;\n    vec4 _TMP26;\n    vec4 _TMP24;\n    vec4 _TMP22;\n    vec4 _TMP20;\n    float _TMP4;\n    vec4 _TMP3;\n    vec4 _TMP2;\n    float _TMP19;\n    float _TMP18;\n    float _TMP17;\n    float _TMP16;\n    vec4 _TMP1;\n    vec2 _TMP0;\n    uniform sampler2D Texture;\n    input_dummy _IN1;\n    float _TMP43;\n    float _x_step0044;\n    float _curve0044;\n    float _a0048;\n    float _val0052;\n    float _a0052;\n    vec4 _TMP57;\n    vec4 _x0072;\n    vec2 _c0086;\n    vec4 _x0088;\n    vec4 _x0094;\n    vec2 _c0098;\n    vec4 _x0100;\n    vec2 _c0104;\n    vec4 _x0106;\n    vec4 _sample_min0110;\n    vec4 _sample_max0110;\n    vec4 _r0112;\n    vec4 _TMP117;\n    vec2 _co0124;\n    vec2 _c0126;\n    vec4 _x0128;\n    vec4 _x0134;\n    vec2 _c0138;\n    vec4 _x0140;\n    vec2 _c0144;\n    vec4 _x0146;\n    vec4 _sample_min0150;\n    vec4 _sample_max0150;\n    vec4 _r0152;\n    vec4 _TMP157;\n    float _TMP163;\n    float _x_step0164;\n    float _curve0164;\n    float _a0168;\n    float _val0172;\n    float _a0172;\n    float _TMP183;\n    float _TMP189;\n    float _x0190;\n    float _a0196;\n    float _x0198;\n    vec2 _x0200;\n    float _x0208;\n    COMPAT_VARYING vec4 TEX0;\n    \n    uniform COMPAT_PRECISION vec2 OutputSize;\n    uniform COMPAT_PRECISION vec2 TextureSize;\n    uniform COMPAT_PRECISION vec2 InputSize;\n    void main()\n    {\n    vec2 _dx1;\n    vec2 _dy;\n    vec2 _pix_co;\n    vec2 _tex_co;\n    vec2 _dist;\n    vec3 _col2;\n    vec3 _col21;\n    vec4 _coeffs1;\n    float _luma;\n    float _bright;\n    float _scan_weight;\n    vec2 _mod_fac;\n    int _dot_no;\n    vec3 _mask_weight;\n    vec3 _TMP37;\n    _dx1 = vec2(1.00000000E+00/TextureSize.x, 0.00000000E+00);\n    _dy = vec2(0.00000000E+00, 1.00000000E+00/TextureSize.y);\n    _pix_co = TEX0.xy*TextureSize - vec2( 5.00000000E-01, 5.00000000E-01);\n    _TMP0 = floor(_pix_co);\n    _tex_co = (_TMP0 + vec2( 5.00000000E-01, 5.00000000E-01))/TextureSize;\n    _dist = fract(_pix_co);\n    _x_step0044 = float((_dist.x >= 5.00000000E-01));\n    _a0048 = 2.50000000E-01 - (_dist.x - _x_step0044)*(_dist.x - _x_step0044);\n    _TMP33 = inversesqrt(_a0048);\n    _TMP14 = 1.00000000E+00/_TMP33;\n    _a0052 = 5.00000000E-01 - _dist.x;\n    _val0052 = float((_a0052 > 0.00000000E+00));\n    _TMP15 = _val0052 - float((_a0052 < 0.00000000E+00));\n    _curve0044 = 5.00000000E-01 - _TMP14*_TMP15;\n    _TMP43 = _dist.x + 2.50000000E-01*(_curve0044 - _dist.x);\n    _coeffs1 = 3.14159274E+00*vec4(1.00000000E+00 + _TMP43, _TMP43, 1.00000000E+00 - _TMP43, 2.00000000E+00 - _TMP43);\n    _TMP1 = abs(_coeffs1);\n    _TMP57 = max(_TMP1, vec4( 9.99999975E-06, 9.99999975E-06, 9.99999975E-06, 9.99999975E-06));\n    _TMP16 = sin(_TMP57.x);\n    _TMP17 = sin(_TMP57.y);\n    _TMP18 = sin(_TMP57.z);\n    _TMP19 = sin(_TMP57.w);\n    _TMP2 = vec4(_TMP16, _TMP17, _TMP18, _TMP19);\n    _x0072 = _TMP57/2.00000000E+00;\n    _TMP16 = sin(_x0072.x);\n    _TMP17 = sin(_x0072.y);\n    _TMP18 = sin(_x0072.z);\n    _TMP19 = sin(_x0072.w);\n    _TMP3 = vec4(_TMP16, _TMP17, _TMP18, _TMP19);\n    _coeffs1 = ((2.00000000E+00*_TMP2)*_TMP3)/(_TMP57*_TMP57);\n    _TMP4 = dot(_coeffs1, vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _coeffs1 = _coeffs1/_TMP4;\n    _c0086 = _tex_co - _dx1;\n    _TMP20 = COMPAT_TEXTURE(Texture, _c0086);\n    _x0088 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP20 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP21 = _TMP20*_x0088;\n    _TMP22 = COMPAT_TEXTURE(Texture, _tex_co);\n    _x0094 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP22 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP23 = _TMP22*_x0094;\n    _c0098 = _tex_co + _dx1;\n    _TMP24 = COMPAT_TEXTURE(Texture, _c0098);\n    _x0100 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP24 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP25 = _TMP24*_x0100;\n    _c0104 = _tex_co + 2.00000000E+00*_dx1;\n    _TMP26 = COMPAT_TEXTURE(Texture, _c0104);\n    _x0106 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP26 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP27 = _TMP26*_x0106;\n    _r0112 = _coeffs1.x*_TMP21;\n    _r0112 = _r0112 + _coeffs1.y*_TMP23;\n    _r0112 = _r0112 + _coeffs1.z*_TMP25;\n    _r0112 = _r0112 + _coeffs1.w*_TMP27;\n    _sample_min0110 = min(_TMP23, _TMP25);\n    _sample_max0110 = max(_TMP23, _TMP25);\n    _TMP34 = min(_sample_max0110, _r0112);\n    _TMP117 = max(_sample_min0110, _TMP34);\n    _co0124 = _tex_co + _dy;\n    _c0126 = _co0124 - _dx1;\n    _TMP20 = COMPAT_TEXTURE(Texture, _c0126);\n    _x0128 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP20 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP21 = _TMP20*_x0128;\n    _TMP22 = COMPAT_TEXTURE(Texture, _co0124);\n    _x0134 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP22 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP23 = _TMP22*_x0134;\n    _c0138 = _co0124 + _dx1;\n    _TMP24 = COMPAT_TEXTURE(Texture, _c0138);\n    _x0140 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP24 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP25 = _TMP24*_x0140;\n    _c0144 = _co0124 + 2.00000000E+00*_dx1;\n    _TMP26 = COMPAT_TEXTURE(Texture, _c0144);\n    _x0146 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP26 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP27 = _TMP26*_x0146;\n    _r0152 = _coeffs1.x*_TMP21;\n    _r0152 = _r0152 + _coeffs1.y*_TMP23;\n    _r0152 = _r0152 + _coeffs1.z*_TMP25;\n    _r0152 = _r0152 + _coeffs1.w*_TMP27;\n    _sample_min0150 = min(_TMP23, _TMP25);\n    _sample_max0150 = max(_TMP23, _TMP25);\n    _TMP34 = min(_sample_max0150, _r0152);\n    _TMP157 = max(_sample_min0150, _TMP34);\n    _x_step0164 = float((_dist.y >= 5.00000000E-01));\n    _a0168 = 2.50000000E-01 - (_dist.y - _x_step0164)*(_dist.y - _x_step0164);\n    _TMP33 = inversesqrt(_a0168);\n    _TMP14 = 1.00000000E+00/_TMP33;\n    _a0172 = 5.00000000E-01 - _dist.y;\n    _val0172 = float((_a0172 > 0.00000000E+00));\n    _TMP15 = _val0172 - float((_a0172 < 0.00000000E+00));\n    _curve0164 = 5.00000000E-01 - _TMP14*_TMP15;\n    _TMP163 = _dist.y + (_curve0164 - _dist.y);\n    _col2 = _TMP117.xyz + _TMP163*(_TMP157.xyz - _TMP117.xyz);\n    _luma = dot(vec3( 2.12599993E-01, 7.15200007E-01, 7.22000003E-02), _col2);\n    _TMP8 = max(_col2.y, _col2.z);\n    _TMP9 = max(_col2.x, _TMP8);\n    _bright = (_TMP9 + _luma)/2.00000000E+00;\n    _TMP31 = min(6.49999976E-01, _bright);\n    _TMP183 = max(3.49999994E-01, _TMP31);\n    _x0190 = _bright*1.50000000E+00;\n    _TMP31 = min(1.50000000E+00, _x0190);\n    _TMP189 = max(1.50000000E+00, _TMP31);\n    _a0196 = TEX0.y*2.00000000E+00*3.14159274E+00*TextureSize.y;\n    _TMP10 = cos(_a0196);\n    _x0198 = _TMP10*5.00000000E-01 + 5.00000000E-01;\n    _TMP11 = pow(_x0198, _TMP189);\n    _scan_weight = 1.00000000E+00 - _TMP11;\n    _x0200 = (TEX0.xy*OutputSize*TextureSize)/InputSize;\n    _mod_fac = floor(_x0200);\n    _x0208 = _mod_fac.x/3.00000000E+00;\n    _TMP32 = floor(_x0208);\n    _TMP13 = _mod_fac.x - 3.00000000E+00*_TMP32;\n    _dot_no = int(_TMP13);\n    if (_dot_no == 0) {\n    _mask_weight = vec3( 1.00000000E+00, 6.99999988E-01, 6.99999988E-01);\n    } else {\n    if (_dot_no == 1) {\n    _mask_weight = vec3( 6.99999988E-01, 1.00000000E+00, 6.99999988E-01);\n    } else {\n    _mask_weight = vec3( 6.99999988E-01, 6.99999988E-01, 1.00000000E+00);\n    }\n    }\n    if (InputSize.y >= 4.00000000E+02) {\n    _scan_weight = 1.00000000E+00;\n    }\n    _col21 = _col2.xyz;\n    _col2 = _col2*vec3(_scan_weight, _scan_weight, _scan_weight);\n    _col2 = _col2 + _TMP183*(_col21 - _col2);\n    _col2 = _col2*_mask_weight;\n    _TMP28 = pow(_col2.x, 5.55555582E-01);\n    _TMP29 = pow(_col2.y, 5.55555582E-01);\n    _TMP30 = pow(_col2.z, 5.55555582E-01);\n    _col2 = vec3(_TMP28, _TMP29, _TMP30);\n    _TMP37 = _col2*1.20000005E+00;\n    _ret_0 = vec4(_TMP37.x, _TMP37.y, _TMP37.z, 1.00000000E+00);\n    FragColor = _ret_0;\n    return;\n    }\n    #endif\n","crt-aperture.glsl":'\n/*\nCRT Shader by EasyMode\nLicense: GPL\n*/\n/*\n#pragma parameter SHARPNESS_IMAGE "Sharpness Image" 1.0 1.0 5.0 1.0\n#pragma parameter SHARPNESS_EDGES "Sharpness Edges" 3.0 1.0 5.0 1.0\n#pragma parameter GLOW_WIDTH "Glow Width" 0.5 0.05 0.65 0.05\n#pragma parameter GLOW_HEIGHT "Glow Height" 0.5 0.05 0.65 0.05\n#pragma parameter GLOW_HALATION "Glow Halation" 0.1 0.0 1.0 0.01\n#pragma parameter GLOW_DIFFUSION "Glow Diffusion" 0.05 0.0 1.0 0.01\n#pragma parameter MASK_COLORS "Mask Colors" 2.0 2.0 3.0 1.0\n#pragma parameter MASK_STRENGTH "Mask Strength" 0.3 0.0 1.0 0.05\n#pragma parameter MASK_SIZE "Mask Size" 1.0 1.0 9.0 1.0\n#pragma parameter SCANLINE_SIZE_MIN "Scanline Size Min." 0.5 0.5 1.5 0.05\n#pragma parameter SCANLINE_SIZE_MAX "Scanline Size Max." 1.5 0.5 1.5 0.05\n#pragma parameter GAMMA_INPUT "Gamma Input" 2.4 1.0 5.0 0.1\n#pragma parameter GAMMA_OUTPUT "Gamma Output" 2.4 1.0 5.0 0.1\n#pragma parameter BRIGHTNESS "Brightness" 1.5 0.0 2.0 0.05\n* */\n\n#define Coord TEX0\n\n#if defined(VERTEX)\n\n#if __VERSION__ >= 130\n#define OUT out\n#define IN  in\n#define tex2D texture\n#else\n#define OUT varying \n#define IN attribute \n#define tex2D texture2D\n#endif\n\n#ifdef GL_ES\n#define PRECISION mediump\n#else\n#define PRECISION\n#endif\n\nIN  vec4 VertexCoord;\nIN  vec4 Color;\nIN  vec2 TexCoord;\nOUT vec4 color;\nOUT vec2 Coord;\n\nuniform mat4 MVPMatrix;\nuniform PRECISION int FrameDirection;\nuniform PRECISION int FrameCount;\nuniform PRECISION vec2 OutputSize;\nuniform PRECISION vec2 TextureSize;\nuniform PRECISION vec2 InputSize;\n\nvoid main()\n{\ngl_Position = MVPMatrix * VertexCoord;\ncolor = Color;\nCoord = TexCoord;\n}\n\n#elif defined(FRAGMENT)\n\n#if __VERSION__ >= 130\n#define IN in\n#define tex2D texture\nout vec4 FragColor;\n#else\n#define IN varying\n#define FragColor gl_FragColor\n#define tex2D texture2D\n#endif\n\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#define PRECISION mediump\n#else\n#define PRECISION\n#endif\n\nuniform PRECISION int FrameDirection;\nuniform PRECISION int FrameCount;\nuniform PRECISION vec2 OutputSize;\nuniform PRECISION vec2 TextureSize;\nuniform PRECISION vec2 InputSize;\nuniform sampler2D Texture;\nIN vec2 Coord;\n\n#ifdef PARAMETER_UNIFORM\nuniform PRECISION float SHARPNESS_IMAGE;\nuniform PRECISION float SHARPNESS_EDGES;\nuniform PRECISION float GLOW_WIDTH;\nuniform PRECISION float GLOW_HEIGHT;\nuniform PRECISION float GLOW_HALATION;\nuniform PRECISION float GLOW_DIFFUSION;\nuniform PRECISION float MASK_COLORS;\nuniform PRECISION float MASK_STRENGTH;\nuniform PRECISION float MASK_SIZE;\nuniform PRECISION float SCANLINE_SIZE_MIN;\nuniform PRECISION float SCANLINE_SIZE_MAX;\nuniform PRECISION float GAMMA_INPUT;\nuniform PRECISION float GAMMA_OUTPUT;\nuniform PRECISION float BRIGHTNESS;\n#else\n#define SHARPNESS_IMAGE 1.0\n#define SHARPNESS_EDGES 3.0\n#define GLOW_WIDTH 0.5\n#define GLOW_HEIGHT 0.5\n#define GLOW_HALATION 0.1\n#define GLOW_DIFFUSION 0.05\n#define MASK_COLORS 2.0\n#define MASK_STRENGTH 0.3\n#define MASK_SIZE 1.0\n#define SCANLINE_SIZE_MIN 0.5\n#define SCANLINE_SIZE_MAX 1.5\n#define GAMMA_INPUT 2.4\n#define GAMMA_OUTPUT 2.4\n#define BRIGHTNESS 1.5\n#endif\n\n#define FIX(c) max(abs(c), 1e-5)\n#define PI 3.141592653589\n#define saturate(c) clamp(c, 0.0, 1.0)\n#define TEX2D(c) pow(tex2D(tex, c).rgb, vec3(GAMMA_INPUT))\n\nmat3 get_color_matrix(sampler2D tex, vec2 co, vec2 dx)\n{\nreturn mat3(TEX2D(co - dx), TEX2D(co), TEX2D(co + dx));\n}\n\nvec3 blur(mat3 m, float dist, float rad)\n{\nvec3 x = vec3(dist - 1.0, dist, dist + 1.0) / rad;\nvec3 w = exp2(x * x * -1.0);\n\nreturn (m[0] * w.x + m[1] * w.y + m[2] * w.z) / (w.x + w.y + w.z);\n}\n\nvec3 filter_gaussian(sampler2D tex, vec2 co, vec2 tex_size)\n{\nvec2 dx = vec2(1.0 / tex_size.x, 0.0);\nvec2 dy = vec2(0.0, 1.0 / tex_size.y);\nvec2 pix_co = co * tex_size;\nvec2 tex_co = (floor(pix_co) + 0.5) / tex_size;\nvec2 dist = (fract(pix_co) - 0.5) * -1.0;\n\nmat3 line0 = get_color_matrix(tex, tex_co - dy, dx);\nmat3 line1 = get_color_matrix(tex, tex_co, dx);\nmat3 line2 = get_color_matrix(tex, tex_co + dy, dx);\nmat3 column = mat3(blur(line0, dist.x, GLOW_WIDTH),\n                       blur(line1, dist.x, GLOW_WIDTH),\n                       blur(line2, dist.x, GLOW_WIDTH));\n\nreturn blur(column, dist.y, GLOW_HEIGHT);\n}\n\nvec3 filter_lanczos(sampler2D tex, vec2 co, vec2 tex_size, float sharp)\n{\ntex_size.x *= sharp;\n\nvec2 dx = vec2(1.0 / tex_size.x, 0.0);\nvec2 pix_co = co * tex_size - vec2(0.5, 0.0);\nvec2 tex_co = (floor(pix_co) + vec2(0.5, 0.0)) / tex_size;\nvec2 dist = fract(pix_co);\nvec4 coef = PI * vec4(dist.x + 1.0, dist.x, dist.x - 1.0, dist.x - 2.0);\n\ncoef = FIX(coef);\ncoef = 2.0 * sin(coef) * sin(coef / 2.0) / (coef * coef);\ncoef /= dot(coef, vec4(1.0));\n\nvec4 col1 = vec4(TEX2D(tex_co), 1.0);\nvec4 col2 = vec4(TEX2D(tex_co + dx), 1.0);\n\nreturn (mat4(col1, col1, col2, col2) * coef).rgb;\n}\n\nvec3 get_scanline_weight(float x, vec3 col)\n{\nvec3 beam = mix(vec3(SCANLINE_SIZE_MIN), vec3(SCANLINE_SIZE_MAX), col);\nvec3 x_mul = 2.0 / beam;\nvec3 x_offset = x_mul * 0.5;\n\nreturn smoothstep(0.0, 1.0, 1.0 - abs(x * x_mul - x_offset)) * x_offset;\n}\n\nvec3 get_mask_weight(float x)\n{\nfloat i = mod(floor(x * OutputSize.x * TextureSize.x / (InputSize.x * MASK_SIZE)), MASK_COLORS);\n\nif (i == 0.0) return mix(vec3(1.0, 0.0, 1.0), vec3(1.0, 0.0, 0.0), MASK_COLORS - 2.0);\nelse if (i == 1.0) return vec3(0.0, 1.0, 0.0);\nelse return vec3(0.0, 0.0, 1.0);\n}\n\nvoid main()\n{\nvec3 col_glow = filter_gaussian(Texture, Coord, TextureSize);\nvec3 col_soft = filter_lanczos(Texture, Coord, TextureSize, SHARPNESS_IMAGE);\nvec3 col_sharp = filter_lanczos(Texture, Coord, TextureSize, SHARPNESS_EDGES);\nvec3 col = sqrt(col_sharp * col_soft);\n\ncol *= get_scanline_weight(fract(Coord.y * TextureSize.y), col_soft);\ncol_glow = saturate(col_glow - col);\ncol += col_glow * col_glow * GLOW_HALATION;\ncol = mix(col, col * get_mask_weight(Coord.x) * MASK_COLORS, MASK_STRENGTH);\ncol += col_glow * GLOW_DIFFUSION;\ncol = pow(col * BRIGHTNESS, vec3(1.0 / GAMMA_OUTPUT));\n\nFragColor = vec4(col, 1.0);\n}\n\n#endif\n',"crt-geom.glsl":'\n/*\nCRT-interlaced\n\nCopyright (C) 2010-2012 cgwg, Themaister and DOLLS\n\nThis program is free software; you can redistribute it and/or modify it\nunder the terms of the GNU General Public License as published by the Free\nSoftware Foundation; either version 2 of the License, or (at your option)\nany later version.\n\n(cgwg gave their consent to have the original version of this shader\ndistributed under the GPL in this message:\n\nhttp://board.byuu.org/viewtopic.php?p=26075#p26075\n\n"Feel free to distribute my shaders under the GPL. After all, the\nbarrel distortion code was taken from the Curvature shader, which is\nunder the GPL."\n)\nThis shader variant is pre-configured with screen curvature\n*/\n/*\n#pragma parameter CRTgamma "CRTGeom Target Gamma" 2.4 0.1 5.0 0.1\n#pragma parameter monitorgamma "CRTGeom Monitor Gamma" 2.2 0.1 5.0 0.1\n#pragma parameter d "CRTGeom Distance" 1.6 0.1 3.0 0.1\n#pragma parameter CURVATURE "CRTGeom Curvature Toggle" 1.0 0.0 1.0 1.0\n#pragma parameter R "CRTGeom Curvature Radius" 2.0 0.1 10.0 0.1\n#pragma parameter cornersize "CRTGeom Corner Size" 0.03 0.001 1.0 0.005\n#pragma parameter cornersmooth "CRTGeom Corner Smoothness" 1000.0 80.0 2000.0 100.0\n#pragma parameter x_tilt "CRTGeom Horizontal Tilt" 0.0 -0.5 0.5 0.05\n#pragma parameter y_tilt "CRTGeom Vertical Tilt" 0.0 -0.5 0.5 0.05\n#pragma parameter overscan_x "CRTGeom Horiz. Overscan %" 100.0 -125.0 125.0 1.0\n#pragma parameter overscan_y "CRTGeom Vert. Overscan %" 100.0 -125.0 125.0 1.0\n#pragma parameter DOTMASK "CRTGeom Dot Mask Toggle" 0.3 0.0 0.3 0.3\n#pragma parameter SHARPER "CRTGeom Sharpness" 1.0 1.0 3.0 1.0\n#pragma parameter scanline_weight "CRTGeom Scanline Weight" 0.3 0.1 0.5 0.05\n*/\n\n#ifndef PARAMETER_UNIFORM\n#define CRTgamma 2.4\n#define monitorgamma 2.2\n#define d 1.6\n#define CURVATURE 1.0\n#define R 2.0\n#define cornersize 0.03\n#define cornersmooth 1000.0\n#define x_tilt 0.0\n#define y_tilt 0.0\n#define overscan_x 100.0\n#define overscan_y 100.0\n#define DOTMASK 0.3\n#define SHARPER 1.0\n#define scanline_weight 0.3\n#endif\n\n#if defined(VERTEX)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING out\n#define COMPAT_ATTRIBUTE in\n#define COMPAT_TEXTURE texture\n#else\n#define COMPAT_VARYING varying \n#define COMPAT_ATTRIBUTE attribute \n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nCOMPAT_ATTRIBUTE vec4 VertexCoord;\nCOMPAT_ATTRIBUTE vec4 COLOR;\nCOMPAT_ATTRIBUTE vec4 TexCoord;\nCOMPAT_VARYING vec4 COL0;\nCOMPAT_VARYING vec4 TEX0;\n\nvec4 _oPosition1; \nuniform mat4 MVPMatrix;\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\n\nCOMPAT_VARYING vec2 overscan;\nCOMPAT_VARYING vec2 aspect;\nCOMPAT_VARYING vec3 stretch;\nCOMPAT_VARYING vec2 sinangle;\nCOMPAT_VARYING vec2 cosangle;\nCOMPAT_VARYING vec2 one;\nCOMPAT_VARYING float mod_factor;\nCOMPAT_VARYING vec2 ilfac;\n\n#ifdef PARAMETER_UNIFORM\nuniform COMPAT_PRECISION float CRTgamma;\nuniform COMPAT_PRECISION float monitorgamma;\nuniform COMPAT_PRECISION float d;\nuniform COMPAT_PRECISION float CURVATURE;\nuniform COMPAT_PRECISION float R;\nuniform COMPAT_PRECISION float cornersize;\nuniform COMPAT_PRECISION float cornersmooth;\nuniform COMPAT_PRECISION float x_tilt;\nuniform COMPAT_PRECISION float y_tilt;\nuniform COMPAT_PRECISION float overscan_x;\nuniform COMPAT_PRECISION float overscan_y;\nuniform COMPAT_PRECISION float DOTMASK;\nuniform COMPAT_PRECISION float SHARPER;\nuniform COMPAT_PRECISION float scanline_weight;\n#endif\n\n#define FIX(c) max(abs(c), 1e-5);\n\nfloat intersect(vec2 xy)\n{\nfloat A = dot(xy,xy)+d*d;\nfloat B = 2.0*(R*(dot(xy,sinangle)-d*cosangle.x*cosangle.y)-d*d);\nfloat C = d*d + 2.0*R*d*cosangle.x*cosangle.y;\nreturn (-B-sqrt(B*B-4.0*A*C))/(2.0*A);\n}\n\nvec2 bkwtrans(vec2 xy)\n{\nfloat c = intersect(xy);\nvec2 point = vec2(c)*xy;\npoint -= vec2(-R)*sinangle;\npoint /= vec2(R);\nvec2 tang = sinangle/cosangle;\nvec2 poc = point/cosangle;\nfloat A = dot(tang,tang)+1.0;\nfloat B = -2.0*dot(poc,tang);\nfloat C = dot(poc,poc)-1.0;\nfloat a = (-B+sqrt(B*B-4.0*A*C))/(2.0*A);\nvec2 uv = (point-a*sinangle)/cosangle;\nfloat r = R*acos(a);\nreturn uv*r/sin(r/R);\n}\n\nvec2 fwtrans(vec2 uv)\n{\nfloat r = FIX(sqrt(dot(uv,uv)));\nuv *= sin(r/R)/r;\nfloat x = 1.0-cos(r/R);\nfloat D = d/R + x*cosangle.x*cosangle.y+dot(uv,sinangle);\nreturn d*(uv*cosangle-x*sinangle)/D;\n}\n\nvec3 maxscale()\n{\nvec2 c = bkwtrans(-R * sinangle / (1.0 + R/d*cosangle.x*cosangle.y));\nvec2 a = vec2(0.5,0.5)*aspect;\nvec2 lo = vec2(fwtrans(vec2(-a.x,c.y)).x, fwtrans(vec2(c.x,-a.y)).y)/aspect;\nvec2 hi = vec2(fwtrans(vec2(+a.x,c.y)).x, fwtrans(vec2(c.x,+a.y)).y)/aspect;\nreturn vec3((hi+lo)*aspect*0.5,max(hi.x-lo.x,hi.y-lo.y));\n}\n\nvoid main()\n{\n// START of parameters\n\n// gamma of simulated CRT\n//	CRTgamma = 1.8;\n// gamma of display monitor (typically 2.2 is correct)\n//	monitorgamma = 2.2;\n// overscan (e.g. 1.02 for 2% overscan)\noverscan = vec2(1.00,1.00);\n// aspect ratio\naspect = vec2(1.0, 0.75);\n// lengths are measured in units of (approximately) the width\n// of the monitor simulated distance from viewer to monitor\n//	d = 2.0;\n// radius of curvature\n//	R = 1.5;\n// tilt angle in radians\n// (behavior might be a bit wrong if both components are\n// nonzero)\nconst vec2 angle = vec2(0.0,0.0);\n// size of curved corners\n//	cornersize = 0.03;\n// border smoothness parameter\n// decrease if borders are too aliased\n//	cornersmooth = 1000.0;\n\n// END of parameters\n\nvec4 _oColor;\nvec2 _otexCoord;\ngl_Position = VertexCoord.x * MVPMatrix[0] + VertexCoord.y * MVPMatrix[1] + VertexCoord.z * MVPMatrix[2] + VertexCoord.w * MVPMatrix[3];\n_oPosition1 = gl_Position;\n_oColor = COLOR;\n_otexCoord = TexCoord.xy;\nCOL0 = COLOR;\nTEX0.xy = TexCoord.xy;\n\n// Precalculate a bunch of useful values we\'ll need in the fragment\n// shader.\nsinangle = sin(vec2(x_tilt, y_tilt)) + vec2(0.001);//sin(vec2(max(abs(x_tilt), 1e-3), max(abs(y_tilt), 1e-3)));\ncosangle = cos(vec2(x_tilt, y_tilt)) + vec2(0.001);//cos(vec2(max(abs(x_tilt), 1e-3), max(abs(y_tilt), 1e-3)));\nstretch = maxscale();\n\nilfac = vec2(1.0,clamp(floor(InputSize.y/200.0), 1.0, 2.0));\n\n// The size of one texel, in texture-coordinates.\nvec2 sharpTextureSize = vec2(SHARPER * TextureSize.x, TextureSize.y);\none = ilfac / sharpTextureSize;\n\n// Resulting X pixel-coordinate of the pixel we\'re drawing.\nmod_factor = TexCoord.x * TextureSize.x * OutputSize.x / InputSize.x;\n\n}\n\n#elif defined(FRAGMENT)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING in\n#define COMPAT_TEXTURE texture\nout vec4 FragColor;\n#else\n#define COMPAT_VARYING varying\n#define FragColor gl_FragColor\n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nstruct output_dummy {\nvec4 _color;\n};\n\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\nuniform sampler2D Texture;\nCOMPAT_VARYING vec4 TEX0;\n\n// Comment the next line to disable interpolation in linear gamma (and\n// gain speed).\n#define LINEAR_PROCESSING\n\n// Enable screen curvature.\n//        #define CURVATURE\n\n// Enable 3x oversampling of the beam profile\n#define OVERSAMPLE\n\n// Use the older, purely gaussian beam profile\n//#define USEGAUSSIAN\n\n// Macros.\n#define FIX(c) max(abs(c), 1e-5);\n#define PI 3.141592653589\n\n#ifdef LINEAR_PROCESSING\n#       define TEX2D(c) pow(COMPAT_TEXTURE(Texture, (c)), vec4(CRTgamma))\n#else\n#       define TEX2D(c) COMPAT_TEXTURE(Texture, (c))\n#endif\n\nCOMPAT_VARYING vec2 one;\nCOMPAT_VARYING float mod_factor;\nCOMPAT_VARYING vec2 ilfac;\nCOMPAT_VARYING vec2 overscan;\nCOMPAT_VARYING vec2 aspect;\nCOMPAT_VARYING vec3 stretch;\nCOMPAT_VARYING vec2 sinangle;\nCOMPAT_VARYING vec2 cosangle;\n\n#ifdef PARAMETER_UNIFORM\nuniform COMPAT_PRECISION float CRTgamma;\nuniform COMPAT_PRECISION float monitorgamma;\nuniform COMPAT_PRECISION float d;\nuniform COMPAT_PRECISION float CURVATURE;\nuniform COMPAT_PRECISION float R;\nuniform COMPAT_PRECISION float cornersize;\nuniform COMPAT_PRECISION float cornersmooth;\nuniform COMPAT_PRECISION float x_tilt;\nuniform COMPAT_PRECISION float y_tilt;\nuniform COMPAT_PRECISION float overscan_x;\nuniform COMPAT_PRECISION float overscan_y;\nuniform COMPAT_PRECISION float DOTMASK;\nuniform COMPAT_PRECISION float SHARPER;\nuniform COMPAT_PRECISION float scanline_weight;\n#endif\n\nfloat intersect(vec2 xy)\n{\nfloat A = dot(xy,xy)+d*d;\nfloat B = 2.0*(R*(dot(xy,sinangle)-d*cosangle.x*cosangle.y)-d*d);\nfloat C = d*d + 2.0*R*d*cosangle.x*cosangle.y;\nreturn (-B-sqrt(B*B-4.0*A*C))/(2.0*A);\n}\n\nvec2 bkwtrans(vec2 xy)\n{\nfloat c = intersect(xy);\nvec2 point = vec2(c)*xy;\npoint -= vec2(-R)*sinangle;\npoint /= vec2(R);\nvec2 tang = sinangle/cosangle;\nvec2 poc = point/cosangle;\nfloat A = dot(tang,tang)+1.0;\nfloat B = -2.0*dot(poc,tang);\nfloat C = dot(poc,poc)-1.0;\nfloat a = (-B+sqrt(B*B-4.0*A*C))/(2.0*A);\nvec2 uv = (point-a*sinangle)/cosangle;\nfloat r = FIX(R*acos(a));\nreturn uv*r/sin(r/R);\n}\n\nvec2 transform(vec2 coord)\n{\ncoord *= TextureSize / InputSize;\ncoord = (coord-vec2(0.5))*aspect*stretch.z+stretch.xy;\nreturn (bkwtrans(coord)/vec2(overscan_x / 100.0, overscan_y / 100.0)/aspect+vec2(0.5)) * InputSize / TextureSize;\n}\n\nfloat corner(vec2 coord)\n{\ncoord *= TextureSize / InputSize;\ncoord = (coord - vec2(0.5)) * vec2(overscan_x / 100.0, overscan_y / 100.0) + vec2(0.5);\ncoord = min(coord, vec2(1.0)-coord) * aspect;\nvec2 cdist = vec2(cornersize);\ncoord = (cdist - min(coord,cdist));\nfloat dist = sqrt(dot(coord,coord));\nreturn clamp((cdist.x-dist)*cornersmooth,0.0, 1.0);\n}\n\n// Calculate the influence of a scanline on the current pixel.\n//\n// \'distance\' is the distance in texture coordinates from the current\n// pixel to the scanline in question.\n// \'color\' is the colour of the scanline at the horizontal location of\n// the current pixel.\nvec4 scanlineWeights(float distance, vec4 color)\n{\n// "wid" controls the width of the scanline beam, for each RGB\n// channel The "weights" lines basically specify the formula\n// that gives you the profile of the beam, i.e. the intensity as\n// a function of distance from the vertical center of the\n// scanline. In this case, it is gaussian if width=2, and\n// becomes nongaussian for larger widths. Ideally this should\n// be normalized so that the integral across the beam is\n// independent of its width. That is, for a narrower beam\n// "weights" should have a higher peak at the center of the\n// scanline than for a wider beam.\n#ifdef USEGAUSSIAN\nvec4 wid = 0.3 + 0.1 * pow(color, vec4(3.0));\nvec4 weights = vec4(distance / wid);\nreturn 0.4 * exp(-weights * weights) / wid;\n#else\nvec4 wid = 2.0 + 2.0 * pow(color, vec4(4.0));\nvec4 weights = vec4(distance / scanline_weight);\nreturn 1.4 * exp(-pow(weights * inversesqrt(0.5 * wid), wid)) / (0.6 + 0.2 * wid);\n#endif\n}\n\nvoid main()\n{\n// Here\'s a helpful diagram to keep in mind while trying to\n// understand the code:\n//\n//  |      |      |      |      |\n// -------------------------------\n//  |      |      |      |      |\n//  |  01  |  11  |  21  |  31  | <-- current scanline\n//  |      | @    |      |      |\n// -------------------------------\n//  |      |      |      |      |\n//  |  02  |  12  |  22  |  32  | <-- next scanline\n//  |      |      |      |      |\n// -------------------------------\n//  |      |      |      |      |\n//\n// Each character-cell represents a pixel on the output\n// surface, "@" represents the current pixel (always somewhere\n// in the bottom half of the current scan-line, or the top-half\n// of the next scanline). The grid of lines represents the\n// edges of the texels of the underlying texture.\n\n// Texture coordinates of the texel containing the active pixel.\nvec2 xy = (CURVATURE > 0.5) ? transform(TEX0.xy) : TEX0.xy;\n\nfloat cval = corner(xy);\n\n// Of all the pixels that are mapped onto the texel we are\n// currently rendering, which pixel are we currently rendering?\nvec2 ilvec = vec2(0.0,ilfac.y > 1.5 ? mod(float(FrameCount),2.0) : 0.0);\nvec2 ratio_scale = (xy * TextureSize - vec2(0.5) + ilvec)/ilfac;\n#ifdef OVERSAMPLE\nfloat filter_ = InputSize.y/OutputSize.y;//fwidth(ratio_scale.y);\n#endif\nvec2 uv_ratio = fract(ratio_scale);\n\n// Snap to the center of the underlying texel.\nxy = (floor(ratio_scale)*ilfac + vec2(0.5) - ilvec) / TextureSize;\n\n// Calculate Lanczos scaling coefficients describing the effect\n// of various neighbour texels in a scanline on the current\n// pixel.\nvec4 coeffs = PI * vec4(1.0 + uv_ratio.x, uv_ratio.x, 1.0 - uv_ratio.x, 2.0 - uv_ratio.x);\n\n// Prevent division by zero.\ncoeffs = FIX(coeffs);\n\n// Lanczos2 kernel.\ncoeffs = 2.0 * sin(coeffs) * sin(coeffs / 2.0) / (coeffs * coeffs);\n\n// Normalize.\ncoeffs /= dot(coeffs, vec4(1.0));\n\n// Calculate the effective colour of the current and next\n// scanlines at the horizontal location of the current pixel,\n// using the Lanczos coefficients above.\nvec4 col  = clamp(mat4(\n                TEX2D(xy + vec2(-one.x, 0.0)),\n                TEX2D(xy),\n                TEX2D(xy + vec2(one.x, 0.0)),\n                TEX2D(xy + vec2(2.0 * one.x, 0.0))) * coeffs,\n                0.0, 1.0);\nvec4 col2 = clamp(mat4(\n                TEX2D(xy + vec2(-one.x, one.y)),\n                TEX2D(xy + vec2(0.0, one.y)),\n                TEX2D(xy + one),\n                TEX2D(xy + vec2(2.0 * one.x, one.y))) * coeffs,\n                0.0, 1.0);\n\n#ifndef LINEAR_PROCESSING\ncol  = pow(col , vec4(CRTgamma));\ncol2 = pow(col2, vec4(CRTgamma));\n#endif\n\n// Calculate the influence of the current and next scanlines on\n// the current pixel.\nvec4 weights  = scanlineWeights(uv_ratio.y, col);\nvec4 weights2 = scanlineWeights(1.0 - uv_ratio.y, col2);\n#ifdef OVERSAMPLE\nuv_ratio.y =uv_ratio.y+1.0/3.0*filter_;\nweights = (weights+scanlineWeights(uv_ratio.y, col))/3.0;\nweights2=(weights2+scanlineWeights(abs(1.0-uv_ratio.y), col2))/3.0;\nuv_ratio.y =uv_ratio.y-2.0/3.0*filter_;\nweights=weights+scanlineWeights(abs(uv_ratio.y), col)/3.0;\nweights2=weights2+scanlineWeights(abs(1.0-uv_ratio.y), col2)/3.0;\n#endif\n\nvec3 mul_res  = (col * weights + col2 * weights2).rgb * vec3(cval);\n\n// dot-mask emulation:\n// Output pixels are alternately tinted green and magenta.\nvec3 dotMaskWeights = mix(\nvec3(1.0, 1.0 - DOTMASK, 1.0),\nvec3(1.0 - DOTMASK, 1.0, 1.0 - DOTMASK),\nfloor(mod(mod_factor, 2.0))\n);\n\nmul_res *= dotMaskWeights;\n\n// Convert the image gamma for display on our output device.\nmul_res = pow(mul_res, vec3(1.0 / monitorgamma));\n\n// Color the texel.\noutput_dummy _OUT;\n_OUT._color = vec4(mul_res, 1.0);\nFragColor = _OUT._color;\nreturn;\n} \n#endif\n\n'},g=v(57),K=v.n(g),O=v(11),x={addStyleHook:function(){h(this.elements.container,this.config.selectors.container.replace(".",""),!0),h(this.elements.container,this.config.classNames.uiSupported,!0),h(this.elements.container,this.config.classNames.hideControls,!0)},build:function(){this.listeners.media(),s.element(this.elements.controls)||(l.inject.call(this),this.listeners.controls()),this.volume=null,this.muted=null,l.updateVolume.call(this),h(this.elements.container,this.config.classNames.isTouch,this.touch),this.ready=!0},toggleControls:function(o){var e,s,t=this.elements.controls;t&&(e=0,s=M.call(this,".".concat(n({ejs__dialogs:!0})," > .").concat(n({ejs__dialog:!0}))),Array.from(s).forEach(function(t){!0!==t.hidden&&(e+=1)}),0<e?this.toggleControls(!1):this.toggleControls(Boolean(o||this.paused||t.pressed||t.hover)))}},e4,ep,em;function $(e){return($="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){if("object"===$(e)&&e.files&&(e=e.files[0]),this.littleEndian=!1,this.offset=0,this._lastRead=null,"object"===$(e)&&e.name&&e.size){if("function"!=typeof window.FileReader)throw new Error("Incompatible Browser");this.fileName=e.name,this.fileType=e.type,this.fileSize=e.size,this._fileReader=new FileReader,(this._fileReader.marcFile=this)._fileReader.addEventListener("load",function(){this.marcFile._u8array=new Uint8Array(this.result),this.marcFile._dataView=new DataView(this.result),t&&t.call()},!1),this._fileReader.readAsArrayBuffer(e)}else if("object"===$(e)&&"string"==typeof e.fileName&&"boolean"==typeof e.littleEndian){this.fileName=e.fileName,this.fileType=e.fileType,this.fileSize=e.fileSize;var n=new ArrayBuffer(e);this._u8array=new Uint8Array(this.fileType),this._dataView=new DataView(this.fileType),e.copyToFile(this,0),t&&t.call()}else if("object"===$(e)&&"number"==typeof e.byteLength)this.fileName="file.bin",this.fileType="application/octet-stream",this.fileSize=e.byteLength,void 0!==e.buffer&&(e=e.buffer),this._u8array=new Uint8Array(e),this._dataView=new DataView(e),t&&t.call();else{if("number"!=typeof e)throw new Error("Invalid source");this.fileName="file.bin",this.fileType="application/octet-stream",this.fileSize=e,n=new ArrayBuffer(e),this._u8array=new Uint8Array(n),this._dataView=new DataView(n),t&&t.call()}}f.IS_MACHINE_LITTLE_ENDIAN=(j=new ArrayBuffer(2),new DataView(j).setInt16(0,256,!0),256===new Int16Array(j)[0]),f.prototype.seek=function(e){this.offset=e},f.prototype.skip=function(e){this.offset+=e},f.prototype.isEOF=function(){return!(this.offset<this.fileSize)},f.prototype.slice=function(n,t){var e;return t=t||this.fileSize-n,void 0!==this._u8array.buffer.slice?((e=new f(0)).fileSize=t,e._u8array=new Uint8Array(this._u8array.buffer.slice(n,n+t))):(e=new f(t),this.copyToFile(e,n,t,0)),e.fileName=this.fileName,e.fileType=this.fileType,e.littleEndian=this.littleEndian,e},f.prototype.copyToFile=function(o,t,n,s){void 0===s&&(s=t),n=n||this.fileSize-t;for(var e=0;e<n;e++)o._u8array[s+e]=this._u8array[t+e]},f.prototype.save=function(){try{e=new Blob([this._u8array],{type:this.fileType})}catch(n){if(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,"InvalidStateError"!==n.name||!window.BlobBuilder)throw new Error("Incompatible Browser");var e,t=new BlobBuilder;t.append(this._u8array.buffer),e=t.getBlob(this.fileType)}saveAs(e,this.fileName)},f.prototype.readU8=function(){return this._lastRead=this._u8array[this.offset],this.offset++,this._lastRead},f.prototype.readU16=function(){return this.littleEndian?this._lastRead=this._u8array[this.offset]+(this._u8array[this.offset+1]<<8):this._lastRead=(this._u8array[this.offset]<<8)+this._u8array[this.offset+1],this.offset+=2,this._lastRead>>>0},f.prototype.readU24=function(){return this.littleEndian?this._lastRead=this._u8array[this.offset]+(this._u8array[this.offset+1]<<8)+(this._u8array[this.offset+2]<<16):this._lastRead=(this._u8array[this.offset]<<16)+(this._u8array[this.offset+1]<<8)+this._u8array[this.offset+2],this.offset+=3,this._lastRead>>>0},f.prototype.readU32=function(){return this.littleEndian?this._lastRead=this._u8array[this.offset]+(this._u8array[this.offset+1]<<8)+(this._u8array[this.offset+2]<<16)+(this._u8array[this.offset+3]<<24):this._lastRead=(this._u8array[this.offset]<<24)+(this._u8array[this.offset+1]<<16)+(this._u8array[this.offset+2]<<8)+this._u8array[this.offset+3],this.offset+=4,this._lastRead>>>0},f.prototype.readBytes=function(t){this._lastRead=new Array(t);for(var e=0;e<t;e++)this._lastRead[e]=this._u8array[this.offset+e];return this.offset+=t,this._lastRead},f.prototype.readString=function(t){this._lastRead="";for(var e=0;e<t&&this.offset+e<this.fileSize&&0<this._u8array[this.offset+e];e++)this._lastRead=this._lastRead+String.fromCharCode(this._u8array[this.offset+e]);return this.offset+=t,this._lastRead},f.prototype.writeU8=function(e){this._u8array[this.offset]=e,this.offset++},f.prototype.writeU16=function(e){this.littleEndian?(this._u8array[this.offset]=255&e,this._u8array[this.offset+1]=e>>8):(this._u8array[this.offset]=e>>8,this._u8array[this.offset+1]=255&e),this.offset+=2},f.prototype.writeU24=function(e){this.littleEndian?(this._u8array[this.offset]=255&e,this._u8array[this.offset+1]=(65280&e)>>8,this._u8array[this.offset+2]=(16711680&e)>>16):(this._u8array[this.offset]=(16711680&e)>>16,this._u8array[this.offset+1]=(65280&e)>>8,this._u8array[this.offset+2]=255&e),this.offset+=3},f.prototype.writeU32=function(e){this.littleEndian?(this._u8array[this.offset]=255&e,this._u8array[this.offset+1]=(65280&e)>>8,this._u8array[this.offset+2]=(16711680&e)>>16,this._u8array[this.offset+3]=(4278190080&e)>>24):(this._u8array[this.offset]=(4278190080&e)>>24,this._u8array[this.offset+1]=(16711680&e)>>16,this._u8array[this.offset+2]=(65280&e)>>8,this._u8array[this.offset+3]=255&e),this.offset+=4},f.prototype.writeBytes=function(t){for(var e=0;e<t.length;e++)this._u8array[this.offset+e]=t[e];this.offset+=t.length},f.prototype.writeString=function(n,t){t=t||n.length;for(var e=0;e<n.length&&e<t;e++)this._u8array[this.offset+e]=n.charCodeAt(e);for(;e<t;e++)this._u8array[this.offset+e]=0;this.offset+=t},b=f,S=0;function L(){this.records=[],this.truncate=!1}function e0(e){var n,s,t=new L;e.seek(5);for(;!e.isEOF();){if(4542278===(n=e.readU24())){if(e.isEOF())break;if(e.offset+3===e.fileSize){t.truncate=e.readU24();break}}(s=e.readU16())===S?t.addRLERecord(n,e.readU16(),e.readU8()):t.addSimpleRecord(n,e.readBytes(s))}return t}L.prototype.addSimpleRecord=function(t,e){this.records.push({offset:t,type:1,length:e.length,data:e})},L.prototype.addRLERecord=function(e,t,n){this.records.push({offset:e,type:S,length:t,byte:n})},L.prototype.toString=function(){nSimpleRecords=0;for(e=nRLERecords=0;e<this.records.length;e++)this.records[e].type===S?nRLERecords++:nSimpleRecords++;var e,t="Simple records: "+nSimpleRecords,t=(t+="\nRLE records: "+nRLERecords)+("\nTotal records: "+this.records.length);return this.truncate&&(t+="\nTruncate at: 0x"+this.truncate.toString(16)),t},L.prototype.export=function(s){for(var e,n=5,t=0;t<this.records.length;t++)this.records[t].type===S?n+=8:n+=5+this.records[t].data.length;for(n+=3,this.truncate&&(n+=3),(tempFile=new b(n)).fileName=s+".ips",tempFile.writeString("PATCH"),t=0;t<this.records.length;t++)e=this.records[t],tempFile.writeU24(e.offset),e.type===S?(tempFile.writeU16(0),tempFile.writeU16(e.length),tempFile.writeU8(e.byte)):(tempFile.writeU16(e.data.length),tempFile.writeBytes(e.data));return tempFile.writeString("EOF"),e.truncate&&tempFile.writeU24(e.truncate),tempFile},L.prototype.apply=function(s){if(this.truncate)n=s.slice(0,this.truncate);else{for(var t,n,i,o=s.fileSize,e=0;e<this.records.length;e++)t=this.records[e],t.type===S?t.offset+t.length>o&&(o=t.offset+t.length):t.offset+t.data.length>o&&(o=t.offset+t.data.length);o===s.fileSize?n=s.slice(0,s.fileSize):(n=new b(o),s.copyToFile(n,0))}for(s.seek(0),e=0;e<this.records.length;e++)if(n.seek(this.records[e].offset),this.records[e].type===S)for(i=0;i<this.records[e].length;i++)n.writeU8(this.records[e].byte);else n.writeBytes(this.records[e].data);return n},"0123456789abcdef".split(""),e4=function(){for(var e,n,s=[],t=0;t<256;t++){for(e=t,n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;s[t]=e}return s}();function F(o,s,i){for(var n=s?new Uint8Array(o._u8array.buffer,s):o._u8array,e=-1,a=i?n.length-4:n.length,t=0;t<a;t++)e=e>>>8^e4[255&(e^n[t])];return(-1^e)>>>0}var G=1,X=2,Y=3;function I(){this.sourceSize=0,this.targetSize=0,this.metaData="",this.actions=[],this.sourceChecksum=0,this.targetChecksum=0,this.patchChecksum=0}function e3(e){e.readVLV=eH,e.littleEndian=!0;var t,s,i,n=new I,o=(e.seek(4),n.sourceSize=e.readVLV(),n.targetSize=e.readVLV(),e.readVLV());o&&(n.metaData=e.readString(o));for(i=e.fileSize-12;e.offset<i;)t=e.readVLV(),t={type:3&t,length:1+(t>>2)},t.type===G?t.bytes=e.readBytes(t.length):t.type!==X&&t.type!==Y||(s=e.readVLV(),t.relativeOffset=(1&s?-1:1)*(s>>1)),n.actions.push(t);if(n.sourceChecksum=e.readU32(),n.targetChecksum=e.readU32(),n.patchChecksum=e.readU32(),n.patchChecksum!==F(e,0,!0))throw new Error("error_crc_patch");return n}function eH(){for(var t,e=0,n=1;;){if(t=this.readU8(),e+=(127&t)*n,128&t)break;e+=n<<=7}return this._lastRead=e}function eP(e){for(;;){var t=127&e;if(0==(e>>=7)){this.writeU8(128|t);break}this.writeU8(t),e--}}function U(t){for(var e=0;;){if(0==(t>>=7)){e++;break}e++,t--}return e}I.prototype.toString=function(){var e="Source size: "+this.sourceSize;return(e=(e+="\nTarget size: "+this.targetSize)+("\nMetadata: "+this.metaData))+("\n#Actions: "+this.actions.length)},I.prototype.validateSource=function(e,t){return this.sourceChecksum===F(e,t)},I.prototype.apply=function(a,r){if(r&&!this.validateSource(a))throw new Error("error_crc_input");for(var e,n,t=new b(this.targetSize),s=0,o=0,i=0;i<this.actions.length;i++)if(e=this.actions[i],0===e.type)a.copyToFile(t,t.offset,e.length),t.skip(e.length);else if(e.type===G)t.writeBytes(e.bytes);else if(e.type===X){s+=e.relativeOffset;for(n=e.length;n--;)t.writeU8(a._u8array[s]),s++}else if(e.type===Y)for(o+=e.relativeOffset,n=e.length;n--;)t.writeU8(t._u8array[o]),o++;if(r&&this.targetChecksum!==F(t))throw new Error("error_crc_output");return t},I.prototype.export=function(o){for(var e,t,n="BPS1".length,n=(n=(n=(n+=U(this.sourceSize))+U(this.targetSize))+U(this.metaData.length))+this.metaData.length,s=0;s<this.actions.length;s++)n+=U(((e=this.actions[s]).length-1<<2)+e.type),e.type===G?n+=e.length:e.type!==X&&e.type!==Y||(n+=U((Math.abs(e.relativeOffset)<<1)+(e.relativeOffset<0?1:0)));t=new b(n+=12);for(t.fileName=o+".bps",t.littleEndian=!0,t.writeVLV=eP,t.writeString("BPS1"),t.writeVLV(this.sourceSize),t.writeVLV(this.targetSize),t.writeVLV(this.metaData.length),t.writeString(this.metaData,this.metaData.length),s=0;s<this.actions.length;s++)e=this.actions[s],t.writeVLV((e.length-1<<2)+e.type),e.type===G?t.writeBytes(e.bytes):e.type!==X&&e.type!==Y||t.writeVLV((Math.abs(e.relativeOffset)<<1)+(e.relativeOffset<0?1:0));return t.writeU32(this.sourceChecksum),t.writeU32(this.targetChecksum),t.writeU32(this.patchChecksum),t},z="UPS1";function D(){this.records=[],this.sizeInput=0,this.sizeOutput=0,this.checksumInput=0,this.checksumOutput=0}function eL(e){for(;;){var t=127&e;if(0==(e>>=7)){this.writeU8(128|t);break}this.writeU8(t),--e}}function eN(){for(var e,t=0,n=1;;){if(e=this.readU8(),-1==e)throw new Error("Can't read UPS VLV at 0x"+(this.offset-1).toString(16));if(t+=(127&e)*n,0!=(128&e))break;t+=n<<=7}return t}function Z(e){for(var t=0;t++,0!=(e>>=7);)--e;return t}function e7(e){t=new D;for(e.readVLV=eN,e.seek(z.length),t.sizeInput=e.readVLV(),t.sizeOutput=e.readVLV();e.offset<e.fileSize-12;){for(var t,s=e.readVLV(),n=[];e.readU8();)n.push(e._lastRead);t.addRecord(s,n)}return e.littleEndian=!0,t.checksumInput=e.readU32(),t.checksumOutput=e.readU32(),e.littleEndian=!1,t}D.prototype.addRecord=function(e,t){this.records.push({offset:e,XORdata:t})},D.prototype.toString=function(){var e="Records: "+(void 0).records.length;return(e=(e=(e+="\nInput file size: "+(void 0).sizeInput)+("\nOutput file size: "+(void 0).sizeOutput))+("\nInput file checksum: "+padZeroes((void 0).checksumInput,4)))+("\nOutput file checksum: "+padZeroes((void 0).checksumOutput,4))},D.prototype.export=function(n){for(var t=z.length,t=(t+=Z(this.sizeInput))+Z(this.sizeOutput),e=0;e<this.records.length;e++)t=(t+=Z(this.records[e].offset))+(this.records[e].XORdata.length+1);for((tempFile=new b(t+=12)).writeVLV=eL,tempFile.fileName=n+".ups",tempFile.writeString(z),tempFile.writeVLV(this.sizeInput),tempFile.writeVLV(this.sizeOutput),e=0;e<this.records.length;e++)tempFile.writeVLV(this.records[e].offset),tempFile.writeBytes(this.records[e].XORdata),tempFile.writeU8(0);return tempFile.littleEndian=!0,tempFile.writeU32(this.checksumInput),tempFile.writeU32(this.checksumOutput),tempFile.writeU32(F(tempFile,0,!0)),tempFile},D.prototype.validateSource=function(e,t){return F(e,t)===this.checksumInput},D.prototype.apply=function(e,o){o&&this.validateSource(e),tempFile=new b(this.sizeOutput),e.copyToFile(tempFile,0,this.sizeInput),e.seek(0);for(var t,n,s=0;s<this.records.length;s++){t=this.records[s],tempFile.skip(t.offset),e.skip(t.offset);for(n=0;n<t.XORdata.length;n++)tempFile.writeU8((e.isEOF()?0:e.readU8())^t.XORdata[n]);tempFile.skip(1),e.skip(1)}return o&&(F(tempFile),this.checksumOutput),tempFile};var g=v(160),eD=v.n(g),t={_FS:{createPath:function(n,e,s,o){t.FS&&("function"!=typeof t.FS.createPath?t.FS.mkdir(e):t.FS.createPath(n,e,s,o))},createDataFile:function(o,i,s,a,r,c){var e,n;t.FS&&("function"!=typeof t.FS.createDataFile?(n=i,e=(e=o).endsWith("/")||n.startsWith("/")?e+n:e+"/"+n,t.FS.writeFile(e,s)):t.FS.createDataFile(o,i,s,a,r,c))},createFolder:function(s,o,i,a){var e,n;t.FS&&("function"!=typeof t.FS.createFolder?(n=o,e=(e=s).endsWith("/")||n.startsWith("/")?e+n:e+"/"+n,t.FS.mkdir(e)):t.FS.createFolder(s,o,i,a))}},romdb:null,supportBatterySave:!1,hash:"2b35cacf70ae",hash2:"f5cbb3f38c0bb20e4",hash3:"88cc8ad0c350400499a0",loading:null,gamePatch:null,saveFilenames:[],FS:null,Module:null,aspectRatio:4/3,memData:null,wasmData:null,coreFileData:{},coreFileName:"",coreFileVersion:"",isMobileDevice:!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(navigator.userAgent||""),create:function(){e=this,window.URL=window.URL||window.webkitURL;var e,Z,L=!1,D=!1,T=!1,j=0,q=!1,Q={psx:["bin","iso","cue","img","mdf","pbp","toc","cbn","m3u"],nds:["nds","bin"],nes:["fds","nes","unif","unf"],snes:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],snes2002:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],snes2005:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],snes2010:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],gb:["gb","gbc","dmg"],gba:["gb","gbc","gba"],vbanext:["gba"],vb:["vb","vboy","bin"],"3do":["iso","bin","cue"],lynx:["lnx"],jaguar:["j64","jag","rom","abs","cof","bin","prg"],a7800:["a78","bin"],a2600:["a26","bin"],ngp:["ngp","ngc"],n64:["n64","v64","z64","bin","u1","ndd"],pce:["pce","bin","iso","cue","ccd","img","chd"],sega:["mdx","md","smd","gen","bin","iso","cue","sms","gg","sg","68k","chd"],segacd:["mdx","md","smd","gen","bin","iso","cue","sms","gg","sg","68k","chd"],"32x":["32x","bin","gen","smd","md","cue","iso","sms"],saturn:["bin","cue","iso"],msx:["rom","mx1","mx2","dsk","cas"],bluemsx:["rom","ri","mx1","mx2","col","dsk","cas","sg","sc","m3u"],ws:["ws","wsc"],arcade:["zip"],"fba0.2.97.29":["zip"],mame2003:["zip"],mame:["zip"],dos:["zip"]},en={psx:"psx",nds:"nds",nes:"nes",snes:"snes",snes2002:"snes2002",snes2005:"snes2005",snes2010:"snes2010",gb:"gb",gbc:"gb",gba:"gba",vbanext:"vbanext",vb:"vb",n64:"n64","3do":"3do",segaMS:"sega",segaGG:"sega",segaMD:"sega",segaCD:"segacd",sega32x:"32x",segaSaturn:"saturn",ngp:"ngp",pce:"pce",msx:"bluemsx",atari2600:"a2600",atari7800:"a7800",lynx:"lynx",ws:"ws",arcade:"arcade","fba0.2.97.29":"fba0.2.97.29",jaguar:"jaguar",mame2003:"mame2003",dos:"dos"},o=this,Y=o.system,M=o.customPaths&&"string"==typeof o.customPaths["extract7z.js"]?o.customPaths["extract7z.js"]:o.dataPath+"extract7z.js",H=o.customPaths&&"string"==typeof o.customPaths["extractzip.js"]?o.customPaths["extractzip.js"]:o.dataPath+"extractzip.js?v=1",W=o.customPaths&&"string"==typeof o.customPaths["libunrar.js"]?o.customPaths["libunrar.js"]:o.dataPath+"libunrar.js",v=c("canvas",{}),i=(this.game.appendChild(v),t.loading=c("div",{class:this.config.classNames.loading}),this.elements.container.appendChild(t.loading),{"loading-info":n({"loading-info":!0}),ad:n({ad:!0}),"close-ad":n({"close-ad":!0}),"start-game":n({"start-game":!0}),on:n({on:!0}),p1:n({p1:!0}),p2:n({p2:!0}),p3:n({p3:!0}),p4:n({p4:!0})}),eo=("string"==typeof o.adUrl?(t.loading.innerHTML='\n        <div>\n        <div class="'+i.ad+'" style="display:block !important;width:300px !important">\n        <div class="'+i["close-ad"]+'" hidden><a href="#" onclick="return false"></a></div>\n        <iframe scrolling="no" frameborder="no" style="width:300px !important;height:250px !important;display: block !important;" src="'+o.adUrl+'"></iframe>\n        </div>\n        <div class="'+i["loading-info"]+'" style="position: absolute;bottom: 20px;left: 50%;transform: translateX(-50%);">\n        <div class="'+i.p1+'"></div>\n        <div class="'+i.p2+'"></div>\n        <div class="'+i.p3+'"></div>\n        </div>\n        <div style="position: absolute;bottom: 20px;left: 50%;transform: translateX(-50%);">\n        <a href="#" onclick="return false" class="'+i["start-game"]+'">'+N("playNow",o.config)+"</a>\n        </div>\n        </div>",Z=c("iframe",{src:o.adUrl,scrolling:"no",frameborder:"no",style:"width:300px !important;height:250px !important;display: block !important;"}),t.loading.querySelector(".".concat(i.ad)).removeChild(t.loading.querySelector(".".concat(i.ad," iframe"))),t.loading.querySelector(".".concat(i.ad)).appendChild(Z),w.webgl.DETECTED||(a(t.loading.querySelector(".".concat(i["start-game"])),!0),t.loading.querySelector(".".concat(i.p3)).innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">Failed to initialize WebGL.</strong>'),t.loading.querySelector(".".concat(i.ad," iframe")).style.setProperty("display","block","important"),t.loading.querySelector(".".concat(i.ad," iframe")).style.setProperty("visibility","visible","important"),t.loading.querySelector(".".concat(i.ad)).style.setProperty("display","block","important"),t.loading.querySelector(".".concat(i.ad)).style.setProperty("visibility","visible","important")):(t.loading.innerHTML='\n        <div>\n        <div class="'.concat(i["loading-info"],'" style="position: absolute;bottom: 20px;left: 50%;transform: translateX(-50%);">\n        <div class="').concat(i.p1,'"></div>\n        <div class="').concat(i.p2,'"></div>\n        <div class="').concat(i.p3,'"></div>\n        </div>\n        <div style="position: absolute;bottom: 20px;left: 50%;transform: translateX(-50%);">\n        <a href="#" onclick="return false" class="').concat(i["start-game"],'">').concat(N("playNow",o.config),"</a>\n        </div>\n        </div>"),w.webgl.DETECTED||(a(t.loading.querySelector(".".concat(i["start-game"])),!0),t.loading.querySelector(".".concat(i.p3)).innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">Failed to initialize WebGL.</strong>')),window.URL||window.webkitURL),U=function(e){var t;return 80===e[0]&&75===e[1]&&3===e[2]&&4===e[3]||80===e[0]&&75===e[1]&&5===e[2]&&6===e[3]||80===e[0]&&75===e[1]&&7===e[2]&&8===e[3]?t="zip":55===e[0]&&122===e[1]&&188===e[2]&&175===e[3]&&39===e[4]&&28===e[5]?t="7z":82===e[0]&&97===e[1]&&114===e[2]&&33===e[3]&&26===e[4]&&7===e[5]&&0==e[6]&&(t="rar"),t},E=function(e){var e=new Blob(['importScripts("'+e+'");'],{type:"application/javascript"}),t=window.URL.createObjectURL(e);return new Promise(function(e){e(new Worker(t))})},B=function(t,e){var n="",e=("rar"==e&&(n="\nvar dataToPass = [];\nModule = {\n    monitorRunDependencies: function(left)  {\n        if (left == 0) {\n            setTimeout(function() {\n                unrar(dataToPass, null);\n            }, 100);\n        }\n    },\n    onRuntimeInitialized: function() {\n    },\n    locateFile: function(file) {\n        return '".concat(t+".mem","';\n    }\n};\nimportScripts(\"").concat(t,'");\nvar unrar = function(data, password) {\n    var cb = function(fileName, fileSize, progress) {\n        postMessage({"t":4,"current":progress,"total":fileSize, "name": fileName});\n    };\n\n    var rarContent = readRARContent(data.map(function(d) {\n        return {\n            name: d.name,\n            content: new Uint8Array(d.content)\n        }\n    }), password, cb)\n    var rec = function(entry) {\n        if (entry.type === \'file\') {\n            postMessage({"t":2,"file":entry.fullFileName,"size":entry.fileSize,"data":entry.fileContent});\n        } else if (entry.type === \'dir\') {\n            Object.keys(entry.ls).forEach(function(k) {\n                rec(entry.ls[k]);\n            })\n        } else {\n            throw "Unknown type";\n        }\n    }\n    rec(rarContent);\n    postMessage({"t":1});\n    return rarContent;\n};\nonmessage = function(data) {\n    dataToPass.push({name:  \'test.rar\', content: data.data});\n};\n                ')),new Blob([n],{type:"application/javascript"})),s=window.URL.createObjectURL(e);return new Promise(function(e){e(new Worker(s))})},C=null,g=null,S=null,f=null;try{C=new K.a({dbVersion:1,storePrefix:"ejs-",storeName:"system",keyPath:null,autoIncrement:!1,onStoreReady:function(){L=!0},onError:function(){L=!0}}),g=new K.a({dbVersion:1,storePrefix:"ejs-",storeName:"roms",keyPath:null,autoIncrement:!1,onStoreReady:function(){D=!0},onError:function(){D=!0}}),S=new K.a({dbVersion:1,storePrefix:"ejs-",storeName:"bios",keyPath:null,autoIncrement:!1,onStoreReady:function(){T=!0},onError:function(){T=!0}}),f=new K.a({dbVersion:1,storePrefix:"ejs-",storeName:"romsdata",keyPath:null,autoIncrement:!1,onStoreReady:function(){},onError:function(){}})}catch(e){T=D=L=!0,console.log(e)}r.call(o,o.elements.container,"start-game",function(){o.started=!0,o.playing=!0,a(t.loading.querySelector(".".concat(i["loading-info"])),!0),!d||"undefined"!=d.virtualGamepadContainer&&null!==d.virtualGamepadContainer||x.toggleControls.call(o,!0);var c,m,f,p,g,j,w,O,C=n({"ejs__tooltip--visible":!0}),E=o.elements.buttons.gamepad.querySelector(".".concat(n({ejs__tooltip:!0}))),r=(h(E,C,!0),setTimeout(function(){h(E,C,!1)},5e3),"string"==typeof o.adUrl&&(a(t.loading.querySelector(".".concat(i["close-ad"])),!1),!0!==o.config.noAutoAdClose&&setTimeout(function(){o.started&&t.loading.querySelector(".".concat(i.ad))&&t.loading.querySelector(".".concat(i.ad)).parentNode.removeChild(t.loading.querySelector(".".concat(i.ad)))},1e4)),a(t.loading.querySelector(".".concat(i["start-game"])),!0),_(l.defaultCoreOptionsValues.call(e),l.storage.get("core-options")||{})),s=("n64"===o.system&&r&&Object.keys(r).forEach(function(e){"glupen64-aspect"===e&&"16:9"===r[e]&&(v.height=v.width/16*9,t.aspectRatio=16/9)}),"arcade"!==e.system&&"fba0.2.97.29"!==e.system||r&&Object.keys(r).forEach(function(e){"fba-aspect"===e&&"PAR"===r[e]&&(v.height=v.width/16*9,t.aspectRatio=16/9)}),"gba"===o.system&&(v.height=v.width/1.5,t.aspectRatio=1.5),window.setTimeout(function(){},150),s=e,"undefined"!=typeof RI?(document.removeEventListener("mousemove",RI.eventHandler,!1),v.removeEventListener("mousedown",RI.canvasEventHandler,!1),v.removeEventListener("mouseup",RI.canvasEventHandler,!1),s.elements.container.addEventListener("mousemove",function(o){var s,i=0,a=0,e=o.offsetX-t.Module.canvas.offsetLeft,n=o.offsetY-t.Module.canvas.offsetTop;if("mousemove"===o.type){i=e<0?(e=0,-t.Module.canvas.offsetWidth):e>t.Module.canvas.offsetWidth?(e=t.Module.canvas.offsetWidth,t.Module.canvas.offsetWidth):e-RI.currentX,a=n<0?(n=0,-t.Module.canvas.offsetHeight):n>t.Module.canvas.offsetHeight?(n=t.Module.canvas.offsetHeight,t.Module.canvas.offsetHeight):n-RI.currentY,RI.currentX=e,RI.currentY=n;for(s=0;s<RI.contexts.length;s+=1)HEAP32[RI.contexts[s].state+32>>2]=i,HEAP32[RI.contexts[s].state+36>>2]=a}},!1),s.elements.container.addEventListener("mousedown",RI.canvasEventHandler,!1),s.elements.container.addEventListener("mouseup",RI.canvasEventHandler,!1),s.elements.container.addEventListener("touchstart",c=function(n){if(n.targetTouches[0]){var o,i,a,c,l=0,r=0,e=n.target.getBoundingClientRect(),s=n.targetTouches[0].clientX-e.left,e=n.targetTouches[0].clientY-e.top,l=s<0?(s=0,-t.Module.canvas.offsetWidth):s>t.Module.canvas.offsetWidth?(s=t.Module.canvas.offsetWidth,t.Module.canvas.offsetWidth):s-RI.currentX,r=e<0?(e=0,-t.Module.canvas.offsetHeight):e>t.Module.canvas.offsetHeight?(e=t.Module.canvas.offsetHeight,t.Module.canvas.offsetHeight):e-RI.currentY;RI.currentX=s,RI.currentY=e;for(o=0;o<RI.contexts.length;o+=1)HEAP32[RI.contexts[o].state+32>>2]=l,HEAP32[RI.contexts[o].state+36>>2]=r;switch(n.type){case"touchend":case"touchstart":if(0===n.button)a=40;else{if(2!==n.button)break;a=41}for(c="touchend"===n.type?0:1,i=0;i<RI.contexts.length;i+=1)HEAP8[RI.contexts[i].state+a>>0]=c}}},!1),s.elements.container.addEventListener("touchend",c,!1)):(s=function(e){e=new MouseEvent(e.type,e),t.Module.canvas.dispatchEvent(e)},u.call(e,".".concat(n({ejs__dialogs:!0}))).addEventListener("mousemove",s,!1),u.call(e,".".concat(n({ejs__dialogs:!0}))).addEventListener("mousedown",s,!1),u.call(e,".".concat(n({ejs__dialogs:!0}))).addEventListener("mouseup",s,!1)),"msx"===o.system&&"undefined"!=typeof RI&&(document.removeEventListener("keydown",RI.eventHandler,!1),document.removeEventListener("keyup",RI.eventHandler,!1),c=function(n){var e,t,s=n.keyCode,o=s>>3,i=1<<(7&s);switch(n.type){case"keyup":case"keydown":if(32<=o)throw"key code error! bad code: "+s;for(e=0;e<RI.contexts.length;e++)t=HEAP8[RI.contexts[e].state+o>>0],"keyup"===n.type?t&=~i:t|=i,HEAP8[RI.contexts[e].state+o>>0]=t}},document.addEventListener("keydown",c,!1),document.addEventListener("keyup",c,!1)),setTimeout(function(){var e=y.info();null===d.setVolume&&"undefined"!=typeof RA?(RA.queueAudio=function(){var n=o.volume,t=RA.bufIndex,i=RA.bufIndex?RA.buffers[RA.bufIndex-1].endTime:RA.context.currentTime,s=(RA.buffers[t].endTime=i+RA.buffers[t].duration,RA.context.createBufferSource());s.buffer=RA.buffers[t],1===(n=o.muted?0:n)?s.connect(RA.context.destination):(t=RA.context.createGain(),s.connect(t),t.connect(RA.context.destination),y.isEdge||"chrome"===e.name&&parseInt(e.version,10)<=60||"firefox"===e.name&&parseInt(e.version,10)<=56||"opera"===e.name&&parseInt(e.version,10)<=44?t.gain.value=n:"firefox"===e.name?t.gain.setValueAtTime(n,RA.context.currentTime):t.gain.setValueAtTime(n,RA.context.currentTime,0)),s.start(i),RA.bufIndex+=1,RA.bufOffset=0},y.isIos&&window.addEventListener("touchstart",function(){var e;RA.context&&(RA.context.resume(),(e=RA.context.createBufferSource()).connect(RA.context.destination),e.start())},!1)):d.setVolume()},500),setTimeout(function(){o.elements.container.focus()},30),void 0===window.addRunDependency&&(window.Module=void 0),t.FS.readFile(o.startName));s.length<=33554432&&".cue"!=o.startName.substr(-4)&&(g="snes"===o.system||["snes2002","snes2005","snes2010"].includes(o.system)?(p=s.length%1024,new b(p?s.slice?s.slice(p):s.subarray(p):s)):new b(s),f=eD.a.create(),O=new FileReader,m=0,j=g._u8array.length,w=function(){var e;m<j?(e=Math.min(m+2097152,j),O.readAsArrayBuffer(new Blob([g._u8array.slice(m,e)])),m=e):(console.log(f.hex()),o.hash=f.hex(),"function"==typeof window.ejsromshash&&window.ejsromshash(o.hash))},O.onload=function(e){try{f.update(e.target.result),w()}catch(e){console.log(e)}},w())}),"string"==typeof o.adUrl&&r.call(o,t.loading.querySelector(".".concat(i["close-ad"])),"click",function(e){e instanceof MouseEvent&&o.started&&t.loading.querySelector(".".concat(i.ad))&&t.loading.querySelector(".".concat(i.ad)).parentNode.removeChild(t.loading.querySelector(".".concat(i.ad))),o.elements.container.focus()});var e=this,X=function(){g.db&&g.getAll(function(e){Array.isArray(e)&&10<e.length&&e.sort(function(e,t){return(t.lastaccess||0)-(e.lastaccess||0)}).forEach(function(e,n){10<n&&!t.saveFilenames.includes(e.key)?(g.remove(e.key),f.db&&f.remove(e.key)):(delete e.data,g.put(e.key,e))})},function(){g.clear(),f.db&&f.clear()})},G=function(s){if(t.gamePatch){var e=s.startName.split("/"),n=e.pop().split(".").pop(),r=(t.gamePatch.split(".").pop(),t.gamePatch.split("/").pop().split(".").shift()),e=(e="".concat(e.join("/"),"/").concat(r,".").concat(n)).replace(/#/g,""),r=t.gamePatch;if(t.FS.rename(s.startName,e),s.startName=e,"snes"===s.system||["snes2002","snes2005","snes2010"].includes(s.system)){var i,a,l,h,n=new b(t.FS.readFile(s.startName)),e=F(n),o=new b(t.FS.readFile(r)),c=o.readString(6),d=n._u8array.length%1024;c.startsWith("PATCH")?(l=e0(o),0==d&&"B19ED489"===e.toString(16).toUpperCase()&&((i=new Uint8Array(n._u8array.length+512)).set(new Uint8Array(512),0),i.set(n._u8array,512),n=new b(i))):c.startsWith(z)?l=e7(o):c.startsWith("BPS1")&&(l=e3(o),0<d&&"A31BEAD4"===e.toString(16).toUpperCase()&&(i=n._u8array.slice?n._u8array.slice(d):n._u8array.subarray(d),n=new b(i)));try{(a=l.apply(n,!1))&&(0<(h=a._u8array.length%1024)&&(i=a._u8array.slice?a._u8array.slice(h):a._u8array.subarray(h),a=new b(i)),t.FS.unlink(r),t.FS.unlink(s.startName),t.FS.writeFile(s.startName,a._u8array))}catch(e){}}else{var u,m,c=new b(t.FS.readFile(s.startName)),o=new b(t.FS.readFile(r)),e=o.readString(6);e.startsWith("PATCH")?u=e0(o):e.startsWith(z)?u=e7(o):e.startsWith("BPS1")&&(u=e3(o));try{(m=u.apply(c,!1))&&(t.FS.unlink(r),t.FS.unlink(s.startName),t.FS.writeFile(s.startName,m._u8array))}catch(e){}}}},P=function(){q?(window.Module.TOTAL_MEMORY=268435456,["jaguar"].includes(e.system)&&(window.Module.TOTAL_MEMORY=268435456),["nds","nes","snes","arcade","mame"].includes(e.system)&&(window.Module.TOTAL_MEMORY=0),["snes2002","snes2005","snes2010"].includes(e.system)&&(window.Module.TOTAL_MEMORY=0),"gba"==e.system&&(window.Module.TOTAL_MEMORY=0),"3do"==e.system&&(window.Module.TOTAL_MEMORY=0),"n64"==e.system&&(window.Module.TOTAL_MEMORY=0)):("nes"===e.system&&(window.Module.TOTAL_MEMORY=134217728),window.Module.TOTAL_MEMORY=j+67108864,["arcade","mame","mame2003","fba0.2.97.29"].includes(e.system)&&(window.Module.TOTAL_MEMORY=j+268435456,t.isMobileDevice&&(window.Module.TOTAL_MEMORY=314572800)),["n64","nds","jaguar"].includes(e.system)&&(window.Module.TOTAL_MEMORY=j+268435456,t.isMobileDevice&&(window.Module.TOTAL_MEMORY=314572800)),"gba"==e.system&&(window.Module.TOTAL_MEMORY=268435456)),"undefined"!=typeof EJS_MEMORY&&(window.Module.TOTAL_MEMORY=EJS_MEMORY)},I=function(h,s){function g(){var e;2===n.coreVer&&(e=t.Module.cwrap("toggleMainLoop","null",["number"]),t.Module.resumeMainLoop=function(){e(1)},t.Module.pauseMainLoop=function(){e(0)}),"string"==typeof n.loadStateOnStart&&fetch(n.loadStateOnStart).then(function(e){e.arrayBuffer().then(function(e){e=new Uint8Array(e),EJS_loadState(e)})})}function d(s){if(s.data){if(1===s.data.t){c.innerHTML="Game Data ready",s.target.terminate();try{P(),G(n),X(),!n.startName&&l&&(n.startName=l),i=[n.startName,[t.hash,t.hash2,t.hash3].join("")],"undefined"!=typeof EJS_DEBUG_XX&&!0===EJS_DEBUG_XX&&i.unshift("-v"),t.Module.callMain(i),2===o.coreVer&&(t.Module.resumeMainLoop(),t.Module.setCanvasSize(800,600)),p.call(n,n.elements.container,"start-game")}catch(e){console.log(e),c.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">Failed to start game</strong>'}try{g()}catch(e){}}if(2===s.data.t){var i,r,d=s.data.file.split("/"),u=(a=d.pop()).split(".").pop(),a=a.replace(/#/g,"");t._FS.createPath("/",d.join("/"),!0,!0);for(r=Q[m].length-1;0<=r;--r)Q[m][r]===u.toLowerCase()&&f<r&&(f=r,n.startName=["",d.join("/"),a].join("/"),n.startName=n.startName.replace(/\/+/,"/"));a&&(t._FS.createDataFile("/".concat(d.join("/")),a,s.data.data,!0,!1),j+=s.data.data.length),l="/".concat(d.join("/"),"/").concat(a)}4===s.data.t&&0<s.data.total&&(i=Math.floor(s.data.current/s.data.total*100),s=s.data.name||"",i<=100&&0<i&&(c.innerHTML=e.localization("Decompress Game Data")+" ".concat(s," ").concat(i,"%")))}}var a,u,n=e,c=t.loading.querySelector(".".concat(i.p3)),m=(h.split(".").pop(),en[Y]),f=-1,l="",r=(window.EJS_terminate=function(){if(t.Module.pauseMainLoop(),n&&n.eventListeners)for(i in n)for(e=0;e<n.eventListeners.length;e++)(s=n.eventListeners[e]).element.removeEventListener(s.type,s.callback,s.capture);if(window.EJS_RESET_VARS){var e,i,s=[],o=[];for(i in window)s.push(i);for(e=0;e<s.length;e++)window.EJS_RESET_VARS.includes(s[e])||o.push(s[e]);for(e=0;e<o.length;e++)window[o[e]]&&delete window[o[e]]}},!1);if(["arcade","mame","mame2003","fba0.2.97.29"].includes(n.system)||(a=s.slice?s.slice(0,10):s.subarray(0,10),"7z"===(a=U(a))?(E(M).then(function(e){e.onmessage=d,e.postMessage(s)}),r=!0):"zip"===a?(E(H).then(function(e){e.onmessage=d,e.postMessage(s)}),r=!0):"rar"==a&&(B(W,"rar").then(function(e){e.onmessage=d,e.postMessage(s)}),r=!0)),!r){a=h.replace(/#/g,"");try{j+=s.length,t._FS.createDataFile("/",a,s,!0,!1)}catch(e){console.log(e)}P(),n.startName=a,G(n),X();try{u=[n.startName,[t.hash,t.hash2,t.hash3].join("")],"undefined"!=typeof EJS_DEBUG_XX&&!0===EJS_DEBUG_XX&&u.unshift("-v"),t.Module.callMain(u),2===o.coreVer&&(t.Module.resumeMainLoop(),t.Module.setCanvasSize(800,600)),p.call(n,n.elements.container,"start-game")}catch(e){console.log(e),c.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">Failed to start game</strong>'}try{g()}catch(e){}}},V=function(){var o=e,s=t.loading.querySelector(".".concat(i.p3)),a=e.config,r=(a.gameId,a.gameUrl),c=a.system,a=("vbanext"==c&&(c="gba"),r.split("/")),n=a[a.length-1];(n=-1<n.indexOf("?")?n.substr(0,n.indexOf("?")):n).split(".").pop(),s.innerHTML=e.localization("Download Game Data"),["arcade","mame","mame2003","fba0.2.97.29"].includes(o.system)&&o.config.gameParentUrl&&(s.innerHTML+=" (2/2)"),o.config.gamePatchUrl&&(s.innerHTML+=" (2/2)"),O.a.head(r,{}).then(function(l){function d(){O.a.get(r,{onDownloadProgress:function(t){t=t.total?"".concat(Math.floor(t.loaded/t.total*100),"%"):"",["arcade","mame","mame2003","fba0.2.97.29"].includes(o.system)&&o.config.gameParentUrl||o.config.gamePatchUrl?s.innerHTML=e.localization("Download Game Data")+" (2/2) ".concat(t):s.innerHTML=e.localization("Download Game Data")+" ".concat(t)},responseType:"arraybuffer"}).then(function(l){if(s=new Uint8Array(l.data),e.config.gameUrl.startsWith("blob:")||e.config.gameUrl.startsWith("file:")||e.config.gameUrl.startsWith("chrome-extension:")||("file:"==window.location.protocol||"chrome-extension:"==window.location.protocol)&&1==e.config.gameUrl.split(":").length)I(n,s);else{if(i&&g.db)if(104857600<s.length)for(var s,r,c,d=Math.ceil(s.length/104857600),o=0;o<d;o+=1)c=s.slice?s.slice(104857600*o,104857600*(o+1)):s.subarray(104857600*o,104857600*(o+1)),r="".concat(i),0<o&&(r="".concat(i,"-part-").concat(o)),t.saveFilenames.push(r),g.put(r,{filename:n,filesize:s.length,filetype:a,key:r,lastaccess:(new Date).valueOf(),next:"".concat(i,"-part-").concat(o+1)}),f.db&&f.put(r,{filename:n,filesize:s.length,filetype:a,key:r,data:c});else t.saveFilenames.push(i),g.put(i,{filename:n,filesize:s.length,filetype:a,key:i,lastaccess:(new Date).valueOf()}),f.db&&f.put(i,{filename:n,filesize:s.length,filetype:a,key:i,data:s});I(n,s)}}).catch(function(t){A(t,s,e)})}var u=l.headers["content-length"],a=l.headers["content-type"],i=(l.headers["last-modified"],"".concat(c,"-").concat(n));f.db?f.get(i,function(e){if(e&&e.filename===n&&e.filesize-u==0&&e.filetype===a&&e.key)if(g.get(i,function(e){e.lastaccess=(new Date).valueOf(),g.put(e.key,e)}),104857600<e.filesize){t=new Uint8Array(e.filesize),t.set(e.data);for(var t,r=Math.ceil(e.filesize/104857600),o=[],s=1;s<r;s+=1)o.push("".concat(i,"-part-").concat(s)),g.get("".concat(i,"-part-").concat(s),function(e){e.lastaccess=(new Date).valueOf(),g.put(e.key,e)});f.getBatch(o,function(n){n.filter(function(e){return e}).length!==o.length?d():(n.forEach(function(e,n){t.set(e.data,104857600*(n+1))}),I(e.filename,t))},function(){},"sparse")}else I(e.filename,e.data);else d()}):d()}).catch(function(t){A(t,s,e)})},R=function(){var n,s,o=t.loading.querySelector(".".concat(i.p3)),a=e.config.gamePatchUrl;a?(s=a.split("/"),(n=-1<(n=s[s.length-1]).indexOf("?")?n.substr(0,n.indexOf("?")):n).split(".").pop(),o.innerHTML=e.localization("Download Game Data")+" (1/2)",O.a.get(a,{onDownloadProgress:function(t){o.innerHTML=e.localization("Download Game Data")+" (1/2) ",t=t.total?"".concat(Math.floor(t.loaded/t.total*100),"%"):"",o.innerHTML+=t},responseType:"arraybuffer"}).then(function(o){var s,a,r,c,o=new Uint8Array(o.data);function l(n){var s,o,i;n.data&&(1===n.data.t&&(n.target.terminate(),V()),2===n.data.t&&(s=(i=(o=n.data.file.split("/")).pop()).split(".").pop(),t._FS.createPath("/",o.join("/"),!0,!0),t._FS.createDataFile("/"+o.join("/"),i,n.data.data,!0,!1),j+=n.data.data.length,["ips","bps","ups"].includes(s)&&!t.gamePatch&&(t.gamePatch="/"+o.join("/")+"/"+i)),4===n.data.t&&0<n.data.total&&(s=Math.floor(n.data.current/n.data.total*100),o=n.data.name||"",s<=100&&0<s&&(c.innerHTML=e.localization("Decompress Game Patch")+" ".concat(o," ").concat(s,"%"))))}r=n,s=o,c=t.loading.querySelector(".".concat(i.p3)),r.split(".").pop(),o=!1,a=s.slice?s.slice(0,10):s.subarray(0,10),"7z"===(a=U(a))?(E(M).then(function(e){e.onmessage=l,e.postMessage(s)}),o=!0):"zip"===a?(E(H).then(function(e){e.onmessage=l,e.postMessage(s)}),o=!0):"rar"==a&&(B(W,"rar").then(function(e){e.onmessage=messageCallBack,e.postMessage(s)}),o=!0),o||(j+=s.length,t.gamePatch="/".concat(r),t._FS.createDataFile("/",r,s,!0,!1),V())}).catch(function(t){A(t,H,e)})):V()},$=function(){var n,a,r=e,s=t.loading.querySelector(".".concat(i.p3)),o=e.config.gameParentUrl;o&&["arcade","mame","mame2003","fba0.2.97.29"].includes(r.system)?(a=o.split("/"),(n=-1<(n=a[a.length-1]).indexOf("?")?n.substr(0,n.indexOf("?")):n).split(".").pop(),s.innerHTML=e.localization("Download Game Data")+" (1/2)",r.config.gamePatchUrl&&(s.innerHTML=e.localization("Download Game Data")+" (1/3)"),O.a.head(o,{}).then(function(r){function c(){O.a.get(o,{onDownloadProgress:function(t){t=t.total?"".concat(Math.floor(t.loaded/t.total*100),"%"):"",s.innerHTML=e.localization("Download Game Data")+" (1/2) ".concat(t)},responseType:"arraybuffer"}).then(function(r){if(e=new Uint8Array(r.data),i&&g.db)if(104857600<e.length)for(var e,o,c,l=Math.ceil(e.length/104857600),s=0;s<l;s+=1)c=e.slice?e.slice(104857600*s,104857600*(s+1)):e.subarray(104857600*s,104857600*(s+1)),o="".concat(i),0<s&&(o="".concat(i,"-part-").concat(s)),t.saveFilenames.push(o),g.put(o,{filename:n,filesize:e.length,filetype:a,key:o,lastaccess:(new Date).valueOf(),next:"".concat(i,"-part-").concat(s+1)}),f.db&&f.put(o,{filename:n,filesize:e.length,filetype:a,key:o,data:c});else t.saveFilenames.push(i),g.put(i,{filename:n,filesize:e.length,filetype:a,key:i,lastaccess:(new Date).valueOf()}),f.db&&f.put(i,{filename:n,filesize:e.length,filetype:a,key:i,data:e});r=n.replace(/#/g,"");try{j+=e.length,t._FS.createDataFile("/",r,e,!0,!1),R()}catch(e){console.log(e)}}).catch(function(t){A(t,s,e)})}var l=r.headers["content-length"],a=r.headers["content-type"],i=(r.headers["last-modified"],"".concat(Y,"-").concat(n));f.db?f.get(i,function(e){if(e&&e.filename===n&&e.filesize-l==0&&e.filetype===a&&e.key)if(104857600<e.filesize){s=new Uint8Array(e.filesize),s.set(e.data);for(var s,d=Math.ceil(e.filesize/104857600),o=[],r=1;r<d;r+=1)o.push("".concat(i,"-part-").concat(r));f.getBatch(o,function(n){n.filter(function(e){return e}).length!==o?c():(n.forEach(function(e,t){s.set(e.data,104857600*(t+1))}),t._FS.createDataFile("/",e.filename,s,!0,!1),R())},function(){},"sparse")}else t._FS.createDataFile("/",e.filename,e.data,!0,!1),R();else c()}):c()}).catch(function(t){A(t,s,e)})):R()},J=function(c,n){function r(e){var n,s;e.data&&(1===e.data.t&&(a.innerHTML="BIOS ready",e.target.terminate(),$()),2===e.data.t&&((s=(n=e.data.file.split("/")).pop()).split(".").pop(),t._FS.createPath("/",n.join("/"),!0,!0),t._FS.createDataFile("/"+n.join("/"),s,e.data.data,!0,!1),j+=e.data.data.length),4===e.data.t&&0<e.data.total&&(n=Math.floor(e.data.current/e.data.total*100),s=e.data.name||"",n<=100&&0<n&&(a.innerHTML="Decompress BIOS ".concat(s," ").concat(n,"%"))))}var l=e,a=t.loading.querySelector(".".concat(i.p2)),o=(c.split(".").pop(),!1),s=n.slice?n.slice(0,10):n.subarray(0,10),s=U(s);"7z"===s?(E(M).then(function(e){e.onmessage=r,e.postMessage(n)}),o=!0):"zip"!==s||["arcade","mame","mame2003","fba0.2.97.29"].includes(l.system)?"rar"===s&&(B(W,"rar").then(function(e){e.onmessage=messageCallBack,e.postMessage(n)}),o=!0):(E(H).then(function(e){e.onmessage=r,e.postMessage(n)}),o=!0),o||(j+=n.length,a.innerHTML="BIOS ready",t._FS.createDataFile("/",c,n,!0,!1),$())},ee=function(){t.loading.querySelector(".".concat(i.p1)).innerHTML="Game Core ready";var o,c,u=e.config.biosUrl,s=e,n=(d.bindFunction.call(e),d.setGamepadDialog.call(e),d.setCacheDialog.call(e),d.setLoadingDialog.call(e),d.setNetplayDialog.call(e),d.setCheatDialog.call(e),d.initGamepad.call(e),d.initKeyboard.call(e),d.listeners.call(e),t._FS.createFolder("/","etc",!0,!0),t.FS.mkdir("/data"),t.FS.mkdir("/data/saves"),"undefined"!=typeof IDBFS?t.FS.mount(IDBFS,{},"/data/saves"):t.FS.mount(t.FS.filesystems.IDBFS,{},"/data/saves"),t.FS.mkdir("/shader"),t.FS.syncfs(!0,function(){}),d.initShaders(),""),a=(n=(n=(n=(n=(n+="savefile_directory = /data/saves\n")+"video_vsync = true\n"+"screenshot_directory = /\n")+"video_shader = /shader/shader.glslp\n"+"video_shader_enable = true\n")+"video_font_enable = false\n"+"video_scale = 1.0\n")+"video_gpu_screenshot = false\n"+"audio_latency = 96\n",l.defaultCoreOptionsValues.call(e)),h=(s.lightgun&&("nes"===e.system&&(n+='input_libretro_device_p2 = "258"\n'),"segaMS"!==e.system&&"segaMD"!==e.system&&"segaCD"!==e.system||(a.genesis_plus_gx_gun_cursor="yes",a.genesis_plus_gx_invert_mouse="yes",a.genesis_plus_gx_bram="per game",n+='input_libretro_device_p2 = "260"\n'),"snes"===e.system&&(n+='input_libretro_device_p2 = "260"\n'),["snes2002","snes2005","snes2010","snesnext"].includes(e.system)&&(n+='input_libretro_device_p2 = "260"\n')),s.mouse&&("snes"===e.system&&(n+="input_libretro_device_p1 = 2\n"),["snes2002","snes2005","snes2010","snesnext"].includes(e.system)&&(n+="input_libretro_device_p1 = 2\n")),s.multitap&&("snes"===e.system&&(n+="input_libretro_device_p2 = 257\n"),["snes2002","snes2005","snes2010","snesnext"].includes(e.system)&&(n+="input_libretro_device_p2 = 257\n")),"n64"===e.system&&(n+="input_libretro_device_p1 = 5\n"),s.system,n=n+"fastforward_ratio = 1.0\n"+"video_smooth = false\n",_(a,l.storage.get("core-options")||{})),m="";2===s.coreVer?(t._FS.createDataFile("/etc","retroarch.cfg",n,!0,!0),t._FS.createFolder("/home/web_user","retroarch",!0,!0),t._FS.createFolder("/home/web_user/retroarch","userdata",!0,!0),t._FS.createDataFile("/home/web_user/retroarch/userdata","retroarch.cfg",m,!0,!0)):(t._FS.createDataFile("/etc","retroarch.cfg",n,!0,!0),t._FS.createFolder("/home/web_user",".config",!0,!0),t._FS.createFolder("/home/web_user/.config","retroarch",!0,!0),t._FS.createDataFile("/home/web_user/.config/retroarch","retroarch-core-options.cfg",m,!0,!0)),h&&Object.keys(h).forEach(function(e){if(s.lightgun&&"nes"===s.system&&"system_type"===e)return!1;m+="".concat(e,' = "').concat(h[e],'"\n'),r.call(s,s.elements.container,"start-game",function(){d.setVariable(e,h[e])})}),u?(a=u.split("/"),(o=-1<(o=a[a.length-1]).indexOf("?")?o.substr(0,o.indexOf("?")):o).split(".").pop(),c=t.loading.querySelector(".".concat(i.p2)),O.a.head(u,{}).then(function(t){function n(){O.a.get(u,{onDownloadProgress:function(e){e=e.total?"".concat(Math.floor(e.loaded/e.total*100),"%"):"",c.innerHTML="Download BIOS ".concat(e)},responseType:"arraybuffer"}).then(function(e){e=new Uint8Array(e.data),S.db&&S.put(Y,{filename:o,filesize:e.length,filetype:i,data:e}),J(o,e)}).catch(function(t){A(t,c,e)})}var a=t.headers["content-length"],i=t.headers["content-type"],t=(t.headers["last-modified"],s.system);S.db?S.get(t,function(e){e&&e.filename===o&&e.filesize-a==0&&e.filetype===i?J(e.filename,e.data):n()}):n()}).catch(function(t){A(t,c,e)})):$()},et=function(e){e=e.byteLength?new Uint8Array(e):e,"undefined"!=typeof GLOBAL_BASE?t.Module.HEAPU8.set(e,GLOBAL_BASE):"undefined"!=typeof Runtime&&Runtime.GLOBAL_BASE?t.Module.HEAPU8.set(e,Runtime.GLOBAL_BASE):t.Module.HEAPU8.set(e,8)},k=function(s){function a(s){var i,a;s.data&&(1===s.data.t&&(p.call(o,o.elements.container,"script-loaded"),s.target.terminate()),2===s.data.t&&(i=(a=s.data.file.split("/").pop()).split(".").pop(),t.coreFileData[a]=s.data.data,"js"!==i||a.includes(".worker.js")||(n=s.data.data),"mem"===i&&(t.memData=s.data.data),"wasm"===i&&(t.wasmData=s.data.data)),4===s.data.t&&0<s.data.total&&(l.innerHTML=e.localization("Decompress Game Core")+" ".concat(Math.floor(s.data.current/s.data.total*100),"%")))}var l=t.loading.querySelector(".".concat(i.p1)),n="";r.call(o,o.elements.container,"script-loaded",function(){var e,s;null!==t.wasmData?(window.Module.wasmBinary=t.wasmData,P(),window.Module.monitorRunDependencies=function(e){0===e&&ee()},window.Module.onRuntimeInitialized=function(){}):(P(),window.Module.monitorRunDependencies=function(e){console.log("monitorRunDependencies, ",e)},window.Module.onRuntimeInitialized=function(){t.Module||(t.Module=window.Module),t.Module&&t.Module.FS?t.FS=t.Module.FS:t.FS=window.FS,console.log("onRuntimeInitialized"),ee()}),s=window.Module,null!==t.wasmData&&(s.wasmBinary=t.wasmData),y.isIos&&null!==t.wasmData?(e=new Blob([n],{type:"text/javascript"}),e=c("script",{src:eo.createObjectURL(e)}),document.body.appendChild(e),e.onload=function(){void 0===window.addRunDependency&&"undefined"!=typeof EmulatorJS&&(t.Module=EmulatorJS(s),EmulatorJS=void 0),null!==t.memData&&et(t.memData),t.Module||(t.Module=window.Module),t.Module&&t.Module.FS?t.FS=t.Module.FS:t.FS=window.FS}):(n=function(n){for(var e,s=[],t=0;t<n.length;t+=1)e=n[t],255<e&&(e&=255),s.push(String.fromCharCode(e));return s.join("")}(n),window.eval(n),void 0===window.addRunDependency&&"undefined"!=typeof EmulatorJS&&(t.Module=EmulatorJS(s),EmulatorJS=void 0),null!==t.memData&&et(t.memData),t.Module||(t.Module=window.Module),t.Module&&t.Module.FS?t.FS=t.Module.FS:t.FS=window.FS,window.EJS_MODULE=t.Module,window.ejs_loader=t,window.ejs_media=d),n=null}),E(M).then(function(e){e.onmessage=a,e.postMessage(s)})},m=this;es(t.loading.querySelector(".".concat(i["start-game"])),"click touchstart",function(n){var e,r;return a(t.loading.querySelector(".".concat(i["start-game"])),!0),(n=t.loading.querySelector(".".concat(i.p1))).innerHTML=m.localization("Loading")+"...",!0===L&&!0===D&&!0===T&&(window.Module={TOTAL_MEMORY:268435456,noInitialRun:!0,arguments:[],preRun:[],postRun:[],canvas:v,print:function(e){!0===window.EJS_DEBUG_XX&&console.log(e)},printErr:function(e){!0===window.EJS_DEBUG_XX&&console.log(e)},totalDependencies:0,monitorRunDependencies:function(){},locateFile:function(e){var s,n=null;return e.includes(".worker.js")?(Object.keys(t.coreFileData).includes(e)&&(n=t.coreFileData[e]),s=new Blob([""],{type:"application/javascript"}),window.URL.createObjectURL(s)):e.includes(".js.mem")&&(n=Object.keys(t.coreFileData).includes(e)?t.coreFileData[e]:n)?(t.memData=null,n.buffer):e},readAsync:function(t,n,s){var e;t instanceof ArrayBuffer?setTimeout(function(){n(t)},500):((e=new XMLHttpRequest).open("GET",t,!0),e.responseType="arraybuffer",e.onload=function(){200==e.status||0==e.status&&e.response?n(e.response):s()},e.onerror=s,e.send(null))}},r=Math.ceil((new Date).valueOf()/1e3),r=o.customPaths&&"string"==typeof o.customPaths["v.json"]?o.customPaths["v.json"]:o.dataPath+"v.json?t="+r,e=function(e,t){var s=o.customPaths&&"string"==typeof o.customPaths[e]?o.customPaths[e]:2===o.coreVer?o.dataPath+"cores/"+e+"?v="+t:o.dataPath+"old/"+e+"?v="+t;O.a.get(s,{onDownloadProgress:function(e){e=e.total?"".concat(Math.floor(e.loaded/e.total*100),"%"):"",n.innerHTML=m.localization("Download Game Core")+" ".concat(e)},responseType:"arraybuffer"}).then(function(n){var s,n=new Uint8Array(n.data);C.db&&C.put(e,{version:t,data:n}),2===o.coreVer?k(n):((s=n.slice?n.slice(12):n.subarray(12)).set([55,122,188,175,39,28,0,3],0),n=null,k(s))}).catch(function(e){A(e,n,o)})},O.a.get(r,{}).then(function(i){var n,c,u,h,p=en[m.system],i=i.data[m.system],d=i.version||1,v=Boolean(i.netplay),r=Boolean(i.state),g=Boolean(i.asmjs),f=Boolean(i.wasm),i=(2!==o.coreVer&&i.old&&(g=Boolean(i.old.asmjs),f=Boolean(i.old.wasm)),"nds"!=m.system||w.wasm||(r=!1),!1===o.statesSupported&&(r=!1),t.coreFileVersion=d,t.coreFileName=p,!1);if(["webgl2","experimental-webgl2"].includes(w.webgl.WEBGL_CONTEXT)&&(i=!0),"undefined"!=typeof EJS_N64_LEGACY&&1==EJS_N64_LEGACY&&(i=!1),"mame"==m.system){if(h=m.mameCore,!h||null===h||2!==h.split("|").length)return void(c.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+m.localization("Missing mame config")+"</strong>");c=h.split("|"),t.coreFileName="".concat(m.system,"-").concat(c[0]),r="1"===c[1],s.element(m.elements.buttons.saveState)&&a(m.elements.buttons.saveState,!r),s.element(m.elements.buttons.loadState)&&a(m.elements.buttons.loadState,!r),a(l.contextMenu.querySelectorAll("ul li").item(2),!r),a(l.contextMenu.querySelectorAll("ul li").item(3),!r),n=2===m.coreVer?"":m.system.concat("-old-").concat(c[0],"-wasm.data"),c[0]?(w.wasm&&f?q=!0:(c.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+m.localization("Webassembly support is not detected in this browser")+"</strong>",n=""),n&&(C.db?C.get(n,function(t){t&&t.version===d?2===o.coreVer?k(t.data):((t=t.data.slice?t.data.slice(12):t.data.subarray(12)).set([55,122,188,175,39,28,0,3],0),k(t)):e(n,d)}):e(n,d))):c.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+m.localization("Unsupported Game")+"</strong>"}else{if(n=!1,w.wasm&&f?(u="wasm",n=!0,"n64"!==m.system||i||(u="legacy-wasm"),q=!0):g&&(n=!0,u="asmjs","n64"!==m.system||i||(u="legacy-asmjs")),!0!==(n="undefined"!=typeof EJS_CUSTOM_COREFILE?EJS_CUSTOM_COREFILE:n))return void(c.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+m.localization("Please upgrade your browser to the latest version")+"</strong>");n=2===m.coreVer?p+"-"+u+".data":p+"-old-"+u+".data","undefined"!=typeof EJS_CUSTOM_COREFILE&&(n=EJS_CUSTOM_COREFILE),C.db?C.get(n,function(t){!t||t.version!==d||"undefined"!=typeof EJS_DEBUG_XX&&!0===EJS_DEBUG_XX?e(n,d):2===o.coreVer?k(t.data):((t=t.data.slice?t.data.slice(12):t.data.subarray(12)).set([55,122,188,175,39,28,0,3],0),k(t))}):e(n,d)}2!==m.coreVer||"undefined"!=typeof EJS_DEBUG_XX&&!0===EJS_DEBUG_XX||s.element(m.elements.buttons.gamepad)&&a(m.elements.buttons.gamepad,!0),v||s.element(m.elements.buttons.netplay)&&a(m.elements.buttons.netplay,!0),s.element(m.elements.buttons.saveState)&&a(m.elements.buttons.saveState,!r),s.element(m.elements.buttons.loadState)&&a(m.elements.buttons.loadState,!r),a(l.contextMenu.querySelectorAll("ul li").item(2),!r),a(l.contextMenu.querySelectorAll("ul li").item(3),!r),o.setStatesSupported(r)}).catch(function(e){A(e,n,o)}),t.romdb=g),!1}),!0===o.startOnLoad&&t.loading.querySelector(".".concat(i["start-game"])).click()}},o=t,eT=v(161);function et(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function eF(s,n){for(var e,t=0;t<n.length;t++)e=n[t],e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(s,e.key,e)}ew=["a[href]","area[href]",'input:not([disabled]):not([type="hidden"]):not([aria-hidden])',"select:not([disabled]):not([aria-hidden])","textarea:not([disabled]):not([aria-hidden])","button:not([disabled]):not([aria-hidden])","iframe","object","embed","[contenteditable]",'[tabindex]:not([tabindex^="-"])'],eF(er.prototype,[{key:"registerTriggers",value:function(){for(var s=this,t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];n.forEach(function(e){e.addEventListener("click",function(){return s.showModal()})})}},{key:"showModal",value:function(){this.activeElement=document.activeElement,this.modal.setAttribute("aria-hidden","false"),this.modal.classList.add(n({"is-open":!0})),this.setFocusToFirstNode(),this.addEventListeners(),this.config.onShow(this.modal)}},{key:"closeModal",value:function(){var e=this.modal;this.modal.setAttribute("aria-hidden","true"),this.removeEventListeners(),this.config.onClose(this.modal),this.config.awaitCloseAnimation?this.modal.addEventListener("animationend",function t(){e.classList.remove(n({"is-open":!0})),e.removeEventListener("animationend",t,!1)},!1):e.classList.remove(n({"is-open":!0}))}},{key:"addEventListeners",value:function(){this.modal.addEventListener("touchstart",this.onClick),this.modal.addEventListener("click",this.onClick),document.addEventListener("keydown",this.onKeydown)}},{key:"removeEventListeners",value:function(){this.modal.removeEventListener("touchstart",this.onClick),this.modal.removeEventListener("click",this.onClick),document.removeEventListener("keydown",this.onKeydown)}},{key:"onClick",value:function(e){e.target.hasAttribute(this.config.closeTrigger)&&(this.closeModal(),e.preventDefault())}},{key:"onKeydown",value:function(e){this.config.closeByEsckey&&27===e.keyCode&&this.closeModal(e),9===e.keyCode&&this.maintainFocus(e)}},{key:"getFocusableNodes",value:function(){var e=this.modal.querySelectorAll(ew);return Object.keys(e).map(function(t){return e[t]})}},{key:"setFocusToFirstNode",value:function(){var e;this.config.disableFocus||(e=this.getFocusableNodes()).length&&e[0].focus()}},{key:"maintainFocus",value:function(t){var n,e=this.getFocusableNodes();this.modal.contains(document.activeElement)?(n=e.indexOf(document.activeElement),t.shiftKey&&0===n&&(e[e.length-1].focus(),t.preventDefault()),t.shiftKey||n!==e.length-1||(e[0].focus(),t.preventDefault())):e[0].focus()}}]);var B,eO=er,ew,en,eE,C={init:function(n){var t,o,i,a,e=Object.assign({},{openTrigger:"data-micromodal-trigger"},n),n=et(document.querySelectorAll("[".concat(e.openTrigger,"]"))),s=(o=e.openTrigger,t=[],n.forEach(function(n){var e=n.attributes[o].value;void 0===t[e]&&(t[e]=[]),t[e].push(n)}),t);if(!0!==e.debugMode||!1!==eE(n,s))for(i in s)a=s[i],e.targetModal=i,e.triggers=et(a),new eO(e)},show:function(t,e){return e=e||{},e.targetModal=t,!0===e.debugMode&&!1===en(t)?B=null:(B=new eO(e)).showModal(),B},close:function(){B.closeModal()}},e={defaultControllers:{0:{0:{value:"88",value2:"1"},1:{value:"83",value2:"3"},2:{value:"16",value2:"8"},3:{value:"13",value2:"9"},4:{value:"38",value2:"12"},5:{value:"40",value2:"13"},6:{value:"37",value2:"14"},7:{value:"39",value2:"15"},8:{value:"90",value2:"0"},9:{value:"65",value2:"2"},10:{value:"81",value2:"4"},11:{value:"69",value2:"5"},12:{value:"82",value2:"6"},13:{value:"87",value2:"7"},14:{},15:{},16:{value:"72"},17:{value:"70"},18:{value:"71"},19:{value:"84"},20:{value:"76"},21:{value:"74"},22:{value:"75"},23:{value:"73"},24:{},25:{},26:{}},1:{},2:{},3:{}},controllers:{},virtualGamepadContainer:B=null,keyMap:{8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause/break",20:"caps lock",27:"escape",32:"space",33:"page up",34:"page down",35:"end",36:"home",37:"left arrow",38:"up arrow",39:"right arrow",40:"down arrow",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"left window key",92:"right window key",93:"select key",96:"numpad 0",97:"numpad 1",98:"numpad 2",99:"numpad 3",100:"numpad 4",101:"numpad 5",102:"numpad 6",103:"numpad 7",104:"numpad 8",105:"numpad 9",106:"multiply",107:"add",109:"subtract",110:"decimal point",111:"divide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"num lock",145:"scroll lock",186:"semi-colon",187:"equal sign",188:"comma",189:"dash",190:"period",191:"forward slash",192:"grave accent",219:"open bracket",220:"back slash",221:"close braket",222:"single quote"},saveLoaddbDB:{put:function(t,n){var e=indexedDB.open("ejs-states",1);e.onerror=function(){},e.onsuccess=function(){var s=e.result.transaction(["states"],"readwrite").objectStore("states").put(n,t);s.onerror=function(){},s.onsuccess=function(){}},e.onupgradeneeded=function(){var t=e.result;t.objectStoreNames.contains("states")||t.createObjectStore("states")}},get:function(e){return new Promise(function(n){var t=indexedDB.open("ejs-states",1);t.onerror=function(){},t.onsuccess=function(){var s=t.result.transaction(["states"],"readwrite").objectStore("states").get(e);s.onsuccess=async function(e){e=e.target.result,e&&n(e)},s.onerror=function(){}},t.onupgradeneeded=function(){var e=t.result;e.objectStoreNames.contains("states")||e.createObjectStore("states")}})}},saveLoadDB:function(i){try{if(l&&"function"==typeof l.getCoreOptionsValues){var t,o,n=l.getCoreOptionsValues()["save-state-location"],a=l.getCoreOptionsValues()["save-state-slot"],s=this.config.gameUrl.split("/").pop();if(this.gameName&&(s=this.gameName),!this.gameName&&this.config.gameUrl.startsWith("blob:")||!window.indexedDB)return!1;if(t=s+"-"+a,!n||"download"===n)return!1;if("save"===i)try{o=e.saveState(),e.saveLoaddbDB.put(t,o)}catch(e){return!1}else e.saveLoaddbDB.get(t).then(function(e){EJS_loadState(e)});return!0}return!1}catch(e){return!1}},gamepad:null,allowCheat:!0,connection:null,connected:!(eE=function(t,e){if(t.length<=0&&(console.warn("MicroModal v".concat(version,": ❗Please specify at least one %c'micromodal-trigger'"),"background-color: #f8f9fa;color: #50596c;font-weight: bold;","data attribute."),console.warn("%cExample:","background-color: #f8f9fa;color: #50596c;font-weight: bold;",'<a href="#" data-micromodal-trigger="my-modal"></a>')),!e)return!0;for(var n in e)en(n);return!0}),playerName:"",players:[],waitingList:{},roomMaster:null,inputsData:{},coreOptionData:{},currentFrame:0,wait:!(en=function(e){if(!document.getElementById(e))return!1}),progressHelper:{},icons:{lock:'<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="lock" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="svg-inline--fa fa-lock fa-w-14 fa-3x"><path fill="currentColor" d="M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z" class=""></path></svg>'},disableInput:!1,disableControl:function(n){if(n){for(var t=0;t<24;t+=1)e.simulateInputFn(0,t,0),e.simulateInputFn(1,t,0),e.simulateInputFn(2,t,0),e.simulateInputFn(3,t,0);e.disableInput=!0}else e.disableInput=!1},loadRoomsListTimer:null,loadRoomsList:function(){},stopLoadRooms:function(){e.loadRoomsListTimer&&clearTimeout(e.loadRoomsListTimer)},openRoom:function(){},isPaused:null,setVolume:null,setVariable:null,simulateInput:null,simulateInputFn:null,toggleShader:null,saveState:null,screenRecord:null,loadState:null,quickSaveState:null,quickLoadState:null,changeStateSlot:null,getScreenData:null,getStateInfo:null,setCheat:null,resetCheat:null,getGameCoreOptions:null,classNames:{"dialog-container":n({"dialog-container":!0}),tabs:n({tabs:!0}),"dialog-title":n({"dialog-title":!0}),"dialog-content":n({"dialog-content":!0}),"dialog-buttons":n({"dialog-buttons":!0}),overlay:n({overlay:!0}),"key-setting-popup":n({"key-setting-popup":!0}),"tabs-panel":n({"tabs-panel":!0}),"tabs-content":n({"tabs-content":!0}),"button-container":n({"button-container":!0}),set:n({set:!0}),active:n({active:!0}),"btn-cancel":n({"btn-cancel":!0}),"btn-reset":n({"btn-reset":!0}),"btn-clear":n({"btn-clear":!0}),"btn-create":n({"btn-create":!0}),"btn-submit":n({"btn-submit":!0}),"btn-join-room":n({"btn-join-room":!0}),"btn-quit":n({"btn-quit":!0}),"btn-create-room":n({"btn-create-room":!0}),"netplay-player-name":n({"netplay-player-name":!0}),"netplay-roomlist":n({"netplay-roomlist":!0}),"netplay-room-name-input":n({"netplay-room-name-input":!0}),"netplay-room-password-input":n({"netplay-room-password-input":!0}),"netplay-create-room-set":n({"netplay-create-room-set":!0}),"netplay-room":n({"netplay-room":!0}),modal:n({modal:!0}),modal__overlay:n({modal__overlay:!0}),modal__container:n({modal__container:!0}),modal__header:n({modal__header:!0}),modal__title:n({modal__title:!0}),modal__close:n({modal__close:!0}),modal__content:n({modal__content:!0}),modal__btn:n({modal__btn:!0}),"modal__btn-primary":n({"modal__btn-primary":!0}),"micromodal-slide":n({"micromodal-slide":!0}),modal__errmsg:n({modal__errmsg:!0}),modal__footer:n({modal__footer:!0}),"cheats-add":n({"cheats-add":!0}),"cheats-list":n({"cheats-list":!0}),"cheat-code-input":n({"cheat-code-input":!0}),"cheat-name-input":n({"cheat-name-input":!0}),"ejs-switch":n({"ejs-switch":!0}),"ejs-delete-cheat":n({"ejs-delete-cheat":!0})},initShaders:function(){for(var n,s=ez,t=Object.keys(s),e=0;e<t.length;e+=1)n=s[t[e]],o.FS.writeFile("/shader/".concat(t[e]),n),l.storage.get("shader")===t[e]&&o.FS.writeFile("/shader/shader.glslp",n)},setGamepadDialog:function(){var s,o,i,t=this,c=(t.elements.dialogs.gamepad.innerHTML='\n        <div class="'+e.classNames["dialog-container"]+'">\n            <div class="'+e.classNames["dialog-title"]+'">\n                <h4>'+t.localization("Control Settings")+'</h4>\n            </div>\n            \n            <ul class="'+e.classNames.tabs+'" id="controls-tabs">\n                <li class="tabs-title" role="presentation"><a href="#" onclick="return false" role="tab" aria-controls="controls-0" aria-selected="false" id="controls-0-label">'+t.localization("Player 1")+'</a></li>\n                <li class="tabs-title" role="presentation"><a href="#" onclick="return false" role="tab" aria-controls="controls-1" aria-selected="false" id="controls-1-label">'+t.localization("Player 2")+'</a></li>\n                <li class="tabs-title" role="presentation"><a href="#" onclick="return false" role="tab" aria-controls="controls-2" aria-selected="false" id="controls-2-label">'+t.localization("Player 3")+'</a></li>\n                <li class="tabs-title" role="presentation"><a href="#" onclick="return false" role="tab" aria-controls="controls-3" aria-selected="false" id="controls-3-label">'+t.localization("Player 4")+'</a></li>\n            </ul>\n            <div class="'+e.classNames["dialog-content"]+'">\n            <div class="'+e.classNames["tabs-content"]+' controls">\n                \n            </div>\n            </div>\n            <div class="'+e.classNames["dialog-buttons"]+'">\n                <a href="#" onclick="return false" class="'+e.classNames["btn-submit"]+'">'+t.localization("Update")+'</a>\n                <a href="#" onclick="return false" class="'+e.classNames["btn-reset"]+'">'+t.localization("Reset")+'</a>\n                <a href="#" onclick="return false" class="'+e.classNames["btn-clear"]+'">'+t.localization("Clear")+'</a>\n                <a href="#" onclick="return false" class="'+e.classNames["btn-cancel"]+'">'+t.localization("Cancel")+'</a>\n            </div>\n            <div class="'+e.classNames.overlay+'" hidden>\n                <div class="'+e.classNames["key-setting-popup"]+'">\n                    <span>[Select]</span><br />\n                    <div style="color:#fff !important">'+t.localization("Press keyboard or gamepad")+"</div>\n                </div>\n            </div>\n        </div>\n        ",'\n        <div class="'.concat(e.classNames["tabs-panel"],'" id="controls-{index}" hidden>\n            <div>\n                <div style="">\n                    <div class="gamepad" style="font-size:12px">Connected gamepad: <span class="gamepad-name">n/a</span></div>\n                </div>\n                <div style="width:25%;float:left">&nbsp;</div>\n                <div style="font-size:12px;width:50%;float:left">\n                    <div class="row">\n                        <div style="text-align:center;width:50%;float:left">'+t.localization("Gamepad")+'</div>\n                        <div style="text-align:center;width:50%;float:left">'+t.localization("Keyboard")+'</div>\n                    </div>\n                </div>\n                <div style="clear:both"></div>\n            </div>\n        </div>')),d='\n        <div class="'.concat(e.classNames["button-container"],'" data-id="{id}" data-index="{index}" data-label="{label}" style="margin-bottom:10px">\n            <div style="width:25%;float:left;font-size:12px">\n                <label>{label}:</label>\n            </div>\n            <div style="width:50%;float:left">\n                <div>\n                    <div style="width:50%;float:left;padding: 0 5px;">\n                        <input style="text-align:center;height:25px;width: 100%;" type="text" data-id="{id}" data-value="" data-type="2" data-index="{index}" readonly="" placeholder="">\n                    </div>\n                    <div style="width:50%;float:left;padding: 0 5px;">\n                        <input style="text-align:center;height:25px;width: 100%;" type="text" data-id="{id}" data-value="" data-type="1" data-index="{index}" readonly="" placeholder="">\n                    </div>\n                    <div style="clear:both"></div>\n                </div>\n            </div>\n            <div style="width:25%;float:left">\n                <a class="').concat(e.classNames.set,'" href="#" onclick="return false">'+t.localization("Set")+'</a>\n            </div>\n            <div style="clear:both"></div>\n        </div>'),n="nes"===t.system?{0:"B",2:"SELECT",3:"START",4:"UP",5:"DOWN",6:"LEFT",7:"RIGHT",8:"A",24:t.localization("QUICK SAVE STATE"),25:t.localization("QUICK LOAD STATE"),26:t.localization("CHANGE STATE SLOT")}:"snes"===t.system?{0:"B",1:"Y",2:"SELECT",3:"START",4:"UP",5:"DOWN",6:"LEFT",7:"RIGHT",8:"A",9:"X",10:"L",11:"R",24:t.localization("QUICK SAVE STATE"),25:t.localization("QUICK LOAD STATE"),26:t.localization("CHANGE STATE SLOT")}:"n64"===t.system?{0:"B",3:"START",4:"UP",5:"DOWN",6:"LEFT",7:"RIGHT",8:"A",10:"L",11:"R",12:"Z",19:"L STICK UP",18:"L STICK DOWN",17:"L STICK LEFT",16:"L STICK RIGHT",23:"R STICK UP",22:"R STICK DOWN",21:"R STICK LEFT",20:"R STICK RIGHT",24:t.localization("QUICK SAVE STATE"),25:t.localization("QUICK LOAD STATE"),26:t.localization("CHANGE STATE SLOT")}:"nds"===t.system?{0:"B",1:"Y",2:"SELECT",3:"START",4:"UP",5:"DOWN",6:"LEFT",7:"RIGHT",8:"A",9:"X",10:"L",11:"R",14:"Microphone",24:t.localization("QUICK SAVE STATE"),25:t.localization("QUICK LOAD STATE"),26:t.localization("CHANGE STATE SLOT")}:{0:"B",1:"Y",2:"SELECT",3:"START",4:"UP",5:"DOWN",6:"LEFT",7:"RIGHT",8:"A",9:"X",10:"L",11:"R",12:"L2",13:"R2",14:"L3",15:"R3",19:"L STICK UP",18:"L STICK DOWN",17:"L STICK LEFT",16:"L STICK RIGHT",23:"R STICK UP",22:"R STICK DOWN",21:"R STICK LEFT",20:"R STICK RIGHT",24:t.localization("QUICK SAVE STATE"),25:t.localization("QUICK LOAD STATE"),26:t.localization("CHANGE STATE SLOT")};["arcade","mame"].includes(t.system)&&(n[2]=t.localization("INSERT COIN")),!1===t.statesSupported&&(delete n[24],delete n[25],delete n[26]);for(i=[2,3,4,5,6,7,8,0,9,1,10,11,12,13,14,15,19,18,17,16,23,22,21,20,24,25,26],o=0;o<=3;o+=1)!function(s){t.elements.dialogs.gamepad.querySelector(".".concat(e.classNames["tabs-content"])).innerHTML+=c.replace(/{index}/g,s),i.forEach(function(e){n[e]&&(t.elements.dialogs.gamepad.querySelector("#controls-".concat(s)).innerHTML+=d.replace(/{index}/g,s).replace(/{id}/g,e).replace(/{label}/g,n[e]))}),t.elements.dialogs.gamepad.querySelector('[data-id="16"][data-index="'.concat(s,'"][data-type="2"]'))&&(t.elements.dialogs.gamepad.querySelector('[data-id="16"][data-index="'.concat(s,'"][data-type="2"]')).style.backgroundColor="#ccc"),t.elements.dialogs.gamepad.querySelector('[data-id="17"][data-index="'.concat(s,'"][data-type="2"]'))&&(t.elements.dialogs.gamepad.querySelector('[data-id="17"][data-index="'.concat(s,'"][data-type="2"]')).style.backgroundColor="#ccc"),t.elements.dialogs.gamepad.querySelector('[data-id="18"][data-index="'.concat(s,'"][data-type="2"]'))&&(t.elements.dialogs.gamepad.querySelector('[data-id="18"][data-index="'.concat(s,'"][data-type="2"]')).style.backgroundColor="#ccc"),t.elements.dialogs.gamepad.querySelector('[data-id="19"][data-index="'.concat(s,'"][data-type="2"]'))&&(t.elements.dialogs.gamepad.querySelector('[data-id="19"][data-index="'.concat(s,'"][data-type="2"]')).style.backgroundColor="#ccc"),t.elements.dialogs.gamepad.querySelector('[data-id="20"][data-index="'.concat(s,'"][data-type="2"]'))&&(t.elements.dialogs.gamepad.querySelector('[data-id="20"][data-index="'.concat(s,'"][data-type="2"]')).style.backgroundColor="#ccc"),t.elements.dialogs.gamepad.querySelector('[data-id="21"][data-index="'.concat(s,'"][data-type="2"]'))&&(t.elements.dialogs.gamepad.querySelector('[data-id="21"][data-index="'.concat(s,'"][data-type="2"]')).style.backgroundColor="#ccc"),t.elements.dialogs.gamepad.querySelector('[data-id="22"][data-index="'.concat(s,'"][data-type="2"]'))&&(t.elements.dialogs.gamepad.querySelector('[data-id="22"][data-index="'.concat(s,'"][data-type="2"]')).style.backgroundColor="#ccc"),t.elements.dialogs.gamepad.querySelector('[data-id="23"][data-index="'.concat(s,'"][data-type="2"]'))&&(t.elements.dialogs.gamepad.querySelector('[data-id="23"][data-index="'.concat(s,'"][data-type="2"]')).style.backgroundColor="#ccc")}(o);Object.keys(e.controllers).forEach(function(n){e.controllers[n]&&Object.keys(e.controllers[n]).forEach(function(s){var i=t.elements.dialogs.gamepad.querySelector('[data-id="'.concat(s,'"][data-index="').concat(n,'"][data-type="1"]')),o=t.elements.dialogs.gamepad.querySelector('[data-id="'.concat(s,'"][data-index="').concat(n,'"][data-type="2"]'));if(!i||!o)return!1;s=e.controllers[n][s],s&&(s.type&&1!==parseInt(s.type,10)?o.value="":s.value&&(i.value=e.keyMap[s.value]||"",i.setAttribute("data-value",s.value)),s.value2&&(o.value=isNaN(s.value2)?s.value2:"button ".concat(parseInt(s.value2,10)+1),o.setAttribute("data-value",s.value2)))})}),r.call(this,t.elements.dialogs.gamepad.querySelector(".".concat(e.classNames["btn-submit"])),"click",function(s){var o=t.elements.dialogs.gamepad.querySelectorAll("input"),n={};return Array.from(o).forEach(function(e){var s,t=e.getAttribute("data-index"),o=e.getAttribute("data-value"),e=(2===parseInt(e.getAttribute("data-type"),10)&&(s=e.getAttribute("data-value")),e.getAttribute("data-id"));n[t]||(n[t]={}),n[t][e]||(n[t][e]={}),o&&(n[t][e].value=o),s&&(n[t][e].value2=s)}),l.storage.set({controllers:n}),e.controllers=n,a(t.elements.dialogs.gamepad,!0),t.elements.container.focus(),s.stopPropagation(),!1}),r.call(this,t.elements.dialogs.gamepad.querySelector(".".concat(e.classNames["btn-reset"])),"click",function(){e.controllers=JSON.parse(JSON.stringify(e.defaultControllers)),localStorage.removeItem(l.storage.key);for(s=t.elements.dialogs.gamepad.querySelectorAll("input"),n=0;n<s.length;n++){var n,s,o=s[n].getAttribute("data-index"),r=s[n].getAttribute("data-type"),i=s[n].getAttribute("data-id"),a=1==r?"value":"value2";e.defaultControllers[o]&&e.defaultControllers[o][i]&&e.defaultControllers[o][i][a]?(s[n].value=1==r?e.keyMap[e.defaultControllers[o][i][a]]:"button "+(parseInt(e.defaultControllers[o][i][a])+1),s[n].setAttribute("data-value",e.defaultControllers[o][i][a])):(s[n].value="",s[n].setAttribute("data-value",""))}}),r.call(this,t.elements.dialogs.gamepad.querySelector(".".concat(e.classNames["btn-clear"])),"click",function(){s={0:{},1:{},2:{},3:{}};for(o in n)s[0][o]={},s[1][o]={},s[2][o]={},s[3][o]={};e.controllers=s,localStorage.setItem(l.storage.key,JSON.stringify({controllers:e.controllers}));for(var s,o,a=t.elements.dialogs.gamepad.querySelectorAll("input"),i=0;i<a.length;i++)a[i].value="",a[i].setAttribute("data-value","")}),r.call(this,t.elements.dialogs.gamepad.querySelector(".".concat(e.classNames["btn-cancel"])),"click",function(e){return a(t.elements.dialogs.gamepad,!0),t.elements.container.focus(),e.stopPropagation(),!1}),Array.from(t.elements.dialogs.gamepad.querySelectorAll(".".concat(e.classNames.tabs," li"))).forEach(function(n){r.call(t,n,"mousedown",function(s){h(t.elements.dialogs.gamepad.querySelectorAll(".".concat(e.classNames.tabs," li")),e.classNames.active,!1),h(n,e.classNames.active,!0);var o=n.querySelector("a").getAttribute("aria-controls");return Array.from(t.elements.dialogs.gamepad.querySelectorAll(".".concat(e.classNames["tabs-content"]," .").concat(e.classNames["tabs-panel"]))).forEach(function(e){a(e,!0)}),a(t.elements.dialogs.gamepad.querySelector(".".concat(e.classNames["tabs-content"]," #").concat(o)),!1),s.stopPropagation(),!1})}),p.call(t,t.elements.dialogs.gamepad.querySelector('[aria-controls="controls-0"]').parentNode,"mousedown"),s=t.elements.dialogs.gamepad.querySelector(".".concat(e.classNames.overlay)),r.call(t,s,"mousedown",function(e){a(s,!0),e.stopPropagation()}),Array.from(t.elements.dialogs.gamepad.querySelectorAll(".".concat(e.classNames["button-container"]))).forEach(function(n){r.call(t,n,"mousedown",function(s){p.call(t,n.querySelector("a.".concat(e.classNames.set)),s.type,!0,{})})}),Array.from(t.elements.dialogs.gamepad.querySelectorAll(".".concat(e.classNames["tabs-panel"]," a.").concat(e.classNames.set))).forEach(function(n){r.call(t,n,"mousedown",function(c){var o=n.parentNode.parentNode,r=o.getAttribute("data-id"),i=o.getAttribute("data-index"),o=o.getAttribute("data-label"),o=(a(s,!1),s.setAttribute("data-id",r),s.setAttribute("data-index",i),"[ ".concat(o," ]"));e.gamepad.gamepads[i]&&r<16?o+='<br /><span style="font-size:12px">Gamepad:'.concat(e.gamepad.gamepads[i].id,"</span><br />"+t.localization("Press keyboard or gamepad")+"<br/>"+t.localization("Press escape (esc) to clear")):o+="<br />Press keyboard<br/>"+t.localization("Press escape (esc) to clear"),s.querySelector(".".concat(e.classNames["key-setting-popup"])).innerHTML=o,c.stopPropagation()})})},setCacheDialog:function(){var t=this;t.elements.dialogs.cache.innerHTML='\n        <div class="'.concat(e.classNames["dialog-container"],'">\n            <div class="').concat(e.classNames["dialog-title"],'">\n                <h4>'+t.localization("Cache Manager")+'</h4>\n            </div>\n            <div class="').concat(e.classNames["dialog-content"],'">\n\n            </div>\n            <div class="').concat(e.classNames["dialog-buttons"],'">\n                <a href="#" onclick="return false" class="').concat(e.classNames["btn-cancel"],'">'+t.localization("Close")+"</a>\n            </div>\n        </div>\n        "),r.call(this,t.elements.dialogs.cache.querySelector(".".concat(e.classNames["btn-cancel"])),"click",function(e){return a(t.elements.dialogs.cache,!0),t.elements.container.focus(),e.stopPropagation(),!1}),r.call(this,t.elements.dialogs.cache.querySelector(".".concat(e.classNames["dialog-title"]," a")),"click",function(n){return o.romdb&&(o.romdb.clear(),t.elements.dialogs.cache.querySelector(".".concat(e.classNames["dialog-content"])).innerHTML='<div style="text-align:center">'+t.localization("Empty")+"</div>"),n.stopPropagation(),!1})},showLoading:function(e){C.show("modal-6ed698f3d04061f5",{closeByEsckey:!1}),e&&console.log(""),a(this.elements.dialogs.loading,!1)},hideLoading:function(){C.close(),a(this.elements.dialogs.loading,!0)},setLoadingDialog:function(){this.elements.dialogs.loading&&(this.elements.dialogs.loading.innerHTML='\n            <div class="'.concat(e.classNames.modal," ").concat(e.classNames["micromodal-slide"],'" id="modal-6ed698f3d04061f5" aria-hidden="true">\n                <div class="').concat(e.classNames.modal__overlay,'" tabindex="-1">\n                <div class="').concat(e.classNames.modal__container,'" role="dialog" aria-modal="true" aria-labelledby="modal-6ed698f3d04061f5-title">\n                '+this.localization("Loading")+"...\n                </div>\n                </div>\n            </div>"))},setCheatDialog:function(){var n,o,i,t=this;t.elements.dialogs.cheat&&(t.elements.dialogs.cheat.innerHTML='\n            <div class="'.concat(e.classNames["dialog-container"],'">\n                <div class="').concat(e.classNames["dialog-title"],'">\n                    <h4>Cheats</h4>\n                </div>\n                <div class="').concat(e.classNames["dialog-content"],'">\n                    <div class="').concat(e.classNames["cheats-list"],'">\n                        \n                    </div>\n                </div>\n                <div class="').concat(e.classNames["dialog-buttons"],'">\n                    <a href="#" onclick="return false" class="').concat(e.classNames["cheats-add"],'">'+t.localization("Add Cheat")+'</a>\n                    <a href="#" onclick="return false" class="').concat(e.classNames["btn-submit"],'">'+t.localization("OK")+'</a>\n                    <a href="#" onclick="return false" class="').concat(e.classNames["btn-cancel"],'">Close</a>\n                </div>\n            </div>\n\n            \n\n            <div class="').concat(e.classNames.modal," ").concat(e.classNames["micromodal-slide"],'" id="modal-85cd7a1c543a484b" aria-hidden="true">\n                <div class="').concat(e.classNames.modal__overlay,'" tabindex="-1" data-modal-close>\n                <div class="').concat(e.classNames.modal__container,'" style="width:100%" role="dialog" aria-modal="true" aria-labelledby="modal-85cd7a1c543a484b-title">\n                    <div class="').concat(e.classNames.modal__header,'">\n                    <h2 class="').concat(e.classNames.modal__title,'" id="modal-85cd7a1c543a484b-title">\n                    '+t.localization("Add Cheat Code")+'\n                    </h2>\n                    <button class="').concat(e.classNames.modal__close,'" aria-label="Close modal" data-modal-close></button>\n                    </div>\n                    <main class="').concat(e.classNames.modal__content,'" id="modal-85cd7a1c543a484b-content">\n\n                        <div class="').concat(e.classNames.modal__errmsg,'"></div>\n                        <strong>'+t.localization("Code")+'</strong><br />\n                        <textarea style="width:100%;height:80px;" class="').concat(e.classNames["cheat-code-input"],'"></textarea><br />\n                        <strong>'+t.localization("Description")+'</strong><br />\n                        <input type="text" class="').concat(e.classNames["cheat-name-input"],'" /><br />\n\n                    </main>\n                    <footer class="').concat(e.classNames.modal__footer,'">\n                    <button class="').concat(e.classNames.modal__btn," ").concat(e.classNames["modal__btn-primary"],'">'+t.localization("Submit")+'</button>\n                    <button class="').concat(e.classNames.modal__btn,'" data-modal-close aria-label="Close">'+t.localization("Close")+"</button>\n                    </footer>\n                </div>\n                </div>\n            </div>\n            "),o=t.elements.dialogs.cheat.querySelector("#modal-85cd7a1c543a484b"),r.call(this,t.elements.dialogs.cheat.querySelector(".".concat(e.classNames["cheats-add"])),"click",function(){return C.show("modal-85cd7a1c543a484b",{closeTrigger:"data-modal-close"}),!1}),n=t.elements.dialogs.cheat.querySelector(".".concat(e.classNames["cheats-list"])),r.call(this,o.querySelector(".".concat(e.classNames["modal__btn-primary"])),"click",function(c){var s,a,i=o.querySelector(".".concat(e.classNames["cheat-name-input"])).value,r=o.querySelector(".".concat(e.classNames["cheat-code-input"])).value;return i&&r&&(a=n.querySelectorAll("input:checked"),o.querySelector(".".concat(e.classNames["cheat-name-input"])).value="",o.querySelector(".".concat(e.classNames["cheat-code-input"])).value="",C.close(),s=t.cheats.length,t.cheats.push([i,r]),n.innerHTML+='<div class="'.concat(e.classNames["ejs-switch"],'">\n                            <input type="checkbox" value="').concat(s,'" id="ejs-cheat-switch-').concat(s,'">\n                            <label for="ejs-cheat-switch-').concat(s,'">').concat(i,'</label>\n                            <a href="#" data-idx="').concat(s,'" onclick="return false" class="').concat(e.classNames["ejs-delete-cheat"],'">&times;</a>\n                        </div>'),a.forEach(function(t,e){n.querySelector("#ejs-cheat-switch-".concat(e)).setAttribute("checked","checked")})),"localStorage"in window&&localStorage.setItem("".concat(t.system,"-").concat(t.startName,"-cheats"),JSON.stringify(t.cheats)),c.stopPropagation(),!1}),i=function(){if("localStorage"in window){var s=localStorage.getItem("".concat(t.system,"-").concat(t.startName,"-cheats"));try{s=JSON.parse(s)}catch(e){}s&&(t.cheats=s)}n.innerHTML="",t.cheats&&Array.isArray(t.cheats)&&t.cheats.forEach(function(s,t){var o=s[0];s[1],n.innerHTML+='<div class="'.concat(e.classNames["ejs-switch"],'">\n                                <input type="checkbox" value="').concat(t,'" id="ejs-cheat-switch-').concat(t,'">\n                                <label for="ejs-cheat-switch-').concat(t,'">').concat(o,'</label>\n                                <a href="#" data-idx="').concat(t,'" onclick="return false" class="').concat(e.classNames["ejs-delete-cheat"],'">&times;</a>\n                            </div>')})},r.call(t,n,"click",function(s){var o,a;return s.target&&s.target.classList.contains(e.classNames["ejs-delete-cheat"])&&s.target.getAttribute("data-idx")&&(a=s.target.getAttribute("data-idx"),t.cheats.splice(a,1),"localStorage"in window&&localStorage.setItem("".concat(t.system,"-").concat(t.startName,"-cheats"),JSON.stringify(t.cheats)),o=[],n.querySelectorAll("input").forEach(function(t,e){o[e]=!!n.querySelector("#ejs-cheat-switch-".concat(e,":checked"))}),o.splice(a,1),i(),o.forEach(function(e,t){e&&n.querySelector("#ejs-cheat-switch-".concat(t)).setAttribute("checked","checked")})),s.stopPropagation(),!1}),r.call(t,t.elements.container,"start-game",function(){i()}),r.call(this,t.elements.dialogs.cheat.querySelector(".".concat(e.classNames["btn-cancel"])),"click",function(e){return a(t.elements.dialogs.cheat,!0),e.stopPropagation(),t.elements.container.focus(),!1}),r.call(this,t.elements.dialogs.cheat.querySelector(".".concat(e.classNames["btn-submit"])),"click",function(){return e.resetCheat(),n.querySelectorAll("input:checked").forEach(function(n,s){n=t.cheats[n.value],n&&e.setCheat(s,1,n[1])}),a(t.elements.dialogs.cheat,!0),t.elements.container.focus(),!1}),"arcade"!==t.system&&"mame"!==t.system&&"mame2003"!==t.system&&"mame2010"!==t.system||(s.element(t.elements.buttons.cheat)&&a(t.elements.buttons.cheat,!0),e.allowCheat=!1),e.setCheat||(a(t.elements.buttons.cheat,!0),e.allowCheat=!1))},setNetplayDialog:function(){var s,i,c,d,u,h,m,f,p,g,v,b,j=this,t=this;t.elements.dialogs.netplay&&(t.elements.dialogs.netplay.innerHTML='\n            <div class="'.concat(e.classNames["dialog-container"],'">\n                <div class="').concat(e.classNames["dialog-title"],'">\n                    <h4>'+t.localization("Netplay")+'</h4>\n                </div>\n                <div class="').concat(e.classNames["dialog-content"],'">\n                    <div class="').concat(e.classNames["netplay-roomlist"],'" hidden>\n                        <strong>'+t.localization("Rooms")+'</strong>\n                        <table style="width:100%" cellspacing=0>\n                            <thead>\n                                <tr>\n                                    <td>'+t.localization("Room Name")+"</td>\n                                    <td>"+t.localization("Players")+'</td>\n                                    <td></td>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                <tr>\n                                    <td></td>\n                                    <td></td>\n                                    <td></td>\n                                </tr>\n                            </tbody>\n                        </table>\n                    </div>\n\n                    <div class="').concat(e.classNames["netplay-room"],'" hidden>\n                        <strong>'+t.localization("Room Name")+"</strong>\n                        <div data-room-password>"+t.localization("Password")+': <span></span></div>\n                        <table style="width:100%" cellspacing="0">\n                            <thead>\n                            <tr>\n                                <td>'+t.localization("Player")+"</td>\n                                <td>"+t.localization("Name")+"</td>\n                                <td></td>\n                            </tr>\n                            </thead>\n                            <tbody>\n                            <tr>\n                                <td>1</td>\n                                <td>"+t.localization("Name")+" 1</td>\n                                <td></td>\n                            </tr>\n                            <tr>\n                                <td>2</td>\n                                <td>"+t.localization("Name")+" 2</td>\n                                <td></td>\n                            </tr>\n                            <tr>\n                                <td>3</td>\n                                <td>"+t.localization("Name")+" 3</td>\n                                <td></td>\n                            </tr>\n                            <tr>\n                                <td>4</td>\n                                <td>"+t.localization("Name")+' 4</td>\n                                <td></td>\n                            </tr>\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n                <div class="').concat(e.classNames["dialog-buttons"],'">\n                    <a href="#" onclick="return false" class="').concat(e.classNames["btn-quit"],'">'+t.localization("Quit Room")+'</a>\n                    <a href="#" onclick="return false" class="').concat(e.classNames["btn-create-room"],'">'+t.localization("Create a Room")+'</a>\n                    <a href="#" onclick="return false" class="').concat(e.classNames["btn-cancel"],'">'+t.localization("Close")+'</a>\n                </div>\n            </div>\n\n            \n            <div class="').concat(e.classNames.modal," ").concat(e.classNames["micromodal-slide"],'" id="modal-9de6c4e9ce2b9361" aria-hidden="true">\n                <div class="').concat(e.classNames.modal__overlay,'" tabindex="-1">\n                <div class="').concat(e.classNames.modal__container,'" role="dialog" aria-modal="true" aria-labelledby="modal-9de6c4e9ce2b9361-title">\n                    <div class="').concat(e.classNames.modal__header,'">\n                    <h2 class="').concat(e.classNames.modal__title,'" id="modal-9de6c4e9ce2b9361-title">\n                        '+t.localization("Set Player Name")+'\n                    </h2>\n                    </div>\n                    <main class="').concat(e.classNames.modal__content,'" id="modal-9de6c4e9ce2b9361-content">\n\n                        <div class="').concat(e.classNames.modal__errmsg,'"></div>\n                        <strong>'+t.localization("Player Name")+'</strong><br />\n                        <input type="text" maxlength="10" class="').concat(e.classNames["netplay-player-name"],'" /><br />\n\n                    </main>\n                    <footer class="').concat(e.classNames.modal__footer,'">\n                    <button class="').concat(e.classNames.modal__btn," ").concat(e.classNames["modal__btn-primary"],'">'+t.localization("Submit")+'</button>\n                    </footer>\n                </div>\n                </div>\n            </div>\n            \n            <div class="').concat(e.classNames.modal," ").concat(e.classNames["micromodal-slide"],'" id="modal-85cd7a1c543a484a" aria-hidden="true">\n                <div class="').concat(e.classNames.modal__overlay,'" tabindex="-1" data-modal-close>\n                <div class="').concat(e.classNames.modal__container,'" role="dialog" aria-modal="true" aria-labelledby="modal-85cd7a1c543a484a-title">\n                    <div class="').concat(e.classNames.modal__header,'">\n                    <h2 class="').concat(e.classNames.modal__title,'" id="modal-85cd7a1c543a484a-title">\n                    '+t.localization("Create a Room")+'\n                    </h2>\n                    <button class="').concat(e.classNames.modal__close,'" aria-label="Close modal" data-modal-close></button>\n                    </div>\n                    <main class="').concat(e.classNames.modal__content,'" id="modal-85cd7a1c543a484a-content">\n\n                        <div class="').concat(e.classNames.modal__errmsg,'"></div>\n                        <strong>'+t.localization("Room Name")+'</strong><br />\n                        <input type="text" maxlength="10" class="').concat(e.classNames["netplay-room-name-input"],'" /><br />\n                        <strong>Max Players</strong><br />\n                        <select data-max-players>\n                            <option value="2">2</option>\n                            <option value="3">3</option>\n                            <option value="4">4</option>\n                        </select>\n                        <br />\n                        <strong>'+t.localization("Password (optional)")+'</strong><br />\n                        <input type="text" maxlength="10" class="').concat(e.classNames["netplay-room-password-input"],'" /><br />\n\n                    </main>\n                    <footer class="').concat(e.classNames.modal__footer,'">\n                    <button class="').concat(e.classNames.modal__btn," ").concat(e.classNames["modal__btn-primary"],'">'+t.localization("Submit")+'</button>\n                    <button class="').concat(e.classNames.modal__btn,'" data-modal-close aria-label="Close">'+t.localization("Close")+'</button>\n                    </footer>\n                </div>\n                </div>\n            </div>\n            \n            <div class="').concat(e.classNames.modal," ").concat(e.classNames["micromodal-slide"],'" id="modal-5aa765d61d8327de" aria-hidden="true">\n                <div class="').concat(e.classNames.modal__overlay,'" tabindex="-1" data-modal-close>\n                <div class="').concat(e.classNames.modal__container,'" role="dialog" aria-modal="true" aria-labelledby="modal-5aa765d61d8327de-title">\n                    <div class="').concat(e.classNames.modal__header,'">\n                    <h2 class="').concat(e.classNames.modal__title,'" id="modal-5aa765d61d8327de-title">\n                        '+t.localization("Password")+'\n                    </h2>\n                    <button class="').concat(e.classNames.modal__close,'" aria-label="Close modal" data-modal-close></button>\n                    </div>\n                    <main class="').concat(e.classNames.modal__content,'" id="modal-5aa765d61d8327de-content">\n\n                        <div class="').concat(e.classNames.modal__errmsg,'"></div>\n                        <input type="text" maxlength="10" class="').concat(e.classNames["netplay-room-password-input"],'" /><br />\n\n                    </main>\n                    <footer class="').concat(e.classNames.modal__footer,'">\n                    <button class="').concat(e.classNames.modal__btn," ").concat(e.classNames["modal__btn-primary"],'">'+t.localization("Submit")+'</button>\n                    <button class="').concat(e.classNames.modal__btn,'" data-modal-close aria-label="Close">'+t.localization("Close")+'</button>\n                    </footer>\n                </div>\n                </div>\n            </div>\n            \n            \n            <div class="').concat(e.classNames.modal," ").concat(e.classNames["micromodal-slide"],'" id="modal-7d8fd50ed642340b" aria-hidden="true">\n                <div class="').concat(e.classNames.modal__overlay,'" tabindex="-1" data-modal-close>\n                <div class="').concat(e.classNames.modal__container,'" role="dialog" aria-modal="true" aria-labelledby="modal-7d8fd50ed642340b-title">\n                    <div class="').concat(e.classNames.modal__header,'">\n                    <h2 class="').concat(e.classNames.modal__title,'" id="modal-7d8fd50ed642340b-title"></h2>\n                    <button class="').concat(e.classNames.modal__close,'" aria-label="Close modal" data-modal-close></button>\n                    </div>\n                    <main class="').concat(e.classNames.modal__content,'" id="modal-7d8fd50ed642340b-content">\n                        \n                    </main>\n                    <footer class="').concat(e.classNames.modal__footer,'">\n                    <button class="').concat(e.classNames.modal__btn," ").concat(e.classNames["modal__btn-primary"],'" data-modal-close>OK</button>\n                    </footer>\n                </div>\n                </div>\n            </div>\n            \n            '),r.call(this,t.elements.dialogs.netplay.querySelector(".".concat(e.classNames["btn-cancel"])),"click",function(n){return a(t.elements.dialogs.netplay,!0),e.disableControl(!1),e.stopLoadRooms(),n.stopPropagation(),t.elements.container.focus(),!1}),window.setInterval(function(){var n="<ul>";e.players.forEach(function(t,o){var s=null;t?(e.connection.peers[t]?s=e.connection.peers[t].extra:e.connection.userid===t&&(s=e.connection.extra),n+="<li>".concat(o+1,". ").concat(s.name,"</li>")):n+="<li>".concat(o+1,". </li>")}),n+="</ul>",t.elements.widgets.netplay.innerHTML=n},500),f=t.elements.dialogs.netplay.querySelector("#modal-9de6c4e9ce2b9361"),i=t.elements.dialogs.netplay.querySelector("#modal-85cd7a1c543a484a"),p=t.elements.dialogs.netplay.querySelector("#modal-7d8fd50ed642340b"),d=t.elements.dialogs.netplay.querySelector("#modal-5aa765d61d8327de"),u={},e.connection=new eT.a,(s=j.socketUrl).endsWith("/")||(s+="/"),e.connection.socketURL="/",e.connection.socketURL=s,e.connection.socketMessageEvent="emulatorjs-message",e.connection.socketCustomEvent="emulatorjs-custom-message",s=y.info(),e.connection.extra={name:e.playerName,game_id:t.config.gameId,browser_name:s.name,room_name:" ",domain:document.domain},e.connection.socketMessageEvent="netplay",e.connection.enableFileSharing=!0,e.connection.enableLogs=!1,e.connection.session={data:!0},e.connection.sdpConstraints.mandatory={OfferToReceiveAudio:!1,OfferToReceiveVideo:!1},e.connection.onclose=function(){},e.connection.iceServers=[{urls:"turn:turn.emulatorjs.com:3478",credential:"dSnmrtehverella",username:"ejs"},{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun.l.google.com:19302?transport=udp"]}],e.connection.maxParticipantsAllowed=4,h=e.netPlayInitFrame=0,m=!1,Module.postMainLoop=function(){if(e.currentFrame=parseInt(e.currentFrameNum(),10),e.connected)if(h+=1,e.connection.isInitiator)if(1<=h){for(var n,i,a,r,d,c=[],s=e.currentFrame-1;s<e.currentFrame;s+=1)e.inputsData[s]?e.inputsData[s].forEach(function(e){c.push("".concat(e.index,"|").concat(e.key,"|").concat(e.status,"|").concat(e.frame))}):c.push("-1|||".concat(s));e.connection.send(JSON.stringify({act:"sync-control",value:c})),h=0,e.currentFrame%100==0&&Object.keys(e.inputsData).forEach(function(t){t<e.currentFrame-50&&(e.inputsData[t]=null,delete e.inputsData[t])});return}else return;else{if(e.coreOptionData[e.currentFrame]&&(n=e.coreOptionData[e.currentFrame].key,d=e.coreOptionData[e.currentFrame].value,l.updateCoreOptions.call(t,n,d),delete e.coreOptionData[e.currentFrame]),e.currentFrame<=0||e.inputsData[e.currentFrame])e.wait=!1,e.systemPause(0),o.Module.resumeMainLoop(),n=e.inputsData[e.currentFrame],e.inputsData[e.currentFrame]=null,delete e.inputsData[e.currentFrame],(n=n||[]).forEach(function(t){0<=t.index&&e.simulateInputFn(t.index,t.key,t.status)});else{e.wait=!0,e.systemPause(1),o.Module.pauseMainLoop(),i=!1,a=Object.keys(e.inputsData),0==a.length&&(i=!0);for(r=0;r<a.length;r+=1)if(a[r]>e.currentFrame){console.log("lost",e.currentFrame),i=!0;break}i?e.wait||(!m||m<(new Date).valueOf()-3e3)&&(e.inputsData={},m=(new Date).valueOf(),e.connection.send(JSON.stringify({act:"sync-mem",value:e.connection.userid}),e.roomMaster)):(e.wait=!0,e.systemPause(1),o.Module.pauseMainLoop())}e.currentFrame%100==0&&Object.keys(e.inputsData).forEach(function(t){t<e.currentFrame-50&&(e.inputsData[t]=null,delete e.inputsData[t])})}},e.connection.onopen=function(n){e.connected=!0,e.connection.isInitiator&&(-1===e.players.indexOf(n.userid)&&(0<e.players.filter(function(e){return null==e}).length?e.players.forEach(function(t,s){null!=t||e.players.includes(n.userid)||(e.players[s]=n.userid)}):e.players.push(n.userid)),e.connection.send(JSON.stringify({act:"get-players-result",value:e.players,coreOptions:l.coreOptionsValues,newuser:n.userid,master:e.connection.userid}))),l.updateCoreOptionMenuItems.call(t)},e.connection.onFileStart=function(n){var s=n.name.split("-");"reset"!==s[0]&&0!=s[0]||(e.inputsData={},e.disableControl(!0)),e.progressHelper[n.remoteUserId]={},e.progressHelper[n.remoteUserId].max=n.maxChunks,e.showLoading.call(t),e.connection.isInitiator?(e.wait=!0,e.systemPause(1),o.Module.pauseMainLoop()):e.inputsData={}},e.connection.onFileProgress=function(t){var n=e.progressHelper[t.remoteUserId];n.current=t.currentPosition||t.maxChunks||n.max},c=!(e.connection.onFileEnd=function(n){e.hideLoading.call(t);var i=n.name.split("-"),s=i[0]>>0;"reset"===i[0]?(s=0,e.connection.isInitiator?(e.systemPause(0),e.disableControl(!1),t.playing=!0,o.Module.resumeMainLoop()):O.a.get(n.url,{responseType:"arraybuffer"}).then(function(n){e.inputsData={},n=new Uint8Array(n.data),e.loadState(n,s),e.wait=!1,e.systemPause(0),e.disableInput=!1,t.playing=!0,o.Module.resumeMainLoop()})):"game.state"===i[1]&&(e.connection.isInitiator?(e.openRoom(t),e.wait=!1,e.systemPause(0),o.Module.resumeMainLoop()):(e.netPlayInitFrame=s,O.a.get(n.url,{responseType:"arraybuffer"}).then(function(n){n=new Uint8Array(n.data),e.loadState(n,s),e.wait=!1,e.disableInput=!1,e.connection.send(JSON.stringify({act:"wait-end",value:e.connection.userid})),e.hideLoading.call(t),t.playing=!0,o.Module.resumeMainLoop()}))),e.connection.isInitiator||console.log("recv mem end",e.currentFrame,n.name)}),e.connection.onmessage=function(s){s=s.data||s;try{n=JSON.parse(s)}catch(e){n=null}if(n){if("room-master"===n.act&&(e.roomMaster=n.value),n.act,"short-pause"!==n.act||c||(e.systemPause(1),o.Module.pauseMainLoop(),c=!0,e.wait=!0,setTimeout(function(){e.systemPause(0),o.Module.resumeMainLoop(),e.wait=!1,c=!1},48)),"sync-control"===n.act&&(s=n.value,t.playing||e.wait,d=e.connection.userid,e.players.indexOf(d),e.connection.isInitiator,s.forEach(function(t){var t=t.split("|"),n=t[0]>>0,i=t[1]>>0,a=t[2]>>0,t=t[3]>>0,s=e.currentFrame;e.inputsData[t]||(e.inputsData[t]=[]),-1!=n&&t===s&&e.simulateInputFn(n,i,a),e.connection.isInitiator?0<=n&&(e.inputsData[s]||(e.inputsData[s]=[]),-2!=i&&(e.inputsData[s].push({index:n,key:i,status:a,frame:s}),e.simulateInputFn(n,i,a)),c||t<=s-10&&(e.systemPause(1),o.Module.pauseMainLoop(),c=!0,e.wait=!0,setTimeout(function(){e.systemPause(0),o.Module.resumeMainLoop(),e.wait=!1,c=!1},48))):(""!==n&&e.inputsData[t].push({index:n,key:i,status:a,frame:t}),e.inputsData[e.currentFrame]&&o.Module.resumeMainLoop(),s+10<=t&&t>e.netPlayInitFrame+100&&e.connection.send(JSON.stringify({act:"short-pause",value:d}),e.roomMaster))})),n.act,n.act,"update-core-option"!==n.act||e.connection.isInitiator||(e.coreOptionData[n.frame]={key:n.key,value:n.value}),"restart-game"===n.act&&(e.inputsData={},e.connection.send(JSON.stringify({act:"sync-mem",value:e.connection.userid}),e.roomMaster)),"pause"===n.act&&o.Module.pauseMainLoop(),"resume"===n.act&&o.Module.resumeMainLoop(),"wait"===n.act&&(e.wait=!0,e.systemPause(1),n.value!==e.connection.userid&&(e.waitingList[n.value]=1),e.disableControl(!0)),"wait-end"===n.act&&(e.waitingList[n.value]&&delete e.waitingList[n.value],0===Object.keys(e.waitingList).length&&(e.wait=!1,e.systemPause(0),e.disableInput=!1)),"sync-mem"===n.act){e.wait=!0,e.systemPause(1),s=n.value,e.disableControl(!0),e.connection.send(JSON.stringify({act:"wait",value:s}));for(var n,s,d,h,a=e.getStateInfo().split("|"),m=a[0]>>0,r=new Uint8Array(m),f=a[1]>>0,i=0;i<m;i+=1)r[i]=o.Module.getValue(f+i);o._FS.createDataFile("/","game.state",r,!0,!0),o.Module.cwrap("load_state","number",["string","number"])("game.state",0),o.FS.unlink("game.state"),e.inputsData={},a=new File([r],"".concat(0,"-game.state"),{type:"",lastModified:new Date}),e.connection.shareFile(a,s)}n.act,"get-players-result"===n.act&&(e.players=n.value,e.roomMaster=n.master,n.newuser===e.connection.userid)&&(h=l.coreOptionsValues,n.coreOptions&&Object.keys(n.coreOptions).forEach(function(e){h[e]!==n.coreOptions[e]&&l.updateCoreOptions.call(t,e,n.coreOptions[e])}),e.showLoading.call(t),e.disableControl(!0),setTimeout(function(){e.connection.send(JSON.stringify({act:"sync-mem",value:e.connection.userid}),e.roomMaster)},1),e.roomMaster&&e.connection.peers[e.roomMaster]&&(e.connection.extra.room_name=e.connection.peers[e.roomMaster].extra.room_name,e.connection.updateExtraData()),e.connection.peers[e.roomMaster]&&(u=e.connection.peers[e.roomMaster].extra),e.openRoom(t))}},e.connection.onUserStatusChanged=function(t){var n;"offline"===t.status&&0<=(n=e.players.indexOf(t.userid))&&(e.players[n]=null),t.status},e.connection.onExtraDataUpdated=function(t){t.userid===e.connection.userid&&(e.connection.extra=t.extra)},e.connection.onleave=function(n){var s;n.userid&&0<=(s=e.players.indexOf(n.userid))&&(e.players[s]=null),e.waitingList[n.userid]&&delete e.waitingList[n.userid],e.connection.isInitiator&&0===Object.keys(e.waitingList).length&&e.wait&&(e.wait=!1,e.systemPause(0),e.disableInput=!1,e.connection.send(JSON.stringify({act:"wait-end",value:e.connection.userid}))),e.openRoom(t),e.inputsData={},e.hideLoading.call(t)},e.connection.close=s=function(){try{e.connection.onbeforeunload()}catch(e){}e.connected=!1,e.connection.password=null,e.players=[],e.connection.peersBackup=[],e.waitingList={},e.inputsData={},e.hideLoading.call(t),a(t.elements.buttons.restart,!1),a(t.elements.buttons.loadState,!1),a(t.elements.buttons.saveState,!1),e.allowCheat&&a(t.elements.buttons.cheat,!1),a(l.contextMenu.querySelectorAll("ul li").item(2),!1),a(l.contextMenu.querySelectorAll("ul li").item(3),!1),Array.from(t.elements.buttons.play).forEach(function(e){a(e,!1)}),l.updateCoreOptionMenuItems.call(t)},e.connection.disconnect=s,e.connection.leave=s,v=function(n,i,s){e.hideLoading.call(t),n?(e.stopLoadRooms(),a(t.elements.buttons.restart,!0),a(t.elements.buttons.loadState,!0),a(t.elements.buttons.saveState,!0),e.resetCheat(),a(t.elements.buttons.cheat,!0),a(l.contextMenu.querySelectorAll("ul li").item(2),!0),a(l.contextMenu.querySelectorAll("ul li").item(3),!0),Array.from(t.elements.buttons.play).forEach(function(e){a(e,!0)}),e.connection.socket&&e.connection.socket.on("set-isInitiator-true",function(n){n===e.connection.sessionid&&(e.connection.socket.emit("extra-data-updated",e.connection.extra),e.connection.send(JSON.stringify({act:"room-master",value:e.connection.userid})),e.roomMaster=e.connection.userid,e.systemPause(0),o.Module.resumeMainLoop(),l.updateCoreOptionMenuItems.call(t),a(t.elements.buttons.restart,!1),a(t.elements.buttons.loadState,!1),a(t.elements.buttons.saveState,!1),Array.from(t.elements.buttons.play).forEach(function(e){a(e,!1)}))})):(C.close(),p.querySelector("#modal-7d8fd50ed642340b-content").innerHTML=s,C.show("modal-7d8fd50ed642340b",{closeTrigger:"data-modal-close"}))},b=function(n){var s=n.target.getAttribute("data-id");if("Y"===n.target.getAttribute("data-password"))C.show("modal-5aa765d61d8327de",{closeTrigger:"data-modal-close"}),d.setAttribute("data-id",s);else{e.showLoading.call(t),e.connection.userid=e.connection.token();try{e.connection.join(s,v)}catch(n){e.hideLoading.call(t),p.querySelector("#modal-7d8fd50ed642340b-content").innerHTML="Error",C.show("modal-7d8fd50ed642340b",{closeTrigger:"data-modal-close"})}}return n.stopPropagation(),!1},e.loadRoomsList=function(){a(t.elements.dialogs.netplay.querySelector(".".concat(e.classNames["netplay-roomlist"])),!1),a(t.elements.dialogs.netplay.querySelector(".".concat(e.classNames["netplay-room"])),!0),a(t.elements.dialogs.netplay.querySelector(".".concat(e.classNames["btn-create-room"])),!1),a(t.elements.dialogs.netplay.querySelector(".".concat(e.classNames["btn-quit"])),!0);var s=t.listUrl,n=(s.endsWith("/")||(s+="/"),t.elements.dialogs.netplay.querySelector(".".concat(e.classNames["netplay-roomlist"])).querySelector("tbody")),s=[s,"list?game_id=",t.config.gameId,"&domain=",document.domain].join("");O.a.get(s,{}).then(function(t){var s,o;t.data&&(s=[],o=[],n.querySelectorAll("tr").forEach(function(e){o.push(e.getAttribute("id"))}),Object.keys(t.data).forEach(function(i){var a=t.data[i],c=(s.push(i),o.includes(i)&&(c=n.querySelector('tr[id="'.concat(i,'"]')),n.removeChild(c)),document.createElement("tr")),d=(c.setAttribute("id",i),a.password?e.icons.lock:""),l=a.password?"Y":"N",i=a.current<a.max?'<span data-id="'.concat(i,'" data-password="').concat(l,'" class="').concat(e.classNames["btn-join-room"],'">Join</span>'):"",l=a.country||"?";c.innerHTML="<td>[".concat(l,"] ").concat(d," ").concat(a.room_name,"</td><td>").concat(a.current,"/").concat(a.max,"</td><td>").concat(i,"</td>"),r.call(j,c.querySelector(".".concat(e.classNames["btn-join-room"])),"click",b),n.appendChild(c)}),n.querySelectorAll("tr").forEach(function(e){s.includes(e.id)||n.removeChild(e)})),e.loadRoomsListTimer=setTimeout(e.loadRoomsList,2e3)}).catch(function(t){console.log("Network Error",t),e.loadRoomsListTimer=setTimeout(e.loadRoomsList,2e3)})},e.openRoom=function(t){e.stopLoadRooms(),a(t.elements.dialogs.netplay.querySelector(".".concat(e.classNames["netplay-roomlist"])),!0),a(t.elements.dialogs.netplay.querySelector(".".concat(e.classNames["netplay-room"])),!1),a(t.elements.dialogs.netplay.querySelector(".".concat(e.classNames["btn-create-room"])),!0),a(t.elements.dialogs.netplay.querySelector(".".concat(e.classNames["btn-quit"])),!1),e.resetCheat(),a(t.elements.buttons.cheat,!0);var t=t.elements.dialogs.netplay.querySelector(".".concat(e.classNames["netplay-room"])),n=t.querySelector("[data-room-password]"),s=(null===e.connection.password?a(n,!0):(a(n,!1),n.querySelector("span").innerText=e.connection.password),t.querySelector("tbody"));s.innerHTML="",t.querySelector("strong").innerText=u.room_name,e.players.forEach(function(t,o){var n=null;t&&(e.connection.peers[t]?n=e.connection.peers[t].extra:e.connection.userid===t&&(n=e.connection.extra),n&&n.name)&&((t=document.createElement("tr")).innerHTML="<td>".concat(o+1,"</td><td>").concat(n.name,"</td><td></td>"),s.appendChild(t))})},r.call(this,d.querySelector(".".concat(e.classNames["modal__btn-primary"])),"click",function(o){var s=d.querySelector(".".concat(e.classNames["netplay-room-password-input"])).value,s=(e.showLoading.call(t),e.connection.password=s,d.getAttribute("data-id"));e.connection.join(s,function(e,s,t){v(e,0,t),e&&d.classList.remove(n({"is-open":!0}))}),o.stopPropagation()}),r.call(this,f.querySelector(".".concat(e.classNames["modal__btn-primary"])),"click",function(n){var t=(t=f.querySelector(".".concat(e.classNames["netplay-player-name"])).value).replace(/<|>/g,"");f.querySelector(".".concat(e.classNames.modal__errmsg)).innerHTML="",t.trim()&&(e.playerName=t.trim(),e.connection.extra.name=t.trim(),C.close()),n.stopPropagation()}),r.call(this,i.querySelector(".".concat(e.classNames["modal__btn-primary"])),"click",function(c){var s,r,o=(o=i.querySelector(".".concat(e.classNames["netplay-room-name-input"])).value).replace(/<|>/g,""),n=i.querySelector("select[data-max-players] option:checked").value;4<(n=n<2?2:n)&&(n=4);for(s=0;s<n;s++)e.players[s]=null;e.connection.maxParticipantsAllowed=n,r=i.querySelector(".".concat(e.classNames["netplay-room-password-input"])).value,i.querySelector(".".concat(e.classNames.modal__errmsg)).innerHTML="",o.trim()?(e.connection.extra.room_name=o.trim(),""!==r.trim()&&(e.connection.password=r.trim()),e.showLoading.call(t),e.connection.open(e.connection.token(),function(n,o,s){e.hideLoading.call(t),n?(e.players[0]=e.connection.userid,e.roomMaster=e.connection.userid,g.closeModal(),e.stopLoadRooms(),u=e.connection.extra,e.openRoom(t),a(l.contextMenu.querySelectorAll("ul li").item(2),!0),a(l.contextMenu.querySelectorAll("ul li").item(3),!0)):i.querySelector(".".concat(e.classNames.modal__errmsg)).innerHTML=s})):g.closeModal(),c.stopPropagation()}),r.call(this,t.elements.dialogs.netplay.querySelector(".".concat(e.classNames["btn-create-room"])),"click",function(e){return g=C.show("modal-85cd7a1c543a484a",{closeTrigger:"data-modal-close",onClose:function(){t.elements.container.focus()}}),e.stopPropagation(),!1}),r.call(this,t.elements.dialogs.netplay.querySelector(".".concat(e.classNames["btn-quit"])),"click",function(t){return e.connection.close(),e.stopLoadRooms(),e.loadRoomsList(),e.inputsData={},t.stopPropagation(),!1})),window._0x378b5c=e},initKeyboard:function(){var s=this,n=this,t=this.elements.dialogs.gamepad.querySelector(".".concat(e.classNames.overlay));r.call(this,document.body,"keydown keyup",function(o){if(!(112<=o.which&&o.which<=123))if(r=!s.elements.dialogs.gamepad.hidden&&!t.hidden,l="keydown"===o.type,l&&r){var l,r=t.getAttribute("data-index"),c=t.getAttribute("data-id"),i=null;if(o.key&&"escape"===e.keyMap[o.keyCode])return(i=n.elements.dialogs.gamepad.querySelector('[data-id="'.concat(c,'"][data-index="').concat(r,'"][data-type="1"]'))).setAttribute("data-value",""),i.value=""(i=n.elements.dialogs.gamepad.querySelector('[data-id="'.concat(c,'"][data-index="').concat(r,'"][data-type="2"]'))).setAttribute("data-value",""),i.value="",void a(t,!0);r=t.getAttribute("data-index"),c=t.getAttribute("data-id"),i=null,o.key&&((i=n.elements.dialogs.gamepad.querySelector('[data-id="'.concat(c,'"][data-index="').concat(r,'"][data-type="1"]'))).setAttribute("data-value",o.keyCode),i.value=e.keyMap[o.keyCode]),a(t,!0)}else Object.keys(e.controllers).forEach(function(t){Object.keys(e.controllers[t]).forEach(function(n){parseInt(e.controllers[t][n].value,10)===o.keyCode&&["24","25","26"].includes(n)&&"keydown"==o.type&&!o.repeat&&("24"==n?e.quickSaveState():"25"==n?e.quickLoadState():"26"==n&&e.changeStateSlot()),parseInt(e.controllers[t][n].value,10)===o.keyCode&&(l?16<=n&&n<=23?e.simulateInput(t,n,32767):e.simulateInput(t,n,1):e.simulateInput(t,n,0))})})}),document.body.addEventListener("keydown",function(t){var s=t.keyCode||t.which;[32,37,38,39,40,112,113,114,115,116,117,118,119,120,121,122,123].includes(s)&&t.srcElement===n.elements.container&&t.preventDefault(),t.srcElement.className.split(/ +/).includes(e.classNames.set)&&t.preventDefault()})},initGamepad:function(){var s=this,o=this,n=this.elements.dialogs.gamepad.querySelector(".".concat(e.classNames.overlay)),t=new m.Gamepad;(e.gamepad=t).init()&&(t.bind(m.Gamepad.Event.TICK,function(e){e.forEach(function(e){var n;e&&e.axes&&e.axes[9]&&((n=e.axes[9])<3.28571?1==n?(e.extra_buttons[12].pressed||(e.extra_buttons[12]={pressed:!0,value:1},t._fire(m.Gamepad.Event.BUTTON_DOWN,{index:12,gamepad:e,gamepadIndex:e.index})),e.extra_buttons[14].pressed||(e.extra_buttons[14]={pressed:!0,value:1},t._fire(m.Gamepad.Event.BUTTON_DOWN,{index:14,gamepad:e,gamepadIndex:e.index}))):n<=-.7142857&&-.714291<=n?(e.extra_buttons[12].pressed||(e.extra_buttons[12]={pressed:!0,value:1},t._fire(m.Gamepad.Event.BUTTON_DOWN,{index:12,gamepad:e,gamepadIndex:e.index})),e.extra_buttons[15].pressed||(e.extra_buttons[15]={pressed:!0,value:1},t._fire(m.Gamepad.Event.BUTTON_DOWN,{index:15,gamepad:e,gamepadIndex:e.index}))):.42856<=n&&n<=.42858?(e.extra_buttons[13].pressed||(e.extra_buttons[13]={pressed:!0,value:1},t._fire(m.Gamepad.Event.BUTTON_DOWN,{index:13,gamepad:e,gamepadIndex:e.index})),e.extra_buttons[14].pressed||(e.extra_buttons[14]={pressed:!0,value:1},t._fire(m.Gamepad.Event.BUTTON_DOWN,{index:14,gamepad:e,gamepadIndex:e.index}))):-.14287<=n&&n<=-.14285?(e.extra_buttons[13].pressed||(e.extra_buttons[13]={pressed:!0,value:1},t._fire(m.Gamepad.Event.BUTTON_DOWN,{index:13,gamepad:e,gamepadIndex:e.index})),e.extra_buttons[15].pressed||(e.extra_buttons[15]={pressed:!0,value:1},t._fire(m.Gamepad.Event.BUTTON_DOWN,{index:15,gamepad:e,gamepadIndex:e.index}))):n<=-1&&-1.01<=n?e.extra_buttons[12].pressed||(e.extra_buttons[12]={pressed:!0,value:1},t._fire(m.Gamepad.Event.BUTTON_DOWN,{index:12,gamepad:e,gamepadIndex:e.index})):.142857<=n&&n<=.142858?e.extra_buttons[13].pressed||(e.extra_buttons[13]={pressed:!0,value:1},t._fire(m.Gamepad.Event.BUTTON_DOWN,{index:13,gamepad:e,gamepadIndex:e.index})):.7142857<=n&&n<=.7142858?e.extra_buttons[14].pressed||(e.extra_buttons[14]={pressed:!0,value:1},t._fire(m.Gamepad.Event.BUTTON_DOWN,{index:14,gamepad:e,gamepadIndex:e.index})):n<=-.42857&&-.42858<=n&&(e.extra_buttons[15].pressed||(e.extra_buttons[15]={pressed:!0,value:1},t._fire(m.Gamepad.Event.BUTTON_DOWN,{index:15,gamepad:e,gamepadIndex:e.index}))):(e.extra_buttons[12].pressed&&(e.extra_buttons[12]={pressed:!1,value:0},t._fire(m.Gamepad.Event.BUTTON_UP,{index:12,gamepad:e,gamepadIndex:e.index})),e.extra_buttons[13].pressed&&(e.extra_buttons[13]={pressed:!1,value:0},t._fire(m.Gamepad.Event.BUTTON_UP,{index:13,gamepad:e,gamepadIndex:e.index})),e.extra_buttons[14].pressed&&(e.extra_buttons[14]={pressed:!1,value:0},t._fire(m.Gamepad.Event.BUTTON_UP,{index:14,gamepad:e,gamepadIndex:e.index})),e.extra_buttons[15].pressed&&(e.extra_buttons[15]={pressed:!1,value:0},t._fire(m.Gamepad.Event.BUTTON_UP,{index:15,gamepad:e,gamepadIndex:e.index}))))})}),t.bind(m.Gamepad.Event.BUTTON_DOWN,function(t){if(s.elements.dialogs.gamepad.hidden||n.hidden)Object.keys(e.controllers[t.gamepad.index.toString()]).forEach(function(n){var s=t.gamepad.index.toString();parseInt(e.controllers[s][n].value2,10)===parseInt(t.index,10)&&["24","25","26"].includes(n)&&("24"==n?e.quickSaveState():"25"==n?e.quickLoadState():"26"==n&&e.changeStateSlot()),parseInt(e.controllers[s][n].value2,10)===parseInt(t.index,10)&&parseInt(s,10)===parseInt(t.gamepad.index,10)&&e.simulateInput(s,n,1)});else{var i,r,c,l=parseInt(n.getAttribute("data-index"),10),d=n.getAttribute("data-id");if(t.gamepad.index===parseInt(l,10)){for(r=0;r<32&&(!(i=(i=t.gamepad.buttons[r])||t.gamepad.extra_buttons[r])||!("number"==typeof i&&1===i||"number"==typeof i.value&&1===i.value));r+=1);c=null,(c=o.elements.dialogs.gamepad.querySelector('[data-id="'.concat(d,'"][data-index="').concat(l,'"][data-type="2"]'))).setAttribute("data-value",t.index),c.value="button ".concat(t.index+1),a(n,!0)}}}),t.bind(m.Gamepad.Event.BUTTON_UP,function(t){Object.keys(e.controllers).forEach(function(n){Object.keys(e.controllers[n]).forEach(function(s){parseInt(e.controllers[n][s].value2,10)===parseInt(t.index,10)&&parseInt(n,10)===parseInt(t.gamepad.index,10)&&e.simulateInput(n,s,0)})})}),t.bind(m.Gamepad.Event.AXIS_CHANGED,function(t){if(c=.5<(l=parseFloat(t.value))||l<.5?0<l?1:-1:0,s.elements.dialogs.gamepad.hidden||n.hidden){{e.prevButtons||(e.prevButtons={});var i,r,c,l,u,d=!1,o=t.gamepad.index.toString();e.prevButtons[o]||(e.prevButtons[o]={}),e.prevButtons[o][t.axis]||(e.prevButtons[o][t.axis]=0),e.prevButtons[o].buttonID||(e.prevButtons[o].buttonID=0);for(u=0;u<Object.keys(e.controllers[o]).length;u++)r=Object.keys(e.controllers[o])[u],e.controllers[o][r].value2&&(e.controllers[o][r].value2.split(":")[0]===t.axis&&parseInt(e.controllers[o][r].value2.split(":")[1])===c&&["24","25","26"].includes(r)&&("24"==r?(d=!0,e.quickSaveState()):"25"==r?(d=!0,e.quickLoadState()):"26"==r&&e.changeStateSlot()),0==c?e.controllers[o][r].value2.split(":")[0]===t.axis&&(e.prevButtons[o][t.axis]=c,e.prevButtons[o].buttonID=r,e.simulateInput(o,r,0)):((1===e.prevButtons[o][t.axis]&&-1==c||-1===e.prevButtons[o][t.axis]&&1==c)&&e.simulateInput(o,e.prevButtons[o].buttonID,0),e.controllers[o][r].value2.split(":")[0]===t.axis&&parseInt(e.controllers[o][r].value2.split(":")[1])===c&&(e.prevButtons[o][t.axis]=c,e.prevButtons[o].buttonID=r,d=!0,e.simulateInput(o,r,1))));if(d)return;if(!s.elements.dialogs.gamepad.hidden&&!n.hidden)return}}else 0!=c&&(l=n.getAttribute("data-id"),i=parseInt(n.getAttribute("data-index"),10),(l=s.elements.dialogs.gamepad.querySelector('[data-id="'.concat(l,'"][data-index="').concat(i,'"][data-type="2"]'))).setAttribute("data-value",t.axis+":"+c),l.value=t.axis+":"+c,a(n,!0));Math.abs(t.value)<=.1&&(t.value=0),i=t.gamepad.index,"LEFT_STICK_X"===t.axis&&(0<t.value?(e.simulateInput(i,16,32767*t.value),e.simulateInput(i,17,0)):(e.simulateInput(i,17,32767*t.value),e.simulateInput(i,16,0))),"LEFT_STICK_Y"===t.axis&&(0<t.value?(e.simulateInput(i,18,32767*t.value),e.simulateInput(i,19,0)):(e.simulateInput(i,19,32767*t.value),e.simulateInput(i,18,0))),"RIGHT_STICK_X"===t.axis&&(0<t.value?(e.simulateInput(i,20,32767*t.value),e.simulateInput(i,21,0)):(e.simulateInput(i,21,32767*t.value),e.simulateInput(i,20,0))),"RIGHT_STICK_Y"===t.axis&&(0<t.value?(e.simulateInput(i,22,32767*t.value),e.simulateInput(i,23,0)):(e.simulateInput(i,23,32767*t.value),e.simulateInput(i,22,0)))}),t.bind(m.Gamepad.Event.DISCONNECTED,function(){[0,1,2,3].forEach(function(e){var n=t.gamepads[e];o.elements.dialogs.gamepad.querySelector("#controls-".concat(e," .gamepad-name")).innerHTML=n?n.id:"n/a"})}),t.bind(m.Gamepad.Event.CONNECTED,function(){Object.keys(t.gamepads).forEach(function(e){var n=t.gamepads[e];o.elements.dialogs.gamepad.querySelector("#controls-".concat(e," .gamepad-name")).innerHTML=n?n.id:"n/a"})}))},setShader:function(t){"disabled"===t?(o.FS.unlink("/shader/shader.glslp",""),e.toggleShader&&e.toggleShader(0)):(e.toggleShader&&e.toggleShader(0),t="/shader/".concat(t),o.FS.writeFile("/shader/shader.glslp",function(e){if(!(e instanceof Int32Array))throw new Error("uintArrayToString: Only accepts Int32Array parameter");for(var n,s="",t=0,o=e.length;t<o;t+=1){if(n=e[t],65535<n)throw new Error("Invalid value attempted to be serialised");s+=String.fromCharCode(n)}return s}(new Int32Array(o.FS.readFile(t)))),e.toggleShader&&e.toggleShader(1))},toggleVirtualGamepad:function(g){if(o=this,null===e.virtualGamepadContainer){e.virtualGamepadContainer=c("div",{class:n({"ejs-virtual-gamepad":!0}),hidden:""}),this.elements.container.appendChild(e.virtualGamepadContainer),i="height:31px;text-align:center;border:1px solid #ccc;border-radius:5px;line-height:31px;",t="",d=["snes","nds"].includes(o.system)?{order:["X","Y","A","B"],orderCSS:["left:40px;","top:40px;","left:81px;top:40px;","left:40px;top:80px;"],LandR:!0}:["gba","gb","vb","nes"].includes(o.system)?{order:["B","A"],orderCSS:["left:-10px;top:70px;","left:60px;top:70px;"],LandR:"gba"===o.system}:["n64"].includes(o.system)?{order:["B","A"],orderCSS:["left:-10px;top:95px;","left:40px;top:150px;"],LandR:!0}:{order:["Y","X","B","A"],orderCSS:["left:40px;","top:40px;","left:81px;top:40px;","left:40px;top:80px;"],LandR:!0},t=(t+='<div class="'+n({"virtual-gamepad":!0})+'" style="display: block;">')+('<div class="'+n({top:!0})+'">'),!0===d.LandR&&(t="n64"===o.system?(t=(t+='<div class="'+n({buttons:!0,b_l:!0})+'" style="left:10px;top:-40px;'+i+'">L</div>')+'<div class="'+n({buttons:!0,b_z:!0})+'" style="left:10px;'+i+'">Z</div>')+'<div class="'+n({buttons:!0,b_r:!0})+'" style="right:10px;top:-40px;'+i+'">R</div>':(t+='<div class="'+n({buttons:!0,b_l:!0})+'" style="left:10px;'+i+'">L</div>')+'<div class="'+n({buttons:!0,b_r:!0})+'" style="right:10px;'+i+'">R</div>'),t=(t=(t+="</div>")+('<div class="'+n({left:!0})+'"></div>'))+('<div class="'+n({center:!0})+'">'),"n64"===o.system?t+='<div class="'+n({buttons:!0,b_start:!0})+'" style="left:40px;">'+o.localization("Start")+"</div>":t=(t+='<div class="'+n({buttons:!0,b_start:!0})+'" style="left:60px;">'+o.localization("Start")+"</div>")+'<div class="'+n({buttons:!0,b_select:!0})+'" style="left:-5px;">'+o.localization("Select")+"</div>",t=(t+="</div>")+('<div class="'+n({right:!0})+'">'),"n64"===o.system&&(t=(t=(t=(t+='<div class="'+n({buttons:!0,b_cu:!0})+'" style="left:25px;top:-65px;"></div>')+'<div class="'+n({buttons:!0,b_cd:!0})+'" style="left:25px;top:15px;"></div>')+'<div class="'+n({buttons:!0,b_cl:!0})+'" style="left:-15px;top:-25px;"></div>')+'<div class="'+n({buttons:!0,b_cr:!0})+'" style="left:65px;top:-25px;"></div>');for(m=0;m<d.order.length;m++)f={buttons:!0},f["b_"+d.order[m].toLowerCase()]=!0,t+='<div class="'+n(f)+'" style="'+d.orderCSS[m]+'">'+d.order[m]+"</div>";e.virtualGamepadContainer.innerHTML=t+="</div></div>",a(e.virtualGamepadContainer,!g),i=eI.a.create({zone:u.call(this,".".concat(n({"ejs-virtual-gamepad":!0})," .").concat(n({left:!0}))),mode:"static",position:{left:"50%",top:"50%"},color:"red"});function s(){var e;return"n64"!==o.system||"d-pad"===(e=l&&"function"==typeof l.getCoreOptionsValues?l.getCoreOptionsValues()["joystick-input"]:e)?{downVal:1,4:4,5:5,6:6,7:7}:{downVal:32767,4:19,5:18,6:17,7:16}}i.on("end",function(){e.syncInput(0,s()[4],0),e.syncInput(0,s()[5],0),e.syncInput(0,s()[6],0),e.syncInput(0,s()[7],0)}),i.on("move",function(n,t){t=t.angle.degree,30<=t&&t<150?e.syncInput(0,s()[4],s().downVal):window.setTimeout(function(){e.syncInput(0,s()[4],0)},30),210<=t&&t<330?e.syncInput(0,s()[5],s().downVal):window.setTimeout(function(){e.syncInput(0,s()[5],0)},30),120<=t&&t<240?e.syncInput(0,s()[6],s().downVal):window.setTimeout(function(){e.syncInput(0,s()[6],0)},30),300<=t||0<=t&&t<60?e.syncInput(0,s()[7],s().downVal):window.setTimeout(function(){e.syncInput(0,s()[7],0)},30)});var t,o,d,m,f,v,b=n({"virtual-gamepad":!0}),p=n({touch:!0}),i=(y.isIos||r.call(this,u.call(this,".".concat(b)),"touchmove",function(e){e.stopPropagation()}),[{id:{b_a:!0},number:8},{id:{b_b:!0},number:0},{id:{b_x:!0},number:9},{id:{b_y:!0},number:1},{id:{b_l:!0},number:10},{id:{b_z:!0},number:12},{id:{b_r:!0},number:11},{id:{b_start:!0},number:3},{id:{b_select:!0},number:2},{id:{b_cu:!0},number:23},{id:{b_cd:!0},number:22},{id:{b_cl:!0},number:21},{id:{b_cr:!0},number:20}].forEach(t=>{r.call(this,u.call(this,".".concat(b," .").concat(n(t.id))),"touchstart touchend mousedown mouseup mouseout",function(n){n.sourceCapabilities.firesTouchEvents&&n.type.includes("mouse")||(["touchend","mouseup","mouseout"].includes(n.type)?(h(n.target,p,!1),window.setTimeout(function(){e.syncInput(0,t.number,0)},30)):(h(n.target,p,!0),e.syncInput(0,t.number,1)),n.stopPropagation())})}),c("div",{class:n({ejs__widget:!0,ejs__widget_controls_toggle:!0})},""));i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>',u.call(this,".".concat(n({ejs__widgets:!0}))).appendChild(i),r.call(this,i,"mousedown touchstart",function(e){e.sourceCapabilities.firesTouchEvents&&e.type.includes("mouse")||(h(e.target,p,!0),clearTimeout(v),x.toggleControls.call(o,!0),v=setTimeout(function(){x.toggleControls.call(o,!1)},5e3))})}else a(e.virtualGamepadContainer,!g)},setup:function(){var n,i,a,t=this;this.game?(e.playerName=t.config.playerName,h(this.elements.container,this.config.classNames.type,!0),this.elements.container.setAttribute("tabindex","0"),this.color&&(n=function(i){if(e=i.toLowerCase(),e&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(e)){if(4===e.length){for(var e,n,s,o="#",t=1;t<4;t+=1)o+=e.slice(t,t+1).concat(e.slice(t,t+1));e=o}for(s=[],n=1;n<7;n+=2)s.push(parseInt("0x".concat(e.slice(n,n+2)),16));return s}return null}(this.color))&&this.elements.container.setAttribute("style","--ejs-primary-color: ".concat(n[0],", ").concat(n[1],", ").concat(n[2])),this.elements.wrapper=c("div",{class:this.config.classNames.video}),ey(this.game,this.elements.wrapper),"video"!==t.game.tagName.toLocaleLowerCase()&&(i=this.config.volume,Object.defineProperty(t.game,"volume",{get:function(){return i},set:function(e){i=e,p.call(t,t.game,"volumechange")}}),a=t.storage.get("muted"),Object.defineProperty(t.game,"muted",{get:function(){return a},set:function(e){e=!!s.boolean(e)&&e,a=e,p.call(t,t.game,"volumechange")}})),window.addEventListener("beforeunload",function(){if(t.started){var s,n=t.startName.split("/").pop().split("."),n=n.slice(0,n.length-1).join(".");o.FS.syncfs(function(){});try{s="srm","nds"===t.system&&(s="dsv"),o.FS.unlink("/data/saves/".concat(n,".").concat(s))}catch(e){console.log("fail to save")}e.saveSavFiles(),o.FS.syncfs(function(){})}},!0)):console.warn("No game element found!")},listeners:function(){var t=this;t.elements.buttons.restart&&r.call(t,t.elements.buttons.restart,"click",function(){if(e.restartGame(),e.inputsData={},e.connected&&e.connection.isInitiator){for(var t=e.getStateInfo().split("|"),s=t[0]>>0,i=(t[2],new Uint8Array(s)),a=t[1]>>0,n=0;n<s;n+=1)i[n]=o.Module.getValue(a+n);t=new File([i],"0-game.state",{type:"",lastModified:new Date}),e.connection.shareFile(t),e.inputsData={},e.wait=!0,e.systemPause(1),o.Module.pauseMainLoop(),e.disableControl(!0)}}),t.elements.buttons.screenRecord&&r.call(t,t.elements.buttons.screenRecord,"click",function(){var e,s,i;t.recordData||(t.recordData={started:!1,data:[],stopped:!1}),t.recordData.started?t.recordData.started&&(t.recordData.recorder.stop(),t.recordData.stopped=!0):(s=MediaRecorder.isTypeSupported("video/webm; codecs=h264")?{mimeType:"video/webm; codecs=h264"}:MediaRecorder.isTypeSupported("video/webm; codecs=H264")?{mimeType:"video/webm; codecs=H264"}:MediaRecorder.isTypeSupported("video/webm; codecs=vp9")?{mimeType:"video/webm; codecs=vp9"}:MediaRecorder.isTypeSupported("video/webm; codecs=vp8")?{mimeType:"video/webm; codecs=vp8"}:MediaRecorder.isTypeSupported("video/webm; codecs=avc1")?{mimeType:"video/webm; codecs=avc1"}:MediaRecorder.isTypeSupported("video/webm; codecs=vp9.0")?{mimeType:"video/webm; codecs=vp9.0"}:MediaRecorder.isTypeSupported("video/webm; codecs=vp8.0")?{mimeType:"video/webm; codecs=vp8.0"}:{},o.Module.pauseMainLoop(),t.playing=!1,alert('please check "share system audio" to have audio in the recording. We only need the audio stream so your entire screen will not be recorded'),e=o.Module.canvas.captureStream(30),i=setTimeout(function(){t.playing=!0,o.Module.resumeMainLoop()},2e4),navigator.mediaDevices.getDisplayMedia({audio:!0,video:{mediaSource:"screen"}}).then(function(a){try{clearTimeout(i)}catch(e){}for(var c=a.getAudioTracks(),r=0;r<c.length;r++)e.addTrack(c[r]);a=e,t.elements.buttons.screenRecord.querySelector(".".concat(n({ejs__tooltip:!0}))).innerHTML=t.localization("Stop Screen Recording"),t.recordData.stream=a,t.recordData.recorder=new MediaRecorder(t.recordData.stream,s),t.recordData.recorder.ondataavailable=function(e){var s;0<e.data.size&&t.recordData.data.push(e.data),t.recordData.stopped&&((e=document.createElement("a")).href=window.URL.createObjectURL(new Blob(t.recordData.data,{type:"video/webm"})),"string"==typeof t.gameName&&(s=t.gameName),e.download=s?"".concat(s,"-recording.webm"):"record.webm",e.click(),window.URL.revokeObjectURL(e.href),delete t.recordData,t.elements.buttons.screenRecord.querySelector(".".concat(n({ejs__tooltip:!0}))).innerHTML=t.localization("Start Screen Recording"))},t.recordData.recorder.start(),t.recordData.started=!0,t.playing=!0,o.Module.resumeMainLoop()}))}),t.elements.buttons.play&&Array.from(t.elements.buttons.play).forEach(function(n){r.call(t,n,"click",function(){t.playing?(t.playing=!1,o.Module.pauseMainLoop(),e.connected&&e.connection.isInitiator&&e.connection.send(JSON.stringify({act:"pause"})),p.call(t,t.elements.container,"pause",!1,{pause:!0})):(t.playing=!0,o.Module.resumeMainLoop(),e.connected&&e.connection.isInitiator&&e.connection.send(JSON.stringify({act:"resume"})),p.call(t,t.elements.container,"pause",!1,{pause:!1}))})}),t.elements.buttons.netplay&&r.call(t,t.elements.buttons.netplay,"click",function(){e.disableControl(!0),a(t.elements.dialogs.netplay,!1),0<e.players.length?e.openRoom(t):(e.stopLoadRooms(),e.loadRoomsList()),e.playerName||C.show("modal-9de6c4e9ce2b9361",{closeByEsckey:!1})}),t.elements.buttons.cheat&&r.call(t,t.elements.buttons.cheat,"click",function(){a(t.elements.dialogs.cheat,!1)}),r.call(t,t.elements.container,"savestate",function(o){var n;e.saveLoadDB.call(t,"save")||(n=o.detail.state,s.function(t.config.onsavestate)?t.config.onsavestate.call(null,{screenshot:o.detail.screenshot,state:n}):(o=new Blob([n]),n=(n=t.startName.split("/").pop().split(".")).slice(0,n.length-1).join("."),n=(n="string"==typeof t.gameName?t.gameName:n)?"".concat(n,".state"):"game.state",e8()(o,n)),t.elements.container.focus())}),t.game.stateloadField=c("input"),t.game.stateloadField.type="file",t.game.stateloadField.onchange=function s(e){var n,e=e.target.files;0<e.length&&((n=new FileReader).file_name=e[0].name,n.onload=function(){var e=new Uint8Array(n.result);EJS_loadState(e)},n.readAsArrayBuffer(e[0])),t.game.stateloadField=c("input"),t.game.stateloadField.type="file",t.game.stateloadField.onchange=s},r.call(t,t.elements.container,"loadstate",function(){e.saveLoadDB.call(t,"load")||(s.function(t.config.onloadstate)?t.config.onloadstate.call(null,t.loadState):t.game.stateloadField.click(),t.elements.container.focus())}),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState?console.log("hidden"):console.log("active")})},bindFunction:function(){var s,t=this,a=t.system,r=(o.Module&&o.Module._set_volume&&(s=o.Module.cwrap("set_volume","null",["number"]),e.setVolume=function(){var e=0;t.volume<1&&(e=0===t.volume?-80:30*t.volume-30,s(e)),t.muted&&(e=-80),s(e)}),e.setVariable=o.Module.cwrap("set_variable","null",["string","string"]),e.simulateInputFn=o.Module.cwrap("simulate_input","null",["number","number","number"]),{0:null,1:null,2:null,3:null,4:null,5:null,6:null,7:null,8:null,9:null,10:null,11:null,12:null,13:null,14:null,15:null,16:null,17:null,18:null,19:null,20:null,21:null,22:null,23:null,24:null,25:null,26:null,27:null,28:null,29:null,30:null,31:null}),c=(e.simulateInput=function(a,s,o){var n,i,c;e.connected?t.playing&&!e.disableInput&&(n=e.connection.userid,c=e.roomMaster===n,n=e.players.indexOf(n),i=e.currentFrameNum(),a>>0==0&&(r[s]!==o&&(c?(e.inputsData[i]||(e.inputsData[i]=[]),e.inputsData[i].push({index:n,key:s,status:o,frame:i}),e.simulateInputFn(n,s,o)):e.connection.send(JSON.stringify({act:"sync-control",value:["".concat(n,"|").concat(s,"|").concat(o,"|").concat(i)]}),e.roomMaster)),r[s]=o)):e.disableInput||e.simulateInputFn(a,s,o)},e.syncInput=e.simulateInput,window.simulateInput=e.simulateInput,o.Module.cwrap("shader_enable","null",["number"])),n=(e.toggleShader=function(e){return c(e)},e.getStateInfo=o.Module.cwrap("get_state_info","string",[]),e.saveState=function(){if(s=e.getStateInfo().split("|"),t=s[0]>>0,0<t)for(var t,s,i=new Uint8Array(t),a=s[1]>>0,n=0;n<t;n++)i[n]=o.Module.getValue(a+n);return i},o.Module.cwrap("load_state","number",["string","number"])),d=(e.loadState=function(s,i){try{o.FS.unlink("game.state")}catch(e){}if(o._FS.createDataFile("/","game.state",s,!0,!0),null===i&&(i=0),"arcade"===a?setTimeout(function(){e.getStateInfo(),n("game.state",i),o.FS.unlink("game.state")},10):(n("game.state",i),setTimeout(function(){o.FS.unlink("game.state")},100)),e.connected&&e.connection.isInitiator){for(var s=e.getStateInfo().split("|"),c=s[0]>>0,l=(s[2],new Uint8Array(c)),d=s[1]>>0,r=0;r<c;r+=1)l[r]=o.Module.getValue(d+r);s=new File([l],"0-game.state",{type:"",lastModified:new Date}),e.connection.shareFile(s),e.inputsData={},e.wait=!0,e.systemPause(1),o.Module.pauseMainLoop(),e.disableControl(!0)}t.elements.container.focus()},o.Module._set_cheat&&(e.setCheat=o.Module.cwrap("set_cheat","number",["number","number","string"])),o.Module._reset_cheat&&(e.resetCheat=o.Module._reset_cheat),e.quickSaveState=function(){if(t.started&&!e.connected){if(!1===t.statesSupported)return t.elements.widgets.stateInfoDiv.innerHTML="CANNOT CURRENTLY SAVE STATE",clearTimeout(e.saveMsgTransitions),void(e.saveMsgTransitions=setTimeout(function(){t.elements.widgets.stateInfoDiv.innerHTML=""},1500));var n,i,s=(n=l&&"function"==typeof l.getCoreOptionsValues&&l.getCoreOptionsValues()["save-state-slot"]||1)+"-quick.state";try{o.FS.unlink(s)}catch(e){}try{i=e.saveState(),o._FS.createDataFile("/",s,i,!0,!0),t.elements.widgets.stateInfoDiv.innerHTML="STATE SAVED TO SLOT "+n,clearTimeout(e.saveMsgTransitions),e.saveMsgTransitions=setTimeout(function(){t.elements.widgets.stateInfoDiv.innerHTML=""},1500)}catch(s){t.elements.widgets.stateInfoDiv.innerHTML="FAILED TO SAVE STATE TO SLOT "+n,clearTimeout(e.saveMsgTransitions),e.saveMsgTransitions=setTimeout(function(){t.elements.widgets.stateInfoDiv.innerHTML=""},1500)}}},e.saveMsgTransitions=null,e.quickLoadState=function(){if(t.started&&!e.connected){if(!1===t.statesSupported)return t.elements.widgets.stateInfoDiv.innerHTML="CANNOT CURRENTLY LOAD STATE",clearTimeout(e.saveMsgTransitions),void(e.saveMsgTransitions=setTimeout(function(){t.elements.widgets.stateInfoDiv.innerHTML=""},1500));var s,o=(s=l&&"function"==typeof l.getCoreOptionsValues&&l.getCoreOptionsValues()["save-state-slot"]||1)+"-quick.state",i=!0;try{n(o,0),"arcade"===a&&setTimeout(function(){e.getStateInfo(),n(o,0)},10)}catch(e){i=!1}t.elements.widgets.stateInfoDiv.innerHTML=i?"LOADED STATE FROM SLOT "+s:"FAILED TO LOAD STATE FROM SLOT "+s,clearTimeout(e.saveMsgTransitions),e.saveMsgTransitions=setTimeout(function(){t.elements.widgets.stateInfoDiv.innerHTML=""},1500)}},e.changeStateSlot=function(s){var n=l&&"function"==typeof l.getCoreOptionsValues&&l.getCoreOptionsValues()["save-state-slot"]||1;i.updateCoreOptions.call(t,"save-state-slot",n=9<(n="number"!=typeof s?n+1:s)?1:n),t.elements.widgets.stateInfoDiv.innerHTML="SET SAVE STATE SLOT TO "+n,clearTimeout(e.saveMsgTransitions),e.saveMsgTransitions=setTimeout(function(){t.elements.widgets.stateInfoDiv.innerHTML=""},1500)},window.EJS_loadState=function(t){e.loadState(t,0),setTimeout(function(){var n;e.connected&&(n=new File([t],"0-game.state",{type:"",lastModified:new Date}),e.connection.shareFile(n),e.inputsData={},e.wait=!0,e.systemPause(1),o.Module.pauseMainLoop(),e.disableControl(!0))},30)},o.Module.cwrap("cmd_take_screenshot","",[]));e.getScreenData=function(){return e.toggleShader(0),d(),e.toggleShader(1),o.FS.readFile("screenshot.png")},e.restartGame=o.Module.cwrap("system_restart","",[]),e.currentFrameNum=o.Module.cwrap("get_current_frame_count","",[]),e.saveSavFiles=o.Module.cwrap("cmd_savefiles","",[]),o.Module._get_core_options&&(e.getGameCoreOptions=o.Module.cwrap("get_core_options","string",[])),e.systemPause=function(){return!1},e.controllers=l.storage.get("controllers"),e.controllers||(e.controllers=JSON.parse(JSON.stringify(e.defaultControllers)))}},d=e;function er(e){var d=e.targetModal,t=e.triggers,t=void 0===t?[]:t,s=e.onShow,s=void 0===s?function(){}:s,o=e.onClose,o=void 0===o?function(){}:o,i=e.openTrigger,i=void 0===i?"data-micromodal-trigger":i,a=e.closeTrigger,a=void 0===a?"data-micromodal-close":a,n=e.disableScroll,n=void 0!==n&&n,r=e.disableFocus,r=void 0!==r&&r,c=e.awaitCloseAnimation,c=void 0!==c&&c,l=e.debugMode,l=void 0!==l&&l,e=e.closeByEsckey,e=void 0===e||e;if(!(this instanceof er))throw new TypeError("Cannot call a class as a function");this.modal=document.getElementById(d),this.config={debugMode:l,disableScroll:n,openTrigger:i,closeTrigger:a,onShow:s,onClose:o,awaitCloseAnimation:c,disableFocus:r,closeByEsckey:e},0<t.length&&this.registerTriggers.apply(this,et(t)),this.onClick=this.onClick.bind(this),this.onKeydown=this.onKeydown.bind(this)}i={storage:null,coreOptionsValues:{},contextMenu:null,normalOptions:{shader:{label:"Shader",options:{disabled:"Disabled","2xScaleHQ.glslp":"2xScaleHQ","4xScaleHQ.glslp":"4xScaleHQ","crt-easymode.glslp":"CRT easymode","crt-aperture.glslp":"CRT aperture","crt-geom.glslp":"CRT geom"},default:"disabled"},"virtual-gamepad":{label:"Virtual Gamepad",options:{disabled:"Disabled",enabled:"Enabled"},default:"enabled"}},defaultCoreOptionsValues:function(){var e={};switch(this.system){case"pce":e={pce_nospritelimit:"enabled"};break;case"jaguar":e={virtualjaguar_doom_res_hack:"enabled"};break;case"psx":e={pcsx_rearmed_memcard2:"enabled"};break;case"nds":e={}}return e},getCoreOptionsValues:function(){var e=i.storage.get("core-options");return e=s.empty(e)?{}:e},getCoreOptions:function(){var e={};switch(this.system){case"nes":e.fceumm_palette={label:this.localization("Color Palette"),options:{default:this.localization("Default"),asqrealc:"asqrealc","nintendo-vc":"nintendo-vc",rgb:"rgb","yuv-v3":"yuv-v3","unsaturated-final":"unsaturated-final","sony-cxa2025as-us":"sony-cxa2025as-us",pal:"pal","bmf-final2":"bmf-final2","bmf-final3":"bmf-final3","smooth-fbx":"smooth-fbx","composite-direct-fbx":"composite-direct-fbx","pvm-style-d93-fbx":"pvm-style-d93-fbx",nescap:"nescap","ntsc-hardware-fbx":"ntsc-hardware-fbx","nes-classic-fbx-fs":"nes-classic-fbx-fs",wavebeam:"wavebeam"},default:"default"},e.fceumm_nospritelimit={label:this.localization("No Sprite Limit"),options:{enabled:this.localization("Enabled"),disabled:this.localization("Disabled")},default:"disabled"},e.fceumm_sndquality={label:this.localization("Sound Quality"),options:{Low:this.localization("Low"),High:this.localization("High"),"Very High":this.localization("Very High")},default:"Low"},this.lightgun||(e.system_type={label:this.localization("4 Players Support"),options:{nes:"NES",famicom:"Famicom"},default:"nes",netplay:!0}),e.fceumm_turbo_enable={label:this.localization("Turbo Enable"),options:{None:this.localization("None"),"Player 1":this.localization("Player 1"),"Player 2":this.localization("Player 2"),Both:this.localization("Both")},default:"None",netplay:!0},e.fceumm_region={label:this.localization("Region"),options:{Auto:this.localization("Auto"),NTSC:"NTSC",PAL:"PAL",Dendy:"Dendy"},default:"Auto",netplay:!0};break;case"snes":e={snes9x_next_overclock:{label:this.localization("SuperFX Overclock"),options:{disabled:this.localization("Disabled")+"(10MHz)","40MHz":"40MHz","60MHz":"60MHz","80MHz":"80MHz","100MHz":"100MHz"},default:"disabled",netplay:!0}};break;case"snes2002":case"snes2005":case"snes2010":e={};break;case"gb":e={gambatte_gb_colorization:{label:this.localization("GB Colorization"),options:{disabled:this.localization("Disabled"),auto:this.localization("auto"),internal:this.localization("internal")},default:"disabled"},gambatte_gb_internal_palette:{label:this.localization("Internal Palette"),options:{"GBC - Blue":this.localization("GBC - Blue"),"GBC - Brown":this.localization("GBC - Brown"),"GBC - Dark Blue":this.localization("GBC - Dark Blue"),"GBC - Dark Brown":this.localization("GBC - Dark Brown"),"GBC - Dark Green":this.localization("GBC - Dark Green"),"GBC - Grayscale":this.localization("GBC - Grayscale"),"GBC - Green":this.localization("GBC - Green"),"GBC - Inverted":this.localization("GBC - Inverted"),"GBC - Orange":this.localization("GBC - Orange"),"GBC - Pastel Mix":this.localization("GBC - Pastel Mix"),"GBC - Red":this.localization("GBC - Red"),"GBC - Yellow":this.localization("GBC - Yellow")},default:"GBC - Blue"}};break;case"gba":e={mgba_solar_sensor_level:{label:this.localization("Solar sensor level"),options:["0","1","2","3","4","5","6","7","8","9","10"],default:"0"},mgba_frameskip:{label:this.localization("Frameskip"),options:["0","1","2","3","4","5","6","7","8","9","10"],default:"0"}};break;case"vbanext":e={vbanext_turboenable:{label:this.localization("Enable Turbo Buttons"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"},vbanext_turbodelay:{label:this.localization("Turbo Delay in frames"),options:["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],default:"2"}};break;case"n64":e={"glupen64-aspect":{label:this.localization("Aspect Ratio (Need to refresh page)"),options:["4:3","16:9"],default:"4:3"},"glupen64-43screensize":{label:this.localization("4:3 Resolution"),options:["320x240","640x480","960x720","1280x960"],default:"320x240"},"glupen64-169screensize":{label:this.localization("16:9 Resolution"),options:["640x360","960x540","1280x720"],default:"640x360"},"glupen64-pak1":{label:this.localization("Player 1 Pak"),options:{none:this.localization("none"),memory:this.localization("memory"),rumble:this.localization("rumble")},default:"none",netplay:!0},"glupen64-pak2":{label:this.localization("Player 2 Pak"),options:{none:this.localization("none"),memory:this.localization("memory"),rumble:this.localization("rumble")},default:"none",netplay:!0},"glupen64-pak3":{label:this.localization("Player 3 Pak"),options:{none:this.localization("none"),memory:this.localization("memory"),rumble:this.localization("rumble")},default:"none",netplay:!0},"glupen64-pak4":{label:this.localization("Player 4 Pak"),options:{none:this.localization("none"),memory:this.localization("memory"),rumble:this.localization("rumble")},default:"none",netplay:!0}},!d||"undefined"==d.virtualGamepadContainer&&null===d.virtualGamepadContainer||(e["joystick-input"]={label:this.localization("Joystick input keys"),options:{"d-pad":this.localization("d-pad"),"analog-stick":this.localization("Analog Stick")},default:"analog-stick",netplay:!0});break;case"nds":e={desmume_screens_layout:{label:this.localization("Screen layout"),options:{"top/bottom":this.localization("top/bottom"),"bottom/top":this.localization("bottom/top"),"left/right":this.localization("left/right"),"right/left":this.localization("right/left"),"top only":this.localization("top only"),"bottom only":this.localization("bottom only"),"quick switch":this.localization("quick switch"),"hybrid/top":this.localization("hybrid/top"),"hybrid/bottom":this.localization("hybrid/bottom")},default:"top/bottom"},screen_rotation:{label:this.localization("Screen Rotation"),options:{0:"0°",90:"90°",180:"180°",270:"270°"},default:0},desmume_frameskip:{label:this.localization("Frameskip"),options:["0","1","2","3","4","5","6","7","8","9"],default:"0"}},w.wasm||delete e.screen_rotation;break;case"vb":case"pce":e={};break;case"segaMS":case"segaGG":case"segaMD":case"segaCD":e={genesis_plus_gx_no_sprite_limit:{label:this.localization("No Sprite Limit"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"},genesis_plus_gx_overclock:{label:this.localization("CPU speed"),options:["100%","125%","150%","175%","200%"],default:"100%",netplay:!0},genesis_plus_gx_sound_output:{label:this.localization("Sound output"),options:{stereo:this.localization("stereo"),mono:this.localization("mono")},default:"stereo"}};break;case"sega32x":e={picodrive_sprlim:{label:this.localization("No sprite limit"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"}};break;case"segaSaturn":e={yabause_frameskip:{label:this.localization("Frameskip"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"}};break;case"msx":e={bluemsx_nospritelimits:{label:this.localization("No Sprite Limit"),options:{OFF:this.localization("OFF"),ON:this.localization("ON")},default:"OFF"}};break;case"ws":case"ngp":e={};break;case"jaguar":e={virtualjaguar_usefastblitter:{label:this.localization("Fast Blitter"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"},virtualjaguar_bios:{label:this.localization("Bios"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"}};break;case"psx":e={pcsx_rearmed_frameskip:{label:this.localization("Frameskip"),options:[0,1,2,3],default:0,netplay:!0},pcsx_rearmed_memcard2:{label:this.localization("Enable second memory card"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"enabled",netplay:!0},pcsx_rearmed_pad1type:{label:this.localization("Pad 1 Type"),options:{default:this.localization("default"),none:this.localization("none"),standard:this.localization("standard"),analog:this.localization("analog"),negcon:this.localization("negcon")},default:"default",netplay:!0},pcsx_rearmed_pad2type:{label:this.localization("Pad 2 Type"),options:{default:this.localization("default"),none:this.localization("none"),standard:this.localization("standard"),analog:this.localization("analog"),negcon:this.localization("negcon")},default:"default",netplay:!0},pcsx_rearmed_pad3type:{label:this.localization("Pad 3 Type"),options:{default:this.localization("default"),none:this.localization("none"),standard:this.localization("standard"),analog:this.localization("analog"),negcon:this.localization("negcon")},default:"default",netplay:!0},pcsx_rearmed_pad4type:{label:this.localization("Pad 4 Type"),options:{default:this.localization("default"),none:this.localization("none"),standard:this.localization("standard"),analog:this.localization("analog"),negcon:this.localization("negcon")},default:"default",netplay:!0},pcsx_rearmed_vibration:{label:this.localization("Enable Vibration"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"enabled",netplay:!0},pcsx_rearmed_neon_interlace_enable:{label:this.localization("Enable interlacing mode(s)"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled",netplay:!0},pcsx_rearmed_neon_enhancement_enable:{label:this.localization("Enhanced resolution (slow)"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled",netplay:!0},pcsx_rearmed_neon_enhancement_no_main:{label:this.localization("Enhanced resolution speed hack"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled",netplay:!0}};break;case"arcade":case"fba0.2.97.29":e={"fba-aspect":{label:this.localization("Aspect ratio"),options:["DAR","PAR"],default:"DAR"},"fba-frameskip":{label:this.localization("Frameskip"),options:["0","1","2","3","4","5"],default:"0",netplay:!0},"fba-cpu-speed-adjust":{label:this.localization("CPU overclock"),options:["100","110","120","130","140","150","160","170","180","190","200"],default:"100",netplay:!0},"fba-diagnostic-input":{label:this.localization("Diagnostic Input"),options:["None","Hold Start","Start + A + B","Hold Start + A + B","Start + L + R","Hold Start + L + R","Hold Select","Select + A + B","Hold Select + A + B","Select + L + R","Hold Select + L + R"],default:"None",netplay:!0},"fba-neogeo-mode":{label:this.localization("Force Neo Geo mode"),options:["MVS","AES","UNIBIOS","DIPSWITCH"],default:"MVS",netplay:!0}};break;case"mame2003":case"mame2010":case"mame":case"dos":e={};break;default:e={},console.warn("Unsupported emulator")}return 2===this.coreVer&&(e={}),!0===this.statesSupported&&(e["save-state-slot"]={label:this.localization("Save State Slot"),options:[1,2,3,4,5,6,7,8,9],default:1}),!0!==this.statesSupported||!window.indexedDB||"string"!=typeof this.gameName&&this.config.gameUrl.startsWith("blob:")||(e["save-state-location"]={label:this.localization("Save State Location"),options:{download:this.localization("download"),"keep in browser":this.localization("keep in browser")},default:"download"}),d.getGameCoreOptions&&d.getGameCoreOptions().split("\n").forEach(function(t){var s,t=t.split("; "),n=t[0];0===n.indexOf("fba-dipswitch-")&&(t=t[1].split("|"),s=n.replace(/_/g," ").replace(/.+-(.+)/,"$1"),e[n]={label:s,options:t.slice(1,-1),default:t[0].replace("(Default) ",""),netplay:!0})}),e},supportNetPlay:function(){if(this.lightgun||this.mouse)return!1;var e=window.RTCPeerConnection||window.webkitPeerConnection00||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,t=window.mozRTCIceCandidate||window.RTCIceCandidate,n=window.mozRTCSessionDescription||window.RTCSessionDescription;return!!(e&&t&&n)&&!!(e&&"createDataChannel"in e.prototype)},isNetPlay:function(){},findElements:function(){try{return this.elements.controls=u.call(this,this.config.selectors.controls.wrapper),this.elements.buttons={play:M.call(this,this.config.selectors.buttons.play),pause:u.call(this,this.config.selectors.buttons.pause),restart:u.call(this,this.config.selectors.buttons.restart),mute:u.call(this,this.config.selectors.buttons.mute),settings:u.call(this,this.config.selectors.buttons.settings),fullscreen:u.call(this,this.config.selectors.buttons.fullscreen),saveState:u.call(this,this.config.selectors.buttons.saveState),screenRecord:u.call(this,this.config.selectors.buttons.screenRecord),loadState:u.call(this,this.config.selectors.buttons.loadState),gamepad:u.call(this,this.config.selectors.buttons.gamepad),netplay:u.call(this,this.config.selectors.buttons.netplay),cheat:u.call(this,this.config.selectors.buttons.cheat)},this.elements.inputs={volume:u.call(this,this.config.selectors.inputs.volume)},!0}catch(e){return this.debug.warn("It looks like there is a problem with your custom controls HTML",e),!1}},createIcon:function(o,e){var t,s,n=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=(eu(n,_(e,{role:"presentation",focusable:"false"})),document.createElement("div"));e.innerHTML="<svg>".concat(this.icons[o],"</svg>");for(s=e.childNodes[0].childNodes,t=0;t<s.length;t+=1)n.appendChild(s[t]);return n},createLabel:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=N(e,this.config),n={};return n[t.class]=!0,n[this.config.classNames.hidden]=!0,c("span",Object.assign({},t,{class:[t.class,this.config.classNames.tooltip].filter(Boolean).join(" ")}),e)},createBadge:function(e){if(s.empty(e))return null;var t=c("span",{class:this.config.classNames.menu.value});return t.appendChild(c("span",{class:this.config.classNames.menu.badge},e)),t},createButton:function(h,e){var a,r,l,d,t=c("button"),e=Object.assign({},e),o=function(e){return(e=function(e){return e=H((0<arguments.length&&void 0!==e?e:"").toString(),"-"," "),e=H(e,"_"," "),H(function(e){return(0<arguments.length&&void 0!==e?e:"").toString().replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}(e)," ","")}(e=(0<arguments.length&&void 0!==e?e:"").toString())).charAt(0).toLowerCase()+e.slice(1)}(h),u=!1,m=("type"in e||(e.type="button"),n({ejs__control:!0}));switch("class"in e?e.class.includes(m)||(e.class+=" ".concat(m)):e.class=m,h){case"play":u=!0,r=a="play",d=l="pause";break;case"mute":u=!0,a="mute",l="unmute",r="volume",d="muted";break;case"fullscreen":u=!0,a="enterFullscreen",l="exitFullscreen",r="enter-fullscreen",d="exit-fullscreen";break;default:a=o,r=h}return u?(t.appendChild(i.createIcon.call(this,d,{class:n({"icon--pressed":!0})})),t.appendChild(i.createIcon.call(this,r,{class:n({"icon--not-pressed":!0})})),t.appendChild(i.createLabel.call(this,l,{class:n({"icon--pressed":!0})})),t.appendChild(i.createLabel.call(this,a,{class:n({"icon--not-pressed":!0})}))):(t.appendChild(i.createIcon.call(this,r)),t.appendChild(i.createLabel.call(this,a))),_(e,V(this.config.selectors.buttons[o],e)),eu(t,e),"play"===o?(s.array(this.elements.buttons[o])||(this.elements.buttons[o]=[]),this.elements.buttons[o].push(t)):this.elements.buttons[o]=t,t},createRange:function(t,e){return e=c("input",_(V(this.config.selectors.inputs[t]),{type:"range",min:0,max:100,step:.1,value:0,autocomplete:"off",role:"slider","aria-label":N(t,this.config),"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":0},e)),this.elements.inputs[t]=e,i.updateRangeFill.call(this,e),e},bindMenuItemShortcuts:function(e,n){var t=this;r(e,"keydown keyup",function(o){var a,r;[32,38,39,40].includes(o.which)&&(o.preventDefault(),o.stopPropagation(),"keydown"!==o.type)&&(!(r=ee(e,'[role="menuitemradio"]'))&&[32,39].includes(o.which)?i.showMenuPanel.call(t,n,!0):32!==o.which&&(40===o.which||r&&39===o.which?(a=e.nextElementSibling,s.element(a)||(a=e.parentNode.firstElementChild)):(a=e.previousElementSibling,s.element(a)||(a=e.parentNode.lastElementChild)),J.call(t,a,!0)))},!1),r(e,"keyup",function(e){13===e.which&&i.focusFirstMenuItem.call(t,null,!0)})},createMenuItem:function(e){var l=this,r=e.value,m=e.list,t=e.type,h=e.title,a=e.badge,a=void 0===a?null:a,e=e.checked,e=void 0!==e&&e,o=V(this.config.selectors.inputs[t]),n=c("button",_(o,{type:"button",role:"menuitemradio",class:"".concat(this.config.classNames.control," ").concat(o.class||"").trim(),"aria-checked":e,value:r})),o=c("span"),u=(o.innerHTML=h,s.element(a)&&o.appendChild(a),n.appendChild(o),Object.defineProperty(n,"checked",{enumerable:!0,get:function(){return"true"===n.getAttribute("aria-checked")},set:function(e){e&&Array.from(n.parentNode.children).filter(function(e){return ee(e,'[role="menuitemradio"]')}).forEach(function(e){return e.setAttribute("aria-checked","false")}),n.setAttribute("aria-checked",e?"true":"false")}}),i.getCoreOptions.call(this));this.listeners.bind(n,"click keyup",function(e){s.keyboardEvent(e)&&32!==e.which||(e.preventDefault(),e.stopPropagation(),n.checked=!0,Object.keys(i.normalOptions).includes(t)&&i.updateNormalOptions.call(l,t,r),Object.keys(u).includes(t)&&(u[t].netplay&&d.connected?d.connection.isInitiator&&(i.updateCoreOptions.call(l,t,r),d.connection.send(JSON.stringify({act:"update-core-option",key:t,value:r,frame:d.currentFrame}))):i.updateCoreOptions.call(l,t,r)),i.showMenuPanel.call(l,"home",s.keyboardEvent(e)))},t,!1),i.bindMenuItemShortcuts.call(this,n,t),m.appendChild(n)},updateVolume:function(){s.element(this.elements.inputs.volume)&&i.setRange.call(this,this.elements.inputs.volume,this.muted?0:this.volume),s.element(this.elements.buttons.mute)&&(this.elements.buttons.mute.pressed=this.muted||0===this.volume)},setRange:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;s.element(e)&&(e.value=t,i.updateRangeFill.call(this,e))},updateRangeFill:function(e){var t,e=s.event(e)?e.target:e;s.element(e)&&"range"===e.getAttribute("type")&&(ee(e,this.config.selectors.inputs.volume)?(t=100*e.value,e.setAttribute("aria-valuenow",t),e.setAttribute("aria-valuetext","".concat(t.toFixed(1),"%"))):e.setAttribute("aria-valuenow",e.value),y.isWebkit&&e.style.setProperty("--value","".concat(e.value/e.max*100,"%")))},toggleMenuButton:function(e,t){a(this.elements.settings.buttons[e],!t)},updateNormalOptions:function(e,t){this.elements.settings.buttons[e].querySelector(".".concat(this.config.classNames.menu.value)).innerHTML=i.normalOptions[e].options[t];var n={};n[e]=t,i.storage.set(n),"shader"===e&&d.setShader(t),"virtual-gamepad"===e&&d.toggleVirtualGamepad.call(this,"enabled"===t)},updateCoreOptions:function(e,t){if("nds"==this.system&&!w.wasm)return!0;if(i.coreOptionsValues[e]=t,"psx"===this.system&&o.Module.pauseMainLoop(),d.setVariable(e,t),"psx"===this.system&&(setTimeout(function(){o.Module.resumeMainLoop()},100),setTimeout(function(){o.Module.resumeMainLoop()},200)),"nds"===this.system&&w.wasm&&(n=this.elements.wrapper.querySelector("canvas"),"screen_rotation"===e))switch(n.style.transform="rotate("+t+"deg)",t){case"0":d.setVariable("desmume_input_rotation","0");break;case"90":d.setVariable("desmume_input_rotation","270");break;case"180":d.setVariable("desmume_input_rotation","180");break;case"270":d.setVariable("desmume_input_rotation","90")}"arcade"!==this.system&&"fba0.2.97.29"!==this.system||((n=this.elements.wrapper.querySelector("canvas")).height="fba-aspect"===e&&"PAR"===t?n.width/16*9:n.width/4*3);var n=i.getCoreOptions.call(this),a=i.storage.get("core-options");(a=s.empty(a)?{}:a)[e]=t,i.storage.set({"core-options":a}),this.elements.settings.buttons[e]&&(a=this.elements.settings.buttons[e].querySelector(".".concat(this.config.classNames.menu.value)),s.object(n[e].options)?a.innerHTML=n[e].options[t]:a.innerHTML=t)},setOptionMenuItem:function(e,o){var t=this,a=this.elements.settings.panels.home.querySelector('[role="menu"]'),l=this.elements.settings.popup.children[0];Object.keys(e).forEach(function(u){d=u,p=c("button",_(V(t.config.selectors.buttons.settings),{type:"button",class:n({ejs__control:!0,"ejs__control--forward":!0}),role:"menuitem",item:u,"aria-haspopup":!0})),r(p,"click",function(){i.showMenuPanel.call(t,d,!1)});var d,m,p,b,f=c("span",null,e[u].label),h=c("span",{class:t.config.classNames.menu.value}),h=(s.object(o)&&(m=o[d]),s.empty(m)&&(m=e[d].default),s.object(e[d].options)?h.innerHTML=e[d].options[m]:h.innerHTML=m,f.appendChild(h),p.appendChild(f),a.appendChild(p),c("div",{"data-pane":escape(d),hidden:""})),f=c("button",{type:"button",class:n({ejs__control:!0,"ejs__control--back":!0})}),v=(f.appendChild(c("span",{"aria-hidden":!0},e[u].label)),f.appendChild(c("span",{class:n({"ejs__sr-only":!0})},N("menuBack",t.config))),r(h,"keydown",function(e){37===e.which&&(e.preventDefault(),e.stopPropagation(),i.showMenuPanel.call(t,"home",!0))},!1),r(f,"click",function(){i.showMenuPanel.call(t,"home",!1)}),h.appendChild(f),h.appendChild(c("div",{role:"menu"})),l.appendChild(h),t.elements.settings.buttons[d]=p,(t.elements.settings.panels[d]=h).querySelector('[role="menu"]')),g=v;if(s.element(g))for(b=g.childNodes.length;0<b;)g.removeChild(g.lastChild),--b;s.object(e[u].options)?Object.keys(e[u].options).forEach(function(n){i.createMenuItem.call(t,{value:n,list:v,type:d,title:e[u].options[n],badge:null,checked:Boolean(m===n)})}):s.array(e[u].options)&&e[u].options.forEach(function(e){i.createMenuItem.call(t,{value:e,list:v,type:d,title:e,badge:null,checked:Boolean(m===e)})})})},setNormalOptionsMenu:function(){var n=this,e=this,t={};t.orientation=i.storage.get("orientation"),t.shader=i.storage.get("shader"),e.touch?(t["virtual-gamepad"]=i.storage.get("virtual-gamepad"),r.call(e,e.elements.container,"start-game",function(){"enabled"!==t["virtual-gamepad"]&&!s.empty(t["virtual-gamepad"])||d.toggleVirtualGamepad.call(e,!0)})):delete i.normalOptions["virtual-gamepad"],i.setOptionMenuItem.call(this,i.normalOptions,t),r.call(e,e.elements.container,"start-game",function(){var s=n,t={},a=(d.getGameCoreOptions&&d.getGameCoreOptions().split("\n").forEach(function(e){var s,e=e.split("; "),n=e[0];0===n.indexOf("fba-dipswitch-")&&(e=e[1].split("|"),s=n.replace(/_/g," ").replace(/.+-(.+)/,"$1"),t[n]={label:s,options:e.slice(1,-1),default:e[0].replace("(Default) ",""),netplay:!0})}),i.storage.get("core-options"));i.coreOptionsValues=a||{},i.setOptionMenuItem.call(e,t,i.coreOptionsValues),Object.keys(i.coreOptionsValues).forEach(function(e){i.updateCoreOptions.call(s,e,i.coreOptionsValues[e])}),"nds"==e.system&&(o.Module._fast_forward_2?o.Module._fast_forward_2(1):o.Module._fast_forward&&o.Module._fast_forward(1))})},updateCoreOptionMenuItems:function(){var t=this.elements.settings.panels.home.querySelector('[role="menu"]'),e=i.getCoreOptions.call(this);d.connected&&!d.connection.isInitiator?Object.keys(e).forEach(function(n){e[n].netplay&&t.querySelector('[item="'.concat(n,'"]')).setAttribute("disabled","")}):Object.keys(e).forEach(function(e){t.querySelector('[item="'.concat(e,'"]')).removeAttribute("disabled")})},setCoreOptionsMenu:function(){this.elements.settings.panels.home.querySelector('[role="menu"]'),this.elements.settings.popup.children[0];var t=i.getCoreOptions.call(this),e=i.storage.get("core-options");i.coreOptionsValues=e||{},i.setOptionMenuItem.call(this,t,e)},checkMenu:function(){var e=this.elements.settings.buttons;s.empty(e)||Object.values(e).some(function(e){return!e.hidden}),a(this.elements.settings.menu,!1)},focusFirstMenuItem:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];this.elements.settings.popup.hidden||(e=(e=s.element(e=e)?e:Object.values(this.elements.settings.panels).find(function(e){return!e.hidden})).querySelector('[role^="menuitem"]'),J.call(this,e,t))},toggleMenu:function(e){var t,r,c,n=this.elements.settings.popup,o=this.elements.buttons.settings;if(s.element(n)&&s.element(o)){if(r=n.hidden,t=r,s.boolean(e))t=e;else if(s.keyboardEvent(e)&&27===e.which)t=!1;else if(s.event(e)&&(c=n.contains(e.target),c||!c&&e.target!==o&&t))return;o.setAttribute("aria-expanded",t),a(n,!t),h(this.elements.container,this.config.classNames.menu.open,t),t&&s.keyboardEvent(e)?i.focusFirstMenuItem.call(this,null,!0):t||r||J.call(this,o,s.keyboardEvent(e))}},getMenuSize:function(t){var e=t.cloneNode(!0),t=(e.style.position="absolute",e.style.opacity=0,e.removeAttribute("hidden"),t.parentNode.appendChild(e),e.scrollWidth),n=e.scrollHeight;return e9(e),{width:t,height:n}},showLoadStatePanel:function(){},showMenuPanel:function(){var e,n,o,c=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",l=1<arguments.length&&void 0!==arguments[1]&&arguments[1],t=u.call(this,'[data-pane="'.concat(escape(t),'"]'));s.element(t)&&(e=t.parentNode,n=Array.from(e.children).find(function(e){return!e.hidden}),w.transitions&&!w.reducedMotion&&(e.style.width="".concat(n.scrollWidth,"px"),e.style.height="".concat(n.scrollHeight,"px"),o=i.getMenuSize.call(this,t),r.call(this,e,q,function n(t){t.target===e&&["width","height"].includes(t.propertyName)&&(e.style.width="",e.style.height="",eo.call(c,e,q,n))}),e.style.width="".concat(o.width,"px"),e.style.height="".concat(o.height,"px")),a(n,!0),a(t,!1),i.focusFirstMenuItem.call(this,t,l))},setLoadState:function(e){e.appendChild(i.createButton.call(this,"load-state",{"aria-haspopup":!0,"aria-expanded":!1}));var e=c("div",{class:n({ejs__dialog:!0,"ejs__load-state__container":!0}),hidden:""}),t=c("div");e.appendChild(t),u.call(this,".".concat(n({ejs__dialogs:!0}))).appendChild(e),this.elements.dialogs.loadState=e},setScreenRecord:function(e){var t;window.MediaRecorder&&(t=i.createButton.call(this,"screen-record",{"aria-haspopup":!0,"aria-expanded":!1,style:"margin-right:auto;"}),e.appendChild(t),e=c("div",{class:n({ejs__dialog:!0,ejs__screenRecord__container:!0}),hidden:""}),t=c("div"),e.appendChild(t),u.call(this,".".concat(n({ejs__dialogs:!0}))).appendChild(e),this.elements.dialogs.screenRecord=e)},setGamepad:function(e){var t=i.createButton.call(this,"gamepad",{"aria-haspopup":!0,"aria-expanded":!1,style:"margin-right:auto;"}),e=(e.appendChild(t),c("div",{class:n({ejs__dialog:!0,ejs__gamepad__container:!0}),hidden:""})),t=c("div");e.appendChild(t),u.call(this,".".concat(n({ejs__dialogs:!0}))).appendChild(e),this.elements.dialogs.gamepad=e},setCheat:function(e){var t=i.createButton.call(this,"cheat",{"aria-haspopup":!0,"aria-expanded":!1,style:"margin-right:auto;"}),e=(e.appendChild(t),c("div",{class:n({ejs__dialog:!0,ejs__cheat__container:!0}),hidden:""})),t=c("div");e.appendChild(t),u.call(this,".".concat(n({ejs__dialogs:!0}))).appendChild(e),this.elements.dialogs.cheat=e},setStateInfoBarWidget:function(){var e=c("div",{class:n({ejs__widget:!0})}),t=c("div");t.style="color: red;font-size: 17px;padding:10px;text-align:left;text-shadow:1px 1px 1px #000",e.appendChild(t),u.call(this,".".concat(n({ejs__widgets:!0}))).appendChild(e),this.elements.widgets.stateInfo=e,this.elements.widgets.stateInfoDiv=t},setNetplayWidgets:function(){var e=c("div",{class:n({ejs__widget:!0,ejs__widget_netplay:!0})}),t=c("div");e.appendChild(t),u.call(this,".".concat(n({ejs__widgets:!0}))).appendChild(e),this.elements.widgets.netplay=e},setNetplay:function(e){e.appendChild(i.createButton.call(this,"netplay",{"aria-haspopup":!0,"aria-expanded":!1}));var e=c("div",{class:n({ejs__dialog:!0,ejs__netplay__container:!0}),hidden:""}),t=c("div");e.appendChild(t),u.call(this,".".concat(n({ejs__dialogs:!0}))).appendChild(e),this.elements.dialogs.netplay=e,i.setNetplayWidgets.call(this)},toggleContextMenu:function(s,o){var e,t;Q(s.target,n({ejs__dialogs:!0}))&&(e=i.contextMenu.timer,this.started&&(t=u.call(this,".".concat(n({ejs__contextmenu:!0})," ul")),o?(i.contextMenu.style.display="block",i.contextMenu.style.left="".concat(s.layerX,"px"),i.contextMenu.style.top="".concat(s.layerY,"px"),M.call(this,".".concat(n({ejs__contextmenu:!0})," ul li")),null===t.getAttribute("menu")&&((o=c("li",{})).appendChild(c("a",{target:"_blank",href:"https://github.com/ethanaobrien/emulatorjs"},"EmulatorJS v".concat(this.version))),t.appendChild(o),t.setAttribute("menu","")),e&&clearTimeout(e),e=setTimeout(function(){},4e3),i.contextMenu.timer=e):i.contextMenu.style.display="none"))},create:function(d){var h=this,t=(i.storage=new ed(this,"ejs_".concat(this.system,"_settings")),c("div",V(this.config.selectors.controls.wrapper))),f=(i.contextMenu=c("div",{class:n({ejs__contextmenu:!0}),style:"position: absolute; display:none;z-index:9"}),["<ul>","</ul>"]),v=[];function p(t,n,e){"function"==typeof e?v.push(e):v.push(function(){}),e=f.length-1,n?f.splice(e,0,'<li hidden><a href="#" onclick="return false">'+t+"</a></li>"):f.splice(e,0,'<li><a href="#" onclick="return false">'+t+"</a></li>")}p(h.localization("Take Screenshot"),!1,function(){var n=e.getScreenData(),t=(t="string"==typeof h.gameName?h.gameName:t)?"".concat(t,"-screenshot.png"):"game.png";return e8()(new Blob([n]),t),!1}),p(h.localization("Cache Manage"),!0,function(){var t;return o.romdb&&(a(h.elements.dialogs.cache,!1),(t=h.elements.dialogs.cache.querySelector(".".concat(e.classNames["dialog-content"]))).innerHTML="<div>"+h.localization("Loading")+"</div>",o.romdb.getAll(function(n){var e,s;n?(s=c("table",{style:"width:100%;padding-left:10px;text-align:left"}),e=c("tbody"),0<n.length?(t.innerHTML="",n.forEach(function(t){if(t.key&&!/-part-\d+$/.test(t.key)){for(var d=Math.ceil(t.filesize/104857600),r=[t.key],i=1;i<d;i+=1)r.push("".concat(t.key,"-part-").concat(i));var n=c("tr"),l=c("td"),a=c("td"),s=c("td");l.innerHTML=t.filename,a.innerHTML=function(e){for(var t=-1;t++,1024<(e/=1024););return Math.max(e,.1).toFixed(1)+[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"][t]}(t.filesize),s.innerHTML='<a href="#" onclick="return false">Remove</a>',n.appendChild(l),n.appendChild(a),n.appendChild(s),e.appendChild(n),s.querySelector("a").onclick=function(t){o.romdb.removeBatch(r);try{e.removeChild(n)}catch(e){}return t.stopPropagation(),!1}}}),s.appendChild(e),t.appendChild(s)):t.innerHTML='<div style="text-align:center">'+h.localization("Empty")+"</div>"):t.innerHTML='<div style="text-align:center">'+h.localization("Empty")+"</div>"},function(){})),!1}),p(h.localization("Quick Save")+" (F2)",!1,function(){e.quickSaveState(),l.contextMenu.style.display="none"}),p(h.localization("Quick Load")+" (F4)",!1,function(){e.quickLoadState(),l.contextMenu.style.display="none"}),i.contextMenu.innerHTML=f.join("");for(g=i.contextMenu.getElementsByTagName("li"),m=0;m<g.length;m++)r.call(h,g[m],"click",v[m]);this.elements.container.appendChild(i.contextMenu);var m,g,s=c("div",{class:n({ejs__dialog:!0,ejs__cache__container:!0}),hidden:""}),s=(u.call(this,".".concat(n({ejs__dialogs:!0}))).appendChild(s),this.elements.dialogs.cache=s,c("div",{class:n({ejs__dialog:!0,ejs__loading__container:!0}),hidden:""})),s=(u.call(this,".".concat(n({ejs__dialogs:!0}))).appendChild(s),this.elements.dialogs.loading=s,t.appendChild(i.createButton.call(this,"restart")),t.appendChild(i.createButton.call(this,"play")),t.appendChild(i.createButton.call(this,"save-state",{"aria-expanded":!1})),i.setLoadState.call(this,t,d),i.setScreenRecord.call(this,t,d),i.supportNetPlay.call(this,t)&&0<parseInt(this.config.gameId,10)&&i.setNetplay.call(this,t,d),i.setGamepad.call(this,t,d),i.setStateInfoBarWidget.call(this,t,d),i.setCheat.call(this,t,d),t.appendChild(c("span",{style:"flex:1"})),c("div",{class:n({ejs__volume:!0})})),d=(s.appendChild(i.createButton.call(this,"mute")),{max:1,step:.01,value:this.config.volume}),d=(s.appendChild(i.createRange.call(this,"volume",_(d,{}))),this.elements.volume=s,t.appendChild(s),c("div",{class:n({ejs__menu:!0})})),s=(d.appendChild(i.createButton.call(this,"settings",{"aria-haspopup":!0,"aria-expanded":!1})),c("div",{class:n({ejs__menu__container:!0}),hidden:""})),j=c("div"),b=c("div",{"data-pane":"home"}),y=c("div",{role:"menu"}),w=(b.appendChild(y),j.appendChild(b),this.elements.settings.panels.home=b,s.appendChild(j),d.appendChild(s),t.appendChild(d),this.elements.settings.popup=s,this.elements.settings.menu=d,t.appendChild(i.createButton.call(this,"fullscreen")),this);return t.addEventListener("mousedown",function(){w.onButtonDiv=!0}),this.elements.controls=t,i.setNormalOptionsMenu.call(this),i.setCoreOptionsMenu.call(this),t},inject:function(){var t,n,c=this,e=(this.icons={"enter-fullscreen":'<path d="M10 3h3.6l-4 4L11 8.4l4-4V8h2V1h-7zM7 9.6l-4 4V10H1v7h7v-2H4.4l4-4z"/>',"exit-fullscreen":'<path d="M1 12h3.6l-4 4L2 17.4l4-4V17h2v-7H1zM16 .6l-4 4V1h-2v7h7V6h-3.6l4-4z"/>',gamepad:'<svg viewBox="0 0 640 512"><path fill="currentColor" d="M480 96H160C71.6 96 0 167.6 0 256s71.6 160 160 160c44.8 0 85.2-18.4 114.2-48h91.5c29 29.6 69.5 48 114.2 48 88.4 0 160-71.6 160-160S568.4 96 480 96zM256 276c0 6.6-5.4 12-12 12h-52v52c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-52H76c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h52v-52c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h52c6.6 0 12 5.4 12 12v40zm184 68c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm80-80c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48z"/></svg>',"load-state":'<svg viewBox="0 0 576 512"><path fill="currentColor" d="M572.694 292.093L500.27 416.248A63.997 63.997 0 0 1 444.989 448H45.025c-18.523 0-30.064-20.093-20.731-36.093l72.424-124.155A64 64 0 0 1 152 256h399.964c18.523 0 30.064 20.093 20.73 36.093zM152 224h328v-48c0-26.51-21.49-48-48-48H272l-64-64H48C21.49 64 0 85.49 0 112v278.046l69.077-118.418C86.214 242.25 117.989 224 152 224z"/></svg>',muted:'<path d="M12.4 12.5l2.1-2.1 2.1 2.1 1.4-1.4L15.9 9 18 6.9l-1.4-1.4-2.1 2.1-2.1-2.1L11 6.9 13.1 9 11 11.1zM3.786 6.008H.714C.286 6.008 0 6.31 0 6.76v4.512c0 .452.286.752.714.752h3.072l4.071 3.858c.5.3 1.143 0 1.143-.602V2.752c0-.601-.643-.977-1.143-.601L3.786 6.008z"/>',netplay:'<svg viewBox="0 0 512 512"><path fill="currentColor" d="M364.215 192h131.43c5.439 20.419 8.354 41.868 8.354 64s-2.915 43.581-8.354 64h-131.43c5.154-43.049 4.939-86.746 0-128zM185.214 352c10.678 53.68 33.173 112.514 70.125 151.992.221.001.44.008.661.008s.44-.008.661-.008c37.012-39.543 59.467-98.414 70.125-151.992H185.214zm174.13-192h125.385C452.802 84.024 384.128 27.305 300.95 12.075c30.238 43.12 48.821 96.332 58.394 147.925zm-27.35 32H180.006c-5.339 41.914-5.345 86.037 0 128h151.989c5.339-41.915 5.345-86.037-.001-128zM152.656 352H27.271c31.926 75.976 100.6 132.695 183.778 147.925-30.246-43.136-48.823-96.35-58.393-147.925zm206.688 0c-9.575 51.605-28.163 104.814-58.394 147.925 83.178-15.23 151.852-71.949 183.778-147.925H359.344zm-32.558-192c-10.678-53.68-33.174-112.514-70.125-151.992-.221 0-.44-.008-.661-.008s-.44.008-.661.008C218.327 47.551 195.872 106.422 185.214 160h141.572zM16.355 192C10.915 212.419 8 233.868 8 256s2.915 43.581 8.355 64h131.43c-4.939-41.254-5.154-84.951 0-128H16.355zm136.301-32c9.575-51.602 28.161-104.81 58.394-147.925C127.872 27.305 59.198 84.024 27.271 160h125.385z"/></svg>',pause:'<path d="M6 1H3c-.6 0-1 .4-1 1v14c0 .6.4 1 1 1h3c.6 0 1-.4 1-1V2c0-.6-.4-1-1-1zM12 1c-.6 0-1 .4-1 1v14c0 .6.4 1 1 1h3c.6 0 1-.4 1-1V2c0-.6-.4-1-1-1h-3z"/>',play:'<path d="M15.562 8.1L3.87.225C3.052-.337 2 .225 2 1.125v15.75c0 .9 1.052 1.462 1.87.9L15.563 9.9c.584-.45.584-1.35 0-1.8z"/>',restart:'<path d="M9.7 1.2l.7 6.4 2.1-2.1c1.9 1.9 1.9 5.1 0 7-.9 1-2.2 1.5-3.5 1.5-1.3 0-2.6-.5-3.5-1.5-1.9-1.9-1.9-5.1 0-7 .6-.6 1.4-1.1 2.3-1.3l-.6-1.9C6 2.6 4.9 3.2 4 4.1 1.3 6.8 1.3 11.2 4 14c1.3 1.3 3.1 2 4.9 2 1.9 0 3.6-.7 4.9-2 2.7-2.7 2.7-7.1 0-9.9L16 1.9l-6.3-.7z"/>',"save-state":'<svg viewBox="0 0 448 512"><path fill="currentColor" d="M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"/></svg>',"screen-record":'<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px",viewBox="0 0 39.989 39.989" style="enable-background:new 0 0 39.989 39.989;" xml:space="preserve"><path id="XMLID_155_" d="M19.994,0C8.952,0,0,8.952,0,19.995c0,11.043,8.952,19.994,19.994,19.994s19.995-8.952,19.995-19.994,C39.989,8.952,31.037,0,19.994,0z M19.994,27.745c-4.28,0-7.75-3.47-7.75-7.75s3.47-7.75,7.75-7.75s7.75,3.47,7.75,7.75,S24.275,27.745,19.994,27.745z"/></svg>',settings:'<path d="M16.135 7.784a2 2 0 0 1-1.23-2.969c.322-.536.225-.998-.094-1.316l-.31-.31c-.318-.318-.78-.415-1.316-.094a2 2 0 0 1-2.969-1.23C10.065 1.258 9.669 1 9.219 1h-.438c-.45 0-.845.258-.997.865a2 2 0 0 1-2.969 1.23c-.536-.322-.999-.225-1.317.093l-.31.31c-.318.318-.415.781-.093 1.317a2 2 0 0 1-1.23 2.969C1.26 7.935 1 8.33 1 8.781v.438c0 .45.258.845.865.997a2 2 0 0 1 1.23 2.969c-.322.536-.225.998.094 1.316l.31.31c.319.319.782.415 1.316.094a2 2 0 0 1 2.969 1.23c.151.607.547.865.997.865h.438c.45 0 .845-.258.997-.865a2 2 0 0 1 2.969-1.23c.535.321.997.225 1.316-.094l.31-.31c.318-.318.415-.781.094-1.316a2 2 0 0 1 1.23-2.969c.607-.151.865-.547.865-.997v-.438c0-.451-.26-.846-.865-.997zM9 12a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>',volume:'<path d="M15.5999996,3.3 C15.1999996,2.9 14.5999996,2.9 14.1999996,3.3 C13.7999996,3.7 13.7999996,4.3 14.1999996,4.7 C15.3999996,5.9 15.9999996,7.4 15.9999996,9 C15.9999996,10.6 15.3999996,12.1 14.1999996,13.3 C13.7999996,13.7 13.7999996,14.3 14.1999996,14.7 C14.3999996,14.9 14.6999996,15 14.8999996,15 C15.1999996,15 15.3999996,14.9 15.5999996,14.7 C17.0999996,13.2 17.9999996,11.2 17.9999996,9 C17.9999996,6.8 17.0999996,4.8 15.5999996,3.3 L15.5999996,3.3 Z"></path>\n            <path d="M11.2819745,5.28197449 C10.9060085,5.65794047 10.9060085,6.22188944 11.2819745,6.59785542 C12.0171538,7.33303477 12.2772954,8.05605449 12.2772954,9.00000021 C12.2772954,9.93588462 11.851678,10.9172014 11.2819745,11.4869049 C10.9060085,11.8628709 10.9060085,12.4268199 11.2819745,12.8027859 C11.4271642,12.9479755 11.9176724,13.0649528 12.2998149,12.9592565 C12.4124479,12.9281035 12.5156669,12.8776063 12.5978555,12.8027859 C13.773371,11.732654 14.1311161,10.1597914 14.1312523,9.00000021 C14.1312723,8.8299555 14.1286311,8.66015647 14.119665,8.4897429 C14.0674781,7.49784946 13.8010171,6.48513613 12.5978554,5.28197449 C12.2218894,4.9060085 11.6579405,4.9060085 11.2819745,5.28197449 Z"></path>\n            <path d="M3.78571429,6.00820648 L0.714285714,6.00820648 C0.285714286,6.00820648 0,6.30901277 0,6.76022222 L0,11.2723167 C0,11.7235261 0.285714286,12.0243324 0.714285714,12.0243324 L3.78571429,12.0243324 L7.85714286,15.8819922 C8.35714286,16.1827985 9,15.8819922 9,15.2803796 L9,2.75215925 C9,2.15054666 8.35714286,1.77453879 7.85714286,2.15054666 L3.78571429,6.00820648 Z"></path>',cheat:'<svg viewBox="0 0 496 512"><path fill="currentColor" d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm-80-216c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm4 72.6c-20.8 25-51.5 39.4-84 39.4s-63.2-14.3-84-39.4c-8.5-10.2-23.7-11.5-33.8-3.1-10.2 8.5-11.5 23.6-3.1 33.8 30 36 74.1 56.6 120.9 56.6s90.9-20.6 120.9-56.6c8.5-10.2 7.1-25.3-3.1-33.8-10.1-8.4-25.3-7.1-33.8 3.1z" class=""></path></svg>'},this.id=Math.floor(1e4*Math.random()),null),r=(this.elements.controls=null,{id:this.id}),o=!0;s.function(this.config.controls)&&(this.config.controls=this.config.controls.call(this.props)),this.config.controls||(this.config.controls=[]),s.element(this.config.controls)||s.string(this.config.controls)?e=this.config.controls:(e=i.create.call(this,{id:this.id,seektime:this.config.seekTime,speed:this.speed,quality:this.quality}),o=!1);function a(t){var e=t;return Object.entries(r).forEach(function(t){var n=2,t=function(e){if(Array.isArray(e))return e}(t=t)||function(r,a){var e,s,t=[],n=!0,o=!1,i=void 0;try{for(e=r[Symbol.iterator]();!(n=(s=e.next()).done)&&(t.push(s.value),!a||t.length!==a);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==e.return||e.return()}finally{if(o)throw i}}return t}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}(),n=t[0],t=t[1];e=H(e,"{".concat(n,"}"),t)}),e}o&&(s.string(this.config.controls)?e=a(e):s.element(e)&&(e.innerHTML=a(e.innerHTML))),s.string(this.config.selectors.controls.container)&&(t=document.querySelector(this.config.selectors.controls.container)),(t=s.element(t)?t:this.elements.container)[s.element(e)?"insertAdjacentElement":"insertAdjacentHTML"]("afterbegin",e),s.element(this.elements.controls)||i.findElements.call(this),s.empty(this.elements.buttons)||(n=function(e){var t=c.config.classNames.controlPressed;Object.defineProperty(e,"pressed",{enumerable:!0,get:function(){return Q(e,t)},set:function(){h(e,t,0<arguments.length&&void 0!==arguments[0]&&arguments[0])}})},Object.values(this.elements.buttons).filter(Boolean).forEach(function(e){s.array(e)||s.nodeList(e)?Array.from(e).filter(Boolean).forEach(n):n(e)})),window.navigator.userAgent.includes("Edge")&&eA(t)}},l=i;function eb(s,n){for(var e,t=0;t<n.length;t++)e=n[t],e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(s,e.key,e)}function ev(){var e;this.enabled&&(e=this.player.elements.buttons.fullscreen,s.element(e)&&(e.pressed=this.active),p.call(this.player,this.target,this.active?"enterfullscreen":"exitfullscreen",!0),y.isIos||function(){var t,n,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,o=1<arguments.length&&void 0!==arguments[1]&&arguments[1];s.element(e)&&(e=M.call(this,"button:not(:disabled), input:not(:disabled), [tabindex]"),t=e[0],n=e[e.length-1],R.call(this,this.elements.container,"keydown",function(e){var s;"Tab"===e.key&&9===e.keyCode&&((s=document.activeElement)!==n||e.shiftKey?s===t&&e.shiftKey&&(n.focus(),e.preventDefault()):(t.focus(),e.preventDefault()))},o,!1))}.call(this.player,this.target,this.active))}function eg(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];e?this.scrollPosition={x:window.scrollX||0,y:window.scrollY||0}:window.scrollTo(this.scrollPosition.x,this.scrollPosition.y),document.body.style.overflow=e?"hidden":"",h(this.target,this.player.config.classNames.fullscreen.fallback,e),ev.call(this)}j=[{key:"native",get:function(){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)}},{key:"prefix",get:function(){if(s.function(document.exitFullscreen))return"";var e="";return["webkit","moz","ms"].some(function(t){return!(!s.function(document["".concat(t,"ExitFullscreen")])&&!s.function(document["".concat(t,"CancelFullScreen")])||(e=t,0))}),e}},{key:"property",get:function(){return"moz"===this.prefix?"FullScreen":"Fullscreen"}}],eb((g=k).prototype,[{key:"update",value:function(){this.enabled,h(this.player.elements.container,this.player.config.classNames.fullscreen.enabled,this.enabled)}},{key:"enter",value:function(){this.enabled&&(k.native?this.prefix?s.empty(this.prefix)||this.target["".concat(this.prefix,"Request").concat(this.property)]():this.target.requestFullscreen():eg.call(this,!0))}},{key:"exit",value:function(){var e;this.enabled&&(k.native?this.prefix?s.empty(this.prefix)||(e="moz"===this.prefix?"Cancel":"Exit",document["".concat(this.prefix).concat(e).concat(this.property)]()):(document.cancelFullScreen||document.exitFullscreen).call(document):eg.call(this,!1))}},{key:"toggle",value:function(){this.active?this.exit():this.enter()}},{key:"enabled",get:function(){return k.native}},{key:"active",get:function(){return!!this.enabled&&(k.native?(this.prefix?document["".concat(this.prefix).concat(this.property,"Element")]:document.fullscreenElement)===this.target:Q(this.target,this.player.config.classNames.fullscreen.fallback))}},{key:"target",get:function(){return y.isEdge?this.player.game:this.player.elements.container}}]),eb(g,j),ep=k;function k(e){var t=this;if(!(this instanceof k))throw new TypeError("Cannot call a class as a function");this.player=e,this.prefix=k.prefix,this.property=k.property,this.scrollPosition={x:0,y:0},r.call(this.player,document,"ms"===this.prefix?"MSFullscreenChange":"".concat(this.prefix,"fullscreenchange"),function(){ev.call(t)}),this.update()}el.prototype={toggleMenu:function(e){l.toggleMenu.call(this.emulator,e)},firstTouch:function(){var e=this.emulator,t=e.elements;e.touch=!0,h(t.container,e.config.classNames.isTouch,!0)},setTabFocus:function(e){var t=this.emulator,s=t.elements,n=t;clearTimeout(this.focusTimer),"keydown"===e.type&&9!==e.which||("keydown"===e.type&&(this.lastKeyDown=e.timeStamp),t=e.timeStamp-this.lastKeyDown<=20,"focus"===e.type&&!t||(e=n.config.classNames.tabFocus,h(M.call(n,".".concat(e)),e,!1),this.focusTimer=setTimeout(function(){var e=document.activeElement;s.container.contains(e)&&h(document.activeElement,n.config.classNames.tabFocus,!0)},10)))},global:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],e=this.emulator;R.call(e,document.body,"click",this.toggleMenu,t),es.call(e,document.body,"touchstart",this.firstTouch),R.call(e,document.body,"keydown focus blur",this.setTabFocus,t,!1,!0),r.call(e,document.body,"keyup",function(t){e.started&&(113===t.which&&(t.shiftKey?null===e.elements.buttons.saveState.getAttribute("hidden")&&p.call(e,e.elements.buttons.saveState,"click"):d.quickSaveState()),115===t.which&&(t.shiftKey?null===e.elements.buttons.loadState.getAttribute("hidden")&&p.call(e,e.elements.buttons.loadState,"click"):d.quickLoadState()),120===t.which&&p.call(e,e.elements.buttons.mute,"click"))})},container:function(){var s,i=this.emulator,a=i.elements,e=i,t=null;r.call(e,a.container,"mousemove mouseleave touchstart touchmove enterfullscreen exitfullscreen start-game",function(n){var t=a.controls;if(t&&"enterfullscreen"===n.type&&(t.pressed=!1,t.hover=!1),["touchstart","touchmove","mousemove","start-game"].includes(n.type)){if("nds"==i.system&&"mousemove"==n.type&&o&&o.Module&&o.Module.canvas&&(document.pointerLockElement===o.Module.canvas||document.mozPointerLockElement===o.Module.canvas))return void x.toggleControls.call(e,!1);!d||"undefined"!=d.virtualGamepadContainer&&null!==d.virtualGamepadContainer||(x.toggleControls.call(e,!0),t=e.touch?3e3:2e3,clearTimeout(s),s=setTimeout(function(){return x.toggleControls.call(e,!1)},t),a.controls.setAttribute("data-timer",s))}}),r.call(e,window,"resize",function(){var t=e.elements.container.clientHeight,s=M.call(e,".".concat(n({ejs__menu__container:!0}),' [role="menu"]'));Array.from(s).forEach(function(e){e.style.maxHeight="".concat(t-95,"px"),e.style.overflow="auto"}),o.Module&&o.Module.canvas,e.elements.container.clientWidth/e.elements.container.clientHeight<1.3?h(e.elements.container,n({portrait:!0}),!0):h(e.elements.container,n({portrait:!0}),!1)}),p.call(e,window,"resize"),r.call(e,e.elements.container,"enterfullscreen",function(){if(o.isMobileDevice&&window.screen&&screen.orientation&&"function"==typeof screen.orientation.lock)try{screen.orientation.lock("landscape")}catch(e){}else if(o.isMobileDevice&&window.ScreenOrientation&&"function"==typeof ScreenOrientation.lock)try{ScreenOrientation.lock("landscape")}catch(e){}var n;2===e.coreVer&&o.Module&&(n=50,clearInterval(t),t=setInterval(function(){o.Module.setCanvasSize(window.innerWidth,window.innerHeight),n<0&&clearInterval(t),n--},100)),setTimeout(function(){p.call(e,window,"resize")},300)}),r.call(e,e.elements.container,"exitfullscreen",function(){if(o.isMobileDevice&&window.screen&&screen.orientation&&"function"==typeof screen.orientation.unlock)try{screen.orientation.unlock()}catch(e){}else if(o.isMobileDevice&&window.ScreenOrientation&&"function"==typeof ScreenOrientation.unlock)try{ScreenOrientation.unlock()}catch(e){}2===e.coreVer&&o.Module&&(clearInterval(t),o.Module.setCanvasSize(800,600)),setTimeout(function(){p.call(e,window,"resize")},300)}),r.call(e,e.elements.container,"start-game",function(){var t=window.document.createEvent("UIEvents");t.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(t),h(e.elements.container,n({"game-started":!0}),!0)}),r.call(e,e.elements.container,"blur",function(t){var n=t.currentTarget;setTimeout(function(){n.contains(document.activeElement)||p.call(e,e.elements,"blurgame")},0)}),r.call(e,e.elements.container,"focus",function(t){var n=t.currentTarget;setTimeout(function(){n.contains(document.activeElement)&&p.call(e,e.elements,"focusgame")},0)})},media:function(){var t=this.emulator,n=t.elements,e=t,s=(r.call(e,e.game,"volumechange",function(t){return l.updateVolume.call(e,t)}),r.call(e,n.container,"contextmenu",function(t){e.touch||e.lightgun||l.toggleContextMenu.call(e,t,!0),t.preventDefault()},!1),r.call(e,n.container,"mousewheel",function(e){e.stopPropagation()},!1),r.call(e,n.container,"mousedown",function(n){"nds"==t.system&&o&&o.Module&&o.Module.canvas&&!o.isMobileDevice&&document.pointerLockElement!==o.Module.canvas&&document.mozPointerLockElement!==o.Module.canvas&&t.started&&!t.connected&&setTimeout(function(){!0!==t.onButtonDiv&&(o.Module.canvas.requestPointerLock=o.Module.canvas.requestPointerLock||o.Module.canvas.mozRequestPointerLock,o.Module.canvas.requestPointerLock()),t.onButtonDiv=!1},100),e.touch||l.toggleContextMenu.call(e,n,!1)},!1),r.call(e,e.game,"volumechange",function(){e.storage.set({volume:e.volume,muted:e.muted}),d.setVolume&&d.setVolume()}),e.config.events.concat(["keyup","keydown"]).join(" "));r.call(e,e.game,s,function(s){var t=s.detail,t=void 0===t?{}:t;"error"===s.type&&(t=e.game.error),p.call(e,n.container,s.type,!0,t)})},proxy:function(n,o,e){var t=this.emulator,e=t.config.listeners[e],i=!0;(i=s.function(e)?e.call(t,n):i)&&s.function(o)&&o.call(t,n)},bind:function(c,l,o,n){var i=this,a=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],t=this.emulator,e=t.config.listeners[n],e=s.function(e);r.call(t,c,l,function(e){return i.proxy(e,o,n)},a&&!e)},controls:function(){var s,n=this,e=this.emulator,t=e.elements,o=y.isIE?"change":"input";this.bind(t.buttons.mute,"click",function(){e.muted=!e.muted},"mute"),this.bind(t.buttons.fullscreen,"click",function(){e.fullscreen.toggle()},"fullscreen"),this.bind(t.buttons.gamepad,"click",function(){x.toggleControls.call(e,!1),a(t.dialogs.gamepad,!1)},"mute"),this.bind(t.buttons.saveState,"click",function(){p.call(e,e.elements.container,"savestate-start",!1,{});var t=d.saveState(),n=d.getScreenData();p.call(e,e.elements.container,"savestate",!1,{state:t,screenshot:n})},"mute"),this.bind(t.buttons.loadState,"click",function(){p.call(e,e.elements.container,"loadstate",!1,{})},"mute"),this.bind(t.buttons.settings,"click",function(t){t.stopPropagation(),l.toggleMenu.call(e,t)}),this.bind(t.buttons.settings,"keyup",function(t){var n=t.which;[13,32].includes(n)&&(13!==n?(t.preventDefault(),t.stopPropagation(),l.toggleMenu.call(e,t)):l.focusFirstMenuItem.call(e,null,!0))},null,!1),this.bind(t.settings.menu,"keydown",function(t){27===t.which&&l.toggleMenu.call(e,t)}),y.isIos&&(s=M.call(e,'input[type="range"]'),Array.from(s).forEach(function(e){return n.bind(e,o,function(e){return eA(e.target)})})),y.isWebkit&&Array.from(M.call(e,'input[type="range"]')).forEach(function(t){n.bind(t,"input",function(t){return l.updateRangeFill.call(e,t.target)})}),this.bind(t.inputs.volume,o,function(t){e.volume=t.target.value},"volume"),this.bind(t.controls,"mouseenter mouseleave",function(n){"mouseleave"===n.type&&null===n.toElement?t.controls.hover=!0:t.controls.hover=!e.touch&&"mouseenter"===n.type}),this.bind(t.controls,"mousedown mouseup touchstart touchend touchcancel",function(e){["mousedown","touchstart"].includes(e.type)?(t.controls.pressed=!0,e=t.controls.getAttribute("data-timer2"),clearTimeout(e)):(e=setTimeout(function(){t.controls.pressed=!1},4e3),t.controls.setAttribute("data-timer2",e))}),this.bind(t.controls,"focusin focusout",function(t){var i=e.config,s=e.elements,t="focusin"===t.type,o=s.controls.getAttribute("data-timer");h(s.controls,i.classNames.noTransition,t),x.toggleControls.call(e,t),t&&(setTimeout(function(){h(s.controls,i.classNames.noTransition,!1)},0),t=n.touch?3e3:4e3,clearTimeout(o),o=setTimeout(function(){return x.toggleControls.call(e,!1)},t),s.controls.setAttribute("data-timer",o))}),this.bind(t.inputs.volume,"wheel",function(s){var o=s.webkitDirectionInvertedFromDevice,t=function(t,r){if(Array.isArray(t))return t;var e,a,n=[],s=!0,o=!1,i=void 0;try{for(e=t[Symbol.iterator]();!(s=(a=e.next()).done)&&(n.push(a.value),!r||n.length!==r);s=!0);}catch(e){o=!0,i=e}finally{try{s||null==e.return||e.return()}finally{if(o)throw i}}return n}([s.deltaX,-s.deltaY].map(function(e){return o?-e:e}),2),n=t[0],t=t[1],n=Math.sign(Math.abs(n)>Math.abs(t)?n:t),t=(e.increaseVolume(n/50),e.game.volume);(1===n&&t<1||-1===n&&0<t)&&s.preventDefault()},"volume",!1),this.bind(t.controls,"contextmenu",function(e){e.stopPropagation()}),this.bind(t.contextMenu,"contextmenu",function(e){e.stopPropagation()})}},em=el;function el(e){if(!(this instanceof el))throw new TypeError("Cannot call a class as a function");this.emulator=e,this.lastKey=null,this.focusTimer=null,this.lastKeyDown=null,this.toggleMenu=this.toggleMenu.bind(this),this.setTabFocus=this.setTabFocus.bind(this),this.firstTouch=this.firstTouch.bind(this)}function e2(s,n){for(var e,t=0;t<n.length;t++)e=n[t],e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(s,e.key,e)}v=[{key:"setup",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=null;return s.string(e)?t=Array.from(document.querySelectorAll(e)):s.nodeList(e)?t=Array.from(e):s.array(e)&&(t=e.filter(s.element)),s.empty(t)?null:t.map(function(e){return new P(e,n)})}}],e2((g=P).prototype,[{key:"restart",value:function(){this.currentTime=0}},{key:"increaseVolume",value:function(e){var t=this.game.muted?0:this.volume;this.volume=t+(s.number(e)?e:0)}},{key:"decreaseVolume",value:function(e){this.increaseVolume(-e)}},{key:"toggleControls",value:function(e){return!!this.started&&((e=h(this.elements.container,this.config.classNames.hideControls,void 0===e?void 0:!e))&&l.toggleMenu.call(this,!1),!e)}},{key:"setStatesSupported",value:function(e){this.statesSupported=e}},{key:"loadState",value:function(e){d.loadState(e,0)}},{key:"on",value:function(e,t){r.call(this,this.elements.container,e,t)}},{key:"once",value:function(e,t){es.call(this,this.elements.container,e,t)}},{key:"off",value:function(e,t){eo(this.elements.container,e,t)}},{key:"playing",set:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];Array.from(this.elements.buttons.play||[]).forEach(function(t){t.pressed=e}),this.paused=!e},get:function(){return Boolean(this.ready&&!this.paused)}},{key:"volume",set:function(t){var e=t;s.string(e)&&(e=Number(e)),s.number(e)||(e=this.storage.get("volume")),s.number(e)||(e=this.config.volume),this.config.volume=e=(e=1<e?1:e)<0?0:e,this.game.volume=e,!s.empty(t)&&this.muted&&0<e&&(this.muted=!1)},get:function(){return Number(this.game.volume)}},{key:"muted",set:function(e){s.boolean(e)||(e=this.storage.get("muted")),s.boolean(e)||(e=this.config.muted),this.config.muted=e,this.game.muted=e},get:function(){return Boolean(this.game.muted)}}]),e2(g,v),j=P;function P(t,e){return new Promise(async function(f){function m(e,c){for(var t,i,r=window.location.pathname.split("/").pop(),a=window.location.pathname.substring(0,window.location.pathname.length-r.length).split("/"),s=e.split("/"),n=[],o=0;o<a.length;o++)""!=a[o]&&n.push(a[o]);if(!(e.startsWith("/")||e.includes("://")||e.includes("http:")||e.includes("https:")||e.includes("file:")||e.includes("blob:"))){for(t=0;t<s.length;t++)""!=s[t]&&"."!=s[t]&&(".."==s[t]?0<n.length&&(n=("/"===(i=n.join("/"))?"/":i.substring(0,i.length-i.split("/").pop().length)).split("/")):n.push(s[t]));(e=n.join("/")).startsWith("/")||(e="/"+e),e=window.location.protocol+"//"+window.location.host+e}return!(e=e.startsWith("/")?window.location.protocol+"//"+window.location.host+e:e).endsWith("/")&&c&&(e+="/"),e}var l,u=this,r=(this.version="1.2.2",this.system="",this.adUrl=null,this.gameName=null,this.loadStateOnStart=!1,this.statesSupported=!0,this.mameCore=null,this.startOnLoad=!1,this.dataPath="",this.customPaths=null,this.hash="",this.lightgun=!1,this.mouse=!1,this.multitap=!1,this.ready=!1,this.paused=!0,this.started=!1,this.touch=w.touch,this.game=t,s.string(this.game)&&(this.game=document.querySelectorAll(this.game)),(window.jQuery&&this.game instanceof jQuery||s.nodeList(this.game)||s.array(this.game))&&(this.game=this.game[0]),this.game=this.game,this.game.innerHTML="",this.config=_({},ea,P.defaults,e||{}),this.coreVer=(l=this.config.system,!0===this.config.useBeta&&window.WebAssembly&&["nes","snes","gb","nds"].includes(l)?2:1),this.lightgun=this.config.lightgun,this.loadStateOnStart=this.config.loadStateOnStart||!1,this.adUrl=this.config.adUrl||null,this.gameName=this.config.gameName||null,this.mouse=this.config.mouse,this.multitap=this.config.multitap,this.cheats=this.config.cheats,this.cheats||(this.cheats=[]),l=this.config.oldNetplayServer,"string"==typeof(r=this.config.netplayUrl)?r:!0===l?"https://ws.emulatorjs.com/":"https://emuserver.emulatorjs.ga/"),h=(this.listUrl=r,this.socketUrl=r,this.mameCore=this.config.mameCore||null,this.color=this.config.color,this.startOnLoad=this.config.startOnLoad||!1,this.statesSupported=this.config.statesSupported||!0,this.customPaths=function(e){if(!e)return{};var t,n={};for(t in e)"string"==typeof e[t]&&(n[t]=m(e[t]));return n}(this.config.paths),this.dataPath="string"!=typeof(l=this.config.dataPath)?(r=window.location.href,h=(a=r).split("/").pop(),a=a.substring(0,a.length-h.length),"/"==r?window.location.protocol+"//"+window.location.host+"/":((a=a.startsWith("/")?window.location.protocol+"//"+window.location.host+a:a).endsWith("/")||(a+="/"),a)):m(l,!0),this.localization=await async function(s,t,e){if(n={},e&&"string"==typeof e&&"en-US"!==e){t=t&&"string"==typeof t[e+".json"]?t[e+".json"]:s+"localization/"+e+".json";try{var o=await(await fetch(t)).text(),n=JSON.parse(o);ea.i18n=n.i18n,i.normalOptions=n.normalOptions}catch(e){console.warn("error setting localization",e)}}return function(t){return"string"==typeof n[t]?n[t]:(e&&"en-US"!==e&&"undefined"!=typeof EJS_DEBUG_XX&&!0===EJS_DEBUG_XX&&console.warn('Missing translation for "'+t+'". Language is set to "'+e+'"'),t)}}(this.dataPath,this.customPaths,this.config.lang),this.config=_({},ea,P.defaults,e||{}),Object.keys(this.config.classNames).forEach(function(e){var t=u;s.object(t.config.classNames[e])?Object.keys(t.config.classNames[e]).forEach(function(t){var s={};s[u.config.classNames[e][t]]=!0,u.config.classNames[e][t]=n(s)}):((t={})[u.config.classNames[e]]=!0,u.config.classNames[e]=n(t))}),this.config.selectors.controls.wrapper=".".concat(n({ejs__controls:!0})),this.config.selectors.container=".".concat(n({ejs:!0})),this.system=this.config.system,this.elements={container:null,buttons:{},display:{},inputs:{},settings:{popup:null,menu:null,panels:{},buttons:{}},dialogs:{gamepad:null,loading:null,netplay:null},widgets:{}},this.fullscreen={active:!1},this.config.mute=!0,this.eventListeners=[],this.listeners=new em(this),this.storage=new ed(this,"ejs_settings"),this.game.emulator=this,s.element(this.elements.container)||(this.elements.container=c("div"),ey(this.game,this.elements.container)),c("div",{class:n({ejs__widgets:!0})})),r=(this.elements.container.appendChild(h),c("div",{class:n({ejs__dialogs:!0})})),a=(this.elements.container.appendChild(r),x.addStyleHook.call(this),d.setup.call(this),x.build.call(this),this.listeners.container(),this.listeners.global(),this.fullscreen=new ep(this),o.create.call(this),document.createElement("script"));a.src=this.customPaths&&"string"==typeof this.customPaths["webrtc-adapter.js"]?this.customPaths["webrtc-adapter.js"]:this.dataPath+"webrtc-adapter.js",document.body.appendChild(a),f(this)}.bind(this))}j.defaults={},eh.default=j}]).default