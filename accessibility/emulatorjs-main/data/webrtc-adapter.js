!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).adapter=e()}(function(){return function a(e,t,s){function o(n,c){if(!t[n]){if(!e[n]){var r="function"==typeof require&&require;if(!c&&r)return r(n,!0);if(i)return i(n,!0);throw(r=new Error("Cannot find module '"+n+"'")).code="MODULE_NOT_FOUND",r}r=t[n]={exports:{}},e[n][0].call(r.exports,function(t){return o(e[n][1][t]||t)},r,r.exports,a,e,t,s)}return t[n].exports}for(var i="function"==typeof require&&require,n=0;n<s.length;n++)o(s[n]);return o}({1:[function(e,t){"use strict";e=(0,e("./adapter_factory.js").adapterFactory)({window}),t.exports=e},{"./adapter_factory.js":2}],2:[function(a,l,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.adapterFactory=function(){var o=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).window,l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},a=r.log,d=r.detectBrowser(o),c={browserDetails:d,commonShim:e,extractVersion:r.extractVersion,disableLog:r.disableLog,disableWarnings:r.disableWarnings};switch(d.browser){case"chrome":if(!t||!t.shimPeerConnection||!l.shimChrome)return a("Chrome shim is not included in this adapter release."),c;a("adapter.js shimming chrome."),(c.browserShim=t).shimGetUserMedia(o),t.shimMediaStream(o),t.shimPeerConnection(o),t.shimOnTrack(o),t.shimAddTrackRemoveTrack(o),t.shimGetSendersWithDtmf(o),t.shimGetStats(o),t.shimSenderReceiverGetStats(o),t.fixNegotiationNeeded(o),e.shimRTCIceCandidate(o),e.shimConnectionState(o),e.shimMaxMessageSize(o),e.shimSendThrowTypeError(o),e.removeAllowExtmapMixed(o);break;case"firefox":if(!n||!n.shimPeerConnection||!l.shimFirefox)return a("Firefox shim is not included in this adapter release."),c;a("adapter.js shimming firefox."),(c.browserShim=n).shimGetUserMedia(o),n.shimPeerConnection(o),n.shimOnTrack(o),n.shimRemoveStream(o),n.shimSenderGetStats(o),n.shimReceiverGetStats(o),n.shimRTCDataChannel(o),e.shimRTCIceCandidate(o),e.shimConnectionState(o),e.shimMaxMessageSize(o),e.shimSendThrowTypeError(o);break;case"edge":if(!i||!i.shimPeerConnection||!l.shimEdge)return a("MS edge shim is not included in this adapter release."),c;a("adapter.js shimming edge."),(c.browserShim=i).shimGetUserMedia(o),i.shimGetDisplayMedia(o),i.shimPeerConnection(o),i.shimReplaceTrack(o),e.shimMaxMessageSize(o),e.shimSendThrowTypeError(o);break;case"safari":if(!s||!l.shimSafari)return a("Safari shim is not included in this adapter release."),c;a("adapter.js shimming safari."),(c.browserShim=s).shimRTCIceServerUrls(o),s.shimCreateOfferLegacy(o),s.shimCallbacksAPI(o),s.shimLocalStreamsAPI(o),s.shimRemoteStreamsAPI(o),s.shimTrackEventTransceiver(o),s.shimGetUserMedia(o),e.shimRTCIceCandidate(o),e.shimMaxMessageSize(o),e.shimSendThrowTypeError(o),e.removeAllowExtmapMixed(o);break;default:a("Unsupported browser!")}return c};var r=o(a("./utils")),t=o(a("./chrome/chrome_shim")),i=o(a("./edge/edge_shim")),n=o(a("./firefox/firefox_shim")),s=o(a("./safari/safari_shim")),e=o(a("./common_shim"));function o(e){if(e&&e.__esModule)return e;var n,t={};if(null!=e)for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(s,r,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.shimGetDisplayMedia=e.shimGetUserMedia=void 0;var t,i,n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=s("./getusermedia");Object.defineProperty(e,"shimGetUserMedia",{enumerable:!0,get:function(){return a.shimGetUserMedia}}),i=s("./getdisplaymedia"),Object.defineProperty(e,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),e.shimMediaStream=function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},e.shimOnTrack=function(e){{var s;"object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype?t.wrapPeerConnectionEvent(e,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}):(Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0}),s=e.RTCPeerConnection.prototype.setRemoteDescription,e.RTCPeerConnection.prototype.setRemoteDescription=function(){var t=this;return this._ontrackpoly||(this._ontrackpoly=function(n){n.stream.addEventListener("addtrack",function(o){var i=void 0,i=e.RTCPeerConnection.prototype.getReceivers?t.getReceivers().find(function(e){return e.track&&e.track.id===o.track.id}):{track:o.track},s=new Event("track");s.track=o.track,s.receiver=i,s.transceiver={receiver:i},s.streams=[n.stream],t.dispatchEvent(s)}),n.stream.getTracks().forEach(function(o){var i=void 0,i=e.RTCPeerConnection.prototype.getReceivers?t.getReceivers().find(function(e){return e.track&&e.track.id===o.id}):{track:o},s=new Event("track");s.track=o,s.receiver=i,s.transceiver={receiver:i},s.streams=[n.stream],t.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),s.apply(this,arguments)})}},e.shimGetSendersWithDtmf=function(e){{var t,s,o,i,a,r;"object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype?(t=function(t,e){return{track:e,get dtmf(){return void 0===this._dtmf&&("audio"===e.kind?this._dtmf=t.createDTMFSender(e):this._dtmf=null),this._dtmf},_pc:t}},e.RTCPeerConnection.prototype.getSenders||(e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()},s=e.RTCPeerConnection.prototype.addTrack,e.RTCPeerConnection.prototype.addTrack=function(n){var e=s.apply(this,arguments);return e||(e=t(this,n),this._senders.push(e)),e},o=e.RTCPeerConnection.prototype.removeTrack,e.RTCPeerConnection.prototype.removeTrack=function(e){o.apply(this,arguments),e=this._senders.indexOf(e),-1!==e&&this._senders.splice(e,1)}),i=e.RTCPeerConnection.prototype.addStream,e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach(function(e){n._senders.push(t(n,e))})},a=e.RTCPeerConnection.prototype.removeStream,e.RTCPeerConnection.prototype.removeStream=function(t){var e=this;this._senders=this._senders||[],a.apply(this,[t]),t.getTracks().forEach(function(n){var t=e._senders.find(function(e){return e.track===n});t&&e._senders.splice(e._senders.indexOf(t),1)})}):"object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&(r=e.RTCPeerConnection.prototype.getSenders,e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=r.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}}))}},e.shimGetStats=function(t){if(!t.RTCPeerConnection)return;var e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(t,o,i){var a=this,r=arguments;if(0<arguments.length&&"function"==typeof t)return e.apply(this,arguments);if(0===e.length&&(0===arguments.length||"function"!=typeof t))return e.apply(this,[]);function n(t){var e={};return t.result().forEach(function(t){var n={id:t.id,timestamp:t.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[t.type]||t.type};t.names().forEach(function(e){n[e]=t.stat(e)}),e[n.id]=n}),e}function s(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))}return 2<=arguments.length?e.apply(this,[function(e){r[1](s(n(e)))},t]):new Promise(function(t,o){e.apply(a,[function(e){t(s(n(e)))},o])}).then(o,i)}},e.shimSenderReceiverGetStats=function(e){if(!("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if("getStats"in e.RTCRtpSender.prototype||((s=e.RTCPeerConnection.prototype.getSenders)&&(e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=s.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e}),(o=e.RTCPeerConnection.prototype.addTrack)&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=o.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(n){return t.filterStats(n,e.track,!0)})}),"getStats"in e.RTCRtpReceiver.prototype||((i=e.RTCPeerConnection.prototype.getReceivers)&&(e.RTCPeerConnection.prototype.getReceivers=function(){var t=this,e=i.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e}),t.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(n){return t.filterStats(n,e.track,!1)})}),!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;var s,o,i,a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(0<arguments.length&&arguments[0]instanceof e.MediaStreamTrack){var s=arguments[0],t=void 0,n=void 0,o=void 0;return this.getSenders().forEach(function(e){e.track===s&&(t?o=!0:t=e)}),this.getReceivers().forEach(function(e){return e.track===s&&(n?o=!0:n=e),e.track===s}),o||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return a.apply(this,arguments)}},e.shimAddTrackRemoveTrackWithNative=o,e.shimAddTrackRemoveTrack=function(e){if(!e.RTCPeerConnection)return;var s,i,a,r,c,l=t.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&65<=l.version)return o(e);i=e.RTCPeerConnection.prototype.getLocalStreams,e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=i.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})},a=e.RTCPeerConnection.prototype.addStream,e.RTCPeerConnection.prototype.addStream=function(t){var n,s=this;this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(function(e){if(s.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),this._reverseStreams[t.id]||(n=new e.MediaStream(t.getTracks()),this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n),a.apply(this,[t])},r=e.RTCPeerConnection.prototype.removeStream;function n(e,n){var t=n.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(n){var s=e._reverseStreams[n],n=e._streams[s.id];t=t.replace(new RegExp(n.id,"g"),s.id)}),new RTCSessionDescription({type:n.type,sdp:t})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[(this._streams[e.id]||e).id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(n,s){var t,o=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(t=[].slice.call(arguments,1),1!==t.length||!t[0].getTracks().find(function(e){return e===n}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(e){return e.track===n}))throw new DOMException("Track already exists.","InvalidAccessError");return this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t=this._streams[s.id],t?(t.addTrack(n),Promise.resolve().then(function(){o.dispatchEvent(new Event("negotiationneeded"))})):(t=new e.MediaStream([n]),this._streams[s.id]=t,this._reverseStreams[t.id]=s,this.addStream(t)),this.getSenders().find(function(e){return e.track===n})},["createOffer","createAnswer"].forEach(function(t){var s=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var t=this,e=arguments;return arguments.length&&"function"==typeof arguments[0]?s.apply(this,[function(s){s=n(t,s),e[0].apply(null,[s])},function(t){e[1]&&e[1].apply(null,t)},arguments[2]]):s.apply(this,arguments).then(function(e){return n(t,e)})}}),c=e.RTCPeerConnection.prototype.setLocalDescription,e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type&&(arguments[0]=(e=this,t=(n=arguments[0]).sdp,Object.keys(e._reverseStreams||[]).forEach(function(n){var s=e._reverseStreams[n],n=e._streams[s.id];t=t.replace(new RegExp(s.id,"g"),n.id)}),new RTCSessionDescription({type:n.type,sdp:t}))),c.apply(this,arguments);var e,t,n},s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription"),Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=s.get.apply(this);return""===e.type?e:n(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(t){var e,n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!t._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(t._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},e=void 0,Object.keys(this._streams).forEach(function(s){n._streams[s].getTracks().find(function(e){return t.track===e})&&(e=n._streams[s])}),e&&(1===e.getTracks().length?this.removeStream(this._reverseStreams[e.id]):e.removeTrack(t.track),this.dispatchEvent(new Event("negotiationneeded")))}},e.shimPeerConnection=function(e){if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),!e.RTCPeerConnection)return;["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var t=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}},e.fixNegotiationNeeded=function(e){t.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){if("stable"===e.target.signalingState)return e})},t=function(e){{if(e&&e.__esModule)return e;var n,t={};if(null!=e)for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(s("../utils.js"));function o(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var n,s,o,t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(s,e){if(!e)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=t.apply(this,arguments);return this._shimmedLocalStreams[e.id]?-1===this._shimmedLocalStreams[e.id].indexOf(n)&&this._shimmedLocalStreams[e.id].push(n):this._shimmedLocalStreams[e.id]=[e,n],n},n=e.RTCPeerConnection.prototype.addStream,e.RTCPeerConnection.prototype.addStream=function(e){var t,s,o=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){if(o.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),t=this.getSenders(),n.apply(this,arguments),s=this.getSenders().filter(function(e){return-1===t.indexOf(e)}),this._shimmedLocalStreams[e.id]=[e].concat(s)},s=e.RTCPeerConnection.prototype.removeStream,e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],s.apply(this,arguments)},o=e.RTCPeerConnection.prototype.removeTrack,e.RTCPeerConnection.prototype.removeTrack=function(t){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},t&&Object.keys(this._shimmedLocalStreams).forEach(function(n){var s=e._shimmedLocalStreams[n].indexOf(t);-1!==s&&e._shimmedLocalStreams[n].splice(s,1),1===e._shimmedLocalStreams[n].length&&delete e._shimmedLocalStreams[n]}),o.apply(this,arguments)}}},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(t,n,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.shimGetDisplayMedia=function(e,t){if(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)return;if(!e.navigator.mediaDevices)return;if("function"!=typeof t)return void console.error("shimGetDisplayMedia: getSourceId argument is not a function");e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(function(o){var t=n.video&&n.video.width,s=n.video&&n.video.height,i=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:i||3}},t&&(n.video.mandatory.maxWidth=t),s&&(n.video.mandatory.maxHeight=s),e.navigator.mediaDevices.getUserMedia(n)})}}},{}],5:[function(o,i,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var t,n,e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};s.shimGetUserMedia=function(i){var o,l,s=i&&i.navigator;if(!s.mediaDevices)return;function a(n){if("object"!==(void 0===n?"undefined":e(n))||n.mandatory||n.optional)return n;var t={};return Object.keys(n).forEach(function(o){var s,i,a;"require"!==o&&"advanced"!==o&&"mediaSource"!==o&&(void 0!==(s="object"===e(n[o])?n[o]:{ideal:n[o]}).exact&&"number"==typeof s.exact&&(s.min=s.max=s.exact),i=function(t,e){return t?t+e.charAt(0).toUpperCase()+e.slice(1):"deviceId"===e?"sourceId":e},void 0!==s.ideal&&(t.optional=t.optional||[],a={},"number"==typeof s.ideal?(a[i("min",o)]=s.ideal,t.optional.push(a),(a={})[i("max",o)]=s.ideal):a[i("",o)]=s.ideal,t.optional.push(a)),void 0!==s.exact&&"number"!=typeof s.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",o)]=s.exact):["min","max"].forEach(function(e){void 0!==s[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,o)]=s[e])}))}),n.advanced&&(t.optional=(t.optional||[]).concat(n.advanced)),t}function r(t,c){if(61<=o.version)return c(t);if((t=JSON.parse(JSON.stringify(t)))&&"object"===e(t.audio)&&((l=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])})((t=JSON.parse(JSON.stringify(t))).audio,"autoGainControl","googAutoGainControl"),l(t.audio,"noiseSuppression","googNoiseSuppression"),t.audio=a(t.audio)),t&&"object"===e(t.video)){var r,i=(i=t.video.facingMode)&&("object"===(void 0===i?"undefined":e(i))?i:{ideal:i}),l=o.version<66;if(i&&("user"===i.exact||"environment"===i.exact||"user"===i.ideal||"environment"===i.ideal)&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||l)&&(delete t.video.facingMode,r=void 0,"environment"===i.exact||"environment"===i.ideal?r=["back","rear"]:"user"!==i.exact&&"user"!==i.ideal||(r=["front"]),r))return s.mediaDevices.enumerateDevices().then(function(e){var s=(e=e.filter(function(e){return"videoinput"===e.kind})).find(function(e){return r.some(function(t){return e.label.toLowerCase().includes(t)})});return!s&&e.length&&r.includes("back")&&(s=e[e.length-1]),s&&(t.video.deviceId=i.exact?{exact:s.deviceId}:{ideal:s.deviceId}),t.video=a(t.video),n("chrome: "+JSON.stringify(t)),c(t)});t.video=a(t.video)}return n("chrome: "+JSON.stringify(t)),c(t)}function c(e){return 64<=o.version?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}}o=t.detectBrowser(i),s.getUserMedia=function(t,n,e){r(t,function(t){s.webkitGetUserMedia(t,n,function(t){e&&e(c(t))})})}.bind(s),s.mediaDevices.getUserMedia&&(l=s.mediaDevices.getUserMedia.bind(s.mediaDevices),s.mediaDevices.getUserMedia=function(e){return r(e,function(e){return l(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(c(e))})})})},t=function(e){{if(e&&e.__esModule)return e;var n,t={};if(null!=e)for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(o("../utils.js")),n=t.log},{"../utils.js":15}],6:[function(i,r,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.shimRTCIceCandidate=function(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;var s=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var i=new s(e),a=t.default.parseCandidate(e.candidate),n=Object.assign(i,a);return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new s(e)},e.RTCIceCandidate.prototype=s.prototype,n.wrapPeerConnectionEvent(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})},e.shimMaxMessageSize=function(e){if(e.RTCSctpTransport||!e.RTCPeerConnection)return;var o,s=n.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}}),o=e.RTCPeerConnection.prototype.setRemoteDescription,e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e,n,i,a;return this._sctp=null,function(e){return!!e&&!!e.sdp&&(e=t.default.splitSections(e.sdp),e.shift(),e.some(function(e){return e=t.default.parseMLine(e),e&&"application"===e.kind&&-1!==e.protocol.indexOf("SCTP")}))}(arguments[0])&&(e=function(e){return e=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/),null===e||e.length<2?-1:(e=parseInt(e[1],10),e!=e?-1:e)}(arguments[0]),a=e,n=65536,"firefox"===s.browser&&(n=s.version<57?-1===a?16384:2147483637:s.version<60?57===s.version?65535:65536:2147483637),n=n,e=function(e,o){var n=65536;return"firefox"===s.browser&&57===s.version&&(n=65535),e=t.default.matchPrefix(e.sdp,"a=max-message-size:"),0<e.length?n=parseInt(e[0].substr(19),10):"firefox"===s.browser&&-1!==o&&(n=2147483637),n}(arguments[0],e),i=void 0,i=0===n&&0===e?Number.POSITIVE_INFINITY:0===n||0===e?Math.max(n,e):Math.min(n,e),e={},Object.defineProperty(e,"maxMessageSize",{get:function(){return i}}),this._sctp=e),o.apply(this,arguments)}},e.shimSendThrowTypeError=function(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){var n=e.send;e.send=function(){var s=arguments[0],s=s.length||s.size||s.byteLength;if("open"===e.readyState&&t.sctp&&s>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}var s=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=s.apply(this,arguments);return t(e,this),e},n.wrapPeerConnectionEvent(e,"datachannel",function(e){return t(e.channel,e.target),e})},e.shimConnectionState=function(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;var e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(t){var n=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(t){var n,e=t.target;return e._lastConnectionState!==e.connectionState&&(e._lastConnectionState=e.connectionState,n=new Event("connectionstatechange",t),e.dispatchEvent(n)),t},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})},e.removeAllowExtmapMixed=function(e){if(!e.RTCPeerConnection)return;var s,t=n.detectBrowser(e);if("chrome"===t.browser&&71<=t.version)return;s=e.RTCPeerConnection.prototype.setRemoteDescription,e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter(function(e){return"a=extmap-allow-mixed"!==e.trim()}).join("\n")),s.apply(this,arguments)}};var s,o,a=i("sdp"),t=(s=a)&&s.__esModule?s:{default:s},n=function(e){{if(e&&e.__esModule)return e;var n,t={};if(null!=e)for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(i("./utils"))},{"./utils":15,sdp:17}],7:[function(t,l,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.shimGetDisplayMedia=e.shimGetUserMedia=void 0,s=t("./getusermedia"),Object.defineProperty(e,"shimGetUserMedia",{enumerable:!0,get:function(){return s.shimGetUserMedia}}),o=t("./getdisplaymedia"),Object.defineProperty(e,"shimGetDisplayMedia",{enumerable:!0,get:function(){return o.shimGetDisplayMedia}}),e.shimPeerConnection=function(e){var n,s,t=i.detectBrowser(e);e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025&&(s=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled"),Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){s.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}}))),!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender),n=(0,c.default)(e,t.version),e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=(0,a.filterIceServers)(e.iceServers,t.version),i.log("ICE servers after filtering:",e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype},e.shimReplaceTrack=function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)};var n,s,o,i=function(e){{if(e&&e.__esModule)return e;var n,t={};if(null!=e)for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(t("../utils")),a=t("./filtericeservers"),r=t("rtcpeerconnection-shim"),c=(n=r)&&n.__esModule?n:{default:n}},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(t,s,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.filterIceServers=function(e){var t=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var o,s=e.urls||e.url;return e.url&&!e.urls&&n.deprecated("RTCIceServer.url","RTCIceServer.urls"),o="string"==typeof s,o&&(s=[s]),s=s.filter(function(e){return 0!==e.indexOf("stun:")&&(e=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp"),e&&!t&&(t=!0))}),delete e.url,e.urls=o?s[0]:s,!!s.length}})};var n=function(e){{if(e&&e.__esModule)return e;var n,t={};if(null!=e)for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(t("../utils"))},{"../utils":15}],9:[function(t,n,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.shimGetDisplayMedia=function(e){if(!("getDisplayMedia"in e.navigator))return;if(!e.navigator.mediaDevices)return;if(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)return;e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)}},{}],10:[function(t,n,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.shimGetUserMedia=function(e){var e=e&&e.navigator,t=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(e){return t(e).catch(function(e){return Promise.reject({name:{PermissionDeniedError:"NotAllowedError"}[(e=e).name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}})})}}},{}],11:[function(s,a,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.shimGetDisplayMedia=e.shimGetUserMedia=void 0;var t,o,n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=s("./getusermedia");Object.defineProperty(e,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}}),o=s("./getdisplaymedia"),Object.defineProperty(e,"shimGetDisplayMedia",{enumerable:!0,get:function(){return o.shimGetDisplayMedia}}),e.shimOnTrack=function(e){"object"===(void 0===e?"undefined":n(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},e.shimPeerConnection=function(e){if(s=t.detectBrowser(e),"object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}}),o=e.RTCPeerConnection.prototype.addIceCandidate,e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?o.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var s,o,i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(t,e,n){return a.apply(this,[t||null]).then(function(t){if(s.version<53&&!e)try{t.forEach(function(e){e.type=i[e.type]||e.type})}catch(e){if("TypeError"!==e.name)throw e;t.forEach(function(e,n){t.set(n,Object.assign({},e,{type:i[e.type]||e.type}))})}return t}).then(e,n)}},e.shimSenderGetStats=function(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;var t,s=e.RTCPeerConnection.prototype.getSenders;s&&(e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=s.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e}),t=e.RTCPeerConnection.prototype.addTrack,t&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=t.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}},e.shimReceiverGetStats=function(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;var s=e.RTCPeerConnection.prototype.getReceivers;s&&(e.RTCPeerConnection.prototype.getReceivers=function(){var t=this,e=s.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e}),t.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}},e.shimRemoveStream=function(e){if(!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype)return;e.RTCPeerConnection.prototype.removeStream=function(e){var n=this;t.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(t){t.track&&e.getTracks().includes(t.track)&&n.removeTrack(t)})}},e.shimRTCDataChannel=function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},t=function(e){{if(e&&e.__esModule)return e;var n,t={};if(null!=e)for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(s("../utils"))},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(t,n,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.shimGetDisplayMedia=function(e,t){if(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)return;if(!e.navigator.mediaDevices)return;e.navigator.mediaDevices.getDisplayMedia=function(n){return n&&n.video?(!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)):(n=new DOMException("getDisplayMedia without video constraints is undefined"),n.name="NotFoundError",n.code=8,Promise.reject(n))}}},{}],13:[function(s,o,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t,e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.shimGetUserMedia=function(n){var s,i,a,r,c=t.detectBrowser(n),o=n&&n.navigator,n=n&&n.MediaStreamTrack;o.getUserMedia=function(e,n,s){t.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),o.mediaDevices.getUserMedia(e).then(n,s)},55<c.version&&"autoGainControl"in o.mediaDevices.getSupportedConstraints()||(s=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},i=o.mediaDevices.getUserMedia.bind(o.mediaDevices),o.mediaDevices.getUserMedia=function(t){return"object"===(void 0===t?"undefined":e(t))&&"object"===e(t.audio)&&(t=JSON.parse(JSON.stringify(t)),s(t.audio,"autoGainControl","mozAutoGainControl"),s(t.audio,"noiseSuppression","mozNoiseSuppression")),i(t)},n&&n.prototype.getSettings&&(a=n.prototype.getSettings,n.prototype.getSettings=function(){var e=a.apply(this,arguments);return s(e,"mozAutoGainControl","autoGainControl"),s(e,"mozNoiseSuppression","noiseSuppression"),e}),n&&n.prototype.applyConstraints&&(r=n.prototype.applyConstraints,n.prototype.applyConstraints=function(t){return"audio"===this.kind&&"object"===(void 0===t?"undefined":e(t))&&(t=JSON.parse(JSON.stringify(t)),s(t,"autoGainControl","mozAutoGainControl"),s(t,"noiseSuppression","mozNoiseSuppression")),r.apply(this,[t])}))},t=function(e){{if(e&&e.__esModule)return e;var n,t={};if(null!=e)for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(s("../utils"))},{"../utils":15}],14:[function(o,i,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.shimLocalStreamsAPI=function(e){if("object"!==(void 0===e?"undefined":t(e))||!e.RTCPeerConnection)return;"getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams});{var n;"addStream"in e.RTCPeerConnection.prototype||(n=e.RTCPeerConnection.prototype.addTrack,e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getTracks().forEach(function(s){return n.call(t,s,e)})},e.RTCPeerConnection.prototype.addTrack=function(t,e){return e&&(this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]),n.call(this,t,e)})}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){var e,n,s=this;this._localStreams||(this._localStreams=[]),e=this._localStreams.indexOf(t),-1!==e&&(this._localStreams.splice(e,1),n=t.getTracks(),this.getSenders().forEach(function(e){n.includes(e.track)&&s.removeTrack(e)}))})},e.shimRemoteStreamsAPI=function(e){if("object"!==(void 0===e?"undefined":t(e))||!e.RTCPeerConnection)return;"getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams||[]});{var n;"onaddstream"in e.RTCPeerConnection.prototype||(Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(t){var e=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){var n;e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.includes(t)||(e._remoteStreams.push(t),(n=new Event("addstream")).stream=t,e.dispatchEvent(n))})})}}),n=e.RTCPeerConnection.prototype.setRemoteDescription,e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){var n;e._remoteStreams||(e._remoteStreams=[]),0<=e._remoteStreams.indexOf(t)||(e._remoteStreams.push(t),(n=new Event("addstream")).stream=t,e.dispatchEvent(n))})}),n.apply(e,arguments)})}},e.shimCallbacksAPI=function(e){if("object"!==(void 0===e?"undefined":t(e))||!e.RTCPeerConnection)return;var n=e.RTCPeerConnection.prototype,s=n.createOffer,o=n.createAnswer,i=n.setLocalDescription,a=n.setRemoteDescription,r=n.addIceCandidate;n.createOffer=function(t,n){var e=2<=arguments.length?arguments[2]:t,e=s.apply(this,[e]);return n?(e.then(t,n),Promise.resolve()):e},n.createAnswer=function(t,n){var e=2<=arguments.length?arguments[2]:t,e=o.apply(this,[e]);return n?(e.then(t,n),Promise.resolve()):e},e=function(e,n,t){return e=i.apply(this,[e]),t?(e.then(n,t),Promise.resolve()):e},n.setLocalDescription=e,e=function(e,n,t){return e=a.apply(this,[e]),t?(e.then(n,t),Promise.resolve()):e},n.setRemoteDescription=e,e=function(e,n,t){return e=r.apply(this,[e]),t?(e.then(n,t),Promise.resolve()):e},n.addIceCandidate=e},e.shimGetUserMedia=function(t){var n,e=t&&t.navigator;e.mediaDevices&&e.mediaDevices.getUserMedia&&(t=e.mediaDevices,n=t.getUserMedia.bind(t),e.mediaDevices.getUserMedia=function(e){return n(s(e))}),!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=function(t,n,s){e.mediaDevices.getUserMedia(t).then(n,s)}.bind(e))},e.shimConstraints=s,e.shimRTCIceServerUrls=function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(s,a){if(s&&s.iceServers){for(var e,i=[],o=0;o<s.iceServers.length;o++)e=s.iceServers[o],!e.hasOwnProperty("urls")&&e.hasOwnProperty("url")?(n.deprecated("RTCIceServer.url","RTCIceServer.urls"),(e=JSON.parse(JSON.stringify(e))).urls=e.url,delete e.url,i.push(e)):i.push(s.iceServers[o]);s.iceServers=i}return new t(s,a)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},e.shimTrackEventTransceiver=function(e){"object"===(void 0===e?"undefined":t(e))&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},e.shimCreateOfferLegacy=function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){var e;return n&&(void 0!==n.offerToReceiveAudio&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio),e=this.getTransceivers().find(function(e){return"audio"===e.receiver.track.kind}),!1===n.offerToReceiveAudio&&e?"sendrecv"===e.direction?e.setDirection?e.setDirection("sendonly"):e.direction="sendonly":"recvonly"===e.direction&&(e.setDirection?e.setDirection("inactive"):e.direction="inactive"):!0!==n.offerToReceiveAudio||e||this.addTransceiver("audio"),void 0!==n.offerToReceiveVideo&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo),e=this.getTransceivers().find(function(e){return"video"===e.receiver.track.kind}),!1===n.offerToReceiveVideo&&e?"sendrecv"===e.direction?e.setDirection?e.setDirection("sendonly"):e.direction="sendonly":"recvonly"===e.direction&&(e.setDirection?e.setDirection("inactive"):e.direction="inactive"):!0!==n.offerToReceiveVideo||e||this.addTransceiver("video")),t.apply(this,arguments)}},n=function(e){{if(e&&e.__esModule)return e;var n,t={};if(null!=e)for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(o("../utils"));function s(e){return e&&void 0!==e.video?Object.assign({},e,{video:n.compactObject(e.video)}):e}},{"../utils":15}],15:[function(r,c,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}e.extractVersion=n,e.wrapPeerConnectionEvent=function(t,e,o){if(!t.RTCPeerConnection)return;var n,t=t.RTCPeerConnection.prototype,s=t.addEventListener;t.addEventListener=function(t,n){if(t!==e)return s.apply(this,arguments);function i(e){(e=o(e))&&n(e)}return this._eventMap=this._eventMap||{},this._eventMap[n]=i,s.apply(this,[t,i])},n=t.removeEventListener,t.removeEventListener=function(s,t){if(s!==e||!this._eventMap||!this._eventMap[t])return n.apply(this,arguments);var o=this._eventMap[t];return delete this._eventMap[t],n.apply(this,[s,o])},Object.defineProperty(t,"on"+e,{get:function(){return this["_on"+e]},set:function(t){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),t&&this.addEventListener(e,this["_on"+e]=t)},enumerable:!0,configurable:!0})},e.disableLog=function(e){return"boolean"==typeof e?(i=e)?"adapter.js logging disabled":"adapter.js logging enabled":new Error("Argument type: "+(void 0===e?"undefined":t(e))+". Please use a boolean.")},e.disableWarnings=function(e){return"boolean"==typeof e?(o=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled")):new Error("Argument type: "+(void 0===e?"undefined":t(e))+". Please use a boolean.")},e.log=function(){"object"===("undefined"==typeof window?"undefined":t(window))&&(i||"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments))},e.deprecated=function(e,t){if(!o)return;console.warn(e+" is deprecated, please use "+t+" instead.")},e.detectBrowser=function(s){var t=s.navigator,e={browser:null,version:null};if(void 0===s||!s.navigator)return e.browser="Not a browser.",e;if(t.mozGetUserMedia)e.browser="firefox",e.version=n(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===s.isSecureContext&&s.webkitRTCPeerConnection&&!s.RTCIceGatherer)e.browser="chrome",e.version=n(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=n(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!s.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return e.browser="Not a supported browser.",e;e.browser="safari",e.version=n(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return e},e.compactObject=function n(e){return"object"!==(void 0===e?"undefined":t(e))?e:Object.keys(e).reduce(function(r,s){var o="object"===t(e[s]),i=o?n(e[s]):e[s],o=o&&!Object.keys(i).length;return void 0===i||o?r:Object.assign(r,a({},s,i))},{})},e.walkStats=s,e.filterStats=function(e,o,i){var n,a=i?"outbound-rtp":"inbound-rtp",t=new Map;return null===o?t:(n=[],e.forEach(function(e){"track"===e.type&&e.trackIdentifier===o.id&&n.push(e)}),n.forEach(function(n){e.forEach(function(o){o.type===a&&o.trackId===n.id&&s(e,o,t)})}),t)};var t,i=!0,o=!0;function n(n,e,t){return e=n.match(e),e&&e.length>=t&&parseInt(e[t],10)}function s(t,e,n){e&&!n.has(e.id)&&(n.set(e.id,e),Object.keys(e).forEach(function(o){o.endsWith("Id")?s(t,t.get(e[o]),n):o.endsWith("Ids")&&e[o].forEach(function(e){s(t,t.get(e),n)})}))}},{}],16:[function(a,r){"use strict";var e=a("sdp");function i(t,n,i,o,s){return n=e.writeRtpDescription(t.kind,n),n+=e.writeIceParameters(t.iceGatherer.getLocalParameters()),n+=e.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":s||"active"),n+="a=mid:"+t.mid+"\r\n",t.rtpSender&&t.rtpReceiver?n+="a=sendrecv\r\n":t.rtpSender?n+="a=sendonly\r\n":t.rtpReceiver?n+="a=recvonly\r\n":n+="a=inactive\r\n",t.rtpSender&&(s=t.rtpSender._initialTrackId||t.rtpSender.track.id,t.rtpSender._initialTrackId=s,n+="a="+(s="msid:"+(o?o.id:"-")+" "+s+"\r\n"),n+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+s,t.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" "+s,n+="a=ssrc-group:FID "+t.sendEncodingParameters[0].ssrc+" "+t.sendEncodingParameters[0].rtx.ssrc+"\r\n")),n+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+e.localCName+"\r\n",t.rtpSender&&t.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" cname:"+e.localCName+"\r\n"),n}function n(t,e){function s(t,n){t=parseInt(t,10);for(var e=0;e<n.length;e++)if(n[e].payloadType===t||n[e].preferredPayloadType===t)return n[e]}var n={codecs:[],headerExtensions:[],fecMechanisms:[]};return t.codecs.forEach(function(i){for(var o,a=0;a<e.codecs.length;a++)if(o=e.codecs[a],i.name.toLowerCase()===o.name.toLowerCase()&&i.clockRate===o.clockRate&&("rtx"!==i.name.toLowerCase()||!i.parameters||!o.parameters.apt||function(n,o,e,t){return e=s(n.parameters.apt,e),t=s(o.parameters.apt,t),e&&t&&e.name.toLowerCase()===t.name.toLowerCase()}(i,o,t.codecs,e.codecs))){(o=JSON.parse(JSON.stringify(o))).numChannels=Math.min(i.numChannels,o.numChannels),n.codecs.push(o),o.rtcpFeedback=o.rtcpFeedback.filter(function(t){for(var e=0;e<i.rtcpFeedback.length;e++)if(i.rtcpFeedback[e].type===t.type&&i.rtcpFeedback[e].parameter===t.parameter)return!0;return!1});break}}),t.headerExtensions.forEach(function(o){for(var s,t=0;t<e.headerExtensions.length;t++)if(s=e.headerExtensions[t],o.uri===s.uri){n.headerExtensions.push(s);break}}),n}function o(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function s(t,e){var n=t.getRemoteCandidates().find(function(t){return e.foundation===t.foundation&&e.ip===t.ip&&e.port===t.port&&e.priority===t.priority&&e.protocol===t.protocol&&e.type===t.type});return n||t.addRemoteCandidate(e),!n}function t(t,e){return e=new Error(e),e.name=t,e.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[t],e}r.exports=function(r,c){function l(e,t){t.addTrack(e),t.dispatchEvent(new r.MediaStreamTrackEvent("addtrack",{track:e}))}function d(n,s,t,o){var e=new Event("track");e.track=s,e.receiver=t,e.transceiver={receiver:t},e.streams=o,r.setTimeout(function(){n._dispatchEvent("track",e)})}function a(n){var s,o,i,a,d=this,l=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){d[e]=l[e].bind(l)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw t("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=(s=n.iceServers||[],a=c,o=!1,(s=JSON.parse(JSON.stringify(s))).filter(function(e){if(e&&(e.urls||e.url)){var n,t=e.urls||e.url;return e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead."),n="string"==typeof t,n&&(t=[t]),t=t.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||o?0===e.indexOf("stun:")&&14393<=a&&-1===e.indexOf("?transport=udp"):o=!0}),delete e.url,e.urls=n?t[0]:t,!!t.length}})),this._iceGatherers=[],n.iceCandidatePoolSize)for(i=n.iceCandidatePoolSize;0<i;i--)this._iceGatherers.push(new r.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=e.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1}Object.defineProperty(a.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(a.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),a.prototype.onicecandidate=null,a.prototype.onaddstream=null,a.prototype.ontrack=null,a.prototype.onremovestream=null,a.prototype.onsignalingstatechange=null,a.prototype.oniceconnectionstatechange=null,a.prototype.onconnectionstatechange=null,a.prototype.onicegatheringstatechange=null,a.prototype.onnegotiationneeded=null,a.prototype.ondatachannel=null,a.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},a.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},a.prototype.getConfiguration=function(){return this._config},a.prototype.getLocalStreams=function(){return this.localStreams},a.prototype.getRemoteStreams=function(){return this.remoteStreams},a.prototype._createTransceiver=function(e,n){var t=0<this.transceivers.length,e={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};return this.usingBundle&&t?(e.iceTransport=this.transceivers[0].iceTransport,e.dtlsTransport=this.transceivers[0].dtlsTransport):(t=this._createIceAndDtlsTransports(),e.iceTransport=t.iceTransport,e.dtlsTransport=t.dtlsTransport),n||this.transceivers.push(e),e},a.prototype.addTrack=function(n,o){if(this._isClosed)throw t("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");if(this.transceivers.find(function(e){return e.track===n}))throw t("InvalidAccessError","Track already exists.");for(var e,s=0;s<this.transceivers.length;s++)this.transceivers[s].track||this.transceivers[s].kind!==n.kind||(e=this.transceivers[s]);return e=e||this._createTransceiver(n.kind),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(o)&&this.localStreams.push(o),e.track=n,e.stream=o,e.rtpSender=new r.RTCRtpSender(n,e.dtlsTransport),e.rtpSender},a.prototype.addStream=function(e){var t,n=this;15025<=c?e.getTracks().forEach(function(t){n.addTrack(t,e)}):(t=e.clone(),e.getTracks().forEach(function(e,n){var s=t.getTracks()[n];e.addEventListener("enabled",function(e){s.enabled=e.enabled})}),t.getTracks().forEach(function(e){n.addTrack(e,t)}))},a.prototype.removeTrack=function(s){if(this._isClosed)throw t("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(s instanceof r.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n,e=this.transceivers.find(function(e){return e.rtpSender===s});if(!e)throw t("InvalidAccessError","Sender was not created by this connection.");n=e.stream,e.rtpSender.stop(),e.rtpSender=null,e.track=null,e.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(n)&&-1<this.localStreams.indexOf(n)&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},a.prototype.removeStream=function(t){var e=this;t.getTracks().forEach(function(n){var t=e.getSenders().find(function(e){return e.track===n});t&&e.removeTrack(t)})},a.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},a.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},a.prototype._createIceGatherer=function(e,s){var t,n=this;return s&&0<e?this.transceivers[0].iceGatherer:this._iceGatherers.length?this._iceGatherers.shift():(t=new r.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy}),Object.defineProperty(t,"state",{value:"new",writable:!0}),this.transceivers[e].bufferedCandidateEvents=[],this.transceivers[e].bufferCandidates=function(s){var o=!s.candidate||0===Object.keys(s.candidate).length;t.state=o?"completed":"gathering",null!==n.transceivers[e].bufferedCandidateEvents&&n.transceivers[e].bufferedCandidateEvents.push(s)},t.addEventListener("localcandidate",this.transceivers[e].bufferCandidates),t)},a.prototype._gather=function(i,s){var o,t=this,n=this.transceivers[s].iceGatherer;n.onlocalcandidate||(o=this.transceivers[s].bufferedCandidateEvents,this.transceivers[s].bufferedCandidateEvents=null,n.removeEventListener("localcandidate",this.transceivers[s].bufferCandidates),n.onlocalcandidate=function(c){var o,a,r;t.usingBundle&&0<s||((o=new Event("icecandidate")).candidate={sdpMid:i,sdpMLineIndex:s},(c=!(r=c.candidate)||0===Object.keys(r).length)?"new"!==n.state&&"gathering"!==n.state||(n.state="completed"):("new"===n.state&&(n.state="gathering"),r.component=1,r.ufrag=n.getLocalParameters().usernameFragment,a=e.writeCandidate(r),o.candidate=Object.assign(o.candidate,e.parseCandidate(a)),o.candidate.candidate=a,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}),(a=e.getMediaSections(t._localDescription.sdp))[o.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",t._localDescription.sdp=e.getDescription(t._localDescription.sdp)+a.join(""),a=t.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}),"gathering"!==t.iceGatheringState&&(t.iceGatheringState="gathering",t._emitGatheringStateChange()),c||t._dispatchEvent("icecandidate",o),a&&(t._dispatchEvent("icecandidate",new Event("icecandidate")),t.iceGatheringState="complete",t._emitGatheringStateChange()))},r.setTimeout(function(){o.forEach(function(e){n.onlocalcandidate(e)})},0))},a.prototype._createIceAndDtlsTransports=function(){var e,t=this,n=new r.RTCIceTransport(null);return n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()},e=new r.RTCDtlsTransport(n),e.ondtlsstatechange=function(){t._updateConnectionState()},e.onerror=function(){Object.defineProperty(e,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:e}},a.prototype._disposeIceAndDtlsTransports=function(t){var e=this.transceivers[t].iceGatherer;e&&(delete e.onlocalcandidate,delete this.transceivers[t].iceGatherer),e=this.transceivers[t].iceTransport,e&&(delete e.onicestatechange,delete this.transceivers[t].iceTransport),e=this.transceivers[t].dtlsTransport,e&&(delete e.ondtlsstatechange,delete e.onerror,delete this.transceivers[t].dtlsTransport)},a.prototype._transceive=function(t,o,i){var s=n(t.localCapabilities,t.remoteCapabilities);o&&t.rtpSender&&(s.encodings=t.sendEncodingParameters,s.rtcp={cname:e.localCName,compound:t.rtcpParameters.compound},t.recvEncodingParameters.length&&(s.rtcp.ssrc=t.recvEncodingParameters[0].ssrc),t.rtpSender.send(s)),i&&t.rtpReceiver&&0<s.codecs.length&&("video"===t.kind&&t.recvEncodingParameters&&c<15019&&t.recvEncodingParameters.forEach(function(e){delete e.rtx}),t.recvEncodingParameters.length?s.encodings=t.recvEncodingParameters:s.encodings=[{}],s.rtcp={compound:t.rtcpParameters.compound},t.rtcpParameters.cname&&(s.rtcp.cname=t.rtcpParameters.cname),t.sendEncodingParameters.length&&(s.rtcp.ssrc=t.sendEncodingParameters[0].ssrc),t.rtpReceiver.receive(s))},a.prototype.setLocalDescription=function(i){var a,r,c,s=this;return-1===["offer","answer"].indexOf(i.type)?Promise.reject(t("TypeError",'Unsupported type "'+i.type+'"')):!o("setLocalDescription",i.type,s.signalingState)||s._isClosed?Promise.reject(t("InvalidStateError","Can not set local "+i.type+" in state "+s.signalingState)):("offer"===i.type?(a=e.splitSections(i.sdp),r=a.shift(),a.forEach(function(t,n){t=e.parseRtpParameters(t),s.transceivers[n].localCapabilities=t}),s.transceivers.forEach(function(e,t){s._gather(e.mid,t)})):"answer"===i.type&&(a=e.splitSections(s._remoteDescription.sdp),r=a.shift(),c=0<e.matchPrefix(r,"a=ice-lite").length,a.forEach(function(o,i){var u,t=s.transceivers[i],h=t.iceGatherer,l=t.iceTransport,d=t.dtlsTransport,m=t.localCapabilities,a=t.remoteCapabilities;e.isRejected(o)&&0===e.matchPrefix(o,"a=bundle-only").length||t.rejected||(u=e.getIceParameters(o,r),o=e.getDtlsParameters(o,r),c&&(o.role="server"),s.usingBundle&&0!==i||(s._gather(t.mid,i),"new"===l.state&&l.start(h,u,c?"controlling":"controlled"),"new"===d.state&&d.start(o)),a=n(m,a),s._transceive(t,0<a.codecs.length,!1))})),s._localDescription={type:i.type,sdp:i.sdp},"offer"===i.type?s._updateSignalingState("have-local-offer"):s._updateSignalingState("stable"),Promise.resolve())},a.prototype.setRemoteDescription=function(u){if(i=this,-1===["offer","answer"].indexOf(u.type))return Promise.reject(t("TypeError",'Unsupported type "'+u.type+'"'));if(!o("setRemoteDescription",u.type,i.signalingState)||i._isClosed)return Promise.reject(t("InvalidStateError","Can not set remote "+u.type+" in state "+i.signalingState));a={},i.remoteStreams.forEach(function(e){a[e.id]=e});var i,a,p,f=[],g=e.splitSections(u.sdp),h=g.shift(),v=0<e.matchPrefix(h,"a=ice-lite").length,m=0<e.matchPrefix(h,"a=group:BUNDLE ").length;return i.usingBundle=m,p=e.matchPrefix(h,"a=ice-options:")[0],i.canTrickleIceCandidates=!!p&&0<=p.substr(14).split(" ").indexOf("trickle"),g.forEach(function(d,o){var t,j,y,O,C,E,k,A,S,M,F,T,g=e.splitLines(d),w=e.getKind(d),b=e.isRejected(d)&&0===e.matchPrefix(d,"a=bundle-only").length,x=g[0].substr(2).split(" ")[2],_=e.getDirection(d,h),p=e.parseMsid(d),z=e.getMid(d)||e.generateIdentifier();b||"application"===w&&("DTLS/SCTP"===x||"UDP/DTLS/SCTP"===x)?i.transceivers[o]={mid:z,kind:w,protocol:x,rejected:!0}:(!b&&i.transceivers[o]&&i.transceivers[o].rejected&&(i.transceivers[o]=i._createTransceiver(w,!0)),A=e.parseRtpParameters(d),b||(T=e.getIceParameters(d,h),(F=e.getDtlsParameters(d,h)).role="client"),S=e.parseRtpEncodingParameters(d),k=e.parseRtcpParameters(d),E=0<e.matchPrefix(d,"a=end-of-candidates",h).length,g=e.matchPrefix(d,"a=candidate:").map(function(t){return e.parseCandidate(t)}).filter(function(e){return 1===e.component}),("offer"===u.type||"answer"===u.type)&&!b&&m&&0<o&&i.transceivers[o]&&(i._disposeIceAndDtlsTransports(o),i.transceivers[o].iceGatherer=i.transceivers[0].iceGatherer,i.transceivers[o].iceTransport=i.transceivers[0].iceTransport,i.transceivers[o].dtlsTransport=i.transceivers[0].dtlsTransport,i.transceivers[o].rtpSender&&i.transceivers[o].rtpSender.setTransport(i.transceivers[0].dtlsTransport),i.transceivers[o].rtpReceiver&&i.transceivers[o].rtpReceiver.setTransport(i.transceivers[0].dtlsTransport)),"offer"!==u.type||b?"answer"!==u.type||b||(x=(t=i.transceivers[o]).iceGatherer,d=t.iceTransport,b=t.dtlsTransport,j=t.rtpReceiver,M=t.sendEncodingParameters,O=t.localCapabilities,i.transceivers[o].recvEncodingParameters=S,i.transceivers[o].remoteCapabilities=A,i.transceivers[o].rtcpParameters=k,g.length&&"new"===d.state&&(!v&&!E||m&&0!==o?g.forEach(function(e){s(t.iceTransport,e)}):d.setRemoteCandidates(g)),m&&0!==o||("new"===d.state&&d.start(x,T,"controlling"),"new"===b.state&&b.start(F)),!n(t.localCapabilities,t.remoteCapabilities).codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&t.sendEncodingParameters[0].rtx&&delete t.sendEncodingParameters[0].rtx,i._transceive(t,"sendrecv"===_||"recvonly"===_,"sendrecv"===_||"sendonly"===_),!j||"sendrecv"!==_&&"sendonly"!==_?delete t.rtpReceiver:(y=j.track,p?(a[p.stream]||(a[p.stream]=new r.MediaStream),l(y,a[p.stream]),f.push([y,j,a[p.stream]])):(a.default||(a.default=new r.MediaStream),l(y,a.default),f.push([y,j,a.default])))):((t=i.transceivers[o]||i._createTransceiver(w)).mid=z,t.iceGatherer||(t.iceGatherer=i._createIceGatherer(o,m)),g.length&&"new"===t.iceTransport.state&&(!E||m&&0!==o?g.forEach(function(e){s(t.iceTransport,e)}):t.iceTransport.setRemoteCandidates(g)),O=r.RTCRtpReceiver.getCapabilities(w),c<15019&&(O.codecs=O.codecs.filter(function(e){return"rtx"!==e.name})),M=t.sendEncodingParameters||[{ssrc:1001*(2*o+2)}],g=!1,"sendrecv"===_||"sendonly"===_?(g=!t.rtpReceiver,j=t.rtpReceiver||new r.RTCRtpReceiver(t.dtlsTransport,w),g&&(y=j.track,p&&"-"===p.stream||(C=p?(a[p.stream]||(a[p.stream]=new r.MediaStream,Object.defineProperty(a[p.stream],"id",{get:function(){return p.stream}})),Object.defineProperty(y,"id",{get:function(){return p.track}}),a[p.stream]):(a.default||(a.default=new r.MediaStream),a.default)),C&&(l(y,C),t.associatedRemoteMediaStreams.push(C)),f.push([y,j,C]))):t.rtpReceiver&&t.rtpReceiver.track&&(t.associatedRemoteMediaStreams.forEach(function(n){var e=n.getTracks().find(function(e){return e.id===t.rtpReceiver.track.id});e&&(e=e,(n=n).removeTrack(e),n.dispatchEvent(new r.MediaStreamTrackEvent("removetrack",{track:e})))}),t.associatedRemoteMediaStreams=[]),t.localCapabilities=O,t.remoteCapabilities=A,t.rtpReceiver=j,t.rtcpParameters=k,t.sendEncodingParameters=M,t.recvEncodingParameters=S,i._transceive(i.transceivers[o],!1,g)))}),void 0===i._dtlsRole&&(i._dtlsRole="offer"===u.type?"active":"passive"),i._remoteDescription={type:u.type,sdp:u.sdp},"offer"===u.type?i._updateSignalingState("have-remote-offer"):i._updateSignalingState("stable"),Object.keys(a).forEach(function(n){var t,e=a[n];e.getTracks().length&&(-1===i.remoteStreams.indexOf(e)&&(i.remoteStreams.push(e),(t=new Event("addstream")).stream=e,r.setTimeout(function(){i._dispatchEvent("addstream",t)})),f.forEach(function(t){var n=t[0],s=t[1];e.id===t[2].id&&d(i,n,s,[e])}))}),f.forEach(function(e){e[2]||d(i,e[0],e[1],[])}),r.setTimeout(function(){i&&i.transceivers&&i.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&0<e.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},a.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},a.prototype._updateSignalingState=function(e){this.signalingState=e,e=new Event("signalingstatechange"),this._dispatchEvent("signalingstatechange",e)},a.prototype._maybeFireNegotiationNeeded=function(){var e=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,r.setTimeout(function(){var t;e.needNegotiation&&(e.needNegotiation=!1,t=new Event("negotiationneeded"),e._dispatchEvent("negotiationneeded",t))},0))},a.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++}),e="new",0<t.failed?e="failed":0<t.checking?e="checking":0<t.disconnected?e="disconnected":0<t.new?e="new":0<t.connected?e="connected":0<t.completed&&(e="completed"),e!==this.iceConnectionState&&(this.iceConnectionState=e,e=new Event("iceconnectionstatechange"),this._dispatchEvent("iceconnectionstatechange",e))},a.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)}),t.connected+=t.completed,e="new",0<t.failed?e="failed":0<t.connecting?e="connecting":0<t.disconnected?e="disconnected":0<t.new?e="new":0<t.connected&&(e="connected"),e!==this.connectionState&&(this.connectionState=e,e=new Event("connectionstatechange"),this._dispatchEvent("connectionstatechange",e))},a.prototype.createOffer=function(){if(n=this,n._isClosed)return Promise.reject(t("InvalidStateError","Can not call createOffer after close"));var n,o,a=n.transceivers.filter(function(e){return"audio"===e.kind}).length,l=n.transceivers.filter(function(e){return"video"===e.kind}).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==s.offerToReceiveAudio&&(a=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(l=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(n.transceivers.forEach(function(e){"audio"===e.kind?--a<0&&(e.wantReceive=!1):"video"===e.kind&&--l<0&&(e.wantReceive=!1)});0<a||0<l;)0<a&&(n._createTransceiver("audio"),a--),0<l&&(n._createTransceiver("video"),l--);return o=e.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++),n.transceivers.forEach(function(t,s){var a=t.track,i=t.kind,o=t.mid||e.generateIdentifier();t.mid=o,t.iceGatherer||(t.iceGatherer=n._createIceGatherer(s,n.usingBundle)),o=r.RTCRtpSender.getCapabilities(i),c<15019&&(o.codecs=o.codecs.filter(function(e){return"rtx"!==e.name})),o.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),t.remoteCapabilities&&t.remoteCapabilities.codecs&&t.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),o.headerExtensions.forEach(function(e){(t.remoteCapabilities&&t.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})}),s=t.sendEncodingParameters||[{ssrc:1001*(2*s+1)}],a&&15019<=c&&"video"===i&&!s[0].rtx&&(s[0].rtx={ssrc:s[0].ssrc+1}),t.wantReceive&&(t.rtpReceiver=new r.RTCRtpReceiver(t.dtlsTransport,i)),t.localCapabilities=o,t.sendEncodingParameters=s}),"max-compat"!==n._config.bundlePolicy&&(o+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),o+="a=ice-options:trickle\r\n",n.transceivers.forEach(function(t,s){o+=i(t,t.localCapabilities,"offer",t.stream,n._dtlsRole),o+="a=rtcp-rsize\r\n",!t.iceGatherer||"new"===n.iceGatheringState||0!==s&&n.usingBundle||(t.iceGatherer.getLocalCandidates().forEach(function(t){t.component=1,o+="a="+e.writeCandidate(t)+"\r\n"}),"completed"===t.iceGatherer.state&&(o+="a=end-of-candidates\r\n"))}),s=new r.RTCSessionDescription({type:"offer",sdp:o}),Promise.resolve(s)},a.prototype.createAnswer=function(){var o,a,l,s=this;return s._isClosed?Promise.reject(t("InvalidStateError","Can not call createAnswer after close")):"have-remote-offer"!==s.signalingState&&"have-local-pranswer"!==s.signalingState?Promise.reject(t("InvalidStateError","Can not call createAnswer in signalingState "+s.signalingState)):(o=e.writeSessionBoilerplate(s._sdpSessionId,s._sdpSessionVersion++),s.usingBundle&&(o+="a=group:BUNDLE "+s.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),o+="a=ice-options:trickle\r\n",a=e.getMediaSections(s._remoteDescription.sdp).length,s.transceivers.forEach(function(e,r){if(!(a<r+1)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?o+="m=application 0 DTLS/SCTP 5000\r\n":o+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?o+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(o+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(o+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");e.stream&&("audio"===e.kind?t=e.stream.getAudioTracks()[0]:"video"===e.kind&&(t=e.stream.getVideoTracks()[0]),t&&15019<=c&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}));var t=n(e.localCapabilities,e.remoteCapabilities);!t.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,o+=i(e,t,"answer",e.stream,s._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(o+="a=rtcp-rsize\r\n")}}),l=new r.RTCSessionDescription({type:"answer",sdp:o}),Promise.resolve(l))},a.prototype.addIceCandidate=function(o){var i,n=this;return o&&void 0===o.sdpMLineIndex&&!o.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(h,a){if(!n._remoteDescription)return a(t("InvalidStateError","Can not add ICE candidate without a remote description"));if(o&&""!==o.candidate){var r,c,d,u,l=o.sdpMLineIndex;if(o.sdpMid)for(d=0;d<n.transceivers.length;d++)if(n.transceivers[d].mid===o.sdpMid){l=d;break}if(u=n.transceivers[l],!u)return a(t("OperationError","Can not add ICE candidate"));if(u.rejected)return h();if(r=0<Object.keys(o.candidate).length?e.parseCandidate(o.candidate):{},"tcp"===r.protocol&&(0===r.port||9===r.port))return h();if(r.component&&1!==r.component)return h();if((0===l||0<l&&u.iceTransport!==n.transceivers[0].iceTransport)&&!s(u.iceTransport,r))return a(t("OperationError","Can not add ICE candidate"));a=o.candidate.trim(),0===a.indexOf("a=")&&(a=a.substr(2)),(i=e.getMediaSections(n._remoteDescription.sdp))[l]+="a="+(r.type?a:"end-of-candidates")+"\r\n",n._remoteDescription.sdp=e.getDescription(n._remoteDescription.sdp)+i.join("")}else for(c=0;c<n.transceivers.length&&(n.transceivers[c].rejected||(n.transceivers[c].iceTransport.addRemoteCandidate({}),(i=e.getMediaSections(n._remoteDescription.sdp))[c]+="a=end-of-candidates\r\n",n._remoteDescription.sdp=e.getDescription(n._remoteDescription.sdp)+i.join(""),!n.usingBundle));c++);h()})},a.prototype.getStats=function(e){if(e&&e instanceof r.MediaStreamTrack){var s,n=null;if(this.transceivers.forEach(function(t){t.rtpSender&&t.rtpSender.track===e?n=t.rtpSender:t.rtpReceiver&&t.rtpReceiver.track===e&&(n=t.rtpReceiver)}),!n)throw t("InvalidAccessError","Invalid selector.");return n.getStats()}return s=[],this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&s.push(e[t].getStats())})}),Promise.all(s).then(function(t){var e=new Map;return t.forEach(function(t){t.forEach(function(t){e.set(t.id,t)})}),e})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(e){var t,e=r[e];e&&e.prototype&&e.prototype.getStats&&(t=e.prototype.getStats,e.prototype.getStats=function(){return t.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(n){var s;e[n].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(s=e[n]).type]||s.type,t.set(n,e[n])}),t})})});var u=["createOffer","createAnswer"];return u.forEach(function(e){var t=a.prototype[e];a.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(u=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=a.prototype[e];a.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=a.prototype[e];a.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),a}},{sdp:17}],17:[function(n,t){"use strict";var e={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};e.localCName=e.generateIdentifier(),e.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},e.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(0<t?"m="+e:e).trim()+"\r\n"})},e.getDescription=function(t){return t=e.splitSections(t),t&&t[0]},e.getMediaSections=function(t){return t=e.splitSections(t),t.shift(),t},e.matchPrefix=function(t,n){return e.splitLines(t).filter(function(e){return 0===e.indexOf(n)})},e.parseCandidate=function(s){for(var e=(0===s.indexOf("a=candidate:")?s.substring(12):s.substring(10)).split(" "),n={foundation:e[0],component:parseInt(e[1],10),protocol:e[2].toLowerCase(),priority:parseInt(e[3],10),ip:e[4],address:e[4],port:parseInt(e[5],10),type:e[7]},t=8;t<e.length;t+=2)switch(e[t]){case"raddr":n.relatedAddress=e[t+1];break;case"rport":n.relatedPort=parseInt(e[t+1],10);break;case"tcptype":n.tcpType=e[t+1];break;case"ufrag":n.ufrag=e[t+1],n.usernameFragment=e[t+1];break;default:n[e[t]]=e[t+1]}return n},e.writeCandidate=function(e){var n,t=[];return t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port),n=e.type,t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},e.parseIceOptions=function(e){return e.substr(14).split(" ")},e.parseRtpMap=function(e){var t=e.substr(9).split(" "),e={payloadType:parseInt(t.shift(),10)},t=t[0].split("/");return e.name=t[0],e.clockRate=parseInt(t[1],10),e.channels=3===t.length?parseInt(t[2],10):1,e.numChannels=e.channels,e},e.writeRtpMap=function(e){var t,n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),t=e.channels||e.numChannels||1,"a=rtpmap:"+n+" "+e.name+"/"+e.clockRate+(1!==t?"/"+t:"")+"\r\n"},e.parseExtmap=function(e){return e=e.substr(9).split(" "),{id:parseInt(e[0],10),direction:0<e[0].indexOf("/")?e[0].split("/")[1]:"sendrecv",uri:e[1]}},e.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},e.parseFmtp=function(t){for(var n,s={},o=t.substr(t.indexOf(" ")+1).split(";"),e=0;e<o.length;e++)s[(n=o[e].trim().split("="))[0].trim()]=n[1];return s},e.writeFmtp=function(e){var t,n="",s=e.payloadType;return void 0!==e.preferredPayloadType&&(s=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length&&(t=[],Object.keys(e.parameters).forEach(function(n){e.parameters[n]?t.push(n+"="+e.parameters[n]):t.push(n)}),n+="a=fmtp:"+s+" "+t.join(";")+"\r\n"),n},e.parseRtcpFb=function(e){return e=e.substr(e.indexOf(" ")+1).split(" "),{type:e.shift(),parameter:e.join(" ")}},e.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},e.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},s=e.indexOf(":",t);return-1<s?(n.attribute=e.substr(t+1,s-t-1),n.value=e.substr(s+1)):n.attribute=e.substr(t+1),n},e.parseSsrcGroup=function(e){return e=e.substr(13).split(" "),{semantics:e.shift(),ssrcs:e.map(function(e){return parseInt(e,10)})}},e.getMid=function(t){if(t=e.matchPrefix(t,"a=mid:")[0],t)return t.substr(6)},e.parseFingerprint=function(e){return e=e.substr(14).split(" "),{algorithm:e[0].toLowerCase(),value:e[1]}},e.getDtlsParameters=function(t,n){return{role:"auto",fingerprints:e.matchPrefix(t+n,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,n){var e="a=setup:"+n+"\r\n";return t.fingerprints.forEach(function(t){e+="a=fingerprint:"+t.algorithm+" "+t.value+"\r\n"}),e},e.getIceParameters=function(t,n){return t=e.splitLines(t),{usernameFragment:(t=t.concat(e.splitLines(n))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:t.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},e.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},e.parseRtpParameters=function(s){for(var t,n,i,o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=e.splitLines(s)[0].split(" "),a=3;a<r.length;a++)if(i=r[a],n=e.matchPrefix(s,"a=rtpmap:"+i+" ")[0],n)switch(t=e.parseRtpMap(n),n=e.matchPrefix(s,"a=fmtp:"+i+" "),t.parameters=n.length?e.parseFmtp(n[0]):{},t.rtcpFeedback=e.matchPrefix(s,"a=rtcp-fb:"+i+" ").map(e.parseRtcpFb),o.codecs.push(t),t.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(t.name.toUpperCase())}return e.matchPrefix(s,"a=extmap:").forEach(function(t){o.headerExtensions.push(e.parseExtmap(t))}),o},e.writeRtpDescription=function(o,n){var s,t="";return t+="m="+o+" ",t+=0<n.codecs.length?"9":"0",t+=" UDP/TLS/RTP/SAVPF ",t+=n.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",t+="c=IN IP4 0.0.0.0\r\n",t+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach(function(n){t+=e.writeRtpMap(n),t+=e.writeFmtp(n),t+=e.writeRtcpFb(n)}),s=0,n.codecs.forEach(function(e){e.maxptime>s&&(s=e.maxptime)}),0<s&&(t+="a=maxptime:"+s+"\r\n"),t+="a=rtcp-mux\r\n",n.headerExtensions&&n.headerExtensions.forEach(function(n){t+=e.writeExtmap(n)}),t},e.parseRtpEncodingParameters=function(i){var t,r,o=[],a=e.parseRtpParameters(i),c=-1!==a.fecMechanisms.indexOf("RED"),l=-1!==a.fecMechanisms.indexOf("ULPFEC"),n=e.matchPrefix(i,"a=ssrc:").map(function(t){return e.parseSsrcMedia(t)}).filter(function(e){return"cname"===e.attribute}),s=0<n.length&&n[0].ssrc,n=e.matchPrefix(i,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});return 0<n.length&&1<n[0].length&&n[0][0]===s&&(r=n[0][1]),a.codecs.forEach(function(e){"RTX"===e.name.toUpperCase()&&e.parameters.apt&&(e={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)},s&&r&&(e.rtx={ssrc:r}),o.push(e),c&&((e=JSON.parse(JSON.stringify(e))).fec={ssrc:s,mechanism:l?"red+ulpfec":"red"},o.push(e)))}),0===o.length&&s&&o.push({ssrc:s}),t=e.matchPrefix(i,"b="),t.length&&(t=0===t[0].indexOf("b=TIAS:")?parseInt(t[0].substr(7),10):0===t[0].indexOf("b=AS:")?1e3*parseInt(t[0].substr(5),10)*.95-16e3:void 0,o.forEach(function(e){e.maxBitrate=t})),o},e.parseRtcpParameters=function(s){var t={},n=e.matchPrefix(s,"a=ssrc:").map(function(t){return e.parseSsrcMedia(t)}).filter(function(e){return"cname"===e.attribute})[0];return n&&(t.cname=n.value,t.ssrc=n.ssrc),n=e.matchPrefix(s,"a=rtcp-rsize"),t.reducedSize=0<n.length,t.compound=0===n.length,s=e.matchPrefix(s,"a=rtcp-mux"),t.mux=0<s.length,t},e.parseMsid=function(t){var n,s=e.matchPrefix(t,"a=msid:");return 1===s.length?{stream:(n=s[0].substr(7).split(" "))[0],track:n[1]}:(t=e.matchPrefix(t,"a=ssrc:").map(function(t){return e.parseSsrcMedia(t)}).filter(function(e){return"msid"===e.attribute}),0<t.length?{stream:(n=t[0].value.split(" "))[0],track:n[1]}:void 0)},e.generateSessionId=function(){return Math.random().toString().substr(2,21)},e.writeSessionBoilerplate=function(n,t,s){return t=void 0!==t?t:2,n=n||e.generateSessionId(),"v=0\r\no="+(s||"thisisadapterortc")+" "+n+" "+t+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},e.writeMediaSection=function(t,n,o,s){return n=e.writeRtpDescription(t.kind,n),n+=e.writeIceParameters(t.iceGatherer.getLocalParameters()),n+=e.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),"offer"===o?"actpass":"active"),n+="a=mid:"+t.mid+"\r\n",t.direction?n+="a="+t.direction+"\r\n":t.rtpSender&&t.rtpReceiver?n+="a=sendrecv\r\n":t.rtpSender?n+="a=sendonly\r\n":t.rtpReceiver?n+="a=recvonly\r\n":n+="a=inactive\r\n",t.rtpSender&&(n+="a="+(s="msid:"+s.id+" "+t.rtpSender.track.id+"\r\n"),n+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+s,t.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" "+s,n+="a=ssrc-group:FID "+t.sendEncodingParameters[0].ssrc+" "+t.sendEncodingParameters[0].rtx.ssrc+"\r\n")),n+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+e.localCName+"\r\n",t.rtpSender&&t.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" cname:"+e.localCName+"\r\n"),n},e.getDirection=function(o,s){for(var n=e.splitLines(o),t=0;t<n.length;t++)switch(n[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[t].substr(2)}return s?e.getDirection(s):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substr(2)},e.isRejected=function(e){return"0"===e.split(" ",2)[1]},e.parseMLine=function(t){return t=e.splitLines(t)[0].substr(2).split(" "),{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},e.parseOLine=function(t){return t=e.matchPrefix(t,"o=")[0].substr(2).split(" "),{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},e.isValidSDP=function(n){if("string"!=typeof n||0===n.length)return!1;for(var s=e.splitLines(n),t=0;t<s.length;t++)if(s[t].length<2||"="!==s[t].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=e)},{}]},{},[1])(1)})