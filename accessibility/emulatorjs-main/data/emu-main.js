window.EJS_main=function(eJ,eC,g){'use strict';window.EJS_RESET_VARS=[];for(eq in window)window.EJS_RESET_VARS.push(eq);g.r(eC);var i,l,v,b,j,E,T,D,U,Q,Z,J,eq,ea={volume:.5,muted:!1,i18n:{restart:"Restart",play:"Play",pause:"Pause",played:"Played",volume:"Volume",mute:"Mute (F9)",unmute:"Unmute (F9)",enterFullscreen:"Enter fullscreen",exitFullscreen:"Exit fullscreen",settings:"Settings",saveState:"Save State (Shift + F2)",loadState:"Load State (Shift + F4)",screenRecord:"Start Screen Recording",netplay:"Netplay",gamepad:"Control Settings",cheat:"Cheats",menuBack:"Go back to previous menu",normal:"Normal",all:"All",reset:"Reset",disabled:"Disabled",enabled:"Enabled",playNow:"Play Now"},listeners:{play:null,pause:null,restart:null,rewind:null,mute:null,volume:null,fullscreen:null},events:["ready"],selectors:{editable:"input, textarea, select, [contenteditable]",container:".ejs",controls:{container:null,wrapper:".jes__controls"},buttons:{play:'[data-btn="play"]',pause:'[data-btn="pause"]',mute:'[data-btn="mute"]',fullscreen:'[data-btn="fullscreen"]',settings:'[data-btn="settings"]',saveState:'[data-btn="save-state"]',loadState:'[data-btn="load-state"]',screenRecord:'[data-btn="screen-record"]',gamepad:'[data-btn="gamepad"]',netplay:'[data-btn="netplay"]',cheat:'[data-btn="cheat"]'},inputs:{volume:'[data-range="volume"]'}},classNames:{type:"ejs--video",video:"ejs__video-wrapper",poster:"ejs__poster",posterEnabled:"ejs__poster-enabled",control:"ejs__control",controlPressed:"ejs__control--pressed",playing:"ejs--playing",paused:"ejs--paused",stopped:"ejs--stopped",loading:"ejs--loading",hover:"ejs--hover",tooltip:"ejs__tooltip",hidden:"ejs__sr-only",hideControls:"ejs--hide-controls",isIos:"ejs--is-ios",isTouch:"ejs--is-touch",uiSupported:"ejs--full-ui",noTransition:"ejs--no-transition",menu:{value:"ejs__menu__value",badge:"ejs__badge",open:"ejs--menu-open"},fullscreen:{enabled:"ejs--fullscreen-enabled",fallback:"ejs--fullscreen-fallback"},tabFocus:"ejs__tab-focus"}},x=g(0),eQ=g(157),eG=g.n(eQ),M=function(e){return null!=e?e.constructor:null},C=function(e,t){return Boolean(e&&t&&e instanceof t)},X=function(e){return null==e},e_=function(e){return M(e)===Object},K=function(e){return M(e)===String},ey=function(e){return Array.isArray(e)},ed=function(e){return C(e,NodeList)},ev=function(e){return X(e)||(K(e)||ey(e)||ed(e))&&!e.length||e_(e)&&!Object.keys(e).length},s={nullOrUndefined:X,object:e_,number:function(e){return M(e)===Number&&!Number.isNaN(e)},string:K,boolean:function(e){return M(e)===Boolean},function:function(e){return M(e)===Function},array:ey,weakMap:function(e){return C(e,WeakMap)},nodeList:ed,element:function(e){return C(e,Element)},textNode:function(e){return M(e)===Text},event:function(e){return C(e,Event)},keyboardEvent:function(e){return C(e,KeyboardEvent)},cue:function(e){return C(e,window.TextTrackCue)||C(e,window.VTTCue)},track:function(e){return C(e,TextTrack)||!X(e)&&K(e.kind)},url:function(e){if(C(e,window.URL))return!0;var t=e;e.startsWith("http://")&&e.startsWith("https://")||(t="http://".concat(e));try{return!ev(new URL(t).hostname)}catch(e){return!1}},empty:ev},eY=function(){var e,t=!1;try{e=Object.defineProperty({},"passive",{get:function(){return t=!0,null}}),window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch(e){}return t}(),e5,eg,e2,ef,ew,eO,ec;function F(e,i,o){var t,c,n=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];e&&"addEventListener"in e&&!s.empty(i)&&s.function(o)&&(c=i.split(" "),t=r,eY&&(t={passive:l,capture:r}),c.forEach(function(s){n&&n.eventListeners&&a&&n.eventListeners.push({element:e,type:s,callback:o,options:t}),e[a?"addEventListener":"removeEventListener"](s,o,t)}))}function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:'',n=arguments.length>2?arguments[2]:void 0,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];F.call(this,e,t,n,!0,s,o)}function er(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:'',n=arguments.length>2?arguments[2]:void 0,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];F.call(this,e,t,n,!1,s,o)}function en(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:'',o=arguments.length>2?arguments[2]:void 0,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];F.call(this,e,t,function c(){er(e,t,c,n,s);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];o.apply(this,r)},!0,n,s)}function p(e){var n,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:'',o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};s.element(e)&&!s.empty(t)&&(n=new CustomEvent(t,{bubbles:o,detail:Object.assign({},i,{emulator:this})}),e.dispatchEvent(n))}e5=g(158),eg=g.n(e5);function ep(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(r,a){var e,s,t=[],n=!0,o=!1,i=void 0;try{for(e=r[Symbol.iterator]();!(n=(s=e.next()).done)&&(t.push(s.value),!a||t.length!==a);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==e.return||e.return()}finally{if(o)throw i}}return t}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function e6(e,t){var n=e.length?e:[e];Array.from(n).reverse().forEach(function(e,i){var n=i>0?t.cloneNode(!0):t,s=e.parentNode,o=e.nextSibling;n.appendChild(e),o?s.insertBefore(n,o):s.appendChild(n)})}function el(e,t){s.element(e)&&!s.empty(t)&&Object.entries(t).filter(function(e){var t=ep(e,2)[1];return!s.nullOrUndefined(t)}).forEach(function(n){var t=ep(n,2),s=t[0],o=t[1];return e.setAttribute(s,o)})}function c(o,t,n){var e=document.createElement(o);return s.object(t)&&el(e,t),s.string(n)&&(e.innerText=n),e}function eh(e){s.nodeList(e)||s.array(e)?Array.from(e).forEach(eh):s.element(e)&&s.element(e.parentNode)&&e.parentNode.removeChild(e)}function N(t,o){if(!s.string(t)||s.empty(t))return{};var e={},n=o;return t.split(",").forEach(function(a){var t=a.trim(),i=t.replace(".",''),o=t.replace(/[[\]]/g,'').split("="),r=o[0],c=o.length>1?o[1].replace(/["']/g,''):'';switch(t.charAt(0)){case".":s.object(n)&&s.string(n.class)&&(n.class+=" ".concat(i)),e.class=i;break;case"#":e.id=t.replace("#",'');break;case"[":e[r]=c}}),e}function a(e,n){if(s.element(e)){var t=n;s.boolean(t)||(t=!e.hidden),t?e.setAttribute("hidden",''):e.removeAttribute("hidden")}}function h(e,t,n){if(s.nodeList(e))return Array.from(e).map(function(e){return h(e,t,n)});if(s.element(e)){var o="toggle";return void 0!==n&&(o=n?"add":"remove"),e.classList[o](t),e.classList.contains(t)}return!1}function et(e,t){return s.element(e)&&e.classList.contains(t)}function ee(n,t){var e={Element};return(e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector||function(){return Array.from(document.querySelectorAll(t)).includes(this)}).call(n,t)}function k(e){return this.elements.container.querySelectorAll(e)}function u(e){return this.elements.container.querySelector(e)}function eK(){if(t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s.element(t)){var t,n,e=k.call(this,"button:not(:disabled), input:not(:disabled), [tabindex]"),o=e[0],i=e[e.length-1];F.call(this,this.elements.container,"keydown",function(e){if("Tab"===e.key&&9===e.keyCode){var t=document.activeElement;t!==i||e.shiftKey?t===o&&e.shiftKey&&(i.focus(),e.preventDefault()):(o.focus(),e.preventDefault())}},n,!1)}}function Y(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];s.element(e)&&(e.focus(),t&&h(e,this.config.classNames.tabFocus))}function n(e){return eG.a.bind(eg.a)(e)}U=(e2=document.createElement("span"),J={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},Z=Object.keys(J).find(function(e){return void 0!==e2.style[e]}),!!s.string(Z)&&J[Z]);function e0(e){setTimeout(function(){try{a(e,!0),e.offsetHeight,a(e,!1)}catch(e){}},0)}b={isEdge:"Netscape"===navigator.appName&&navigator.appVersion.indexOf("Edge")>-1,isIE:!!document.documentMode,isWebkit:"WebkitAppearance"in document.documentElement.style&&!/Edge/.test(navigator.userAgent),isIPhone:/(iPhone|iPod)/gi.test(navigator.platform),isIos:/(iPad|iPhone|iPod)/gi.test(navigator.platform),info:function(){var e=/(MSIE|(?!Gecko.+)Firefox|(?!AppleWebKit.+Chrome.+)Safari|(?!AppleWebKit.+)Chrome|AppleWebKit(?!.+Chrome|.+Safari)|Gecko(?!.+Firefox))(?: |\/)([\d.apre]+)/.exec(navigator.userAgent);return{name:e[1].toLowerCase(),version:e[2]}}},j={rangeInput:(Q=document.createElement("input"),Q.type="range","range"===Q.type),touch:"ontouchstart"in document.documentElement,transitions:!1!==U,reducedMotion:"matchMedia"in window&&window.matchMedia("(prefers-reduced-motion)").matches,webgl:function(){if(t={DETECTED:!1},!t.DETECTED&&(n=document.createElement("canvas"),n&&n.getContext))for(var e,t,n,s,i,a=["webgl2","experimental-webgl2","webgl","experimental-webgl"],o=0,r=a.length;o<r;++o)if(i=a[o],e=n.getContext(i),e){t.WEBGL_CONTEXT=i,t.WEBGL_VERSION=e.getParameter(e.VERSION),t.WEBGL_VENDOR=e.getParameter(e.VENDOR),t.WEBGL_SL_VERSION=e.getParameter(e.SHADING_LANGUAGE_VERSION),t.MAX_TEXTURE_SIZE=e.getParameter(e.MAX_TEXTURE_SIZE),s=e.getExtension("WEBGL_debug_renderer_info"),s&&(t.WEBGL_VENDOR=e.getParameter(s.UNMASKED_VENDOR_WEBGL),t.WEBGL_RENDERER=e.getParameter(s.UNMASKED_RENDERER_WEBGL)),t.DETECTED=!0;break}return t}(),wasm:"undefined"!=typeof WebAssembly&&s.object(WebAssembly),audioContext:"undefined"!=typeof AudioContext};function e4(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function eU(e,t){return t.split(".").reduce(function(e,t){return e&&e[t]},e)}function y(){for(var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length,n=new Array(i>1?i-1:0),o=1;o<i;o++)n[o-1]=arguments[o];return n.length?(t=n.shift(),s.object(t)?(Object.keys(t).forEach(function(n){s.object(t[n])?(Object.keys(e).includes(n)||Object.assign(e,e4({},n,{})),y(e[n],t[n])):Object.assign(e,e4({},n,t[n]))}),y.apply(void 0,[e].concat(n))):e):e}function H(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'',t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:'',n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:'';return e.replace(new RegExp(t.toString().replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1"),"g"),n.toString())}function eW(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:'').toString();return(e=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:'').toString();return e=H(e,"-"," "),e=H(e,"_"," "),H(e=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:'').toString().replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}(e)," ",'')}(e)).charAt(0).toLowerCase()+e.slice(1)}function eV(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(r,a){var e,s,t=[],n=!0,o=!1,i=void 0;try{for(e=r[Symbol.iterator]();!(n=(s=e.next()).done)&&(t.push(s.value),!a||t.length!==a);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==e.return||e.return()}finally{if(o)throw i}}return t}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}D={get:function(){var e,o,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'',t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s.empty(n)||s.empty(t)?'':(e=eU(t.i18n,n),s.empty(e)?'':(o={'{seektime}':t.seekTime,'{title}':t.title},Object.entries(o).forEach(function(n){var t=eV(n,2),s=t[0],o=t[1];e=H(e,s,o)}),e))}};function e1(s,n){for(var e,t=0;t<n.length;t++)e=n[t],e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(s,e.key,e)}var eu=function(){function e(n,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.enabled=!0,this.key=t}var t,n,o;return t=e,n=[{key:"supported",get:function(){try{return"localStorage"in window&&(window.localStorage.getItem("___test")||window.localStorage.setItem("___test","___test"),!0)}catch(e){return!1}}}],(o=[{key:"get",value:function(t){if(!e.supported||!this.enabled)return null;var n,o=window.localStorage.getItem(this.key);return s.empty(o)?null:(n=JSON.parse(o),s.string(t)&&t.length?n[t]:n)}},{key:"set",value:function(n){if(e.supported&&this.enabled&&s.object(n)){var t=this.get();s.empty(t)&&(t={}),y(t,n),window.localStorage.setItem(this.key,JSON.stringify(t))}}}])&&e1(t.prototype,o),n&&e1(t,n),e}(),es,eB=g(108),eE=g.n(eB),m=g(6),eI=g(159),eH=g.n(eI),eP={'2xScaleHQ.glslp':'shaders = 1\n\nshader0 = "2xScaleHQ.glsl"\nfilter_linear0 = false\nscale_type_0 = source\n','4xScaleHQ.glslp':'shaders = 1\n\nshader0 = "4xScaleHQ.glsl"\nfilter_linear0 = false\nscale_type_0 = source\n','crt-easymode.glslp':"shaders = 1\n\nshader0 = crt-easymode.glsl\nfilter_linear0 = false\nscale_type_0 = source\n",'crt-aperture.glslp':"shaders = 1\n\nshader0 = crt-aperture.glsl\nfilter_linear0 = false\n",'crt-geom.glslp':"shaders = 1\n\nshader0 = crt-geom.glsl\nfilter_linear0 = false\nscale_type_0 = source\n",'2xScaleHQ.glsl':"/*\n2xGLSLHqFilter shader\n\nCopyright (C) 2005 guest(r) - guest.r@gmail.com\n\nThis program is free software; you can redistribute it and/or\nmodify it under the terms of the GNU General Public License\nas published by the Free Software Foundation; either version 2\nof the License, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program; if not, write to the Free Software\nFoundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.\n*/\n\n#if defined(VERTEX)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING out\n#define COMPAT_ATTRIBUTE in\n#define COMPAT_TEXTURE texture\n#else\n#define COMPAT_VARYING varying \n#define COMPAT_ATTRIBUTE attribute \n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nCOMPAT_ATTRIBUTE vec4 VertexCoord;\nCOMPAT_ATTRIBUTE vec4 COLOR;\nCOMPAT_ATTRIBUTE vec4 TexCoord;\nCOMPAT_VARYING vec4 COL0;\nCOMPAT_VARYING vec4 TEX0;\nCOMPAT_VARYING vec4 t1;\nCOMPAT_VARYING vec4 t2;\nCOMPAT_VARYING vec4 t3;\nCOMPAT_VARYING vec4 t4;\n\nvec4 _oPosition1; \nuniform mat4 MVPMatrix;\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\n\n// compatibility #defines\n#define vTexCoord TEX0.xy\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define OutSize vec4(OutputSize, 1.0 / OutputSize)\n\nvoid main()\n{\ngl_Position = MVPMatrix * VertexCoord;\nTEX0.xy = TexCoord.xy;\nfloat x = 0.5 * SourceSize.z;\nfloat y = 0.5 * SourceSize.w;\nvec2 dg1 = vec2( x, y);\nvec2 dg2 = vec2(-x, y);\nvec2 dx = vec2(x, 0.0);\nvec2 dy = vec2(0.0, y);\nt1 = vec4(vTexCoord - dg1, vTexCoord - dy);\nt2 = vec4(vTexCoord - dg2, vTexCoord + dx);\nt3 = vec4(vTexCoord + dg1, vTexCoord + dy);\nt4 = vec4(vTexCoord + dg2, vTexCoord - dx);\n}\n\n#elif defined(FRAGMENT)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING in\n#define COMPAT_TEXTURE texture\nout vec4 FragColor;\n#else\n#define COMPAT_VARYING varying\n#define FragColor gl_FragColor\n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\nuniform sampler2D Texture;\nCOMPAT_VARYING vec4 TEX0;\nCOMPAT_VARYING vec4 t1;\nCOMPAT_VARYING vec4 t2;\nCOMPAT_VARYING vec4 t3;\nCOMPAT_VARYING vec4 t4;\n\n// compatibility #defines\n#define Source Texture\n#define vTexCoord TEX0.xy\n\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define OutSize vec4(OutputSize, 1.0 / OutputSize)\n\nfloat mx = 0.325;      // start smoothing wt.\nfloat k = -0.250;      // wt. decrease factor\nfloat max_w = 0.25;    // max filter weight\nfloat min_w =-0.05;    // min filter weight\nfloat lum_add = 0.25;  // affects smoothing\nvec3 dt = vec3(1.0);\n\nvoid main()\n{\nvec3 c00 = COMPAT_TEXTURE(Source, t1.xy).xyz; \nvec3 c10 = COMPAT_TEXTURE(Source, t1.zw).xyz; \nvec3 c20 = COMPAT_TEXTURE(Source, t2.xy).xyz; \nvec3 c01 = COMPAT_TEXTURE(Source, t4.zw).xyz; \nvec3 c11 = COMPAT_TEXTURE(Source, vTexCoord).xyz; \nvec3 c21 = COMPAT_TEXTURE(Source, t2.zw).xyz; \nvec3 c02 = COMPAT_TEXTURE(Source, t4.xy).xyz; \nvec3 c12 = COMPAT_TEXTURE(Source, t3.zw).xyz; \nvec3 c22 = COMPAT_TEXTURE(Source, t3.xy).xyz; \n\nfloat md1 = dot(abs(c00 - c22), dt);\nfloat md2 = dot(abs(c02 - c20), dt);\n\nfloat w1 = dot(abs(c22 - c11), dt) * md2;\nfloat w2 = dot(abs(c02 - c11), dt) * md1;\nfloat w3 = dot(abs(c00 - c11), dt) * md2;\nfloat w4 = dot(abs(c20 - c11), dt) * md1;\n\nfloat t1 = w1 + w3;\nfloat t2 = w2 + w4;\nfloat ww = max(t1, t2) + 0.0001;\n\nc11 = (w1 * c00 + w2 * c20 + w3 * c22 + w4 * c02 + ww * c11) / (t1 + t2 + ww);\n\nfloat lc1 = k / (0.12 * dot(c10 + c12 + c11, dt) + lum_add);\nfloat lc2 = k / (0.12 * dot(c01 + c21 + c11, dt) + lum_add);\n\nw1 = clamp(lc1 * dot(abs(c11 - c10), dt) + mx, min_w, max_w);\nw2 = clamp(lc2 * dot(abs(c11 - c21), dt) + mx, min_w, max_w);\nw3 = clamp(lc1 * dot(abs(c11 - c12), dt) + mx, min_w, max_w);\nw4 = clamp(lc2 * dot(abs(c11 - c01), dt) + mx, min_w, max_w);\nFragColor = vec4(w1 * c10 + w2 * c21 + w3 * c12 + w4 * c01 + (1.0 - w1 - w2 - w3 - w4) * c11, 1.0);\n} \n#endif\n",'4xScaleHQ.glsl':"/*\n4xGLSLHqFilter shader\n\nCopyright (C) 2005 guest(r) - guest.r@gmail.com\n\nThis program is free software; you can redistribute it and/or\nmodify it under the terms of the GNU General Public License\nas published by the Free Software Foundation; either version 2\nof the License, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program; if not, write to the Free Software\nFoundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.\n*/\n\n#if defined(VERTEX)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING out\n#define COMPAT_ATTRIBUTE in\n#define COMPAT_TEXTURE texture\n#else\n#define COMPAT_VARYING varying \n#define COMPAT_ATTRIBUTE attribute \n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nCOMPAT_ATTRIBUTE vec4 VertexCoord;\nCOMPAT_ATTRIBUTE vec4 COLOR;\nCOMPAT_ATTRIBUTE vec4 TexCoord;\nCOMPAT_VARYING vec4 COL0;\nCOMPAT_VARYING vec4 TEX0;\nCOMPAT_VARYING vec4 t1;\nCOMPAT_VARYING vec4 t2;\nCOMPAT_VARYING vec4 t3;\nCOMPAT_VARYING vec4 t4;\nCOMPAT_VARYING vec4 t5;\nCOMPAT_VARYING vec4 t6;\n\nvec4 _oPosition1; \nuniform mat4 MVPMatrix;\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\n\n// compatibility #defines\n#define vTexCoord TEX0.xy\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define OutSize vec4(OutputSize, 1.0 / OutputSize)\n\nvoid main()\n{\ngl_Position = MVPMatrix * VertexCoord;\nTEX0.xy = TexCoord.xy;\nfloat x = 0.5 * SourceSize.z;\nfloat y = 0.5 * SourceSize.w;\nvec2 dg1 = vec2( x, y);\nvec2 dg2 = vec2(-x, y);\nvec2 sd1 = dg1 * 0.5;\nvec2 sd2 = dg2 * 0.5;\nvec2 ddx = vec2(x, 0.0);\nvec2 ddy = vec2(0.0, y);\nt1 = vec4(vTexCoord - sd1, vTexCoord - ddy);\nt2 = vec4(vTexCoord - sd2, vTexCoord + ddx);\nt3 = vec4(vTexCoord + sd1, vTexCoord + ddy);\nt4 = vec4(vTexCoord + sd2, vTexCoord - ddx);\nt5 = vec4(vTexCoord - dg1, vTexCoord - dg2);\nt6 = vec4(vTexCoord + dg1, vTexCoord + dg2);\n}\n\n#elif defined(FRAGMENT)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING in\n#define COMPAT_TEXTURE texture\nout vec4 FragColor;\n#else\n#define COMPAT_VARYING varying\n#define FragColor gl_FragColor\n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\nuniform sampler2D Texture;\nCOMPAT_VARYING vec4 TEX0;\nCOMPAT_VARYING vec4 t1;\nCOMPAT_VARYING vec4 t2;\nCOMPAT_VARYING vec4 t3;\nCOMPAT_VARYING vec4 t4;\nCOMPAT_VARYING vec4 t5;\nCOMPAT_VARYING vec4 t6;\n\n// compatibility #defines\n#define Source Texture\n#define vTexCoord TEX0.xy\n\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define OutSize vec4(OutputSize, 1.0 / OutputSize)\n\nfloat mx = 1.0;      // start smoothing wt.\nfloat k = -1.10;      // wt. decrease factor\nfloat max_w = 0.75;    // max filter weight\nfloat min_w = 0.03;    // min filter weight\nfloat lum_add = 0.33;  // affects smoothing\nvec3 dt = vec3(1.0);\n\nvoid main()\n{\nvec3 c  = COMPAT_TEXTURE(Source, vTexCoord).xyz;\nvec3 i1 = COMPAT_TEXTURE(Source, t1.xy).xyz; \nvec3 i2 = COMPAT_TEXTURE(Source, t2.xy).xyz; \nvec3 i3 = COMPAT_TEXTURE(Source, t3.xy).xyz; \nvec3 i4 = COMPAT_TEXTURE(Source, t4.xy).xyz; \nvec3 o1 = COMPAT_TEXTURE(Source, t5.xy).xyz; \nvec3 o3 = COMPAT_TEXTURE(Source, t6.xy).xyz; \nvec3 o2 = COMPAT_TEXTURE(Source, t5.zw).xyz;\nvec3 o4 = COMPAT_TEXTURE(Source, t6.zw).xyz;\nvec3 s1 = COMPAT_TEXTURE(Source, t1.zw).xyz; \nvec3 s2 = COMPAT_TEXTURE(Source, t2.zw).xyz; \nvec3 s3 = COMPAT_TEXTURE(Source, t3.zw).xyz; \nvec3 s4 = COMPAT_TEXTURE(Source, t4.zw).xyz; \n\nfloat ko1=dot(abs(o1-c),dt);\nfloat ko2=dot(abs(o2-c),dt);\nfloat ko3=dot(abs(o3-c),dt);\nfloat ko4=dot(abs(o4-c),dt);\n\nfloat k1=min(dot(abs(i1-i3),dt),max(ko1,ko3));\nfloat k2=min(dot(abs(i2-i4),dt),max(ko2,ko4));\n\nfloat w1 = k2; if(ko3<ko1) w1*=ko3/ko1;\nfloat w2 = k1; if(ko4<ko2) w2*=ko4/ko2;\nfloat w3 = k2; if(ko1<ko3) w3*=ko1/ko3;\nfloat w4 = k1; if(ko2<ko4) w4*=ko2/ko4;\n\nc=(w1*o1+w2*o2+w3*o3+w4*o4+0.001*c)/(w1+w2+w3+w4+0.001);\nw1 = k*dot(abs(i1-c)+abs(i3-c),dt)/(0.125*dot(i1+i3,dt)+lum_add);\nw2 = k*dot(abs(i2-c)+abs(i4-c),dt)/(0.125*dot(i2+i4,dt)+lum_add);\nw3 = k*dot(abs(s1-c)+abs(s3-c),dt)/(0.125*dot(s1+s3,dt)+lum_add);\nw4 = k*dot(abs(s2-c)+abs(s4-c),dt)/(0.125*dot(s2+s4,dt)+lum_add);\n\nw1 = clamp(w1+mx,min_w,max_w); \nw2 = clamp(w2+mx,min_w,max_w);\nw3 = clamp(w3+mx,min_w,max_w); \nw4 = clamp(w4+mx,min_w,max_w);\n\nFragColor = vec4((w1*(i1+i3)+w2*(i2+i4)+w3*(s1+s3)+w4*(s2+s4)+c)/(2.0*(w1+w2+w3+w4)+1.0), 1.0);\n} \n#endif\n",'crt-easymode.glsl':"#if defined(VERTEX)\n\n    #if __VERSION__ >= 130\n    #define COMPAT_VARYING out\n    #define COMPAT_ATTRIBUTE in\n    #define COMPAT_TEXTURE texture\n    #else\n    #define COMPAT_VARYING varying\n    #define COMPAT_ATTRIBUTE attribute\n    #define COMPAT_TEXTURE texture2D\n    #endif\n    \n    #ifdef GL_ES\n    #define COMPAT_PRECISION mediump\n    #else\n    #define COMPAT_PRECISION\n    #endif\n    COMPAT_VARYING     float _frame_rotation;\n    struct input_dummy {\n    vec2 _video_size;\n    vec2 _texture_size;\n    vec2 _output_dummy_size;\n    float _frame_count;\n    float _frame_direction;\n    float _frame_rotation;\n    };\n    vec4 _oPosition1;\n    vec4 _r0005;\n    COMPAT_ATTRIBUTE vec4 VertexCoord;\n    COMPAT_ATTRIBUTE vec4 TexCoord;\n    COMPAT_VARYING vec4 TEX0;\n    \n    uniform mat4 MVPMatrix;\n    uniform int FrameDirection;\n    uniform int FrameCount;\n    uniform COMPAT_PRECISION vec2 OutputSize;\n    uniform COMPAT_PRECISION vec2 TextureSize;\n    uniform COMPAT_PRECISION vec2 InputSize;\n    void main()\n    {\n    vec2 _oTex;\n    _r0005 = VertexCoord.x*MVPMatrix[0];\n    _r0005 = _r0005 + VertexCoord.y*MVPMatrix[1];\n    _r0005 = _r0005 + VertexCoord.z*MVPMatrix[2];\n    _r0005 = _r0005 + VertexCoord.w*MVPMatrix[3];\n    _oPosition1 = _r0005;\n    _oTex = TexCoord.xy;\n    gl_Position = _r0005;\n    TEX0.xy = TexCoord.xy;\n    }\n    #elif defined(FRAGMENT)\n    \n    #if __VERSION__ >= 130\n    #define COMPAT_VARYING in\n    #define COMPAT_TEXTURE texture\n    out vec4 FragColor;\n    #else\n    #define COMPAT_VARYING varying\n    #define FragColor gl_FragColor\n    #define COMPAT_TEXTURE texture2D\n    #endif\n    \n    #ifdef GL_ES\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    #else\n    precision mediump float;\n    #endif\n    #define COMPAT_PRECISION mediump\n    #else\n    #define COMPAT_PRECISION\n    #endif\n    COMPAT_VARYING     float _frame_rotation;\n    struct input_dummy {\n    vec2 _video_size;\n    vec2 _texture_size;\n    vec2 _output_dummy_size;\n    float _frame_count;\n    float _frame_direction;\n    float _frame_rotation;\n    };\n    vec4 _ret_0;\n    float _TMP30;\n    float _TMP29;\n    float _TMP28;\n    float _TMP13;\n    float _TMP32;\n    float _TMP11;\n    float _TMP10;\n    float _TMP31;\n    float _TMP9;\n    float _TMP8;\n    float _TMP15;\n    float _TMP14;\n    float _TMP33;\n    vec4 _TMP34;\n    vec4 _TMP27;\n    vec4 _TMP25;\n    vec4 _TMP23;\n    vec4 _TMP21;\n    vec4 _TMP26;\n    vec4 _TMP24;\n    vec4 _TMP22;\n    vec4 _TMP20;\n    float _TMP4;\n    vec4 _TMP3;\n    vec4 _TMP2;\n    float _TMP19;\n    float _TMP18;\n    float _TMP17;\n    float _TMP16;\n    vec4 _TMP1;\n    vec2 _TMP0;\n    uniform sampler2D Texture;\n    input_dummy _IN1;\n    float _TMP43;\n    float _x_step0044;\n    float _curve0044;\n    float _a0048;\n    float _val0052;\n    float _a0052;\n    vec4 _TMP57;\n    vec4 _x0072;\n    vec2 _c0086;\n    vec4 _x0088;\n    vec4 _x0094;\n    vec2 _c0098;\n    vec4 _x0100;\n    vec2 _c0104;\n    vec4 _x0106;\n    vec4 _sample_min0110;\n    vec4 _sample_max0110;\n    vec4 _r0112;\n    vec4 _TMP117;\n    vec2 _co0124;\n    vec2 _c0126;\n    vec4 _x0128;\n    vec4 _x0134;\n    vec2 _c0138;\n    vec4 _x0140;\n    vec2 _c0144;\n    vec4 _x0146;\n    vec4 _sample_min0150;\n    vec4 _sample_max0150;\n    vec4 _r0152;\n    vec4 _TMP157;\n    float _TMP163;\n    float _x_step0164;\n    float _curve0164;\n    float _a0168;\n    float _val0172;\n    float _a0172;\n    float _TMP183;\n    float _TMP189;\n    float _x0190;\n    float _a0196;\n    float _x0198;\n    vec2 _x0200;\n    float _x0208;\n    COMPAT_VARYING vec4 TEX0;\n    \n    uniform COMPAT_PRECISION vec2 OutputSize;\n    uniform COMPAT_PRECISION vec2 TextureSize;\n    uniform COMPAT_PRECISION vec2 InputSize;\n    void main()\n    {\n    vec2 _dx1;\n    vec2 _dy;\n    vec2 _pix_co;\n    vec2 _tex_co;\n    vec2 _dist;\n    vec3 _col2;\n    vec3 _col21;\n    vec4 _coeffs1;\n    float _luma;\n    float _bright;\n    float _scan_weight;\n    vec2 _mod_fac;\n    int _dot_no;\n    vec3 _mask_weight;\n    vec3 _TMP37;\n    _dx1 = vec2(1.00000000E+00/TextureSize.x, 0.00000000E+00);\n    _dy = vec2(0.00000000E+00, 1.00000000E+00/TextureSize.y);\n    _pix_co = TEX0.xy*TextureSize - vec2( 5.00000000E-01, 5.00000000E-01);\n    _TMP0 = floor(_pix_co);\n    _tex_co = (_TMP0 + vec2( 5.00000000E-01, 5.00000000E-01))/TextureSize;\n    _dist = fract(_pix_co);\n    _x_step0044 = float((_dist.x >= 5.00000000E-01));\n    _a0048 = 2.50000000E-01 - (_dist.x - _x_step0044)*(_dist.x - _x_step0044);\n    _TMP33 = inversesqrt(_a0048);\n    _TMP14 = 1.00000000E+00/_TMP33;\n    _a0052 = 5.00000000E-01 - _dist.x;\n    _val0052 = float((_a0052 > 0.00000000E+00));\n    _TMP15 = _val0052 - float((_a0052 < 0.00000000E+00));\n    _curve0044 = 5.00000000E-01 - _TMP14*_TMP15;\n    _TMP43 = _dist.x + 2.50000000E-01*(_curve0044 - _dist.x);\n    _coeffs1 = 3.14159274E+00*vec4(1.00000000E+00 + _TMP43, _TMP43, 1.00000000E+00 - _TMP43, 2.00000000E+00 - _TMP43);\n    _TMP1 = abs(_coeffs1);\n    _TMP57 = max(_TMP1, vec4( 9.99999975E-06, 9.99999975E-06, 9.99999975E-06, 9.99999975E-06));\n    _TMP16 = sin(_TMP57.x);\n    _TMP17 = sin(_TMP57.y);\n    _TMP18 = sin(_TMP57.z);\n    _TMP19 = sin(_TMP57.w);\n    _TMP2 = vec4(_TMP16, _TMP17, _TMP18, _TMP19);\n    _x0072 = _TMP57/2.00000000E+00;\n    _TMP16 = sin(_x0072.x);\n    _TMP17 = sin(_x0072.y);\n    _TMP18 = sin(_x0072.z);\n    _TMP19 = sin(_x0072.w);\n    _TMP3 = vec4(_TMP16, _TMP17, _TMP18, _TMP19);\n    _coeffs1 = ((2.00000000E+00*_TMP2)*_TMP3)/(_TMP57*_TMP57);\n    _TMP4 = dot(_coeffs1, vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _coeffs1 = _coeffs1/_TMP4;\n    _c0086 = _tex_co - _dx1;\n    _TMP20 = COMPAT_TEXTURE(Texture, _c0086);\n    _x0088 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP20 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP21 = _TMP20*_x0088;\n    _TMP22 = COMPAT_TEXTURE(Texture, _tex_co);\n    _x0094 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP22 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP23 = _TMP22*_x0094;\n    _c0098 = _tex_co + _dx1;\n    _TMP24 = COMPAT_TEXTURE(Texture, _c0098);\n    _x0100 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP24 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP25 = _TMP24*_x0100;\n    _c0104 = _tex_co + 2.00000000E+00*_dx1;\n    _TMP26 = COMPAT_TEXTURE(Texture, _c0104);\n    _x0106 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP26 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP27 = _TMP26*_x0106;\n    _r0112 = _coeffs1.x*_TMP21;\n    _r0112 = _r0112 + _coeffs1.y*_TMP23;\n    _r0112 = _r0112 + _coeffs1.z*_TMP25;\n    _r0112 = _r0112 + _coeffs1.w*_TMP27;\n    _sample_min0110 = min(_TMP23, _TMP25);\n    _sample_max0110 = max(_TMP23, _TMP25);\n    _TMP34 = min(_sample_max0110, _r0112);\n    _TMP117 = max(_sample_min0110, _TMP34);\n    _co0124 = _tex_co + _dy;\n    _c0126 = _co0124 - _dx1;\n    _TMP20 = COMPAT_TEXTURE(Texture, _c0126);\n    _x0128 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP20 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP21 = _TMP20*_x0128;\n    _TMP22 = COMPAT_TEXTURE(Texture, _co0124);\n    _x0134 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP22 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP23 = _TMP22*_x0134;\n    _c0138 = _co0124 + _dx1;\n    _TMP24 = COMPAT_TEXTURE(Texture, _c0138);\n    _x0140 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP24 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP25 = _TMP24*_x0140;\n    _c0144 = _co0124 + 2.00000000E+00*_dx1;\n    _TMP26 = COMPAT_TEXTURE(Texture, _c0144);\n    _x0146 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP26 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP27 = _TMP26*_x0146;\n    _r0152 = _coeffs1.x*_TMP21;\n    _r0152 = _r0152 + _coeffs1.y*_TMP23;\n    _r0152 = _r0152 + _coeffs1.z*_TMP25;\n    _r0152 = _r0152 + _coeffs1.w*_TMP27;\n    _sample_min0150 = min(_TMP23, _TMP25);\n    _sample_max0150 = max(_TMP23, _TMP25);\n    _TMP34 = min(_sample_max0150, _r0152);\n    _TMP157 = max(_sample_min0150, _TMP34);\n    _x_step0164 = float((_dist.y >= 5.00000000E-01));\n    _a0168 = 2.50000000E-01 - (_dist.y - _x_step0164)*(_dist.y - _x_step0164);\n    _TMP33 = inversesqrt(_a0168);\n    _TMP14 = 1.00000000E+00/_TMP33;\n    _a0172 = 5.00000000E-01 - _dist.y;\n    _val0172 = float((_a0172 > 0.00000000E+00));\n    _TMP15 = _val0172 - float((_a0172 < 0.00000000E+00));\n    _curve0164 = 5.00000000E-01 - _TMP14*_TMP15;\n    _TMP163 = _dist.y + (_curve0164 - _dist.y);\n    _col2 = _TMP117.xyz + _TMP163*(_TMP157.xyz - _TMP117.xyz);\n    _luma = dot(vec3( 2.12599993E-01, 7.15200007E-01, 7.22000003E-02), _col2);\n    _TMP8 = max(_col2.y, _col2.z);\n    _TMP9 = max(_col2.x, _TMP8);\n    _bright = (_TMP9 + _luma)/2.00000000E+00;\n    _TMP31 = min(6.49999976E-01, _bright);\n    _TMP183 = max(3.49999994E-01, _TMP31);\n    _x0190 = _bright*1.50000000E+00;\n    _TMP31 = min(1.50000000E+00, _x0190);\n    _TMP189 = max(1.50000000E+00, _TMP31);\n    _a0196 = TEX0.y*2.00000000E+00*3.14159274E+00*TextureSize.y;\n    _TMP10 = cos(_a0196);\n    _x0198 = _TMP10*5.00000000E-01 + 5.00000000E-01;\n    _TMP11 = pow(_x0198, _TMP189);\n    _scan_weight = 1.00000000E+00 - _TMP11;\n    _x0200 = (TEX0.xy*OutputSize*TextureSize)/InputSize;\n    _mod_fac = floor(_x0200);\n    _x0208 = _mod_fac.x/3.00000000E+00;\n    _TMP32 = floor(_x0208);\n    _TMP13 = _mod_fac.x - 3.00000000E+00*_TMP32;\n    _dot_no = int(_TMP13);\n    if (_dot_no == 0) {\n    _mask_weight = vec3( 1.00000000E+00, 6.99999988E-01, 6.99999988E-01);\n    } else {\n    if (_dot_no == 1) {\n    _mask_weight = vec3( 6.99999988E-01, 1.00000000E+00, 6.99999988E-01);\n    } else {\n    _mask_weight = vec3( 6.99999988E-01, 6.99999988E-01, 1.00000000E+00);\n    }\n    }\n    if (InputSize.y >= 4.00000000E+02) {\n    _scan_weight = 1.00000000E+00;\n    }\n    _col21 = _col2.xyz;\n    _col2 = _col2*vec3(_scan_weight, _scan_weight, _scan_weight);\n    _col2 = _col2 + _TMP183*(_col21 - _col2);\n    _col2 = _col2*_mask_weight;\n    _TMP28 = pow(_col2.x, 5.55555582E-01);\n    _TMP29 = pow(_col2.y, 5.55555582E-01);\n    _TMP30 = pow(_col2.z, 5.55555582E-01);\n    _col2 = vec3(_TMP28, _TMP29, _TMP30);\n    _TMP37 = _col2*1.20000005E+00;\n    _ret_0 = vec4(_TMP37.x, _TMP37.y, _TMP37.z, 1.00000000E+00);\n    FragColor = _ret_0;\n    return;\n    }\n    #endif\n",'crt-aperture.glsl':'\n/*\nCRT Shader by EasyMode\nLicense: GPL\n*/\n/*\n#pragma parameter SHARPNESS_IMAGE "Sharpness Image" 1.0 1.0 5.0 1.0\n#pragma parameter SHARPNESS_EDGES "Sharpness Edges" 3.0 1.0 5.0 1.0\n#pragma parameter GLOW_WIDTH "Glow Width" 0.5 0.05 0.65 0.05\n#pragma parameter GLOW_HEIGHT "Glow Height" 0.5 0.05 0.65 0.05\n#pragma parameter GLOW_HALATION "Glow Halation" 0.1 0.0 1.0 0.01\n#pragma parameter GLOW_DIFFUSION "Glow Diffusion" 0.05 0.0 1.0 0.01\n#pragma parameter MASK_COLORS "Mask Colors" 2.0 2.0 3.0 1.0\n#pragma parameter MASK_STRENGTH "Mask Strength" 0.3 0.0 1.0 0.05\n#pragma parameter MASK_SIZE "Mask Size" 1.0 1.0 9.0 1.0\n#pragma parameter SCANLINE_SIZE_MIN "Scanline Size Min." 0.5 0.5 1.5 0.05\n#pragma parameter SCANLINE_SIZE_MAX "Scanline Size Max." 1.5 0.5 1.5 0.05\n#pragma parameter GAMMA_INPUT "Gamma Input" 2.4 1.0 5.0 0.1\n#pragma parameter GAMMA_OUTPUT "Gamma Output" 2.4 1.0 5.0 0.1\n#pragma parameter BRIGHTNESS "Brightness" 1.5 0.0 2.0 0.05\n* */\n\n#define Coord TEX0\n\n#if defined(VERTEX)\n\n#if __VERSION__ >= 130\n#define OUT out\n#define IN  in\n#define tex2D texture\n#else\n#define OUT varying \n#define IN attribute \n#define tex2D texture2D\n#endif\n\n#ifdef GL_ES\n#define PRECISION mediump\n#else\n#define PRECISION\n#endif\n\nIN  vec4 VertexCoord;\nIN  vec4 Color;\nIN  vec2 TexCoord;\nOUT vec4 color;\nOUT vec2 Coord;\n\nuniform mat4 MVPMatrix;\nuniform PRECISION int FrameDirection;\nuniform PRECISION int FrameCount;\nuniform PRECISION vec2 OutputSize;\nuniform PRECISION vec2 TextureSize;\nuniform PRECISION vec2 InputSize;\n\nvoid main()\n{\ngl_Position = MVPMatrix * VertexCoord;\ncolor = Color;\nCoord = TexCoord;\n}\n\n#elif defined(FRAGMENT)\n\n#if __VERSION__ >= 130\n#define IN in\n#define tex2D texture\nout vec4 FragColor;\n#else\n#define IN varying\n#define FragColor gl_FragColor\n#define tex2D texture2D\n#endif\n\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#define PRECISION mediump\n#else\n#define PRECISION\n#endif\n\nuniform PRECISION int FrameDirection;\nuniform PRECISION int FrameCount;\nuniform PRECISION vec2 OutputSize;\nuniform PRECISION vec2 TextureSize;\nuniform PRECISION vec2 InputSize;\nuniform sampler2D Texture;\nIN vec2 Coord;\n\n#ifdef PARAMETER_UNIFORM\nuniform PRECISION float SHARPNESS_IMAGE;\nuniform PRECISION float SHARPNESS_EDGES;\nuniform PRECISION float GLOW_WIDTH;\nuniform PRECISION float GLOW_HEIGHT;\nuniform PRECISION float GLOW_HALATION;\nuniform PRECISION float GLOW_DIFFUSION;\nuniform PRECISION float MASK_COLORS;\nuniform PRECISION float MASK_STRENGTH;\nuniform PRECISION float MASK_SIZE;\nuniform PRECISION float SCANLINE_SIZE_MIN;\nuniform PRECISION float SCANLINE_SIZE_MAX;\nuniform PRECISION float GAMMA_INPUT;\nuniform PRECISION float GAMMA_OUTPUT;\nuniform PRECISION float BRIGHTNESS;\n#else\n#define SHARPNESS_IMAGE 1.0\n#define SHARPNESS_EDGES 3.0\n#define GLOW_WIDTH 0.5\n#define GLOW_HEIGHT 0.5\n#define GLOW_HALATION 0.1\n#define GLOW_DIFFUSION 0.05\n#define MASK_COLORS 2.0\n#define MASK_STRENGTH 0.3\n#define MASK_SIZE 1.0\n#define SCANLINE_SIZE_MIN 0.5\n#define SCANLINE_SIZE_MAX 1.5\n#define GAMMA_INPUT 2.4\n#define GAMMA_OUTPUT 2.4\n#define BRIGHTNESS 1.5\n#endif\n\n#define FIX(c) max(abs(c), 1e-5)\n#define PI 3.141592653589\n#define saturate(c) clamp(c, 0.0, 1.0)\n#define TEX2D(c) pow(tex2D(tex, c).rgb, vec3(GAMMA_INPUT))\n\nmat3 get_color_matrix(sampler2D tex, vec2 co, vec2 dx)\n{\nreturn mat3(TEX2D(co - dx), TEX2D(co), TEX2D(co + dx));\n}\n\nvec3 blur(mat3 m, float dist, float rad)\n{\nvec3 x = vec3(dist - 1.0, dist, dist + 1.0) / rad;\nvec3 w = exp2(x * x * -1.0);\n\nreturn (m[0] * w.x + m[1] * w.y + m[2] * w.z) / (w.x + w.y + w.z);\n}\n\nvec3 filter_gaussian(sampler2D tex, vec2 co, vec2 tex_size)\n{\nvec2 dx = vec2(1.0 / tex_size.x, 0.0);\nvec2 dy = vec2(0.0, 1.0 / tex_size.y);\nvec2 pix_co = co * tex_size;\nvec2 tex_co = (floor(pix_co) + 0.5) / tex_size;\nvec2 dist = (fract(pix_co) - 0.5) * -1.0;\n\nmat3 line0 = get_color_matrix(tex, tex_co - dy, dx);\nmat3 line1 = get_color_matrix(tex, tex_co, dx);\nmat3 line2 = get_color_matrix(tex, tex_co + dy, dx);\nmat3 column = mat3(blur(line0, dist.x, GLOW_WIDTH),\n                       blur(line1, dist.x, GLOW_WIDTH),\n                       blur(line2, dist.x, GLOW_WIDTH));\n\nreturn blur(column, dist.y, GLOW_HEIGHT);\n}\n\nvec3 filter_lanczos(sampler2D tex, vec2 co, vec2 tex_size, float sharp)\n{\ntex_size.x *= sharp;\n\nvec2 dx = vec2(1.0 / tex_size.x, 0.0);\nvec2 pix_co = co * tex_size - vec2(0.5, 0.0);\nvec2 tex_co = (floor(pix_co) + vec2(0.5, 0.0)) / tex_size;\nvec2 dist = fract(pix_co);\nvec4 coef = PI * vec4(dist.x + 1.0, dist.x, dist.x - 1.0, dist.x - 2.0);\n\ncoef = FIX(coef);\ncoef = 2.0 * sin(coef) * sin(coef / 2.0) / (coef * coef);\ncoef /= dot(coef, vec4(1.0));\n\nvec4 col1 = vec4(TEX2D(tex_co), 1.0);\nvec4 col2 = vec4(TEX2D(tex_co + dx), 1.0);\n\nreturn (mat4(col1, col1, col2, col2) * coef).rgb;\n}\n\nvec3 get_scanline_weight(float x, vec3 col)\n{\nvec3 beam = mix(vec3(SCANLINE_SIZE_MIN), vec3(SCANLINE_SIZE_MAX), col);\nvec3 x_mul = 2.0 / beam;\nvec3 x_offset = x_mul * 0.5;\n\nreturn smoothstep(0.0, 1.0, 1.0 - abs(x * x_mul - x_offset)) * x_offset;\n}\n\nvec3 get_mask_weight(float x)\n{\nfloat i = mod(floor(x * OutputSize.x * TextureSize.x / (InputSize.x * MASK_SIZE)), MASK_COLORS);\n\nif (i == 0.0) return mix(vec3(1.0, 0.0, 1.0), vec3(1.0, 0.0, 0.0), MASK_COLORS - 2.0);\nelse if (i == 1.0) return vec3(0.0, 1.0, 0.0);\nelse return vec3(0.0, 0.0, 1.0);\n}\n\nvoid main()\n{\nvec3 col_glow = filter_gaussian(Texture, Coord, TextureSize);\nvec3 col_soft = filter_lanczos(Texture, Coord, TextureSize, SHARPNESS_IMAGE);\nvec3 col_sharp = filter_lanczos(Texture, Coord, TextureSize, SHARPNESS_EDGES);\nvec3 col = sqrt(col_sharp * col_soft);\n\ncol *= get_scanline_weight(fract(Coord.y * TextureSize.y), col_soft);\ncol_glow = saturate(col_glow - col);\ncol += col_glow * col_glow * GLOW_HALATION;\ncol = mix(col, col * get_mask_weight(Coord.x) * MASK_COLORS, MASK_STRENGTH);\ncol += col_glow * GLOW_DIFFUSION;\ncol = pow(col * BRIGHTNESS, vec3(1.0 / GAMMA_OUTPUT));\n\nFragColor = vec4(col, 1.0);\n}\n\n#endif\n','crt-geom.glsl':'\n/*\nCRT-interlaced\n\nCopyright (C) 2010-2012 cgwg, Themaister and DOLLS\n\nThis program is free software; you can redistribute it and/or modify it\nunder the terms of the GNU General Public License as published by the Free\nSoftware Foundation; either version 2 of the License, or (at your option)\nany later version.\n\n(cgwg gave their consent to have the original version of this shader\ndistributed under the GPL in this message:\n\nhttp://board.byuu.org/viewtopic.php?p=26075#p26075\n\n"Feel free to distribute my shaders under the GPL. After all, the\nbarrel distortion code was taken from the Curvature shader, which is\nunder the GPL."\n)\nThis shader variant is pre-configured with screen curvature\n*/\n/*\n#pragma parameter CRTgamma "CRTGeom Target Gamma" 2.4 0.1 5.0 0.1\n#pragma parameter monitorgamma "CRTGeom Monitor Gamma" 2.2 0.1 5.0 0.1\n#pragma parameter d "CRTGeom Distance" 1.6 0.1 3.0 0.1\n#pragma parameter CURVATURE "CRTGeom Curvature Toggle" 1.0 0.0 1.0 1.0\n#pragma parameter R "CRTGeom Curvature Radius" 2.0 0.1 10.0 0.1\n#pragma parameter cornersize "CRTGeom Corner Size" 0.03 0.001 1.0 0.005\n#pragma parameter cornersmooth "CRTGeom Corner Smoothness" 1000.0 80.0 2000.0 100.0\n#pragma parameter x_tilt "CRTGeom Horizontal Tilt" 0.0 -0.5 0.5 0.05\n#pragma parameter y_tilt "CRTGeom Vertical Tilt" 0.0 -0.5 0.5 0.05\n#pragma parameter overscan_x "CRTGeom Horiz. Overscan %" 100.0 -125.0 125.0 1.0\n#pragma parameter overscan_y "CRTGeom Vert. Overscan %" 100.0 -125.0 125.0 1.0\n#pragma parameter DOTMASK "CRTGeom Dot Mask Toggle" 0.3 0.0 0.3 0.3\n#pragma parameter SHARPER "CRTGeom Sharpness" 1.0 1.0 3.0 1.0\n#pragma parameter scanline_weight "CRTGeom Scanline Weight" 0.3 0.1 0.5 0.05\n*/\n\n#ifndef PARAMETER_UNIFORM\n#define CRTgamma 2.4\n#define monitorgamma 2.2\n#define d 1.6\n#define CURVATURE 1.0\n#define R 2.0\n#define cornersize 0.03\n#define cornersmooth 1000.0\n#define x_tilt 0.0\n#define y_tilt 0.0\n#define overscan_x 100.0\n#define overscan_y 100.0\n#define DOTMASK 0.3\n#define SHARPER 1.0\n#define scanline_weight 0.3\n#endif\n\n#if defined(VERTEX)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING out\n#define COMPAT_ATTRIBUTE in\n#define COMPAT_TEXTURE texture\n#else\n#define COMPAT_VARYING varying \n#define COMPAT_ATTRIBUTE attribute \n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nCOMPAT_ATTRIBUTE vec4 VertexCoord;\nCOMPAT_ATTRIBUTE vec4 COLOR;\nCOMPAT_ATTRIBUTE vec4 TexCoord;\nCOMPAT_VARYING vec4 COL0;\nCOMPAT_VARYING vec4 TEX0;\n\nvec4 _oPosition1; \nuniform mat4 MVPMatrix;\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\n\nCOMPAT_VARYING vec2 overscan;\nCOMPAT_VARYING vec2 aspect;\nCOMPAT_VARYING vec3 stretch;\nCOMPAT_VARYING vec2 sinangle;\nCOMPAT_VARYING vec2 cosangle;\nCOMPAT_VARYING vec2 one;\nCOMPAT_VARYING float mod_factor;\nCOMPAT_VARYING vec2 ilfac;\n\n#ifdef PARAMETER_UNIFORM\nuniform COMPAT_PRECISION float CRTgamma;\nuniform COMPAT_PRECISION float monitorgamma;\nuniform COMPAT_PRECISION float d;\nuniform COMPAT_PRECISION float CURVATURE;\nuniform COMPAT_PRECISION float R;\nuniform COMPAT_PRECISION float cornersize;\nuniform COMPAT_PRECISION float cornersmooth;\nuniform COMPAT_PRECISION float x_tilt;\nuniform COMPAT_PRECISION float y_tilt;\nuniform COMPAT_PRECISION float overscan_x;\nuniform COMPAT_PRECISION float overscan_y;\nuniform COMPAT_PRECISION float DOTMASK;\nuniform COMPAT_PRECISION float SHARPER;\nuniform COMPAT_PRECISION float scanline_weight;\n#endif\n\n#define FIX(c) max(abs(c), 1e-5);\n\nfloat intersect(vec2 xy)\n{\nfloat A = dot(xy,xy)+d*d;\nfloat B = 2.0*(R*(dot(xy,sinangle)-d*cosangle.x*cosangle.y)-d*d);\nfloat C = d*d + 2.0*R*d*cosangle.x*cosangle.y;\nreturn (-B-sqrt(B*B-4.0*A*C))/(2.0*A);\n}\n\nvec2 bkwtrans(vec2 xy)\n{\nfloat c = intersect(xy);\nvec2 point = vec2(c)*xy;\npoint -= vec2(-R)*sinangle;\npoint /= vec2(R);\nvec2 tang = sinangle/cosangle;\nvec2 poc = point/cosangle;\nfloat A = dot(tang,tang)+1.0;\nfloat B = -2.0*dot(poc,tang);\nfloat C = dot(poc,poc)-1.0;\nfloat a = (-B+sqrt(B*B-4.0*A*C))/(2.0*A);\nvec2 uv = (point-a*sinangle)/cosangle;\nfloat r = R*acos(a);\nreturn uv*r/sin(r/R);\n}\n\nvec2 fwtrans(vec2 uv)\n{\nfloat r = FIX(sqrt(dot(uv,uv)));\nuv *= sin(r/R)/r;\nfloat x = 1.0-cos(r/R);\nfloat D = d/R + x*cosangle.x*cosangle.y+dot(uv,sinangle);\nreturn d*(uv*cosangle-x*sinangle)/D;\n}\n\nvec3 maxscale()\n{\nvec2 c = bkwtrans(-R * sinangle / (1.0 + R/d*cosangle.x*cosangle.y));\nvec2 a = vec2(0.5,0.5)*aspect;\nvec2 lo = vec2(fwtrans(vec2(-a.x,c.y)).x, fwtrans(vec2(c.x,-a.y)).y)/aspect;\nvec2 hi = vec2(fwtrans(vec2(+a.x,c.y)).x, fwtrans(vec2(c.x,+a.y)).y)/aspect;\nreturn vec3((hi+lo)*aspect*0.5,max(hi.x-lo.x,hi.y-lo.y));\n}\n\nvoid main()\n{\n// START of parameters\n\n// gamma of simulated CRT\n//	CRTgamma = 1.8;\n// gamma of display monitor (typically 2.2 is correct)\n//	monitorgamma = 2.2;\n// overscan (e.g. 1.02 for 2% overscan)\noverscan = vec2(1.00,1.00);\n// aspect ratio\naspect = vec2(1.0, 0.75);\n// lengths are measured in units of (approximately) the width\n// of the monitor simulated distance from viewer to monitor\n//	d = 2.0;\n// radius of curvature\n//	R = 1.5;\n// tilt angle in radians\n// (behavior might be a bit wrong if both components are\n// nonzero)\nconst vec2 angle = vec2(0.0,0.0);\n// size of curved corners\n//	cornersize = 0.03;\n// border smoothness parameter\n// decrease if borders are too aliased\n//	cornersmooth = 1000.0;\n\n// END of parameters\n\nvec4 _oColor;\nvec2 _otexCoord;\ngl_Position = VertexCoord.x * MVPMatrix[0] + VertexCoord.y * MVPMatrix[1] + VertexCoord.z * MVPMatrix[2] + VertexCoord.w * MVPMatrix[3];\n_oPosition1 = gl_Position;\n_oColor = COLOR;\n_otexCoord = TexCoord.xy;\nCOL0 = COLOR;\nTEX0.xy = TexCoord.xy;\n\n// Precalculate a bunch of useful values we\'ll need in the fragment\n// shader.\nsinangle = sin(vec2(x_tilt, y_tilt)) + vec2(0.001);//sin(vec2(max(abs(x_tilt), 1e-3), max(abs(y_tilt), 1e-3)));\ncosangle = cos(vec2(x_tilt, y_tilt)) + vec2(0.001);//cos(vec2(max(abs(x_tilt), 1e-3), max(abs(y_tilt), 1e-3)));\nstretch = maxscale();\n\nilfac = vec2(1.0,clamp(floor(InputSize.y/200.0), 1.0, 2.0));\n\n// The size of one texel, in texture-coordinates.\nvec2 sharpTextureSize = vec2(SHARPER * TextureSize.x, TextureSize.y);\none = ilfac / sharpTextureSize;\n\n// Resulting X pixel-coordinate of the pixel we\'re drawing.\nmod_factor = TexCoord.x * TextureSize.x * OutputSize.x / InputSize.x;\n\n}\n\n#elif defined(FRAGMENT)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING in\n#define COMPAT_TEXTURE texture\nout vec4 FragColor;\n#else\n#define COMPAT_VARYING varying\n#define FragColor gl_FragColor\n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nstruct output_dummy {\nvec4 _color;\n};\n\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\nuniform sampler2D Texture;\nCOMPAT_VARYING vec4 TEX0;\n\n// Comment the next line to disable interpolation in linear gamma (and\n// gain speed).\n#define LINEAR_PROCESSING\n\n// Enable screen curvature.\n//        #define CURVATURE\n\n// Enable 3x oversampling of the beam profile\n#define OVERSAMPLE\n\n// Use the older, purely gaussian beam profile\n//#define USEGAUSSIAN\n\n// Macros.\n#define FIX(c) max(abs(c), 1e-5);\n#define PI 3.141592653589\n\n#ifdef LINEAR_PROCESSING\n#       define TEX2D(c) pow(COMPAT_TEXTURE(Texture, (c)), vec4(CRTgamma))\n#else\n#       define TEX2D(c) COMPAT_TEXTURE(Texture, (c))\n#endif\n\nCOMPAT_VARYING vec2 one;\nCOMPAT_VARYING float mod_factor;\nCOMPAT_VARYING vec2 ilfac;\nCOMPAT_VARYING vec2 overscan;\nCOMPAT_VARYING vec2 aspect;\nCOMPAT_VARYING vec3 stretch;\nCOMPAT_VARYING vec2 sinangle;\nCOMPAT_VARYING vec2 cosangle;\n\n#ifdef PARAMETER_UNIFORM\nuniform COMPAT_PRECISION float CRTgamma;\nuniform COMPAT_PRECISION float monitorgamma;\nuniform COMPAT_PRECISION float d;\nuniform COMPAT_PRECISION float CURVATURE;\nuniform COMPAT_PRECISION float R;\nuniform COMPAT_PRECISION float cornersize;\nuniform COMPAT_PRECISION float cornersmooth;\nuniform COMPAT_PRECISION float x_tilt;\nuniform COMPAT_PRECISION float y_tilt;\nuniform COMPAT_PRECISION float overscan_x;\nuniform COMPAT_PRECISION float overscan_y;\nuniform COMPAT_PRECISION float DOTMASK;\nuniform COMPAT_PRECISION float SHARPER;\nuniform COMPAT_PRECISION float scanline_weight;\n#endif\n\nfloat intersect(vec2 xy)\n{\nfloat A = dot(xy,xy)+d*d;\nfloat B = 2.0*(R*(dot(xy,sinangle)-d*cosangle.x*cosangle.y)-d*d);\nfloat C = d*d + 2.0*R*d*cosangle.x*cosangle.y;\nreturn (-B-sqrt(B*B-4.0*A*C))/(2.0*A);\n}\n\nvec2 bkwtrans(vec2 xy)\n{\nfloat c = intersect(xy);\nvec2 point = vec2(c)*xy;\npoint -= vec2(-R)*sinangle;\npoint /= vec2(R);\nvec2 tang = sinangle/cosangle;\nvec2 poc = point/cosangle;\nfloat A = dot(tang,tang)+1.0;\nfloat B = -2.0*dot(poc,tang);\nfloat C = dot(poc,poc)-1.0;\nfloat a = (-B+sqrt(B*B-4.0*A*C))/(2.0*A);\nvec2 uv = (point-a*sinangle)/cosangle;\nfloat r = FIX(R*acos(a));\nreturn uv*r/sin(r/R);\n}\n\nvec2 transform(vec2 coord)\n{\ncoord *= TextureSize / InputSize;\ncoord = (coord-vec2(0.5))*aspect*stretch.z+stretch.xy;\nreturn (bkwtrans(coord)/vec2(overscan_x / 100.0, overscan_y / 100.0)/aspect+vec2(0.5)) * InputSize / TextureSize;\n}\n\nfloat corner(vec2 coord)\n{\ncoord *= TextureSize / InputSize;\ncoord = (coord - vec2(0.5)) * vec2(overscan_x / 100.0, overscan_y / 100.0) + vec2(0.5);\ncoord = min(coord, vec2(1.0)-coord) * aspect;\nvec2 cdist = vec2(cornersize);\ncoord = (cdist - min(coord,cdist));\nfloat dist = sqrt(dot(coord,coord));\nreturn clamp((cdist.x-dist)*cornersmooth,0.0, 1.0);\n}\n\n// Calculate the influence of a scanline on the current pixel.\n//\n// \'distance\' is the distance in texture coordinates from the current\n// pixel to the scanline in question.\n// \'color\' is the colour of the scanline at the horizontal location of\n// the current pixel.\nvec4 scanlineWeights(float distance, vec4 color)\n{\n// "wid" controls the width of the scanline beam, for each RGB\n// channel The "weights" lines basically specify the formula\n// that gives you the profile of the beam, i.e. the intensity as\n// a function of distance from the vertical center of the\n// scanline. In this case, it is gaussian if width=2, and\n// becomes nongaussian for larger widths. Ideally this should\n// be normalized so that the integral across the beam is\n// independent of its width. That is, for a narrower beam\n// "weights" should have a higher peak at the center of the\n// scanline than for a wider beam.\n#ifdef USEGAUSSIAN\nvec4 wid = 0.3 + 0.1 * pow(color, vec4(3.0));\nvec4 weights = vec4(distance / wid);\nreturn 0.4 * exp(-weights * weights) / wid;\n#else\nvec4 wid = 2.0 + 2.0 * pow(color, vec4(4.0));\nvec4 weights = vec4(distance / scanline_weight);\nreturn 1.4 * exp(-pow(weights * inversesqrt(0.5 * wid), wid)) / (0.6 + 0.2 * wid);\n#endif\n}\n\nvoid main()\n{\n// Here\'s a helpful diagram to keep in mind while trying to\n// understand the code:\n//\n//  |      |      |      |      |\n// -------------------------------\n//  |      |      |      |      |\n//  |  01  |  11  |  21  |  31  | <-- current scanline\n//  |      | @    |      |      |\n// -------------------------------\n//  |      |      |      |      |\n//  |  02  |  12  |  22  |  32  | <-- next scanline\n//  |      |      |      |      |\n// -------------------------------\n//  |      |      |      |      |\n//\n// Each character-cell represents a pixel on the output\n// surface, "@" represents the current pixel (always somewhere\n// in the bottom half of the current scan-line, or the top-half\n// of the next scanline). The grid of lines represents the\n// edges of the texels of the underlying texture.\n\n// Texture coordinates of the texel containing the active pixel.\nvec2 xy = (CURVATURE > 0.5) ? transform(TEX0.xy) : TEX0.xy;\n\nfloat cval = corner(xy);\n\n// Of all the pixels that are mapped onto the texel we are\n// currently rendering, which pixel are we currently rendering?\nvec2 ilvec = vec2(0.0,ilfac.y > 1.5 ? mod(float(FrameCount),2.0) : 0.0);\nvec2 ratio_scale = (xy * TextureSize - vec2(0.5) + ilvec)/ilfac;\n#ifdef OVERSAMPLE\nfloat filter_ = InputSize.y/OutputSize.y;//fwidth(ratio_scale.y);\n#endif\nvec2 uv_ratio = fract(ratio_scale);\n\n// Snap to the center of the underlying texel.\nxy = (floor(ratio_scale)*ilfac + vec2(0.5) - ilvec) / TextureSize;\n\n// Calculate Lanczos scaling coefficients describing the effect\n// of various neighbour texels in a scanline on the current\n// pixel.\nvec4 coeffs = PI * vec4(1.0 + uv_ratio.x, uv_ratio.x, 1.0 - uv_ratio.x, 2.0 - uv_ratio.x);\n\n// Prevent division by zero.\ncoeffs = FIX(coeffs);\n\n// Lanczos2 kernel.\ncoeffs = 2.0 * sin(coeffs) * sin(coeffs / 2.0) / (coeffs * coeffs);\n\n// Normalize.\ncoeffs /= dot(coeffs, vec4(1.0));\n\n// Calculate the effective colour of the current and next\n// scanlines at the horizontal location of the current pixel,\n// using the Lanczos coefficients above.\nvec4 col  = clamp(mat4(\n                TEX2D(xy + vec2(-one.x, 0.0)),\n                TEX2D(xy),\n                TEX2D(xy + vec2(one.x, 0.0)),\n                TEX2D(xy + vec2(2.0 * one.x, 0.0))) * coeffs,\n                0.0, 1.0);\nvec4 col2 = clamp(mat4(\n                TEX2D(xy + vec2(-one.x, one.y)),\n                TEX2D(xy + vec2(0.0, one.y)),\n                TEX2D(xy + one),\n                TEX2D(xy + vec2(2.0 * one.x, one.y))) * coeffs,\n                0.0, 1.0);\n\n#ifndef LINEAR_PROCESSING\ncol  = pow(col , vec4(CRTgamma));\ncol2 = pow(col2, vec4(CRTgamma));\n#endif\n\n// Calculate the influence of the current and next scanlines on\n// the current pixel.\nvec4 weights  = scanlineWeights(uv_ratio.y, col);\nvec4 weights2 = scanlineWeights(1.0 - uv_ratio.y, col2);\n#ifdef OVERSAMPLE\nuv_ratio.y =uv_ratio.y+1.0/3.0*filter_;\nweights = (weights+scanlineWeights(uv_ratio.y, col))/3.0;\nweights2=(weights2+scanlineWeights(abs(1.0-uv_ratio.y), col2))/3.0;\nuv_ratio.y =uv_ratio.y-2.0/3.0*filter_;\nweights=weights+scanlineWeights(abs(uv_ratio.y), col)/3.0;\nweights2=weights2+scanlineWeights(abs(1.0-uv_ratio.y), col2)/3.0;\n#endif\n\nvec3 mul_res  = (col * weights + col2 * weights2).rgb * vec3(cval);\n\n// dot-mask emulation:\n// Output pixels are alternately tinted green and magenta.\nvec3 dotMaskWeights = mix(\nvec3(1.0, 1.0 - DOTMASK, 1.0),\nvec3(1.0 - DOTMASK, 1.0, 1.0 - DOTMASK),\nfloor(mod(mod_factor, 2.0))\n);\n\nmul_res *= dotMaskWeights;\n\n// Convert the image gamma for display on our output device.\nmul_res = pow(mul_res, vec3(1.0 / monitorgamma));\n\n// Color the texel.\noutput_dummy _OUT;\n_OUT._color = vec4(mul_res, 1.0);\nFragColor = _OUT._color;\nreturn;\n} \n#endif\n\n'},eR=g(57),V=g.n(eR),_=g(11),w={addStyleHook:function(){h(this.elements.container,this.config.selectors.container.replace(".",''),!0),h(this.elements.container,this.config.classNames.uiSupported,!0),h(this.elements.container,this.config.classNames.hideControls,!0)},build:function(){this.listeners.media(),s.element(this.elements.controls)||(l.inject.call(this),this.listeners.controls()),this.volume=null,this.muted=null,l.updateVolume.call(this),h(this.elements.container,this.config.classNames.isTouch,this.touch),this.ready=!0},toggleControls:function(s){if(e=this.elements.controls,e){var e,t=0,o=k.call(this,".".concat(n({ejs__dialogs:!0})," > .").concat(n({ejs__dialog:!0})));Array.from(o).forEach(function(e){!0!==e.hidden&&(t+=1)}),t>0?this.toggleControls(!1):this.toggleControls(Boolean(s||this.paused||e.pressed||e.hover))}}};function I(e){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){if("object"===I(e)&&e.files&&(e=e.files[0]),this.littleEndian=!1,this.offset=0,this._lastRead=null,"object"===I(e)&&e.name&&e.size){if("function"!=typeof window.FileReader)throw new Error("Incompatible Browser");this.fileName=e.name,this.fileType=e.type,this.fileSize=e.size,this._fileReader=new FileReader,this._fileReader.marcFile=this,this._fileReader.addEventListener("load",function(){this.marcFile._u8array=new Uint8Array(this.result),this.marcFile._dataView=new DataView(this.result),t&&t.call()},!1),this._fileReader.readAsArrayBuffer(e)}else if("object"===I(e)&&"string"==typeof e.fileName&&"boolean"==typeof e.littleEndian){this.fileName=e.fileName,this.fileType=e.fileType,this.fileSize=e.fileSize;var n=new ArrayBuffer(e);this._u8array=new Uint8Array(this.fileType),this._dataView=new DataView(this.fileType),e.copyToFile(this,0),t&&t.call()}else if("object"===I(e)&&"number"==typeof e.byteLength)this.fileName="file.bin",this.fileType="application/octet-stream",this.fileSize=e.byteLength,void 0!==e.buffer&&(e=e.buffer),this._u8array=new Uint8Array(e),this._dataView=new DataView(e),t&&t.call();else{if("number"!=typeof e)throw new Error("Invalid source");this.fileName="file.bin",this.fileType="application/octet-stream",this.fileSize=e,n=new ArrayBuffer(e),this._u8array=new Uint8Array(n),this._dataView=new DataView(n),t&&t.call()}}f.IS_MACHINE_LITTLE_ENDIAN=(es=new ArrayBuffer(2),new DataView(es).setInt16(0,256,!0),256===new Int16Array(es)[0]),f.prototype.seek=function(e){this.offset=e},f.prototype.skip=function(e){this.offset+=e},f.prototype.isEOF=function(){return!(this.offset<this.fileSize)},f.prototype.slice=function(n,t){var e;return t=t||this.fileSize-n,void 0!==this._u8array.buffer.slice?((e=new f(0)).fileSize=t,e._u8array=new Uint8Array(this._u8array.buffer.slice(n,n+t))):(e=new f(t),this.copyToFile(e,n,t,0)),e.fileName=this.fileName,e.fileType=this.fileType,e.littleEndian=this.littleEndian,e},f.prototype.copyToFile=function(o,t,n,s){void 0===s&&(s=t),n=n||this.fileSize-t;for(var e=0;e<n;e++)o._u8array[s+e]=this._u8array[t+e]},f.prototype.save=function(){try{e=new Blob([this._u8array],{type:this.fileType})}catch(n){if(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,"InvalidStateError"!==n.name||!window.BlobBuilder)throw new Error("Incompatible Browser");var e,t=new BlobBuilder;t.append(this._u8array.buffer),e=t.getBlob(this.fileType)}saveAs(e,this.fileName)},f.prototype.readU8=function(){return this._lastRead=this._u8array[this.offset],this.offset++,this._lastRead},f.prototype.readU16=function(){return this.littleEndian?this._lastRead=this._u8array[this.offset]+(this._u8array[this.offset+1]<<8):this._lastRead=(this._u8array[this.offset]<<8)+this._u8array[this.offset+1],this.offset+=2,this._lastRead>>>0},f.prototype.readU24=function(){return this.littleEndian?this._lastRead=this._u8array[this.offset]+(this._u8array[this.offset+1]<<8)+(this._u8array[this.offset+2]<<16):this._lastRead=(this._u8array[this.offset]<<16)+(this._u8array[this.offset+1]<<8)+this._u8array[this.offset+2],this.offset+=3,this._lastRead>>>0},f.prototype.readU32=function(){return this.littleEndian?this._lastRead=this._u8array[this.offset]+(this._u8array[this.offset+1]<<8)+(this._u8array[this.offset+2]<<16)+(this._u8array[this.offset+3]<<24):this._lastRead=(this._u8array[this.offset]<<24)+(this._u8array[this.offset+1]<<16)+(this._u8array[this.offset+2]<<8)+this._u8array[this.offset+3],this.offset+=4,this._lastRead>>>0},f.prototype.readBytes=function(t){this._lastRead=new Array(t);for(var e=0;e<t;e++)this._lastRead[e]=this._u8array[this.offset+e];return this.offset+=t,this._lastRead},f.prototype.readString=function(t){this._lastRead='';for(var e=0;e<t&&this.offset+e<this.fileSize&&this._u8array[this.offset+e]>0;e++)this._lastRead=this._lastRead+String.fromCharCode(this._u8array[this.offset+e]);return this.offset+=t,this._lastRead},f.prototype.writeU8=function(e){this._u8array[this.offset]=e,this.offset++},f.prototype.writeU16=function(e){this.littleEndian?(this._u8array[this.offset]=255&e,this._u8array[this.offset+1]=e>>8):(this._u8array[this.offset]=e>>8,this._u8array[this.offset+1]=255&e),this.offset+=2},f.prototype.writeU24=function(e){this.littleEndian?(this._u8array[this.offset]=255&e,this._u8array[this.offset+1]=(65280&e)>>8,this._u8array[this.offset+2]=(16711680&e)>>16):(this._u8array[this.offset]=(16711680&e)>>16,this._u8array[this.offset+1]=(65280&e)>>8,this._u8array[this.offset+2]=255&e),this.offset+=3},f.prototype.writeU32=function(e){this.littleEndian?(this._u8array[this.offset]=255&e,this._u8array[this.offset+1]=(65280&e)>>8,this._u8array[this.offset+2]=(16711680&e)>>16,this._u8array[this.offset+3]=(4278190080&e)>>24):(this._u8array[this.offset]=(4278190080&e)>>24,this._u8array[this.offset+1]=(16711680&e)>>16,this._u8array[this.offset+2]=(65280&e)>>8,this._u8array[this.offset+3]=255&e),this.offset+=4},f.prototype.writeBytes=function(t){for(var e=0;e<t.length;e++)this._u8array[this.offset+e]=t[e];this.offset+=t.length},f.prototype.writeString=function(n,t){t=t||n.length;for(var e=0;e<n.length&&e<t;e++)this._u8array[this.offset+e]=n.charCodeAt(e);for(;e<t;e++)this._u8array[this.offset+e]=0;this.offset+=t},v=f,E=0;function S(){this.records=[],this.truncate=!1}function e8(e){t=new S,e.seek(5);for(var t,n=0,s=0;!e.isEOF();){if(4542278===(n=e.readU24())){if(e.isEOF())break;if(e.offset+3===e.fileSize){t.truncate=e.readU24();break}}(s=e.readU16())===E?t.addRLERecord(n,e.readU16(),e.readU8()):t.addSimpleRecord(n,e.readBytes(s))}return t}S.prototype.addSimpleRecord=function(t,e){this.records.push({offset:t,type:1,length:e.length,data:e})},S.prototype.addRLERecord=function(e,t,n){this.records.push({offset:e,type:E,length:t,byte:n})},S.prototype.toString=function(){nSimpleRecords=0,nRLERecords=0;for(var e,t=0;t<this.records.length;t++)this.records[t].type===E?nRLERecords++:nSimpleRecords++;return e="Simple records: "+nSimpleRecords,e+="\nRLE records: "+nRLERecords,e+="\nTotal records: "+this.records.length,this.truncate&&(e+="\nTruncate at: 0x"+this.truncate.toString(16)),e},S.prototype.export=function(s){for(var e,n=5,t=0;t<this.records.length;t++)this.records[t].type===E?n+=8:n+=5+this.records[t].data.length;n+=3,this.truncate&&(n+=3),tempFile=new v(n),tempFile.fileName=s+".ips",tempFile.writeString("PATCH");for(t=0;t<this.records.length;t++)e=this.records[t],tempFile.writeU24(e.offset),e.type===E?(tempFile.writeU16(0),tempFile.writeU16(e.length),tempFile.writeU8(e.byte)):(tempFile.writeU16(e.data.length),tempFile.writeBytes(e.data));return tempFile.writeString("EOF"),e.truncate&&tempFile.writeU24(e.truncate),tempFile},S.prototype.apply=function(s){if(this.truncate)n=s.slice(0,this.truncate);else{for(var t,n,i,o=s.fileSize,e=0;e<this.records.length;e++)t=this.records[e],t.type===E?t.offset+t.length>o&&(o=t.offset+t.length):t.offset+t.data.length>o&&(o=t.offset+t.data.length);o===s.fileSize?n=s.slice(0,s.fileSize):(n=new v(o),s.copyToFile(n,0))}s.seek(0);for(e=0;e<this.records.length;e++)if(n.seek(this.records[e].offset),this.records[e].type===E)for(i=0;i<this.records[e].length;i++)n.writeU8(this.records[e].byte);else n.writeBytes(this.records[e].data);return n},"0123456789abcdef".split(''),ef=function(){for(var e,n,s=[],t=0;t<256;t++){e=t;for(n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;s[t]=e}return s}();function A(o,s,i){for(var n=s?new Uint8Array(o._u8array.buffer,s):o._u8array,e=-1,a=i?n.length-4:n.length,t=0;t<a;t++)e=e>>>8^ef[255&(e^n[t])];return(-1^e)>>>0}var eL=0,B=1,W=2,$=3;function R(){this.sourceSize=0,this.targetSize=0,this.metaData='',this.actions=[],this.sourceChecksum=0,this.targetChecksum=0,this.patchChecksum=0}function e9(e){e.readVLV=eN,e.littleEndian=!0,t=new R,e.seek(4),t.sourceSize=e.readVLV(),t.targetSize=e.readVLV(),s=e.readVLV(),s&&(t.metaData=e.readString(s));for(i=e.fileSize-12;e.offset<i;){var t,s,o,i,a=e.readVLV(),n={type:3&a,length:1+(a>>2)};n.type===B?n.bytes=e.readBytes(n.length):(n.type===W||n.type===$)&&(o=e.readVLV(),n.relativeOffset=(1&o?-1:1)*(o>>1)),t.actions.push(n)}if(t.sourceChecksum=e.readU32(),t.targetChecksum=e.readU32(),t.patchChecksum=e.readU32(),t.patchChecksum!==A(e,0,!0))throw new Error("error_crc_patch");return t}function eN(){for(var t,e=0,n=1;;){if(t=this.readU8(),e+=(127&t)*n,128&t)break;e+=n<<=7}return this._lastRead=e,e}function eD(e){for(;;){var t=127&e;if(0===(e>>=7)){this.writeU8(128|t);break}this.writeU8(t),e--}}function P(t){for(var e=0;;){if(0===(t>>=7)){e++;break}e++,t--}return e}function ez(){this.offset=0,this.next=null}R.prototype.toString=function(){var e="Source size: "+this.sourceSize;return e+="\nTarget size: "+this.targetSize,e+="\nMetadata: "+this.metaData,e+="\n#Actions: "+this.actions.length},R.prototype.validateSource=function(e,t){return this.sourceChecksum===A(e,t)},R.prototype.apply=function(a,r){if(r&&!this.validateSource(a))throw new Error("error_crc_input");for(var e,n,t=new v(this.targetSize),s=0,o=0,i=0;i<this.actions.length;i++)if(e=this.actions[i],e.type===eL)a.copyToFile(t,t.offset,e.length),t.skip(e.length);else if(e.type===B)t.writeBytes(e.bytes);else if(e.type===W){s+=e.relativeOffset;for(n=e.length;n--;)t.writeU8(a._u8array[s]),s++}else if(e.type===$){o+=e.relativeOffset;for(n=e.length;n--;)t.writeU8(t._u8array[o]),o++}if(r&&this.targetChecksum!==A(t))throw new Error("error_crc_output");return t},R.prototype.export=function(o){var e,t,s,n="BPS1".length;n+=P(this.sourceSize),n+=P(this.targetSize),n+=P(this.metaData.length),n+=this.metaData.length;for(s=0;s<this.actions.length;s++)n+=P(((e=this.actions[s]).length-1<<2)+e.type),e.type===B?n+=e.length:e.type!==W&&e.type!==$||(n+=P((Math.abs(e.relativeOffset)<<1)+(e.relativeOffset<0?1:0)));t=new v(n+=12),t.fileName=o+".bps",t.littleEndian=!0,t.writeVLV=eD,t.writeString("BPS1"),t.writeVLV(this.sourceSize),t.writeVLV(this.targetSize),t.writeVLV(this.metaData.length),t.writeString(this.metaData,this.metaData.length);for(s=0;s<this.actions.length;s++)e=this.actions[s],t.writeVLV((e.length-1<<2)+e.type),e.type===B?t.writeBytes(e.bytes):e.type!==W&&e.type!==$||t.writeVLV((Math.abs(e.relativeOffset)<<1)+(e.relativeOffset<0?1:0));return t.writeU32(this.sourceChecksum),t.writeU32(this.targetChecksum),t.writeU32(this.patchChecksum),t},ez.prototype.delete=function(){this.next&&delete this.next},T="UPS1";function z(){this.records=[],this.sizeInput=0,this.sizeOutput=0,this.checksumInput=0,this.checksumOutput=0}function eF(e){for(;;){var t=127&e;if(0===(e>>=7)){this.writeU8(128|t);break}this.writeU8(t),e-=1}}function eM(){for(var e,t=0,n=1;;){if(e=this.readU8(),-1==e)throw new Error("Can't read UPS VLV at 0x"+(this.offset-1).toString(16));if(t+=(127&e)*n,0!=(128&e))break;t+=n<<=7}return t}function ei(e){for(var t=0;;){if(t++,0===(e>>=7))break;e-=1}return t}function ek(e){for(t=new z,e.readVLV=eM,e.seek(T.length),t.sizeInput=e.readVLV(),t.sizeOutput=e.readVLV();e.offset<e.fileSize-12;){for(var t,s=e.readVLV(),n=[];e.readU8();)n.push(e._lastRead);t.addRecord(s,n)}return e.littleEndian=!0,t.checksumInput=e.readU32(),t.checksumOutput=e.readU32(),e.littleEndian=!1,t}z.prototype.addRecord=function(e,t){this.records.push({offset:e,XORdata:t})},z.prototype.toString=function(){var e="Records: "+(void 0).records.length;return e+="\nInput file size: "+(void 0).sizeInput,e+="\nOutput file size: "+(void 0).sizeOutput,e+="\nInput file checksum: "+padZeroes((void 0).checksumInput,4),e+="\nOutput file checksum: "+padZeroes((void 0).checksumOutput,4)},z.prototype.export=function(n){var e,t=T.length;t+=ei(this.sizeInput),t+=ei(this.sizeOutput);for(e=0;e<this.records.length;e++)t+=ei(this.records[e].offset),t+=this.records[e].XORdata.length+1;t+=12,tempFile=new v(t),tempFile.writeVLV=eF,tempFile.fileName=n+".ups",tempFile.writeString(T),tempFile.writeVLV(this.sizeInput),tempFile.writeVLV(this.sizeOutput);for(e=0;e<this.records.length;e++)tempFile.writeVLV(this.records[e].offset),tempFile.writeBytes(this.records[e].XORdata),tempFile.writeU8(0);return tempFile.littleEndian=!0,tempFile.writeU32(this.checksumInput),tempFile.writeU32(this.checksumOutput),tempFile.writeU32(A(tempFile,0,!0)),tempFile},z.prototype.validateSource=function(e,t){return A(e,t)===this.checksumInput},z.prototype.apply=function(e,o){o&&this.validateSource(e),tempFile=new v(this.sizeOutput),e.copyToFile(tempFile,0,this.sizeInput),e.seek(0);for(var t,n,s=0;s<this.records.length;s++){t=this.records[s],tempFile.skip(t.offset),e.skip(t.offset);for(n=0;n<t.XORdata.length;n++)tempFile.writeU8((e.isEOF()?0:e.readU8())^t.XORdata[n]);tempFile.skip(1),e.skip(1)}return o&&(A(tempFile),this.checksumOutput),tempFile};var eZ=g(160),eS=g.n(eZ),t={_FS:{createPath:function(n,e,s,o){if(!t.FS)return;typeof t.FS.createPath!="function"?t.FS.mkdir(e):t.FS.createPath(n,e,s,o)},createDataFile:function(e,n,s,o,i,a){if(!t.FS)return;if(typeof t.FS.createDataFile!="function"){var r=function(e,t){return e.endsWith("/")||t.startsWith("/")?e+t:e+"/"+t}(e,n);t.FS.writeFile(r,s)}else t.FS.createDataFile(e,n,s,o,i,a)},createFolder:function(e,n,s,o){if(!t.FS)return;if(typeof t.FS.createFolder!="function"){var i=function(e,t){return e.endsWith("/")||t.startsWith("/")?e+t:e+"/"+t}(e,n);t.FS.mkdir(i)}else t.FS.createFolder(e,n,s,o)}},romdb:null,supportBatterySave:!1,hash:"2b35cacf70ae",hash2:"f5cbb3f38c0bb20e4",hash3:"88cc8ad0c350400499a0",loading:null,gamePatch:null,saveFilenames:[],FS:null,Module:null,aspectRatio:4/3,memData:null,wasmData:null,coreFileData:{},coreFileName:'',coreFileVersion:'',isMobileDevice:!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(navigator.userAgent||''),create:function(){e=this,window.URL=window.URL||window.webkitURL;var z=!1,F=!1,N=!1,O=0,$=!1,J={psx:["bin","iso","cue","img","mdf","pbp","toc","cbn","m3u"],nds:["nds","bin"],nes:["fds","nes","unif","unf"],snes:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],snes2002:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],snes2005:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],snes2010:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],gb:["gb","gbc","dmg"],gba:["gb","gbc","gba"],vbanext:["gba"],vb:["vb","vboy","bin"],'3do':["iso","bin","cue"],lynx:["lnx"],jaguar:["j64","jag","rom","abs","cof","bin","prg"],a7800:["a78","bin"],a2600:["a26","bin"],ngp:["ngp","ngc"],n64:["n64","v64","z64","bin","u1","ndd"],pce:["pce","bin","iso","cue","ccd","img","chd"],sega:["mdx","md","smd","gen","bin","iso","cue","sms","gg","sg","68k","chd"],segacd:["mdx","md","smd","gen","bin","iso","cue","sms","gg","sg","68k","chd"],'32x':["32x","bin","gen","smd","md","cue","iso","sms"],saturn:["bin","cue","iso"],msx:["rom","mx1","mx2","dsk","cas"],bluemsx:["rom","ri","mx1","mx2","col","dsk","cas","sg","sc","m3u"],ws:["ws","wsc"],arcade:["zip"],'fba0.2.97.29':["zip"],mame2003:["zip"],mame:["zip"],dos:["zip"]},G={psx:"psx",nds:"nds",nes:"nes",snes:"snes",snes2002:"snes2002",snes2005:"snes2005",snes2010:"snes2010",gb:"gb",gbc:"gb",gba:"gba",vbanext:"vbanext",vb:"vb",n64:"n64",'3do':"3do",segaMS:"sega",segaGG:"sega",segaMD:"sega",segaCD:"segacd",sega32x:"32x",segaSaturn:"saturn",ngp:"ngp",pce:"pce",msx:"bluemsx",atari2600:"a2600",atari7800:"a7800",lynx:"lynx",ws:"ws",arcade:"arcade",'fba0.2.97.29':"fba0.2.97.29",jaguar:"jaguar",mame2003:"mame2003",dos:"dos"},o=this,U=o.system,L=o.customPaths&&typeof o.customPaths["extract7z.js"]=="string"?o.customPaths["extract7z.js"]:o.dataPath+"extract7z.js",P=o.customPaths&&typeof o.customPaths["extractzip.js"]=="string"?o.customPaths["extractzip.js"]:o.dataPath+"extractzip.js?v=1",W=o.customPaths&&typeof o.customPaths["libunrar.js"]=="string"?o.customPaths["libunrar.js"]:o.dataPath+"libunrar.js",C=c("canvas",{});this.game.appendChild(C),t.loading=c("div",{class:this.config.classNames.loading}),this.elements.container.appendChild(t.loading),i={'loading-info':n({'loading-info':!0}),ad:n({ad:!0}),'close-ad':n({'close-ad':!0}),'start-game':n({'start-game':!0}),on:n({on:!0}),p1:n({p1:!0}),p2:n({p2:!0}),p3:n({p3:!0}),p4:n({p4:!0})},ei='',typeof o.adUrl=="string"?(t.loading.innerHTML='\n        <div>\n        <div class="'+i.ad+'" style="display:block !important;width:300px !important">\n        <div class="'+i["close-ad"]+'" hidden><a href="#" onclick="return false"></a></div>\n        <iframe scrolling="no" frameborder="no" style="width:300px !important;height:250px !important;display: block !important;" src="'+o.adUrl+'"></iframe>\n        </div>\n        <div class="'+i["loading-info"]+'" style="position: absolute;bottom: 20px;left: 50%;transform: translateX(-50%);">\n        <div class="'+i.p1+'"></div>\n        <div class="'+i.p2+'"></div>\n        <div class="'+i.p3+'"></div>\n        </div>\n        <div style="position: absolute;bottom: 20px;left: 50%;transform: translateX(-50%);">\n        <a href="#" onclick="return false" class="'+i["start-game"]+'">'+D.get("playNow",o.config)+"</a>\n        </div>\n        </div>",Z=c("iframe",{src:o.adUrl,scrolling:"no",frameborder:"no",style:"width:300px !important;height:250px !important;display: block !important;"}),(t.loading.querySelector(".".concat(i.ad)).removeChild(t.loading.querySelector(".".concat(i.ad," iframe"))),t.loading.querySelector(".".concat(i.ad)).appendChild(Z),j.webgl.DETECTED)||(a(t.loading.querySelector(".".concat(i["start-game"])),!0),t.loading.querySelector(".".concat(i.p3)).innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">Failed to initialize WebGL.</strong>'),t.loading.querySelector(".".concat(i.ad," iframe")).style.setProperty("display","block","important"),t.loading.querySelector(".".concat(i.ad," iframe")).style.setProperty("visibility","visible","important"),t.loading.querySelector(".".concat(i.ad)).style.setProperty("display","block","important"),t.loading.querySelector(".".concat(i.ad)).style.setProperty("visibility","visible","important")):(t.loading.innerHTML='\n        <div>\n        <div class="'.concat(i["loading-info"],'" style="position: absolute;bottom: 20px;left: 50%;transform: translateX(-50%);">\n        <div class="').concat(i.p1,'"></div>\n        <div class="').concat(i.p2,'"></div>\n        <div class="').concat(i.p3,'"></div>\n        </div>\n        <div style="position: absolute;bottom: 20px;left: 50%;transform: translateX(-50%);">\n        <a href="#" onclick="return false" class="').concat(i["start-game"],'">').concat(D.get("playNow",o.config),"</a>\n        </div>\n        </div>"),j.webgl.DETECTED||(a(t.loading.querySelector(".".concat(i["start-game"])),!0),t.loading.querySelector(".".concat(i.p3)).innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">Failed to initialize WebGL.</strong>'));var eo=window.URL||window.webkitURL,Y=function(e){var t;return 80===e[0]&&75===e[1]&&3===e[2]&&4===e[3]?t="zip":80===e[0]&&75===e[1]&&5===e[2]&&6===e[3]?t="zip":80===e[0]&&75===e[1]&&7===e[2]&&8===e[3]?t="zip":55===e[0]&&122===e[1]&&188===e[2]&&175===e[3]&&39===e[4]&&28===e[5]?t="7z":82===e[0]&&97===e[1]&&114===e[2]&&33===e[3]&&26===e[4]&&7===e[5]&&0==e[6]&&(t="rar"),t},k=function(e){var t='importScripts("'+e+'");',n=new Blob([t],{type:"application/javascript"}),s=window.URL.createObjectURL(n);return new Promise(function(e){e(new Worker(s))})},B=function(t,n){e='',"rar"==n&&(e="\nvar dataToPass = [];\nModule = {\n    monitorRunDependencies: function(left)  {\n        if (left == 0) {\n            setTimeout(function() {\n                unrar(dataToPass, null);\n            }, 100);\n        }\n    },\n    onRuntimeInitialized: function() {\n    },\n    locateFile: function(file) {\n        return '".concat(t+".mem","';\n    }\n};\nimportScripts(\"").concat(t,'");\nvar unrar = function(data, password) {\n    var cb = function(fileName, fileSize, progress) {\n        postMessage({"t":4,"current":progress,"total":fileSize, "name": fileName});\n    };\n\n    var rarContent = readRARContent(data.map(function(d) {\n        return {\n            name: d.name,\n            content: new Uint8Array(d.content)\n        }\n    }), password, cb)\n    var rec = function(entry) {\n        if (entry.type === \'file\') {\n            postMessage({"t":2,"file":entry.fullFileName,"size":entry.fileSize,"data":entry.fileContent});\n        } else if (entry.type === \'dir\') {\n            Object.keys(entry.ls).forEach(function(k) {\n                rec(entry.ls[k]);\n            })\n        } else {\n            throw "Unknown type";\n        }\n    }\n    rec(rarContent);\n    postMessage({"t":1});\n    return rarContent;\n};\nonmessage = function(data) {\n    dataToPass.push({name:  \'test.rar\', content: data.data});\n};\n                '));var e,s=new Blob([e],{type:"application/javascript"}),o=window.URL.createObjectURL(s);return new Promise(function(e){e(new Worker(o))})},E=null,g=null,M=null,f=null;try{E=new V.a({dbVersion:1,storePrefix:"ejs-",storeName:"system",keyPath:null,autoIncrement:!1,onStoreReady:function(){z=!0},onError:function(){z=!0}}),g=new V.a({dbVersion:1,storePrefix:"ejs-",storeName:"roms",keyPath:null,autoIncrement:!1,onStoreReady:function(){F=!0},onError:function(){F=!0}}),M=new V.a({dbVersion:1,storePrefix:"ejs-",storeName:"bios",keyPath:null,autoIncrement:!1,onStoreReady:function(){N=!0},onError:function(){N=!0}}),f=new V.a({dbVersion:1,storePrefix:"ejs-",storeName:"romsdata",keyPath:null,autoIncrement:!1,onStoreReady:function(){},onError:function(){}})}catch(e){z=!0,F=!0,N=!0,console.log(e)}r.call(o,o.elements.container,"start-game",function(){if(o.started=!0,o.playing=!0,a(t.loading.querySelector(".".concat(i["loading-info"])),!0),d&&(d.virtualGamepadContainer=="undefined"||d.virtualGamepadContainer===null)&&w.toggleControls.call(o,!0),p=n({'ejs__tooltip--visible':!0}),g=o.elements.buttons.gamepad.querySelector(".".concat(n({ejs__tooltip:!0}))),h(g,p,!0),setTimeout(function(){h(g,p,!1)},5e3),typeof o.adUrl=="string"&&(a(t.loading.querySelector(".".concat(i["close-ad"])),!1),o.config.noAutoAdClose!==!0&&setTimeout(function(){o.started&&t.loading.querySelector(".".concat(i.ad))&&t.loading.querySelector(".".concat(i.ad)).parentNode.removeChild(t.loading.querySelector(".".concat(i.ad)))},1e4)),a(t.loading.querySelector(".".concat(i["start-game"])),!0),r=y(l.defaultCoreOptionsValues.call(e),l.storage.get("core-options")||{}),"n64"===o.system&&r&&Object.keys(r).forEach(function(e){"glupen64-aspect"===e&&"16:9"===r[e]&&(C.height=C.width/16*9,t.aspectRatio=16/9)}),"arcade"!==e.system&&"fba0.2.97.29"!==e.system||r&&Object.keys(r).forEach(function(e){"fba-aspect"===e&&"PAR"===r[e]&&(C.height=C.width/16*9,t.aspectRatio=16/9)}),"gba"===o.system&&(C.height=C.width/1.5,t.aspectRatio=1.5),window.setTimeout(function(){},150),function(){var o,i,s=e;"undefined"!=typeof RI?(document.removeEventListener("mousemove",RI.eventHandler,!1),C.removeEventListener("mousedown",RI.canvasEventHandler,!1),C.removeEventListener("mouseup",RI.canvasEventHandler,!1),s.elements.container.addEventListener("mousemove",function(a){var s,o=0,i=0,e=a.offsetX-t.Module.canvas.offsetLeft,n=a.offsetY-t.Module.canvas.offsetTop;switch(a.type){case"mousemove":e<0?(e=0,o=-t.Module.canvas.offsetWidth):e>t.Module.canvas.offsetWidth?(e=t.Module.canvas.offsetWidth,o=t.Module.canvas.offsetWidth):o=e-RI.currentX,n<0?(n=0,i=-t.Module.canvas.offsetHeight):n>t.Module.canvas.offsetHeight?(n=t.Module.canvas.offsetHeight,i=t.Module.canvas.offsetHeight):i=n-RI.currentY,RI.currentX=e,RI.currentY=n;for(s=0;s<RI.contexts.length;s+=1)HEAP32[RI.contexts[s].state+32>>2]=o,HEAP32[RI.contexts[s].state+36>>2]=i}},!1),s.elements.container.addEventListener("mousedown",RI.canvasEventHandler,!1),s.elements.container.addEventListener("mouseup",RI.canvasEventHandler,!1),i=function(e){if(e.targetTouches[0]){var o,r,c,d,i=0,a=0,l=e.target.getBoundingClientRect(),s=e.targetTouches[0].clientX-l.left,n=e.targetTouches[0].clientY-l.top;s<0?(s=0,i=-t.Module.canvas.offsetWidth):s>t.Module.canvas.offsetWidth?(s=t.Module.canvas.offsetWidth,i=t.Module.canvas.offsetWidth):i=s-RI.currentX,n<0?(n=0,a=-t.Module.canvas.offsetHeight):n>t.Module.canvas.offsetHeight?(n=t.Module.canvas.offsetHeight,a=t.Module.canvas.offsetHeight):a=n-RI.currentY,RI.currentX=s,RI.currentY=n;for(o=0;o<RI.contexts.length;o+=1)HEAP32[RI.contexts[o].state+32>>2]=i,HEAP32[RI.contexts[o].state+36>>2]=a;switch(e.type){case"touchend":case"touchstart":if(0===e.button)c=40;else{if(2!==e.button)break;c=41}d="touchend"===e.type?0:1;for(r=0;r<RI.contexts.length;r+=1)HEAP8[RI.contexts[r].state+c>>0]=d}}},s.elements.container.addEventListener("touchstart",i,!1),s.elements.container.addEventListener("touchend",i,!1)):(o=function(e){var n=new MouseEvent(e.type,e);t.Module.canvas.dispatchEvent(n)},u.call(e,".".concat(n({ejs__dialogs:!0}))).addEventListener("mousemove",o,!1),u.call(e,".".concat(n({ejs__dialogs:!0}))).addEventListener("mousedown",o,!1),u.call(e,".".concat(n({ejs__dialogs:!0}))).addEventListener("mouseup",o,!1))}(),"msx"===o.system&&function(){if("undefined"!=typeof RI){document.removeEventListener("keydown",RI.eventHandler,!1),document.removeEventListener("keyup",RI.eventHandler,!1);var e=function(n){var e,t,s=n.keyCode,o=s>>3,i=1<<(7&s);switch(n.type){case"keyup":case"keydown":if(o>=32)throw"key code error! bad code: "+s;for(e=0;e<RI.contexts.length;e++)t=HEAP8[RI.contexts[e].state+o>>0],"keyup"===n.type?t&=~i:t|=i,HEAP8[RI.contexts[e].state+o>>0]=t}};document.addEventListener("keydown",e,!1),document.addEventListener("keyup",e,!1)}}(),setTimeout(function(){var e=b.info();null===d.setVolume&&"undefined"!=typeof RA?(RA.queueAudio=function(){var t,s,n=o.volume,i=RA.bufIndex,a=RA.bufIndex?RA.buffers[RA.bufIndex-1].endTime:RA.context.currentTime;RA.buffers[i].endTime=a+RA.buffers[i].duration,s=RA.context.createBufferSource(),s.buffer=RA.buffers[i],o.muted&&(n=0),1===n?s.connect(RA.context.destination):(t=RA.context.createGain(),s.connect(t),t.connect(RA.context.destination),b.isEdge||"chrome"===e.name&&parseInt(e.version,10)<=60||"firefox"===e.name&&parseInt(e.version,10)<=56||"opera"===e.name&&parseInt(e.version,10)<=44?t.gain.value=n:"firefox"===e.name?t.gain.setValueAtTime(n,RA.context.currentTime):t.gain.setValueAtTime(n,RA.context.currentTime,0)),s.start(a),RA.bufIndex+=1,RA.bufOffset=0},b.isIos&&window.addEventListener("touchstart",function(){if(RA.context){RA.context.resume();var e=RA.context.createBufferSource();e.connect(RA.context.destination),e.start()}},!1)):d.setVolume()},500),setTimeout(function(){o.elements.container.focus()},30),void 0===window.addRunDependency&&(window.Module=void 0),s=t.FS.readFile(o.startName),s.length<=33554432&&".cue"!=o.startName.substr(-4)){"snes"===o.system||["snes2002","snes2005","snes2010"].includes(o.system)?(c=s.length%1024,m=new v(c?s.slice?s.slice(c):s.subarray(c):s)):m=new v(s);var s,r,c,m,p,g,j=eS.a.create(),_=new FileReader,f=0,O=m._u8array.length,x=function(){if(f<O){var e=Math.min(f+2097152,O);_.readAsArrayBuffer(new Blob([m._u8array.slice(f,e)])),f=e}else console.log(j.hex()),o.hash=j.hex(),"function"==typeof window.ejsromshash&&window.ejsromshash(o.hash)};_.onload=function(e){try{j.update(e.target.result),x()}catch(e){console.log(e)}},x()}}),typeof o.adUrl=="string"&&r.call(o,t.loading.querySelector(".".concat(i["close-ad"])),"click",function(e){e instanceof MouseEvent&&o.started&&t.loading.querySelector(".".concat(i.ad))&&t.loading.querySelector(".".concat(i.ad)).parentNode.removeChild(t.loading.querySelector(".".concat(i.ad))),o.elements.container.focus()});var i,Z,e=this,ei,Q=function(){g.db&&g.getAll(function(e){Array.isArray(e)&&e.length>10&&e.sort(function(e,t){return(t.lastaccess?t.lastaccess:0)-(e.lastaccess?e.lastaccess:0)}).forEach(function(e,n){n>10&&!t.saveFilenames.includes(e.key)?(g.remove(e.key),f.db&&f.remove(e.key)):(delete e.data,g.put(e.key,e))})},function(){g.clear(),f.db&&f.clear()})},X=function(e){if(t.gamePatch){var g=e.startName.split("/"),y=g.pop().split(".").pop(),j=(t.gamePatch.split(".").pop(),t.gamePatch.split("/").pop().split(".").shift()),c=''.concat(g.join("/"),"/").concat(j,".").concat(y),c=c.replace(/#/g,''),a=t.gamePatch;if(t.FS.rename(e.startName,c),e.startName=c,"snes"===e.system||["snes2002","snes2005","snes2010"].includes(e.system)){var s,o,r,l,n=new v(t.FS.readFile(e.startName)),b=A(n),h=new v(t.FS.readFile(a)),m=h.readString(6),i=n._u8array.length%1024;m.startsWith("PATCH")?(r=e8(h),0===i&&"B19ED489"===b.toString(16).toUpperCase()&&((s=new Uint8Array(n._u8array.length+512)).set(new Uint8Array(512),0),s.set(n._u8array,512),n=new v(s))):m.startsWith(T)?r=ek(h):m.startsWith("BPS1")&&(r=e9(h),i>0&&"A31BEAD4"===b.toString(16).toUpperCase()&&(s=n._u8array.slice?n._u8array.slice(i):n._u8array.subarray(i),n=new v(s)));try{(o=r.apply(n,!1))&&(l=o._u8array.length%1024,l>0&&(s=o._u8array.slice?o._u8array.slice(l):o._u8array.subarray(l),o=new v(s)),t.FS.unlink(a),t.FS.unlink(e.startName),t.FS.writeFile(e.startName,o._u8array))}catch(e){}}else{var d,p,_=new v(t.FS.readFile(e.startName)),u=new v(t.FS.readFile(a)),f=u.readString(6);f.startsWith("PATCH")?d=e8(u):f.startsWith(T)?d=ek(u):f.startsWith("BPS1")&&(d=e9(u));try{(p=d.apply(_,!1))&&(t.FS.unlink(a),t.FS.unlink(e.startName),t.FS.writeFile(e.startName,p._u8array))}catch(e){}}}},H=function(){$?(window.Module.TOTAL_MEMORY=268435456,["jaguar"].includes(e.system)&&(window.Module.TOTAL_MEMORY=268435456),["nds","nes","snes","arcade","mame"].includes(e.system)&&(window.Module.TOTAL_MEMORY=0),["snes2002","snes2005","snes2010"].includes(e.system)&&(window.Module.TOTAL_MEMORY=0),"gba"==e.system&&(window.Module.TOTAL_MEMORY=0),"3do"==e.system&&(window.Module.TOTAL_MEMORY=0),"n64"==e.system&&(window.Module.TOTAL_MEMORY=0)):("nes"===e.system&&(window.Module.TOTAL_MEMORY=134217728),window.Module.TOTAL_MEMORY=O+67108864,["arcade","mame","mame2003","fba0.2.97.29"].includes(e.system)&&(window.Module.TOTAL_MEMORY=O+268435456,t.isMobileDevice&&(window.Module.TOTAL_MEMORY=314572800)),["n64","nds","jaguar"].includes(e.system)&&(window.Module.TOTAL_MEMORY=O+268435456,t.isMobileDevice&&(window.Module.TOTAL_MEMORY=314572800)),"gba"==e.system&&(window.Module.TOTAL_MEMORY=268435456)),"undefined"!=typeof EJS_MEMORY&&(window.Module.TOTAL_MEMORY=EJS_MEMORY)},I=function(b,s){var a,c,l,d,h,f,n=e,r=t.loading.querySelector(".".concat(i.p3)),v=(b.split(".").pop(),G[U]),g=-1,u='',m=function(){if(n.coreVer===2){var e=t.Module.cwrap("toggleMainLoop","null",["number"]);t.Module.resumeMainLoop=function(){e(1)},t.Module.pauseMainLoop=function(){e(0)}}typeof n.loadStateOnStart=="string"&&fetch(n.loadStateOnStart).then(function(e){e.arrayBuffer().then(function(e){var t=new Uint8Array(e);EJS_loadState(t)})})};if(window.EJS_terminate=function(){if(t.Module.pauseMainLoop(),n&&n.eventListeners)for(i in n)for(var s,o,i,e=0;e<n.eventListeners.length;e++)s=n.eventListeners[e],s.element.removeEventListener(s.type,s.callback,s.capture);if(window.EJS_RESET_VARS){s=[],o=[];for(i in window)s.push(i);for(e=0;e<s.length;e++)window.EJS_RESET_VARS.includes(s[e])||o.push(s[e]);for(e=0;e<o.length;e++)window[o[e]]&&delete window[o[e]]}},l=function(s){if(s.data){if(1===s.data.t){r.innerHTML="Game Data ready",s.target.terminate();try{H(),X(n),Q(),!n.startName&&u&&(n.startName=u),d=[n.startName,[t.hash,t.hash2,t.hash3].join('')],"undefined"!=typeof EJS_DEBUG_XX&&!0===EJS_DEBUG_XX&&d.unshift("-v"),t.Module.callMain(d),o.coreVer===2&&(t.Module.resumeMainLoop(),t.Module.setCanvasSize(800,600)),p.call(n,n.elements.container,"start-game")}catch(e){console.log(e),r.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">Failed to start game</strong>'}try{m()}catch(e){}}if(2===s.data.t){var a,l,d,h,c=s.data.file.split("/"),i=c.pop(),f=i.split(".").pop(),i=i.replace(/#/g,'');t._FS.createPath("/",c.join("/"),!0,!0);for(a=J[v].length-1;a>=0;a-=1)J[v][a]===f.toLowerCase()&&a>g&&(g=a,n.startName=['',c.join("/"),i].join("/"),n.startName=n.startName.replace(/\/+/,"/"));i&&(t._FS.createDataFile("/".concat(c.join("/")),i,s.data.data,!0,!1),O+=s.data.data.length),u="/".concat(c.join("/"),"/").concat(i)}4===s.data.t&&s.data.total>0&&(l=Math.floor(s.data.current/s.data.total*100),h=s.data.name||'',l<=100&&l>0&&(r.innerHTML=e.localization("Decompress Game Data")+" ".concat(h," ").concat(l,"%")))}},a=!1,["arcade","mame","mame2003","fba0.2.97.29"].includes(n.system)||(f=s.slice?s.slice(0,10):s.subarray(0,10),c=Y(f),"7z"===c?(k(L).then(function(e){e.onmessage=l,e.postMessage(s)}),a=!0):"zip"===c?(k(P).then(function(e){e.onmessage=l,e.postMessage(s)}),a=!0):"rar"==c&&(B(W,"rar").then(function(e){e.onmessage=l,e.postMessage(s)}),a=!0)),!a){d=b.replace(/#/g,'');try{O+=s.length,t._FS.createDataFile("/",d,s,!0,!1)}catch(e){console.log(e)}H(),n.startName=d,X(n),Q();try{h=[n.startName,[t.hash,t.hash2,t.hash3].join('')],"undefined"!=typeof EJS_DEBUG_XX&&!0===EJS_DEBUG_XX&&h.unshift("-v"),t.Module.callMain(h),o.coreVer===2&&(t.Module.resumeMainLoop(),t.Module.setCanvasSize(800,600)),p.call(n,n.elements.container,"start-game")}catch(e){console.log(e),r.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">Failed to start game</strong>'}try{m()}catch(e){}}},q=function(){var n,l,o=e,s=t.loading.querySelector(".".concat(i.p3)),a=e.config,r=(a.gameId,a.gameUrl),c=a.system;"vbanext"==c&&(c="gba"),l=r.split("/"),n=l[l.length-1],n.indexOf("?")>-1&&(n=n.substr(0,n.indexOf("?"))),n.split(".").pop(),s.innerHTML=e.localization("Download Game Data"),["arcade","mame","mame2003","fba0.2.97.29"].includes(o.system)&&o.config.gameParentUrl&&(s.innerHTML+=" (2/2)"),o.config.gamePatchUrl&&(s.innerHTML+=" (2/2)"),_.a.head(r,{}).then(function(l){var u=l.headers["content-length"],a=l.headers["content-type"],i=(l.headers["last-modified"],''.concat(c,"-").concat(n)),d=function(){_.a.get(r,{onDownloadProgress:function(t){var n=t.total?''.concat(Math.floor(t.loaded/t.total*100),"%"):'';["arcade","mame","mame2003","fba0.2.97.29"].includes(o.system)&&o.config.gameParentUrl?s.innerHTML=e.localization("Download Game Data")+" (2/2) ".concat(n):o.config.gamePatchUrl?s.innerHTML=e.localization("Download Game Data")+" (2/2) ".concat(n):s.innerHTML=e.localization("Download Game Data")+" ".concat(n)},responseType:"arraybuffer"}).then(function(l){if(s=new Uint8Array(l.data),e.config.gameUrl.startsWith("blob:")||e.config.gameUrl.startsWith("file:")||e.config.gameUrl.startsWith("chrome-extension:")||(window.location.protocol=="file:"||window.location.protocol=="chrome-extension:")&&e.config.gameUrl.split(":").length==1){I(n,s);return}if(i&&g.db)if(s.length>104857600)for(var s,r,c,d=Math.ceil(s.length/104857600),o=0;o<d;o+=1)c=s.slice?s.slice(104857600*o,104857600*(o+1)):s.subarray(104857600*o,104857600*(o+1)),r=''.concat(i),o>0&&(r=''.concat(i,"-part-").concat(o)),t.saveFilenames.push(r),g.put(r,{filename:n,filesize:s.length,filetype:a,key:r,lastaccess:(new Date).valueOf(),next:''.concat(i,"-part-").concat(o+1)}),f.db&&f.put(r,{filename:n,filesize:s.length,filetype:a,key:r,data:c});else t.saveFilenames.push(i),g.put(i,{filename:n,filesize:s.length,filetype:a,key:i,lastaccess:(new Date).valueOf()}),f.db&&f.put(i,{filename:n,filesize:s.length,filetype:a,key:i,data:s});I(n,s)}).catch(function(t){x(t,s,e)})};f.db?f.get(i,function(e){if(e&&e.filename===n&&e.filesize-u==0&&e.filetype===a&&e.key)if(g.get(i,function(e){e.lastaccess=(new Date).valueOf(),g.put(e.key,e)}),e.filesize>104857600){t=new Uint8Array(e.filesize),t.set(e.data);for(var t,r=Math.ceil(e.filesize/104857600),o=[],s=1;s<r;s+=1)o.push(''.concat(i,"-part-").concat(s)),g.get(''.concat(i,"-part-").concat(s),function(e){e.lastaccess=(new Date).valueOf(),g.put(e.key,e)});f.getBatch(o,function(n){n.filter(function(e){return e}).length!==o.length?d():(n.forEach(function(e,n){t.set(e.data,104857600*(n+1))}),I(e.filename,t))},function(){},"sparse")}else I(e.filename,e.data);else d()}):d()}).catch(function(t){x(t,s,e)})},R=function(){var n,a,s=t.loading.querySelector(".".concat(i.p3)),o=e.config.gamePatchUrl;o?(a=o.split("/"),n=a[a.length-1],n.indexOf("?")>-1&&(n=n.substr(0,n.indexOf("?"))),n.split(".").pop(),s.innerHTML=e.localization("Download Game Data")+" (1/2)",_.a.get(o,{onDownloadProgress:function(t){s.innerHTML=e.localization("Download Game Data")+" (1/2) ";var n=t.total?''.concat(Math.floor(t.loaded/t.total*100),"%"):'';s.innerHTML+=n},responseType:"arraybuffer"}).then(function(s){var o=new Uint8Array(s.data);!function(o,n){var c=t.loading.querySelector(".".concat(i.p3)),r=(o.split(".").pop(),function(n){if(n.data){if(1===n.data.t&&(n.target.terminate(),q()),2===n.data.t){var o,a,s=n.data.file.split("/"),i=s.pop(),r=i.split(".").pop();t._FS.createPath("/",s.join("/"),!0,!0),t._FS.createDataFile("/"+s.join("/"),i,n.data.data,!0,!1),O+=n.data.data.length,["ips","bps","ups"].includes(r)&&!t.gamePatch&&(t.gamePatch="/"+s.join("/")+"/"+i)}4===n.data.t&&n.data.total>0&&(o=Math.floor(n.data.current/n.data.total*100),a=n.data.name||'',o<=100&&o>0&&(c.innerHTML=e.localization("Decompress Game Patch")+" ".concat(a," ").concat(o,"%")))}}),s=!1,l=n.slice?n.slice(0,10):n.subarray(0,10),a=Y(l);"7z"===a?(k(L).then(function(e){e.onmessage=r,e.postMessage(n)}),s=!0):"zip"===a?(k(P).then(function(e){e.onmessage=r,e.postMessage(n)}),s=!0):"rar"==a&&(B(W,"rar").then(function(e){e.onmessage=messageCallBack,e.postMessage(n)}),s=!0),s||(O+=n.length,t.gamePatch="/".concat(o),t._FS.createDataFile("/",o,n,!0,!1),q())}(n,o)}).catch(function(t){x(t,P,e)})):q()},K=function(){var n,a,r=e,s=t.loading.querySelector(".".concat(i.p3)),o=e.config.gameParentUrl;o&&["arcade","mame","mame2003","fba0.2.97.29"].includes(r.system)?(a=o.split("/"),n=a[a.length-1],n.indexOf("?")>-1&&(n=n.substr(0,n.indexOf("?"))),n.split(".").pop(),s.innerHTML=e.localization("Download Game Data")+" (1/2)",r.config.gamePatchUrl&&(s.innerHTML=e.localization("Download Game Data")+" (1/3)"),_.a.head(o,{}).then(function(r){var l=r.headers["content-length"],a=r.headers["content-type"],i=(r.headers["last-modified"],''.concat(U,"-").concat(n)),c=function(){_.a.get(o,{onDownloadProgress:function(t){var n=t.total?''.concat(Math.floor(t.loaded/t.total*100),"%"):'';s.innerHTML=e.localization("Download Game Data")+" (1/2) ".concat(n)},responseType:"arraybuffer"}).then(function(d){if(e=new Uint8Array(d.data),i&&g.db)if(e.length>104857600)for(var e,o,r,c,l=Math.ceil(e.length/104857600),s=0;s<l;s+=1)c=e.slice?e.slice(104857600*s,104857600*(s+1)):e.subarray(104857600*s,104857600*(s+1)),o=''.concat(i),s>0&&(o=''.concat(i,"-part-").concat(s)),t.saveFilenames.push(o),g.put(o,{filename:n,filesize:e.length,filetype:a,key:o,lastaccess:(new Date).valueOf(),next:''.concat(i,"-part-").concat(s+1)}),f.db&&f.put(o,{filename:n,filesize:e.length,filetype:a,key:o,data:c});else t.saveFilenames.push(i),g.put(i,{filename:n,filesize:e.length,filetype:a,key:i,lastaccess:(new Date).valueOf()}),f.db&&f.put(i,{filename:n,filesize:e.length,filetype:a,key:i,data:e});r=n.replace(/#/g,'');try{O+=e.length,t._FS.createDataFile("/",r,e,!0,!1),R()}catch(e){console.log(e)}}).catch(function(t){x(t,s,e)})};f.db?f.get(i,function(e){if(e&&e.filename===n&&e.filesize-l==0&&e.filetype===a&&e.key)if(e.filesize>104857600){s=new Uint8Array(e.filesize),s.set(e.data);for(var s,d=Math.ceil(e.filesize/104857600),o=[],r=1;r<d;r+=1)o.push(''.concat(i,"-part-").concat(r));f.getBatch(o,function(n){n.filter(function(e){return e}).length!==o?c():(n.forEach(function(e,t){s.set(e.data,104857600*(t+1))}),t._FS.createDataFile("/",e.filename,s,!0,!1),R())},function(){},"sparse")}else t._FS.createDataFile("/",e.filename,e.data,!0,!1),R();else c()}):c()}).catch(function(t){x(t,s,e)})):R()},ee=function(r,n){var l=e,o=t.loading.querySelector(".".concat(i.p2)),c=(r.split(".").pop(),function(e){if(e.data){if(1===e.data.t&&(o.innerHTML="BIOS ready",e.target.terminate(),K()),2===e.data.t){var n,a,s=e.data.file.split("/"),i=s.pop();i.split(".").pop(),t._FS.createPath("/",s.join("/"),!0,!0),t._FS.createDataFile("/"+s.join("/"),i,e.data.data,!0,!1),O+=e.data.data.length}4===e.data.t&&e.data.total>0&&(n=Math.floor(e.data.current/e.data.total*100),a=e.data.name||'',n<=100&&n>0&&(o.innerHTML="Decompress BIOS ".concat(a," ").concat(n,"%")))}}),s=!1,d=n.slice?n.slice(0,10):n.subarray(0,10),a=Y(d);"7z"===a?(k(L).then(function(e){e.onmessage=c,e.postMessage(n)}),s=!0):"zip"!==a||["arcade","mame","mame2003","fba0.2.97.29"].includes(l.system)?"rar"===a&&(B(W,"rar").then(function(e){e.onmessage=messageCallBack,e.postMessage(n)}),s=!0):(k(P).then(function(e){e.onmessage=c,e.postMessage(n)}),s=!0),s||(O+=n.length,o.innerHTML="BIOS ready",t._FS.createDataFile("/",r,n,!0,!1),K())},et=function(){t.loading.querySelector(".".concat(i.p1)).innerHTML="Game Core ready";var n,o,a,c,h,m,f,u=e.config.biosUrl,s=e;d.bindFunction.call(e),d.setGamepadDialog.call(e),d.setCacheDialog.call(e),d.setLoadingDialog.call(e),d.setNetplayDialog.call(e),d.setCheatDialog.call(e),d.initGamepad.call(e),d.initKeyboard.call(e),d.listeners.call(e),t._FS.createFolder("/","etc",!0,!0),t.FS.mkdir("/data"),t.FS.mkdir("/data/saves"),"undefined"!=typeof IDBFS?t.FS.mount(IDBFS,{},"/data/saves"):t.FS.mount(t.FS.filesystems.IDBFS,{},"/data/saves"),t.FS.mkdir("/shader"),t.FS.syncfs(!0,function(){}),d.initShaders(),n='',n+="savefile_directory = /data/saves\n",n+="video_vsync = true\n",n+="screenshot_directory = /\n",n+="video_shader = /shader/shader.glslp\n",n+="video_shader_enable = true\n",n+="video_font_enable = false\n",n+="video_scale = 1.0\n",n+="video_gpu_screenshot = false\n",n+="audio_latency = 96\n",a=l.defaultCoreOptionsValues.call(e),s.lightgun&&("nes"===e.system&&(n+='input_libretro_device_p2 = "258"\n'),"segaMS"!==e.system&&"segaMD"!==e.system&&"segaCD"!==e.system||(a.genesis_plus_gx_gun_cursor="yes",a.genesis_plus_gx_invert_mouse="yes",a.genesis_plus_gx_bram="per game",n+='input_libretro_device_p2 = "260"\n'),"snes"===e.system&&(n+='input_libretro_device_p2 = "260"\n'),["snes2002","snes2005","snes2010","snesnext"].includes(e.system)&&(n+='input_libretro_device_p2 = "260"\n')),s.mouse&&("snes"===e.system&&(n+="input_libretro_device_p1 = 2\n"),["snes2002","snes2005","snes2010","snesnext"].includes(e.system)&&(n+="input_libretro_device_p1 = 2\n")),s.multitap&&("snes"===e.system&&(n+="input_libretro_device_p2 = 257\n"),["snes2002","snes2005","snes2010","snesnext"].includes(e.system)&&(n+="input_libretro_device_p2 = 257\n")),"n64"===e.system&&(n+="input_libretro_device_p1 = 5\n"),s.system,n+="fastforward_ratio = 1.0\n",n+="video_smooth = false\n",c=y(a,l.storage.get("core-options")||{}),h='',s.coreVer===2?(t._FS.createDataFile("/etc","retroarch.cfg",n,!0,!0),t._FS.createFolder("/home/web_user","retroarch",!0,!0),t._FS.createFolder("/home/web_user/retroarch","userdata",!0,!0),t._FS.createDataFile("/home/web_user/retroarch/userdata","retroarch.cfg",h,!0,!0)):(t._FS.createDataFile("/etc","retroarch.cfg",n,!0,!0),t._FS.createFolder("/home/web_user",".config",!0,!0),t._FS.createFolder("/home/web_user/.config","retroarch",!0,!0),t._FS.createDataFile("/home/web_user/.config/retroarch","retroarch-core-options.cfg",h,!0,!0)),c&&Object.keys(c).forEach(function(e){if(s.lightgun&&"nes"===s.system&&"system_type"===e)return!1;h+=''.concat(e,' = "').concat(c[e],'"\n'),r.call(s,s.elements.container,"start-game",function(){d.setVariable(e,c[e])})}),u?(f=u.split("/"),o=f[f.length-1],o.indexOf("?")>-1&&(o=o.substr(0,o.indexOf("?"))),o.split(".").pop(),m=t.loading.querySelector(".".concat(i.p2)),_.a.head(u,{}).then(function(t){var a=t.headers["content-length"],n=t.headers["content-type"],r=(t.headers["last-modified"],s.system),i=function(){_.a.get(u,{onDownloadProgress:function(e){var t=e.total?''.concat(Math.floor(e.loaded/e.total*100),"%"):'';m.innerHTML="Download BIOS ".concat(t)},responseType:"arraybuffer"}).then(function(t){var e=new Uint8Array(t.data);M.db&&M.put(U,{filename:o,filesize:e.length,filetype:n,data:e}),ee(o,e)}).catch(function(t){x(t,m,e)})};M.db?M.get(r,function(e){e&&e.filename===o&&e.filesize-a==0&&e.filetype===n?ee(e.filename,e.data):i()}):i()}).catch(function(t){x(t,m,e)})):K()},es=function(e){var n=e.byteLength?new Uint8Array(e):e;"undefined"!=typeof GLOBAL_BASE?t.Module.HEAPU8.set(n,GLOBAL_BASE):"undefined"!=typeof Runtime&&Runtime.GLOBAL_BASE?t.Module.HEAPU8.set(n,Runtime.GLOBAL_BASE):t.Module.HEAPU8.set(n,8)},S=function(a){var s,l=t.loading.querySelector(".".concat(i.p1)),n='',u=function(){if(null!==t.wasmData?(window.Module.wasmBinary=t.wasmData,H(),window.Module.monitorRunDependencies=function(e){0===e&&et()},window.Module.onRuntimeInitialized=function(){}):(H(),window.Module.monitorRunDependencies=function(e){console.log("monitorRunDependencies, ",e)},window.Module.onRuntimeInitialized=function(){t.Module||(t.Module=window.Module),t.Module&&t.Module.FS?t.FS=t.Module.FS:t.FS=window.FS,console.log("onRuntimeInitialized"),et()}),e=window.Module,null!==t.wasmData&&(e.wasmBinary=t.wasmData),b.isIos&&null!==t.wasmData){var e,o=new Blob([n],{type:"text/javascript"}),s=c("script",{src:eo.createObjectURL(o)});document.body.appendChild(s),s.onload=function(){void 0===window.addRunDependency&&"undefined"!=typeof EmulatorJS&&(t.Module=EmulatorJS(e),EmulatorJS=void 0),null!==t.memData&&es(t.memData),t.Module||(t.Module=window.Module),t.Module&&t.Module.FS?t.FS=t.Module.FS:t.FS=window.FS}}else n=function(n){for(var e,s=[],t=0;t<n.length;t+=1)e=n[t],e>255&&(e&=255),s.push(String.fromCharCode(e));return s.join('')}(n),window.eval(n),void 0===window.addRunDependency&&"undefined"!=typeof EmulatorJS&&(t.Module=EmulatorJS(e),EmulatorJS=void 0),null!==t.memData&&es(t.memData),t.Module||(t.Module=window.Module),t.Module&&t.Module.FS?t.FS=t.Module.FS:t.FS=window.FS,window.EJS_MODULE=t.Module,window.ejs_loader=t,window.ejs_media=d;n=null};r.call(o,o.elements.container,"script-loaded",function(){u()}),s=function(s){if(s.data){if(1===s.data.t&&(p.call(o,o.elements.container,"script-loaded"),s.target.terminate()),2===s.data.t){var i=s.data.file.split("/").pop(),a=i.split(".").pop();t.coreFileData[i]=s.data.data,"js"!==a||i.includes(".worker.js")||(n=s.data.data),"mem"===a&&(t.memData=s.data.data),"wasm"===a&&(t.wasmData=s.data.data)}4===s.data.t&&s.data.total>0&&(l.innerHTML=e.localization("Decompress Game Core")+" ".concat(Math.floor(s.data.current/s.data.total*100),"%"))}},k(L).then(function(e){e.onmessage=s,e.postMessage(a)})},m=this,ea=function(e){a(t.loading.querySelector(".".concat(i["start-game"])),!0);var n,r,c,e=t.loading.querySelector(".".concat(i.p1));return e.innerHTML=m.localization("Loading")+"...",!0===z&&!0===F&&!0===N&&(window.Module={TOTAL_MEMORY:268435456,noInitialRun:!0,arguments:[],preRun:[],postRun:[],canvas:C,print:function(e){window.EJS_DEBUG_XX===!0&&console.log(e)},printErr:function(e){window.EJS_DEBUG_XX===!0&&console.log(e)},totalDependencies:0,monitorRunDependencies:function(){},locateFile:function(e){var s,n=null;return e.includes(".worker.js")?(Object.keys(t.coreFileData).includes(e)&&(n=t.coreFileData[e]),s=new Blob([''],{type:"application/javascript"}),window.URL.createObjectURL(s)):e.includes(".js.mem")&&(Object.keys(t.coreFileData).includes(e)&&(n=t.coreFileData[e]),n)?(t.memData=null,n.buffer):e},readAsync:function(t,n,s){if(t instanceof ArrayBuffer)setTimeout(function(){n(t)},500);else{var e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType="arraybuffer",e.onload=function(){200==e.status||0==e.status&&e.response?n(e.response):s()},e.onerror=s,e.send(null)}}},r=Math.ceil((new Date).valueOf()/1e3),c=o.customPaths&&typeof o.customPaths["v.json"]=="string"?o.customPaths["v.json"]:o.dataPath+"v.json?t="+r,n=function(t,n){var s=o.customPaths&&typeof o.customPaths[t]=="string"?o.customPaths[t]:o.coreVer===2?o.dataPath+"cores/"+t+"?v="+n:o.dataPath+"old/"+t+"?v="+n;_.a.get(s,{onDownloadProgress:function(t){var n=t.total?''.concat(Math.floor(t.loaded/t.total*100),"%"):'';e.innerHTML=m.localization("Download Game Core")+" ".concat(n)},responseType:"arraybuffer"}).then(function(i){var s,e=new Uint8Array(i.data);E.db&&E.put(t,{version:n,data:e}),o.coreVer===2?S(e):(s=e.slice?e.slice(12):e.subarray(12),s.set([55,122,188,175,39,28,0,3],0),e=null,S(s))}).catch(function(t){x(t,e,o)})},_.a.get(c,{}).then(function(y){var e,r,u,h,f,g=G[m.system],c=y.data[m.system],d=c.version?c.version:1,b=Boolean(c.netplay),i=Boolean(c.state),v=Boolean(c.asmjs),p=Boolean(c.wasm);if(o.coreVer!==2&&c.old&&(v=Boolean(c.old.asmjs),p=Boolean(c.old.wasm)),"nds"==m.system&&!j.wasm&&(i=!1),o.statesSupported===!1&&(i=!1),t.coreFileVersion=d,t.coreFileName=g,h=!1,["webgl2","experimental-webgl2"].includes(j.webgl.WEBGL_CONTEXT)&&(h=!0),"undefined"!=typeof EJS_N64_LEGACY&&1==EJS_N64_LEGACY&&(h=!1),"mame"==m.system){if(f=m.mameCore,!f||f===null||f.split("|").length!==2){r.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+m.localization("Missing mame config")+"</strong>";return}r=f.split("|"),t.coreFileName=''.concat(m.system,"-").concat(r[0]),i="1"===r[1],s.element(m.elements.buttons.saveState)&&a(m.elements.buttons.saveState,!i),s.element(m.elements.buttons.loadState)&&a(m.elements.buttons.loadState,!i),a(l.contextMenu.querySelectorAll("ul li").item(2),!i),a(l.contextMenu.querySelectorAll("ul li").item(3),!i),m.coreVer===2?e='':e=m.system.concat("-old-").concat(r[0],"-wasm.data"),r[0]?(j.wasm&&p?$=!0:(r.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+m.localization("Webassembly support is not detected in this browser")+"</strong>",e=''),e&&(E.db?E.get(e,function(t){if(t&&t.version===d)if(o.coreVer===2)S(t.data);else{var s=t.data.slice?t.data.slice(12):t.data.subarray(12);s.set([55,122,188,175,39,28,0,3],0),S(s)}else n(e,d)}):n(e,d))):r.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+m.localization("Unsupported Game")+"</strong>"}else{if(e=!1,j.wasm&&p?(u="wasm",e=!0,"n64"===m.system&&!h&&(u="legacy-wasm"),$=!0):v&&(e=!0,u="asmjs","n64"===m.system&&!h&&(u="legacy-asmjs")),"undefined"!=typeof EJS_CUSTOM_COREFILE&&(e=EJS_CUSTOM_COREFILE),e!==!0){r.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+m.localization("Please upgrade your browser to the latest version")+"</strong>";return}m.coreVer===2?e=g+"-"+u+".data":e=g+"-old-"+u+".data","undefined"!=typeof EJS_CUSTOM_COREFILE&&(e=EJS_CUSTOM_COREFILE),E.db?E.get(e,function(t){if(t&&t.version===d&&("undefined"==typeof EJS_DEBUG_XX||!0!==EJS_DEBUG_XX))if(o.coreVer===2)S(t.data);else{var s=t.data.slice?t.data.slice(12):t.data.subarray(12);s.set([55,122,188,175,39,28,0,3],0),S(s)}else n(e,d)}):n(e,d)}m.coreVer===2&&("undefined"==typeof EJS_DEBUG_XX||!0!==EJS_DEBUG_XX)&&s.element(m.elements.buttons.gamepad)&&a(m.elements.buttons.gamepad,!0),b||s.element(m.elements.buttons.netplay)&&a(m.elements.buttons.netplay,!0),s.element(m.elements.buttons.saveState)&&a(m.elements.buttons.saveState,!i),s.element(m.elements.buttons.loadState)&&a(m.elements.buttons.loadState,!i),a(l.contextMenu.querySelectorAll("ul li").item(2),!i),a(l.contextMenu.querySelectorAll("ul li").item(3),!i),o.setStatesSupported(i)}).catch(function(t){x(t,e,o)}),t.romdb=g),!1};en(t.loading.querySelector(".".concat(i["start-game"])),"click touchstart",ea),o.startOnLoad===!0&&t.loading.querySelector(".".concat(i["start-game"])).click()}},o=t,eT=g(161);function G(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ej(s,n){for(var e,t=0;t<n.length;t++)e=n[t],e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(s,e.key,e)}var L,q,eb,eo,eA,O=(eb=["a[href]","area[href]",'input:not([disabled]):not([type="hidden"]):not([aria-hidden])',"select:not([disabled]):not([aria-hidden])","textarea:not([disabled]):not([aria-hidden])","button:not([disabled]):not([aria-hidden])","iframe","object","embed","[contenteditable]",'[tabindex]:not([tabindex^="-"])'],eo=function(){function e(t){var _=t.targetModal,o=t.triggers,i=void 0===o?[]:o,a=t.onShow,j=void 0===a?function(){}:a,r=t.onClose,v=void 0===r?function(){}:r,l=t.openTrigger,p=void 0===l?"data-micromodal-trigger":l,u=t.closeTrigger,m=void 0===u?"data-micromodal-close":u,n=t.disableScroll,f=void 0!==n&&n,d=t.disableFocus,g=void 0!==d&&d,c=t.awaitCloseAnimation,b=void 0!==c&&c,h=t.debugMode,y=void 0!==h&&h,s=t.closeByEsckey,w=void 0===s||s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.modal=document.getElementById(_),this.config={debugMode:y,disableScroll:f,openTrigger:p,closeTrigger:m,onShow:j,onClose:v,awaitCloseAnimation:b,disableFocus:g,closeByEsckey:w},i.length>0&&this.registerTriggers.apply(this,G(i)),this.onClick=this.onClick.bind(this),this.onKeydown=this.onKeydown.bind(this)}var t,s,o;return t=e,(s=[{key:"registerTriggers",value:function(){for(var s=this,t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];n.forEach(function(e){e.addEventListener("click",function(){return s.showModal()})})}},{key:"showModal",value:function(){this.activeElement=document.activeElement,this.modal.setAttribute("aria-hidden","false"),this.modal.classList.add(n({'is-open':!0})),this.setFocusToFirstNode(),this.addEventListeners(),this.config.onShow(this.modal)}},{key:"closeModal",value:function(){var e=this.modal;this.modal.setAttribute("aria-hidden","true"),this.removeEventListeners(),this.config.onClose(this.modal),this.config.awaitCloseAnimation?this.modal.addEventListener("animationend",function t(){e.classList.remove(n({'is-open':!0})),e.removeEventListener("animationend",t,!1)},!1):e.classList.remove(n({'is-open':!0}))}},{key:"addEventListeners",value:function(){this.modal.addEventListener("touchstart",this.onClick),this.modal.addEventListener("click",this.onClick),document.addEventListener("keydown",this.onKeydown)}},{key:"removeEventListeners",value:function(){this.modal.removeEventListener("touchstart",this.onClick),this.modal.removeEventListener("click",this.onClick),document.removeEventListener("keydown",this.onKeydown)}},{key:"onClick",value:function(e){e.target.hasAttribute(this.config.closeTrigger)&&(this.closeModal(),e.preventDefault())}},{key:"onKeydown",value:function(e){this.config.closeByEsckey&&27===e.keyCode&&this.closeModal(e),9===e.keyCode&&this.maintainFocus(e)}},{key:"getFocusableNodes",value:function(){var e=this.modal.querySelectorAll(eb);return Object.keys(e).map(function(t){return e[t]})}},{key:"setFocusToFirstNode",value:function(){if(!this.config.disableFocus){var e=this.getFocusableNodes();e.length&&e[0].focus()}}},{key:"maintainFocus",value:function(t){var n,e=this.getFocusableNodes();this.modal.contains(document.activeElement)?(n=e.indexOf(document.activeElement),t.shiftKey&&0===n&&(e[e.length-1].focus(),t.preventDefault()),t.shiftKey||n!==e.length-1||(e[0].focus(),t.preventDefault())):e[0].focus()}}])&&ej(t.prototype,s),o&&ej(t,o),e}(),L=null,q=function(e){if(!document.getElementById(e))return!1},eA=function(t,e){if(function(e){e.length<=0&&(console.warn("MicroModal v".concat(version,": Please specify at least one %c'micromodal-trigger'"),"background-color: #f8f9fa;color: #50596c;font-weight: bold;","data attribute."),console.warn("%cExample:","background-color: #f8f9fa;color: #50596c;font-weight: bold;",'<a href="#" data-micromodal-trigger="my-modal"></a>'))}(t),!e)return!0;for(var n in e)q(n);return!0},{init:function(i){var s,o,e=Object.assign({},{openTrigger:"data-micromodal-trigger"},i),n=G(document.querySelectorAll("[".concat(e.openTrigger,"]"))),t=function(t,n){var e=[];return t.forEach(function(s){var t=s.attributes[n].value;void 0===e[t]&&(e[t]=[]),e[t].push(s)}),e}(n,e.openTrigger);if(!0!==e.debugMode||!1!==eA(n,t))for(s in t)o=t[s],e.targetModal=s,e.triggers=G(o),new eo(e)},show:function(t,n){var e=n||{};return e.targetModal=t,!0===e.debugMode&&!1===q(t)?L=null:(L=new eo(e)).showModal(),L},close:function(){L.closeModal()}}),e={defaultControllers:{0:{0:{value:"88",value2:"1"},1:{value:"83",value2:"3"},2:{value:"16",value2:"8"},3:{value:"13",value2:"9"},4:{value:"38",value2:"12"},5:{value:"40",value2:"13"},6:{value:"37",value2:"14"},7:{value:"39",value2:"15"},8:{value:"90",value2:"0"},9:{value:"65",value2:"2"},10:{value:"81",value2:"4"},11:{value:"69",value2:"5"},12:{value:"82",value2:"6"},13:{value:"87",value2:"7"},14:{},15:{},16:{value:"72"},17:{value:"70"},18:{value:"71"},19:{value:"84"},20:{value:"76"},21:{value:"74"},22:{value:"75"},23:{value:"73"},24:{},25:{},26:{}},1:{},2:{},3:{}},controllers:{},virtualGamepadContainer:null,keyMap:{8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause/break",20:"caps lock",27:"escape",32:"space",33:"page up",34:"page down",35:"end",36:"home",37:"left arrow",38:"up arrow",39:"right arrow",40:"down arrow",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"left window key",92:"right window key",93:"select key",96:"numpad 0",97:"numpad 1",98:"numpad 2",99:"numpad 3",100:"numpad 4",101:"numpad 5",102:"numpad 6",103:"numpad 7",104:"numpad 8",105:"numpad 9",106:"multiply",107:"add",109:"subtract",110:"decimal point",111:"divide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"num lock",145:"scroll lock",186:"semi-colon",187:"equal sign",188:"comma",189:"dash",190:"period",191:"forward slash",192:"grave accent",219:"open bracket",220:"back slash",221:"close braket",222:"single quote"},saveLoaddbDB:{put:function(t,n){var e=indexedDB.open("ejs-states",1);e.onerror=function(){},e.onsuccess=function(){var o=e.result,i=o.transaction(["states"],"readwrite"),a=i.objectStore("states"),s=a.put(n,t);s.onerror=function(){},s.onsuccess=function(){}},e.onupgradeneeded=function(){var t=e.result;t.objectStoreNames.contains("states")||t.createObjectStore("states")}},get:function(e){return new Promise(function(n){var t=indexedDB.open("ejs-states",1);t.onerror=function(){},t.onsuccess=function(){var o=t.result,i=o.transaction(["states"],"readwrite"),a=i.objectStore("states"),s=a.get(e);s.onsuccess=async function(t){var e=t.target.result;e&&n(e)},s.onerror=function(){}},t.onupgradeneeded=function(){var e=t.result;e.objectStoreNames.contains("states")||e.createObjectStore("states")}})}},saveLoadDB:function(a){try{if(l&&typeof l.getCoreOptionsValues=="function"){var n,i,s=l.getCoreOptionsValues()["save-state-location"],o=l.getCoreOptionsValues()["save-state-slot"],t=this.config.gameUrl.split("/").pop();if(this.gameName&&(t=this.gameName),!this.gameName&&this.config.gameUrl.startsWith("blob:")||!window.indexedDB)return!1;if(n=t+"-"+o,!s||s==="download")return!1;if(a==="save")try{i=e.saveState(),e.saveLoaddbDB.put(n,i)}catch(e){return!1}else e.saveLoaddbDB.get(n).then(function(e){EJS_loadState(e)});return!0}return!1}catch(e){return!1}},gamepad:null,allowCheat:!0,connection:null,connected:!1,playerName:'',players:[],waitingList:{},roomMaster:null,inputsData:{},coreOptionData:{},currentFrame:0,wait:!1,progressHelper:{},icons:{lock:'<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="lock" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="svg-inline--fa fa-lock fa-w-14 fa-3x"><path fill="currentColor" d="M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z" class=""></path></svg>'},disableInput:!1,disableControl:function(n){if(n){for(var t=0;t<24;t+=1)e.simulateInputFn(0,t,0),e.simulateInputFn(1,t,0),e.simulateInputFn(2,t,0),e.simulateInputFn(3,t,0);e.disableInput=!0}else e.disableInput=!1},loadRoomsListTimer:null,loadRoomsList:function(){},stopLoadRooms:function(){e.loadRoomsListTimer&&clearTimeout(e.loadRoomsListTimer)},openRoom:function(){},isPaused:null,setVolume:null,setVariable:null,simulateInput:null,simulateInputFn:null,toggleShader:null,saveState:null,screenRecord:null,loadState:null,quickSaveState:null,quickLoadState:null,changeStateSlot:null,getScreenData:null,getStateInfo:null,setCheat:null,resetCheat:null,getGameCoreOptions:null,classNames:{'dialog-container':n({'dialog-container':!0}),tabs:n({tabs:!0}),'dialog-title':n({'dialog-title':!0}),'dialog-content':n({'dialog-content':!0}),'dialog-buttons':n({'dialog-buttons':!0}),overlay:n({overlay:!0}),'key-setting-popup':n({'key-setting-popup':!0}),'tabs-panel':n({'tabs-panel':!0}),'tabs-content':n({'tabs-content':!0}),'button-container':n({'button-container':!0}),set:n({set:!0}),active:n({active:!0}),'btn-cancel':n({'btn-cancel':!0}),'btn-reset':n({'btn-reset':!0}),'btn-clear':n({'btn-clear':!0}),'btn-create':n({'btn-create':!0}),'btn-submit':n({'btn-submit':!0}),'btn-join-room':n({'btn-join-room':!0}),'btn-quit':n({'btn-quit':!0}),'btn-create-room':n({'btn-create-room':!0}),'netplay-player-name':n({'netplay-player-name':!0}),'netplay-roomlist':n({'netplay-roomlist':!0}),'netplay-room-name-input':n({'netplay-room-name-input':!0}),'netplay-room-password-input':n({'netplay-room-password-input':!0}),'netplay-create-room-set':n({'netplay-create-room-set':!0}),'netplay-room':n({'netplay-room':!0}),modal:n({modal:!0}),modal__overlay:n({modal__overlay:!0}),modal__container:n({modal__container:!0}),modal__header:n({modal__header:!0}),modal__title:n({modal__title:!0}),modal__close:n({modal__close:!0}),modal__content:n({modal__content:!0}),modal__btn:n({modal__btn:!0}),'modal__btn-primary':n({'modal__btn-primary':!0}),'micromodal-slide':n({'micromodal-slide':!0}),modal__errmsg:n({modal__errmsg:!0}),modal__footer:n({modal__footer:!0}),'cheats-add':n({'cheats-add':!0}),'cheats-list':n({'cheats-list':!0}),'cheat-code-input':n({'cheat-code-input':!0}),'cheat-name-input':n({'cheat-name-input':!0}),'ejs-switch':n({'ejs-switch':!0}),'ejs-delete-cheat':n({'ejs-delete-cheat':!0})},initShaders:function(){for(var s=eP,t=Object.keys(s),n='',e=0;e<t.length;e+=1)n=s[t[e]],o.FS.writeFile("/shader/".concat(t[e]),n),l.storage.get("shader")===t[e]&&o.FS.writeFile("/shader/shader.glslp",n)},setGamepadDialog:function(){t=this,t.elements.dialogs.gamepad.innerHTML='\n        <div class="'+e.classNames["dialog-container"]+'">\n            <div class="'+e.classNames["dialog-title"]+'">\n                <h4>'+t.localization("Control Settings")+'</h4>\n            </div>\n            \n            <ul class="'+e.classNames.tabs+'" id="controls-tabs">\n                <li class="tabs-title" role="presentation"><a href="#" onclick="return false" role="tab" aria-controls="controls-0" aria-selected="false" id="controls-0-label">'+t.localization("Player 1")+'</a></li>\n                <li class="tabs-title" role="presentation"><a href="#" onclick="return false" role="tab" aria-controls="controls-1" aria-selected="false" id="controls-1-label">'+t.localization("Player 2")+'</a></li>\n                <li class="tabs-title" role="presentation"><a href="#" onclick="return false" role="tab" aria-controls="controls-2" aria-selected="false" id="controls-2-label">'+t.localization("Player 3")+'</a></li>\n                <li class="tabs-title" role="presentation"><a href="#" onclick="return false" role="tab" aria-controls="controls-3" aria-selected="false" id="controls-3-label">'+t.localization("Player 4")+'</a></li>\n            </ul>\n            <div class="'+e.classNames["dialog-content"]+'">\n            <div class="'+e.classNames["tabs-content"]+' controls">\n                \n            </div>\n            </div>\n            <div class="'+e.classNames["dialog-buttons"]+'">\n                <a href="#" onclick="return false" class="'+e.classNames["btn-submit"]+'">'+t.localization("Update")+'</a>\n                <a href="#" onclick="return false" class="'+e.classNames["btn-reset"]+'">'+t.localization("Reset")+'</a>\n                <a href="#" onclick="return false" class="'+e.classNames["btn-clear"]+'">'+t.localization("Clear")+'</a>\n                <a href="#" onclick="return false" class="'+e.classNames["btn-cancel"]+'">'+t.localization("Cancel")+'</a>\n            </div>\n            <div class="'+e.classNames.overlay+'" hidden>\n                <div class="'+e.classNames["key-setting-popup"]+'">\n                    <span>[Select]</span><br />\n                    <div style="color:#fff !important">'+t.localization("Press keyboard or gamepad")+"</div>\n                </div>\n            </div>\n        </div>\n        ",c='\n        <div class="'.concat(e.classNames["tabs-panel"],'" id="controls-{index}" hidden>\n            <div>\n                <div style="">\n                    <div class="gamepad" style="font-size:12px">Connected gamepad: <span class="gamepad-name">n/a</span></div>\n                </div>\n                <div style="width:25%;float:left">&nbsp;</div>\n                <div style="font-size:12px;width:50%;float:left">\n                    <div class="row">\n                        <div style="text-align:center;width:50%;float:left">'+t.localization("Gamepad")+'</div>\n                        <div style="text-align:center;width:50%;float:left">'+t.localization("Keyboard")+'</div>\n                    </div>\n                </div>\n                <div style="clear:both"></div>\n            </div>\n        </div>'),i='\n        <div class="'.concat(e.classNames["button-container"],'" data-id="{id}" data-index="{index}" data-label="{label}" style="margin-bottom:10px">\n            <div style="width:25%;float:left;font-size:12px">\n                <label>{label}:</label>\n            </div>\n            <div style="width:50%;float:left">\n                <div>\n                    <div style="width:50%;float:left;padding: 0 5px;">\n                        <input style="text-align:center;height:25px;width: 100%;" type="text" data-id="{id}" data-value="" data-type="2" data-index="{index}" readonly="" placeholder="">\n                    </div>\n                    <div style="width:50%;float:left;padding: 0 5px;">\n                        <input style="text-align:center;height:25px;width: 100%;" type="text" data-id="{id}" data-value="" data-type="1" data-index="{index}" readonly="" placeholder="">\n                    </div>\n                    <div style="clear:both"></div>\n                </div>\n            </div>\n            <div style="width:25%;float:left">\n                <a class="').concat(e.classNames.set,'" href="#" onclick="return false">'+t.localization("Set")+'</a>\n            </div>\n            <div style="clear:both"></div>\n        </div>'),"nes"===t.system?(n={0:"B",2:"SELECT",3:"START",4:"UP",5:"DOWN",6:"LEFT",7:"RIGHT",8:"A",24:t.localization("QUICK SAVE STATE"),25:t.localization("QUICK LOAD STATE"),26:t.localization("CHANGE STATE SLOT")}):"snes"===t.system?(n={0:"B",1:"Y",2:"SELECT",3:"START",4:"UP",5:"DOWN",6:"LEFT",7:"RIGHT",8:"A",9:"X",10:"L",11:"R",24:t.localization("QUICK SAVE STATE"),25:t.localization("QUICK LOAD STATE"),26:t.localization("CHANGE STATE SLOT")}):"n64"===t.system?(n={0:"B",3:"START",4:"UP",5:"DOWN",6:"LEFT",7:"RIGHT",8:"A",10:"L",11:"R",12:"Z",19:"L STICK UP",18:"L STICK DOWN",17:"L STICK LEFT",16:"L STICK RIGHT",23:"R STICK UP",22:"R STICK DOWN",21:"R STICK LEFT",20:"R STICK RIGHT",24:t.localization("QUICK SAVE STATE"),25:t.localization("QUICK LOAD STATE"),26:t.localization("CHANGE STATE SLOT")}):"nds"===t.system?(n={0:"B",1:"Y",2:"SELECT",3:"START",4:"UP",5:"DOWN",6:"LEFT",7:"RIGHT",8:"A",9:"X",10:"L",11:"R",14:"Microphone",24:t.localization("QUICK SAVE STATE"),25:t.localization("QUICK LOAD STATE"),26:t.localization("CHANGE STATE SLOT")}):(n={0:"B",1:"Y",2:"SELECT",3:"START",4:"UP",5:"DOWN",6:"LEFT",7:"RIGHT",8:"A",9:"X",10:"L",11:"R",12:"L2",13:"R2",14:"L3",15:"R3",19:"L STICK UP",18:"L STICK DOWN",17:"L STICK LEFT",16:"L STICK RIGHT",23:"R STICK UP",22:"R STICK DOWN",21:"R STICK LEFT",20:"R STICK RIGHT",24:t.localization("QUICK SAVE STATE"),25:t.localization("QUICK LOAD STATE"),26:t.localization("CHANGE STATE SLOT")}),["arcade","mame"].includes(t.system)&&(n[2]=t.localization("INSERT COIN")),t.statesSupported===!1&&(delete n[24],delete n[25],delete n[26]);for(var t,n,s,i,c,d=[2,3,4,5,6,7,8,0,9,1,10,11,12,13,14,15,19,18,17,16,23,22,21,20,24,25,26],u=function(s){t.elements.dialogs.gamepad.querySelector(".".concat(e.classNames["tabs-content"])).innerHTML+=c.replace(/{index}/g,s),d.forEach(function(e){n[e]&&(t.elements.dialogs.gamepad.querySelector("#controls-".concat(s)).innerHTML+=i.replace(/{index}/g,s).replace(/{id}/g,e).replace(/{label}/g,n[e]))}),t.elements.dialogs.gamepad.querySelector('[data-id="16"][data-index="'.concat(s,'"][data-type="2"]'))&&(t.elements.dialogs.gamepad.querySelector('[data-id="16"][data-index="'.concat(s,'"][data-type="2"]')).style.backgroundColor="#ccc"),t.elements.dialogs.gamepad.querySelector('[data-id="17"][data-index="'.concat(s,'"][data-type="2"]'))&&(t.elements.dialogs.gamepad.querySelector('[data-id="17"][data-index="'.concat(s,'"][data-type="2"]')).style.backgroundColor="#ccc"),t.elements.dialogs.gamepad.querySelector('[data-id="18"][data-index="'.concat(s,'"][data-type="2"]'))&&(t.elements.dialogs.gamepad.querySelector('[data-id="18"][data-index="'.concat(s,'"][data-type="2"]')).style.backgroundColor="#ccc"),t.elements.dialogs.gamepad.querySelector('[data-id="19"][data-index="'.concat(s,'"][data-type="2"]'))&&(t.elements.dialogs.gamepad.querySelector('[data-id="19"][data-index="'.concat(s,'"][data-type="2"]')).style.backgroundColor="#ccc"),t.elements.dialogs.gamepad.querySelector('[data-id="20"][data-index="'.concat(s,'"][data-type="2"]'))&&(t.elements.dialogs.gamepad.querySelector('[data-id="20"][data-index="'.concat(s,'"][data-type="2"]')).style.backgroundColor="#ccc"),t.elements.dialogs.gamepad.querySelector('[data-id="21"][data-index="'.concat(s,'"][data-type="2"]'))&&(t.elements.dialogs.gamepad.querySelector('[data-id="21"][data-index="'.concat(s,'"][data-type="2"]')).style.backgroundColor="#ccc"),t.elements.dialogs.gamepad.querySelector('[data-id="22"][data-index="'.concat(s,'"][data-type="2"]'))&&(t.elements.dialogs.gamepad.querySelector('[data-id="22"][data-index="'.concat(s,'"][data-type="2"]')).style.backgroundColor="#ccc"),t.elements.dialogs.gamepad.querySelector('[data-id="23"][data-index="'.concat(s,'"][data-type="2"]'))&&(t.elements.dialogs.gamepad.querySelector('[data-id="23"][data-index="'.concat(s,'"][data-type="2"]')).style.backgroundColor="#ccc")},o=0;o<=3;o+=1)u(o);Object.keys(e.controllers).forEach(function(n){e.controllers[n]&&Object.keys(e.controllers[n]).forEach(function(i){var s,a=t.elements.dialogs.gamepad.querySelector('[data-id="'.concat(i,'"][data-index="').concat(n,'"][data-type="1"]')),o=t.elements.dialogs.gamepad.querySelector('[data-id="'.concat(i,'"][data-index="').concat(n,'"][data-type="2"]'));if(!a||!o)return!1;s=e.controllers[n][i],s&&(s.type&&1!==parseInt(s.type,10)?o.value='':s.value&&(a.value=e.keyMap[s.value]||'',a.setAttribute("data-value",s.value)),s.value2&&(o.value=isNaN(s.value2)?s.value2:"button ".concat(parseInt(s.value2,10)+1),o.setAttribute("data-value",s.value2)))})}),r.call(this,t.elements.dialogs.gamepad.querySelector(".".concat(e.classNames["btn-submit"])),"click",function(s){var o=t.elements.dialogs.gamepad.querySelectorAll("input"),n={};return Array.from(o).forEach(function(t){var s,o,e=t.getAttribute("data-index"),i=t.getAttribute("data-value");2===parseInt(t.getAttribute("data-type"),10)&&(o=t.getAttribute("data-value")),s=t.getAttribute("data-id"),n[e]||(n[e]={}),n[e][s]||(n[e][s]={}),i&&(n[e][s].value=i),o&&(n[e][s].value2=o)}),l.storage.set({controllers:n}),e.controllers=n,a(t.elements.dialogs.gamepad,!0),t.elements.container.focus(),s.stopPropagation(),!1}),r.call(this,t.elements.dialogs.gamepad.querySelector(".".concat(e.classNames["btn-reset"])),"click",function(){e.controllers=JSON.parse(JSON.stringify(e.defaultControllers)),localStorage.removeItem(l.storage.key);for(var o,i,a,r,s=t.elements.dialogs.gamepad.querySelectorAll("input"),n=0;n<s.length;n++)o=s[n].getAttribute("data-index"),r=s[n].getAttribute("data-type"),i=s[n].getAttribute("data-id"),a=r==1?"value":"value2",e.defaultControllers[o]&&e.defaultControllers[o][i]&&e.defaultControllers[o][i][a]?(r==1?s[n].value=e.keyMap[e.defaultControllers[o][i][a]]:s[n].value="button "+(parseInt(e.defaultControllers[o][i][a])+1),s[n].setAttribute("data-value",e.defaultControllers[o][i][a])):(s[n].value='',s[n].setAttribute("data-value",''))}),r.call(this,t.elements.dialogs.gamepad.querySelector(".".concat(e.classNames["btn-clear"])),"click",function(){var o,i,a,s={0:{},1:{},2:{},3:{}};for(i in n)s[0][i]={},s[1][i]={},s[2][i]={},s[3][i]={};e.controllers=s,localStorage.setItem(l.storage.key,JSON.stringify({controllers:e.controllers})),a=t.elements.dialogs.gamepad.querySelectorAll("input");for(o=0;o<a.length;o++)a[o].value='',a[o].setAttribute("data-value",'')}),r.call(this,t.elements.dialogs.gamepad.querySelector(".".concat(e.classNames["btn-cancel"])),"click",function(e){return a(t.elements.dialogs.gamepad,!0),t.elements.container.focus(),e.stopPropagation(),!1}),Array.from(t.elements.dialogs.gamepad.querySelectorAll(".".concat(e.classNames.tabs," li"))).forEach(function(n){r.call(t,n,"mousedown",function(s){h(t.elements.dialogs.gamepad.querySelectorAll(".".concat(e.classNames.tabs," li")),e.classNames.active,!1),h(n,e.classNames.active,!0);var o=n.querySelector("a").getAttribute("aria-controls");return Array.from(t.elements.dialogs.gamepad.querySelectorAll(".".concat(e.classNames["tabs-content"]," .").concat(e.classNames["tabs-panel"]))).forEach(function(e){a(e,!0)}),a(t.elements.dialogs.gamepad.querySelector(".".concat(e.classNames["tabs-content"]," #").concat(o)),!1),s.stopPropagation(),!1})}),p.call(t,t.elements.dialogs.gamepad.querySelector('[aria-controls="controls-0"]').parentNode,"mousedown"),s=t.elements.dialogs.gamepad.querySelector(".".concat(e.classNames.overlay)),r.call(t,s,"mousedown",function(e){a(s,!0),e.stopPropagation()}),Array.from(t.elements.dialogs.gamepad.querySelectorAll(".".concat(e.classNames["button-container"]))).forEach(function(n){r.call(t,n,"mousedown",function(s){p.call(t,n.querySelector("a.".concat(e.classNames.set)),s.type,!0,{})})}),Array.from(t.elements.dialogs.gamepad.querySelectorAll(".".concat(e.classNames["tabs-panel"]," a.").concat(e.classNames.set))).forEach(function(n){r.call(t,n,"mousedown",function(l){var o,i=n.parentNode.parentNode,c=i.getAttribute("data-id"),r=i.getAttribute("data-index"),d=i.getAttribute("data-label");a(s,!1),s.setAttribute("data-id",c),s.setAttribute("data-index",r),o="[ ".concat(d," ]"),e.gamepad.gamepads[r]&&c<16?o+='<br /><span style="font-size:12px">Gamepad:'.concat(e.gamepad.gamepads[r].id,"</span><br />"+t.localization("Press keyboard or gamepad")+"<br/>"+t.localization("Press escape (esc) to clear")):o+="<br />Press keyboard<br/>"+t.localization("Press escape (esc) to clear"),s.querySelector(".".concat(e.classNames["key-setting-popup"])).innerHTML=o,l.stopPropagation()})})},setCacheDialog:function(){var t=this;t.elements.dialogs.cache.innerHTML='\n        <div class="'.concat(e.classNames["dialog-container"],'">\n            <div class="').concat(e.classNames["dialog-title"],'">\n                <h4>'+t.localization("Cache Manager")+'</h4>\n            </div>\n            <div class="').concat(e.classNames["dialog-content"],'">\n\n            </div>\n            <div class="').concat(e.classNames["dialog-buttons"],'">\n                <a href="#" onclick="return false" class="').concat(e.classNames["btn-cancel"],'">'+t.localization("Close")+"</a>\n            </div>\n        </div>\n        "),r.call(this,t.elements.dialogs.cache.querySelector(".".concat(e.classNames["btn-cancel"])),"click",function(e){return a(t.elements.dialogs.cache,!0),t.elements.container.focus(),e.stopPropagation(),!1}),r.call(this,t.elements.dialogs.cache.querySelector(".".concat(e.classNames["dialog-title"]," a")),"click",function(n){return o.romdb&&(o.romdb.clear(),t.elements.dialogs.cache.querySelector(".".concat(e.classNames["dialog-content"])).innerHTML='<div style="text-align:center">'+t.localization("Empty")+"</div>"),n.stopPropagation(),!1})},showLoading:function(e){O.show("modal-6ed698f3d04061f5",{closeByEsckey:!1}),e&&console.log(''),a(this.elements.dialogs.loading,!1)},hideLoading:function(){O.close(),a(this.elements.dialogs.loading,!0)},setLoadingDialog:function(){this.elements.dialogs.loading&&(this.elements.dialogs.loading.innerHTML='\n            <div class="'.concat(e.classNames.modal," ").concat(e.classNames["micromodal-slide"],'" id="modal-6ed698f3d04061f5" aria-hidden="true">\n                <div class="').concat(e.classNames.modal__overlay,'" tabindex="-1">\n                <div class="').concat(e.classNames.modal__container,'" role="dialog" aria-modal="true" aria-labelledby="modal-6ed698f3d04061f5-title">\n                '+this.localization("Loading")+"...\n                </div>\n                </div>\n            </div>"))},setCheatDialog:function(){var n,o,i,t=this;t.elements.dialogs.cheat&&(t.elements.dialogs.cheat.innerHTML='\n            <div class="'.concat(e.classNames["dialog-container"],'">\n                <div class="').concat(e.classNames["dialog-title"],'">\n                    <h4>Cheats</h4>\n                </div>\n                <div class="').concat(e.classNames["dialog-content"],'">\n                    <div class="').concat(e.classNames["cheats-list"],'">\n                        \n                    </div>\n                </div>\n                <div class="').concat(e.classNames["dialog-buttons"],'">\n                    <a href="#" onclick="return false" class="').concat(e.classNames["cheats-add"],'">'+t.localization("Add Cheat")+'</a>\n                    <a href="#" onclick="return false" class="').concat(e.classNames["btn-submit"],'">'+t.localization("OK")+'</a>\n                    <a href="#" onclick="return false" class="').concat(e.classNames["btn-cancel"],'">Close</a>\n                </div>\n            </div>\n\n            \n\n            <div class="').concat(e.classNames.modal," ").concat(e.classNames["micromodal-slide"],'" id="modal-85cd7a1c543a484b" aria-hidden="true">\n                <div class="').concat(e.classNames.modal__overlay,'" tabindex="-1" data-modal-close>\n                <div class="').concat(e.classNames.modal__container,'" style="width:100%" role="dialog" aria-modal="true" aria-labelledby="modal-85cd7a1c543a484b-title">\n                    <div class="').concat(e.classNames.modal__header,'">\n                    <h2 class="').concat(e.classNames.modal__title,'" id="modal-85cd7a1c543a484b-title">\n                    '+t.localization("Add Cheat Code")+'\n                    </h2>\n                    <button class="').concat(e.classNames.modal__close,'" aria-label="Close modal" data-modal-close></button>\n                    </div>\n                    <main class="').concat(e.classNames.modal__content,'" id="modal-85cd7a1c543a484b-content">\n\n                        <div class="').concat(e.classNames.modal__errmsg,'"></div>\n                        <strong>'+t.localization("Code")+'</strong><br />\n                        <textarea style="width:100%;height:80px;" class="').concat(e.classNames["cheat-code-input"],'"></textarea><br />\n                        <strong>'+t.localization("Description")+'</strong><br />\n                        <input type="text" class="').concat(e.classNames["cheat-name-input"],'" /><br />\n\n                    </main>\n                    <footer class="').concat(e.classNames.modal__footer,'">\n                    <button class="').concat(e.classNames.modal__btn," ").concat(e.classNames["modal__btn-primary"],'">'+t.localization("Submit")+'</button>\n                    <button class="').concat(e.classNames.modal__btn,'" data-modal-close aria-label="Close">'+t.localization("Close")+"</button>\n                    </footer>\n                </div>\n                </div>\n            </div>\n            "),o=t.elements.dialogs.cheat.querySelector("#modal-85cd7a1c543a484b"),r.call(this,t.elements.dialogs.cheat.querySelector(".".concat(e.classNames["cheats-add"])),"click",function(){return O.show("modal-85cd7a1c543a484b",{closeTrigger:"data-modal-close"}),!1}),n=t.elements.dialogs.cheat.querySelector(".".concat(e.classNames["cheats-list"])),r.call(this,o.querySelector(".".concat(e.classNames["modal__btn-primary"])),"click",function(c){var s,r,i=o.querySelector(".".concat(e.classNames["cheat-name-input"])).value,a=o.querySelector(".".concat(e.classNames["cheat-code-input"])).value;return i&&a&&(r=n.querySelectorAll("input:checked"),o.querySelector(".".concat(e.classNames["cheat-name-input"])).value='',o.querySelector(".".concat(e.classNames["cheat-code-input"])).value='',O.close(),s=t.cheats.length,t.cheats.push([i,a]),n.innerHTML+='<div class="'.concat(e.classNames["ejs-switch"],'">\n                            <input type="checkbox" value="').concat(s,'" id="ejs-cheat-switch-').concat(s,'">\n                            <label for="ejs-cheat-switch-').concat(s,'">').concat(i,'</label>\n                            <a href="#" data-idx="').concat(s,'" onclick="return false" class="').concat(e.classNames["ejs-delete-cheat"],'">&times;</a>\n                        </div>'),r.forEach(function(t,e){n.querySelector("#ejs-cheat-switch-".concat(e)).setAttribute("checked","checked")})),"localStorage"in window&&localStorage.setItem(''.concat(t.system,"-").concat(t.startName,"-cheats"),JSON.stringify(t.cheats)),c.stopPropagation(),!1}),i=function(){if("localStorage"in window){var s=localStorage.getItem(''.concat(t.system,"-").concat(t.startName,"-cheats"));try{s=JSON.parse(s)}catch(e){}s&&(t.cheats=s)}n.innerHTML='',t.cheats&&Array.isArray(t.cheats)&&t.cheats.forEach(function(s,t){var o=s[0];s[1],n.innerHTML+='<div class="'.concat(e.classNames["ejs-switch"],'">\n                                <input type="checkbox" value="').concat(t,'" id="ejs-cheat-switch-').concat(t,'">\n                                <label for="ejs-cheat-switch-').concat(t,'">').concat(o,'</label>\n                                <a href="#" data-idx="').concat(t,'" onclick="return false" class="').concat(e.classNames["ejs-delete-cheat"],'">&times;</a>\n                            </div>')})},r.call(t,n,"click",function(s){if(s.target&&s.target.classList.contains(e.classNames["ejs-delete-cheat"])&&s.target.getAttribute("data-idx")){var o,a=s.target.getAttribute("data-idx");t.cheats.splice(a,1),"localStorage"in window&&localStorage.setItem(''.concat(t.system,"-").concat(t.startName,"-cheats"),JSON.stringify(t.cheats)),o=[],n.querySelectorAll("input").forEach(function(t,e){o[e]=!!n.querySelector("#ejs-cheat-switch-".concat(e,":checked"))}),o.splice(a,1),i(),o.forEach(function(e,t){e&&n.querySelector("#ejs-cheat-switch-".concat(t)).setAttribute("checked","checked")})}return s.stopPropagation(),!1}),r.call(t,t.elements.container,"start-game",function(){i()}),r.call(this,t.elements.dialogs.cheat.querySelector(".".concat(e.classNames["btn-cancel"])),"click",function(e){return a(t.elements.dialogs.cheat,!0),e.stopPropagation(),t.elements.container.focus(),!1}),r.call(this,t.elements.dialogs.cheat.querySelector(".".concat(e.classNames["btn-submit"])),"click",function(){return e.resetCheat(),n.querySelectorAll("input:checked").forEach(function(s,o){var n=t.cheats[s.value];n&&e.setCheat(o,1,n[1])}),a(t.elements.dialogs.cheat,!0),t.elements.container.focus(),!1}),"arcade"!==t.system&&"mame"!==t.system&&"mame2003"!==t.system&&"mame2010"!==t.system||(s.element(t.elements.buttons.cheat)&&a(t.elements.buttons.cheat,!0),e.allowCheat=!1),e.setCheat||(a(t.elements.buttons.cheat,!0),e.allowCheat=!1))},setNetplayDialog:function(){if(p=this,t=this,t.elements.dialogs.netplay){t.elements.dialogs.netplay.innerHTML='\n            <div class="'.concat(e.classNames["dialog-container"],'">\n                <div class="').concat(e.classNames["dialog-title"],'">\n                    <h4>'+t.localization("Netplay")+'</h4>\n                </div>\n                <div class="').concat(e.classNames["dialog-content"],'">\n                    <div class="').concat(e.classNames["netplay-roomlist"],'" hidden>\n                        <strong>'+t.localization("Rooms")+'</strong>\n                        <table style="width:100%" cellspacing=0>\n                            <thead>\n                                <tr>\n                                    <td>'+t.localization("Room Name")+"</td>\n                                    <td>"+t.localization("Players")+'</td>\n                                    <td></td>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                <tr>\n                                    <td></td>\n                                    <td></td>\n                                    <td></td>\n                                </tr>\n                            </tbody>\n                        </table>\n                    </div>\n\n                    <div class="').concat(e.classNames["netplay-room"],'" hidden>\n                        <strong>'+t.localization("Room Name")+"</strong>\n                        <div data-room-password>"+t.localization("Password")+': <span></span></div>\n                        <table style="width:100%" cellspacing="0">\n                            <thead>\n                            <tr>\n                                <td>'+t.localization("Player")+"</td>\n                                <td>"+t.localization("Name")+"</td>\n                                <td></td>\n                            </tr>\n                            </thead>\n                            <tbody>\n                            <tr>\n                                <td>1</td>\n                                <td>"+t.localization("Name")+" 1</td>\n                                <td></td>\n                            </tr>\n                            <tr>\n                                <td>2</td>\n                                <td>"+t.localization("Name")+" 2</td>\n                                <td></td>\n                            </tr>\n                            <tr>\n                                <td>3</td>\n                                <td>"+t.localization("Name")+" 3</td>\n                                <td></td>\n                            </tr>\n                            <tr>\n                                <td>4</td>\n                                <td>"+t.localization("Name")+' 4</td>\n                                <td></td>\n                            </tr>\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n                <div class="').concat(e.classNames["dialog-buttons"],'">\n                    <a href="#" onclick="return false" class="').concat(e.classNames["btn-quit"],'">'+t.localization("Quit Room")+'</a>\n                    <a href="#" onclick="return false" class="').concat(e.classNames["btn-create-room"],'">'+t.localization("Create a Room")+'</a>\n                    <a href="#" onclick="return false" class="').concat(e.classNames["btn-cancel"],'">'+t.localization("Close")+'</a>\n                </div>\n            </div>\n\n            \n            <div class="').concat(e.classNames.modal," ").concat(e.classNames["micromodal-slide"],'" id="modal-9de6c4e9ce2b9361" aria-hidden="true">\n                <div class="').concat(e.classNames.modal__overlay,'" tabindex="-1">\n                <div class="').concat(e.classNames.modal__container,'" role="dialog" aria-modal="true" aria-labelledby="modal-9de6c4e9ce2b9361-title">\n                    <div class="').concat(e.classNames.modal__header,'">\n                    <h2 class="').concat(e.classNames.modal__title,'" id="modal-9de6c4e9ce2b9361-title">\n                        '+t.localization("Set Player Name")+'\n                    </h2>\n                    </div>\n                    <main class="').concat(e.classNames.modal__content,'" id="modal-9de6c4e9ce2b9361-content">\n\n                        <div class="').concat(e.classNames.modal__errmsg,'"></div>\n                        <strong>'+t.localization("Player Name")+'</strong><br />\n                        <input type="text" maxlength="10" class="').concat(e.classNames["netplay-player-name"],'" /><br />\n\n                    </main>\n                    <footer class="').concat(e.classNames.modal__footer,'">\n                    <button class="').concat(e.classNames.modal__btn," ").concat(e.classNames["modal__btn-primary"],'">'+t.localization("Submit")+'</button>\n                    </footer>\n                </div>\n                </div>\n            </div>\n            \n            <div class="').concat(e.classNames.modal," ").concat(e.classNames["micromodal-slide"],'" id="modal-85cd7a1c543a484a" aria-hidden="true">\n                <div class="').concat(e.classNames.modal__overlay,'" tabindex="-1" data-modal-close>\n                <div class="').concat(e.classNames.modal__container,'" role="dialog" aria-modal="true" aria-labelledby="modal-85cd7a1c543a484a-title">\n                    <div class="').concat(e.classNames.modal__header,'">\n                    <h2 class="').concat(e.classNames.modal__title,'" id="modal-85cd7a1c543a484a-title">\n                    '+t.localization("Create a Room")+'\n                    </h2>\n                    <button class="').concat(e.classNames.modal__close,'" aria-label="Close modal" data-modal-close></button>\n                    </div>\n                    <main class="').concat(e.classNames.modal__content,'" id="modal-85cd7a1c543a484a-content">\n\n                        <div class="').concat(e.classNames.modal__errmsg,'"></div>\n                        <strong>'+t.localization("Room Name")+'</strong><br />\n                        <input type="text" maxlength="10" class="').concat(e.classNames["netplay-room-name-input"],'" /><br />\n                        <strong>Max Players</strong><br />\n                        <select data-max-players>\n                            <option value="2">2</option>\n                            <option value="3">3</option>\n                            <option value="4">4</option>\n                        </select>\n                        <br />\n                        <strong>'+t.localization("Password (optional)")+'</strong><br />\n                        <input type="text" maxlength="10" class="').concat(e.classNames["netplay-room-password-input"],'" /><br />\n\n                    </main>\n                    <footer class="').concat(e.classNames.modal__footer,'">\n                    <button class="').concat(e.classNames.modal__btn," ").concat(e.classNames["modal__btn-primary"],'">'+t.localization("Submit")+'</button>\n                    <button class="').concat(e.classNames.modal__btn,'" data-modal-close aria-label="Close">'+t.localization("Close")+'</button>\n                    </footer>\n                </div>\n                </div>\n            </div>\n            \n            <div class="').concat(e.classNames.modal," ").concat(e.classNames["micromodal-slide"],'" id="modal-5aa765d61d8327de" aria-hidden="true">\n                <div class="').concat(e.classNames.modal__overlay,'" tabindex="-1" data-modal-close>\n                <div class="').concat(e.classNames.modal__container,'" role="dialog" aria-modal="true" aria-labelledby="modal-5aa765d61d8327de-title">\n                    <div class="').concat(e.classNames.modal__header,'">\n                    <h2 class="').concat(e.classNames.modal__title,'" id="modal-5aa765d61d8327de-title">\n                        '+t.localization("Password")+'\n                    </h2>\n                    <button class="').concat(e.classNames.modal__close,'" aria-label="Close modal" data-modal-close></button>\n                    </div>\n                    <main class="').concat(e.classNames.modal__content,'" id="modal-5aa765d61d8327de-content">\n\n                        <div class="').concat(e.classNames.modal__errmsg,'"></div>\n                        <input type="text" maxlength="10" class="').concat(e.classNames["netplay-room-password-input"],'" /><br />\n\n                    </main>\n                    <footer class="').concat(e.classNames.modal__footer,'">\n                    <button class="').concat(e.classNames.modal__btn," ").concat(e.classNames["modal__btn-primary"],'">'+t.localization("Submit")+'</button>\n                    <button class="').concat(e.classNames.modal__btn,'" data-modal-close aria-label="Close">'+t.localization("Close")+'</button>\n                    </footer>\n                </div>\n                </div>\n            </div>\n            \n            \n            <div class="').concat(e.classNames.modal," ").concat(e.classNames["micromodal-slide"],'" id="modal-7d8fd50ed642340b" aria-hidden="true">\n                <div class="').concat(e.classNames.modal__overlay,'" tabindex="-1" data-modal-close>\n                <div class="').concat(e.classNames.modal__container,'" role="dialog" aria-modal="true" aria-labelledby="modal-7d8fd50ed642340b-title">\n                    <div class="').concat(e.classNames.modal__header,'">\n                    <h2 class="').concat(e.classNames.modal__title,'" id="modal-7d8fd50ed642340b-title"></h2>\n                    <button class="').concat(e.classNames.modal__close,'" aria-label="Close modal" data-modal-close></button>\n                    </div>\n                    <main class="').concat(e.classNames.modal__content,'" id="modal-7d8fd50ed642340b-content">\n                        \n                    </main>\n                    <footer class="').concat(e.classNames.modal__footer,'">\n                    <button class="').concat(e.classNames.modal__btn," ").concat(e.classNames["modal__btn-primary"],'" data-modal-close>OK</button>\n                    </footer>\n                </div>\n                </div>\n            </div>\n            \n            '),r.call(this,t.elements.dialogs.netplay.querySelector(".".concat(e.classNames["btn-cancel"])),"click",function(n){return a(t.elements.dialogs.netplay,!0),e.disableControl(!1),e.stopLoadRooms(),n.stopPropagation(),t.elements.container.focus(),!1}),window.setInterval(function(){var n="<ul>";e.players.forEach(function(t,o){var s=null;t?(e.connection.peers[t]?s=e.connection.peers[t].extra:e.connection.userid===t&&(s=e.connection.extra),n+="<li>".concat(o+1,". ").concat(s.name,"</li>")):n+="<li>".concat(o+1,". </li>")}),n+="</ul>",t.elements.widgets.netplay.innerHTML=n},500);var t,s,d,u,h,m,p,g,j,y,x,v=t.elements.dialogs.netplay.querySelector("#modal-9de6c4e9ce2b9361"),i=t.elements.dialogs.netplay.querySelector("#modal-85cd7a1c543a484a"),w=t.elements.dialogs.netplay.querySelector("#modal-7d8fd50ed642340b"),c=t.elements.dialogs.netplay.querySelector("#modal-5aa765d61d8327de"),f={};e.connection=new eT.a,m=p.socketUrl,m.endsWith("/")||(m+="/"),e.connection.socketURL="/",e.connection.socketURL=m,e.connection.socketMessageEvent="emulatorjs-message",e.connection.socketCustomEvent="emulatorjs-custom-message",y=b.info(),e.connection.extra={name:e.playerName,game_id:t.config.gameId,browser_name:y.name,room_name:" ",domain:document.domain},e.connection.socketMessageEvent="netplay",e.connection.enableFileSharing=!0,e.connection.enableLogs=!1,e.connection.session={data:!0},e.connection.sdpConstraints.mandatory={OfferToReceiveAudio:!1,OfferToReceiveVideo:!1},e.connection.onclose=function(){},e.connection.iceServers=[{urls:"turn:turn.emulatorjs.com:3478",credential:"dSnmrtehverella",username:"ejs"},{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun.l.google.com:19302?transport=udp"]}],e.connection.maxParticipantsAllowed=4,e.netPlayInitFrame=0,d=0,u=!1,Module.postMainLoop=function(){if(e.currentFrame=parseInt(e.currentFrameNum(),10),e.connected)if(d+=1,e.connection.isInitiator)d>=1&&function(){for(var n=[],t=e.currentFrame-1;t<e.currentFrame;t+=1)e.inputsData[t]?e.inputsData[t].forEach(function(e){n.push(''.concat(e.index,"|").concat(e.key,"|").concat(e.status,"|").concat(e.frame))}):n.push("-1|||".concat(t));e.connection.send(JSON.stringify({act:"sync-control",value:n})),d=0,e.currentFrame%100==0&&Object.keys(e.inputsData).forEach(function(t){t<e.currentFrame-50&&(e.inputsData[t]=null,delete e.inputsData[t])})}();else{if(e.coreOptionData[e.currentFrame]){var n,s,i,a,r=e.coreOptionData[e.currentFrame].key,c=e.coreOptionData[e.currentFrame].value;l.updateCoreOptions.call(t,r,c),delete e.coreOptionData[e.currentFrame]}if(e.currentFrame<=0||e.inputsData[e.currentFrame])e.wait=!1,e.systemPause(0),o.Module.resumeMainLoop(),n=e.inputsData[e.currentFrame],e.inputsData[e.currentFrame]=null,delete e.inputsData[e.currentFrame],n||(n=[]),n.forEach(function(t){t.index>=0&&e.simulateInputFn(t.index,t.key,t.status)});else{e.wait=!0,e.systemPause(1),o.Module.pauseMainLoop(),s=!1,i=Object.keys(e.inputsData),0==i.length&&(s=!0);for(a=0;a<i.length;a+=1)if(i[a]>e.currentFrame){console.log("lost",e.currentFrame),s=!0;break}s?e.wait||(!u||u<(new Date).valueOf()-3e3)&&(e.inputsData={},u=(new Date).valueOf(),e.connection.send(JSON.stringify({act:"sync-mem",value:e.connection.userid}),e.roomMaster)):(e.wait=!0,e.systemPause(1),o.Module.pauseMainLoop())}e.currentFrame%100==0&&Object.keys(e.inputsData).forEach(function(t){t<e.currentFrame-50&&(e.inputsData[t]=null,delete e.inputsData[t])})}},e.connection.onopen=function(n){e.connected=!0,e.connection.isInitiator&&(-1===e.players.indexOf(n.userid)&&(e.players.filter(function(e){return null==e}).length>0?e.players.forEach(function(t,s){null!=t||e.players.includes(n.userid)||(e.players[s]=n.userid)}):e.players.push(n.userid)),e.connection.send(JSON.stringify({act:"get-players-result",value:e.players,coreOptions:l.coreOptionsValues,newuser:n.userid,master:e.connection.userid}))),l.updateCoreOptionMenuItems.call(t)},e.connection.onFileStart=function(n){var s=n.name.split("-");"reset"!==s[0]&&0!=s[0]||(e.inputsData={},e.disableControl(!0)),e.progressHelper[n.remoteUserId]={},e.progressHelper[n.remoteUserId].max=n.maxChunks,e.showLoading.call(t),e.connection.isInitiator?(e.wait=!0,e.systemPause(1),o.Module.pauseMainLoop()):e.inputsData={}},e.connection.onFileProgress=function(t){var n=e.progressHelper[t.remoteUserId];n.current=t.currentPosition||t.maxChunks||n.max},e.connection.onFileEnd=function(n){e.hideLoading.call(t);var i=n.name.split("-"),s=i[0]>>0;"reset"===i[0]?(s=0,e.connection.isInitiator?(e.systemPause(0),e.disableControl(!1),t.playing=!0,o.Module.resumeMainLoop()):_.a.get(n.url,{responseType:"arraybuffer"}).then(function(n){e.inputsData={};var i=new Uint8Array(n.data);e.loadState(i,s),e.wait=!1,e.systemPause(0),e.disableInput=!1,t.playing=!0,o.Module.resumeMainLoop()})):"game.state"===i[1]&&(e.connection.isInitiator?(e.openRoom(t),e.wait=!1,e.systemPause(0),o.Module.resumeMainLoop()):(e.netPlayInitFrame=s,_.a.get(n.url,{responseType:"arraybuffer"}).then(function(n){var i=new Uint8Array(n.data);e.loadState(i,s),e.wait=!1,e.disableInput=!1,e.connection.send(JSON.stringify({act:"wait-end",value:e.connection.userid})),e.hideLoading.call(t),t.playing=!0,o.Module.resumeMainLoop()}))),e.connection.isInitiator||console.log("recv mem end",e.currentFrame,n.name)},s=!1,e.connection.onmessage=function(d){g=d.data||d;try{n=JSON.parse(g)}catch(e){n=null}if(n){if(("room-master"===n.act&&(e.roomMaster=n.value),n.act,"short-pause"===n.act&&(s||(e.systemPause(1),o.Module.pauseMainLoop(),s=!0,e.wait=!0,setTimeout(function(){e.systemPause(0),o.Module.resumeMainLoop(),e.wait=!1,s=!1},48))),"sync-control"===n.act)&&(m=n.value,t.playing||e.wait,c=e.connection.userid,e.players.indexOf(c),e.connection.isInitiator,m.forEach(function(d){var r=d.split("|"),i=r[0]>>0,a=r[1]>>0,l=r[2]>>0,t=r[3]>>0,n=e.currentFrame;e.inputsData[t]||(e.inputsData[t]=[]),-1!==i&&t===n&&e.simulateInputFn(i,a,l),e.connection.isInitiator?i>=0&&(e.inputsData[n]||(e.inputsData[n]=[]),-2!=a&&(e.inputsData[n].push({index:i,key:a,status:l,frame:n}),e.simulateInputFn(i,a,l)),s||n-10>=t&&(e.systemPause(1),o.Module.pauseMainLoop(),s=!0,e.wait=!0,setTimeout(function(){e.systemPause(0),o.Module.resumeMainLoop(),e.wait=!1,s=!1},48))):(''!==i&&e.inputsData[t].push({index:i,key:a,status:l,frame:t}),e.inputsData[e.currentFrame]&&o.Module.resumeMainLoop(),n+10<=t&&t>e.netPlayInitFrame+100&&e.connection.send(JSON.stringify({act:"short-pause",value:c}),e.roomMaster))})),n.act,n.act,"update-core-option"===n.act&&(e.connection.isInitiator||(e.coreOptionData[n.frame]={key:n.key,value:n.value})),"restart-game"===n.act&&(e.inputsData={},e.connection.send(JSON.stringify({act:"sync-mem",value:e.connection.userid}),e.roomMaster)),"pause"===n.act&&o.Module.pauseMainLoop(),"resume"===n.act&&o.Module.resumeMainLoop(),"wait"===n.act&&(e.wait=!0,e.systemPause(1),n.value!==e.connection.userid&&(e.waitingList[n.value]=1),e.disableControl(!0)),"wait-end"===n.act&&(e.waitingList[n.value]&&delete e.waitingList[n.value],0===Object.keys(e.waitingList).length&&(e.wait=!1,e.systemPause(0),e.disableInput=!1)),"sync-mem"===n.act){e.wait=!0,e.systemPause(1),a=n.value,e.disableControl(!0),e.connection.send(JSON.stringify({act:"wait",value:a}));for(var n,a,c,m,p,g,v,u=e.getStateInfo().split("|"),h=u[0]>>0,r=new Uint8Array(h),b=u[1]>>0,i=0;i<h;i+=1)r[i]=o.Module.getValue(b+i);o._FS.createDataFile("/","game.state",r,!0,!0),o.Module.cwrap("load_state","number",["string","number"])("game.state",0),o.FS.unlink("game.state"),e.inputsData={},p=new File([r],''.concat(0,"-game.state"),{type:'',lastModified:new Date}),e.connection.shareFile(p,a)}n.act,"get-players-result"===n.act&&(e.players=n.value,e.roomMaster=n.master,n.newuser===e.connection.userid)&&(v=l.coreOptionsValues,n.coreOptions&&Object.keys(n.coreOptions).forEach(function(e){v[e]!==n.coreOptions[e]&&l.updateCoreOptions.call(t,e,n.coreOptions[e])}),e.showLoading.call(t),e.disableControl(!0),setTimeout(function(){e.connection.send(JSON.stringify({act:"sync-mem",value:e.connection.userid}),e.roomMaster)},1),e.roomMaster&&e.connection.peers[e.roomMaster]&&(e.connection.extra.room_name=e.connection.peers[e.roomMaster].extra.room_name,e.connection.updateExtraData()),e.connection.peers[e.roomMaster]&&(f=e.connection.peers[e.roomMaster].extra),e.openRoom(t))}},e.connection.onUserStatusChanged=function(t){if("offline"===t.status){var n=e.players.indexOf(t.userid);n>=0&&(e.players[n]=null)}t.status},e.connection.onExtraDataUpdated=function(t){t.userid===e.connection.userid&&(e.connection.extra=t.extra)},e.connection.onleave=function(n){if(n.userid){var s=e.players.indexOf(n.userid);s>=0&&(e.players[s]=null)}e.waitingList[n.userid]&&delete e.waitingList[n.userid],e.connection.isInitiator&&0===Object.keys(e.waitingList).length&&e.wait&&(e.wait=!1,e.systemPause(0),e.disableInput=!1,e.connection.send(JSON.stringify({act:"wait-end",value:e.connection.userid}))),e.openRoom(t),e.inputsData={},e.hideLoading.call(t)},h=function(){try{e.connection.onbeforeunload()}catch(e){}e.connected=!1,e.connection.password=null,e.players=[],e.connection.peersBackup=[],e.waitingList={},e.inputsData={},e.hideLoading.call(t),a(t.elements.buttons.restart,!1),a(t.elements.buttons.loadState,!1),a(t.elements.buttons.saveState,!1),e.allowCheat&&a(t.elements.buttons.cheat,!1),a(l.contextMenu.querySelectorAll("ul li").item(2),!1),a(l.contextMenu.querySelectorAll("ul li").item(3),!1),Array.from(t.elements.buttons.play).forEach(function(e){a(e,!1)}),l.updateCoreOptionMenuItems.call(t)},e.connection.close=h,e.connection.disconnect=h,e.connection.leave=h,g=function(n,i,s){e.hideLoading.call(t),n?(e.stopLoadRooms(),a(t.elements.buttons.restart,!0),a(t.elements.buttons.loadState,!0),a(t.elements.buttons.saveState,!0),e.resetCheat(),a(t.elements.buttons.cheat,!0),a(l.contextMenu.querySelectorAll("ul li").item(2),!0),a(l.contextMenu.querySelectorAll("ul li").item(3),!0),Array.from(t.elements.buttons.play).forEach(function(e){a(e,!0)}),e.connection.socket&&e.connection.socket.on("set-isInitiator-true",function(n){n===e.connection.sessionid&&(e.connection.socket.emit("extra-data-updated",e.connection.extra),e.connection.send(JSON.stringify({act:"room-master",value:e.connection.userid})),e.roomMaster=e.connection.userid,e.systemPause(0),o.Module.resumeMainLoop(),l.updateCoreOptionMenuItems.call(t),a(t.elements.buttons.restart,!1),a(t.elements.buttons.loadState,!1),a(t.elements.buttons.saveState,!1),Array.from(t.elements.buttons.play).forEach(function(e){a(e,!1)}))})):(O.close(),w.querySelector("#modal-7d8fd50ed642340b-content").innerHTML=s,O.show("modal-7d8fd50ed642340b",{closeTrigger:"data-modal-close"}))},x=function(n){var s=n.target.getAttribute("data-id");if("Y"===n.target.getAttribute("data-password"))O.show("modal-5aa765d61d8327de",{closeTrigger:"data-modal-close"}),c.setAttribute("data-id",s);else{e.showLoading.call(t),e.connection.userid=e.connection.token();try{e.connection.join(s,g)}catch(n){e.hideLoading.call(t),w.querySelector("#modal-7d8fd50ed642340b-content").innerHTML="Error",O.show("modal-7d8fd50ed642340b",{closeTrigger:"data-modal-close"})}}return n.stopPropagation(),!1},e.loadRoomsList=function(){a(t.elements.dialogs.netplay.querySelector(".".concat(e.classNames["netplay-roomlist"])),!1),a(t.elements.dialogs.netplay.querySelector(".".concat(e.classNames["netplay-room"])),!0),a(t.elements.dialogs.netplay.querySelector(".".concat(e.classNames["btn-create-room"])),!1),a(t.elements.dialogs.netplay.querySelector(".".concat(e.classNames["btn-quit"])),!0),s=t.listUrl,s.endsWith("/")||(s+="/");var s,n=t.elements.dialogs.netplay.querySelector(".".concat(e.classNames["netplay-roomlist"])).querySelector("tbody"),o=[s,"list?game_id=",t.config.gameId,"&domain=",document.domain].join('');_.a.get(o,{}).then(function(t){if(t.data){var s=[],o=[];n.querySelectorAll("tr").forEach(function(e){o.push(e.getAttribute("id"))}),Object.keys(t.data).forEach(function(a){i=t.data[a],(s.push(a),o.includes(a))&&(l=n.querySelector('tr[id="'.concat(a,'"]')),n.removeChild(l)),c=document.createElement("tr"),c.setAttribute("id",a);var i,c,l,d=i.password?e.icons.lock:'',u=i.password?"Y":"N",h=i.current<i.max?'<span data-id="'.concat(a,'" data-password="').concat(u,'" class="').concat(e.classNames["btn-join-room"],'">Join</span>'):'',m=i.country?i.country:"?";c.innerHTML="<td>[".concat(m,"] ").concat(d," ").concat(i.room_name,"</td><td>").concat(i.current,"/").concat(i.max,"</td><td>").concat(h,"</td>"),r.call(p,c.querySelector(".".concat(e.classNames["btn-join-room"])),"click",x),n.appendChild(c)}),n.querySelectorAll("tr").forEach(function(e){s.includes(e.id)||n.removeChild(e)})}e.loadRoomsListTimer=setTimeout(e.loadRoomsList,2e3)}).catch(function(t){console.log("Network Error",t),e.loadRoomsListTimer=setTimeout(e.loadRoomsList,2e3)})},e.openRoom=function(t){e.stopLoadRooms(),a(t.elements.dialogs.netplay.querySelector(".".concat(e.classNames["netplay-roomlist"])),!0),a(t.elements.dialogs.netplay.querySelector(".".concat(e.classNames["netplay-room"])),!1),a(t.elements.dialogs.netplay.querySelector(".".concat(e.classNames["btn-create-room"])),!0),a(t.elements.dialogs.netplay.querySelector(".".concat(e.classNames["btn-quit"])),!1),e.resetCheat(),a(t.elements.buttons.cheat,!0);var o,n=t.elements.dialogs.netplay.querySelector(".".concat(e.classNames["netplay-room"])),s=n.querySelector("[data-room-password]");null===e.connection.password?a(s,!0):(a(s,!1),s.querySelector("span").innerText=e.connection.password),o=n.querySelector("tbody"),o.innerHTML='',n.querySelector("strong").innerText=f.room_name,e.players.forEach(function(n,i){var s,t=null;n&&(e.connection.peers[n]?t=e.connection.peers[n].extra:e.connection.userid===n&&(t=e.connection.extra),t&&t.name)&&(s=document.createElement("tr"),s.innerHTML="<td>".concat(i+1,"</td><td>").concat(t.name,"</td><td></td>"),o.appendChild(s))})},r.call(this,c.querySelector(".".concat(e.classNames["modal__btn-primary"])),"click",function(o){var s,i=c.querySelector(".".concat(e.classNames["netplay-room-password-input"])).value;e.showLoading.call(t),e.connection.password=i,s=c.getAttribute("data-id"),e.connection.join(s,function(e,s,t){g(e,0,t),e&&c.classList.remove(n({'is-open':!0}))}),o.stopPropagation()}),r.call(this,v.querySelector(".".concat(e.classNames["modal__btn-primary"])),"click",function(n){var t=v.querySelector(".".concat(e.classNames["netplay-player-name"])).value,t=t.replace(/<|>/g,'');v.querySelector(".".concat(e.classNames.modal__errmsg)).innerHTML='',t.trim()&&(e.playerName=t.trim(),e.connection.extra.name=t.trim(),O.close()),n.stopPropagation()}),r.call(this,i.querySelector(".".concat(e.classNames["modal__btn-primary"])),"click",function(c){var o,r,s=i.querySelector(".".concat(e.classNames["netplay-room-name-input"])).value,s=s.replace(/<|>/g,''),n=i.querySelector("select[data-max-players] option:checked").value;n<2&&(n=2),n>4&&(n=4);for(o=0;o<n;o++)e.players[o]=null;e.connection.maxParticipantsAllowed=n,r=i.querySelector(".".concat(e.classNames["netplay-room-password-input"])).value,i.querySelector(".".concat(e.classNames.modal__errmsg)).innerHTML='',s.trim()?(e.connection.extra.room_name=s.trim(),''!==r.trim()&&(e.connection.password=r.trim()),e.showLoading.call(t),e.connection.open(e.connection.token(),function(n,o,s){e.hideLoading.call(t),n?(e.players[0]=e.connection.userid,e.roomMaster=e.connection.userid,j.closeModal(),e.stopLoadRooms(),f=e.connection.extra,e.openRoom(t),a(l.contextMenu.querySelectorAll("ul li").item(2),!0),a(l.contextMenu.querySelectorAll("ul li").item(3),!0)):i.querySelector(".".concat(e.classNames.modal__errmsg)).innerHTML=s})):j.closeModal(),c.stopPropagation()}),r.call(this,t.elements.dialogs.netplay.querySelector(".".concat(e.classNames["btn-create-room"])),"click",function(e){return j=O.show("modal-85cd7a1c543a484a",{closeTrigger:"data-modal-close",onClose:function(){t.elements.container.focus()}}),e.stopPropagation(),!1}),r.call(this,t.elements.dialogs.netplay.querySelector(".".concat(e.classNames["btn-quit"])),"click",function(t){return e.connection.close(),e.stopLoadRooms(),e.loadRoomsList(),e.inputsData={},t.stopPropagation(),!1})}window._0x378b5c=e},initKeyboard:function(){var s=this,n=this,t=this.elements.dialogs.gamepad.querySelector(".".concat(e.classNames.overlay));r.call(this,document.body,"keydown keyup",function(o){if(o.which>=112&&o.which<=123);else if(d=!s.elements.dialogs.gamepad.hidden&&!t.hidden,l="keydown"===o.type,l&&d){var l,d,r=t.getAttribute("data-index"),c=t.getAttribute("data-id"),i=null;if(o.key&&e.keyMap[o.keyCode]==="escape"){(i=n.elements.dialogs.gamepad.querySelector('[data-id="'.concat(c,'"][data-index="').concat(r,'"][data-type="1"]'))).setAttribute("data-value",''),i.value=''(i=n.elements.dialogs.gamepad.querySelector('[data-id="'.concat(c,'"][data-index="').concat(r,'"][data-type="2"]'))).setAttribute("data-value",''),i.value='',a(t,!0);return}var r=t.getAttribute("data-index"),c=t.getAttribute("data-id"),i=null;o.key&&((i=n.elements.dialogs.gamepad.querySelector('[data-id="'.concat(c,'"][data-index="').concat(r,'"][data-type="1"]'))).setAttribute("data-value",o.keyCode),i.value=e.keyMap[o.keyCode]),a(t,!0)}else Object.keys(e.controllers).forEach(function(t){Object.keys(e.controllers[t]).forEach(function(n){parseInt(e.controllers[t][n].value,10)===o.keyCode&&["24","25","26"].includes(n)&&o.type=="keydown"&&!o.repeat&&(n=="24"?e.quickSaveState():n=="25"?e.quickLoadState():n=="26"&&e.changeStateSlot()),parseInt(e.controllers[t][n].value,10)===o.keyCode&&(l?n>=16&&n<=23?e.simulateInput(t,n,32767):e.simulateInput(t,n,1):e.simulateInput(t,n,0))})})}),document.body.addEventListener("keydown",function(t){var s=t.keyCode?t.keyCode:t.which;[32,37,38,39,40,112,113,114,115,116,117,118,119,120,121,122,123].includes(s)&&t.srcElement===n.elements.container&&t.preventDefault(),t.srcElement.className.split(/ +/).includes(e.classNames.set)&&t.preventDefault()})},initGamepad:function(){var s=this,o=this,n=this.elements.dialogs.gamepad.querySelector(".".concat(e.classNames.overlay)),t=new m.Gamepad;e.gamepad=t,t.init()&&(t.bind(m.Gamepad.Event.TICK,function(e){e.forEach(function(e){var n;e&&e.axes&&e.axes[9]&&((n=e.axes[9])<3.28571?1==n?(e.extra_buttons[12].pressed||(e.extra_buttons[12]={pressed:!0,value:1},t._fire(m.Gamepad.Event.BUTTON_DOWN,{index:12,gamepad:e,gamepadIndex:e.index})),e.extra_buttons[14].pressed||(e.extra_buttons[14]={pressed:!0,value:1},t._fire(m.Gamepad.Event.BUTTON_DOWN,{index:14,gamepad:e,gamepadIndex:e.index}))):n<=-.7142857&&n>=-.714291?(e.extra_buttons[12].pressed||(e.extra_buttons[12]={pressed:!0,value:1},t._fire(m.Gamepad.Event.BUTTON_DOWN,{index:12,gamepad:e,gamepadIndex:e.index})),e.extra_buttons[15].pressed||(e.extra_buttons[15]={pressed:!0,value:1},t._fire(m.Gamepad.Event.BUTTON_DOWN,{index:15,gamepad:e,gamepadIndex:e.index}))):n>=.42856&&n<=.42858?(e.extra_buttons[13].pressed||(e.extra_buttons[13]={pressed:!0,value:1},t._fire(m.Gamepad.Event.BUTTON_DOWN,{index:13,gamepad:e,gamepadIndex:e.index})),e.extra_buttons[14].pressed||(e.extra_buttons[14]={pressed:!0,value:1},t._fire(m.Gamepad.Event.BUTTON_DOWN,{index:14,gamepad:e,gamepadIndex:e.index}))):n>=-.14287&&n<=-.14285?(e.extra_buttons[13].pressed||(e.extra_buttons[13]={pressed:!0,value:1},t._fire(m.Gamepad.Event.BUTTON_DOWN,{index:13,gamepad:e,gamepadIndex:e.index})),e.extra_buttons[15].pressed||(e.extra_buttons[15]={pressed:!0,value:1},t._fire(m.Gamepad.Event.BUTTON_DOWN,{index:15,gamepad:e,gamepadIndex:e.index}))):n<=-1&&n>=-1.01?e.extra_buttons[12].pressed||(e.extra_buttons[12]={pressed:!0,value:1},t._fire(m.Gamepad.Event.BUTTON_DOWN,{index:12,gamepad:e,gamepadIndex:e.index})):n>=.142857&&n<=.142858?e.extra_buttons[13].pressed||(e.extra_buttons[13]={pressed:!0,value:1},t._fire(m.Gamepad.Event.BUTTON_DOWN,{index:13,gamepad:e,gamepadIndex:e.index})):n>=.7142857&&n<=.7142858?e.extra_buttons[14].pressed||(e.extra_buttons[14]={pressed:!0,value:1},t._fire(m.Gamepad.Event.BUTTON_DOWN,{index:14,gamepad:e,gamepadIndex:e.index})):n<=-.42857&&n>=-.42858&&(e.extra_buttons[15].pressed||(e.extra_buttons[15]={pressed:!0,value:1},t._fire(m.Gamepad.Event.BUTTON_DOWN,{index:15,gamepad:e,gamepadIndex:e.index}))):(e.extra_buttons[12].pressed&&(e.extra_buttons[12]={pressed:!1,value:0},t._fire(m.Gamepad.Event.BUTTON_UP,{index:12,gamepad:e,gamepadIndex:e.index})),e.extra_buttons[13].pressed&&(e.extra_buttons[13]={pressed:!1,value:0},t._fire(m.Gamepad.Event.BUTTON_UP,{index:13,gamepad:e,gamepadIndex:e.index})),e.extra_buttons[14].pressed&&(e.extra_buttons[14]={pressed:!1,value:0},t._fire(m.Gamepad.Event.BUTTON_UP,{index:14,gamepad:e,gamepadIndex:e.index})),e.extra_buttons[15].pressed&&(e.extra_buttons[15]={pressed:!1,value:0},t._fire(m.Gamepad.Event.BUTTON_UP,{index:15,gamepad:e,gamepadIndex:e.index}))))})}),t.bind(m.Gamepad.Event.BUTTON_DOWN,function(t){if(!s.elements.dialogs.gamepad.hidden&&!n.hidden){{var i,r,c,l=parseInt(n.getAttribute("data-index"),10),d=n.getAttribute("data-id");if(t.gamepad.index===parseInt(l,10)){for(r=0;r<32&&((i=t.gamepad.buttons[r])||(i=t.gamepad.extra_buttons[r]),!i||!("number"==typeof i&&1===i||"number"==typeof i.value&&1===i.value));r+=1);c=null,(c=o.elements.dialogs.gamepad.querySelector('[data-id="'.concat(d,'"][data-index="').concat(l,'"][data-type="2"]'))).setAttribute("data-value",t.index),c.value="button ".concat(t.index+1),a(n,!0)}}}else Object.keys(e.controllers[t.gamepad.index.toString()]).forEach(function(n){var s=t.gamepad.index.toString();parseInt(e.controllers[s][n].value2,10)===parseInt(t.index,10)&&["24","25","26"].includes(n)&&(n=="24"?e.quickSaveState():n=="25"?e.quickLoadState():n=="26"&&e.changeStateSlot()),parseInt(e.controllers[s][n].value2,10)===parseInt(t.index,10)&&parseInt(s,10)===parseInt(t.gamepad.index,10)&&e.simulateInput(s,n,1)})}),t.bind(m.Gamepad.Event.BUTTON_UP,function(t){Object.keys(e.controllers).forEach(function(n){Object.keys(e.controllers[n]).forEach(function(s){parseInt(e.controllers[n][s].value2,10)===parseInt(t.index,10)&&parseInt(n,10)===parseInt(t.gamepad.index,10)&&e.simulateInput(n,s,0)})})}),t.bind(m.Gamepad.Event.AXIS_CHANGED,function(t){if(c=function(e){return e>.5||e<.5?e>0?1:-1:0}(parseFloat(t.value)),!s.elements.dialogs.gamepad.hidden&&!n.hidden){if(c!==0){var o,i,r,c,l,d,h=n.getAttribute("data-id"),m=parseInt(n.getAttribute("data-index"),10),u=s.elements.dialogs.gamepad.querySelector('[data-id="'.concat(h,'"][data-index="').concat(m,'"][data-type="2"]'));u.setAttribute("data-value",t.axis+":"+c),u.value=t.axis+":"+c,a(n,!0)}}else{e.prevButtons||(e.prevButtons={}),l=!1,o=t.gamepad.index.toString(),e.prevButtons[o]||(e.prevButtons[o]={}),e.prevButtons[o][t.axis]||(e.prevButtons[o][t.axis]=0),e.prevButtons[o].buttonID||(e.prevButtons[o].buttonID=0);for(d=0;d<Object.keys(e.controllers[o]).length;d++){if(r=Object.keys(e.controllers[o])[d],!e.controllers[o][r].value2)continue;e.controllers[o][r].value2.split(":")[0]===t.axis&&parseInt(e.controllers[o][r].value2.split(":")[1])===c&&["24","25","26"].includes(r)&&(r=="24"?(l=!0,e.quickSaveState()):r=="25"?(l=!0,e.quickLoadState()):r=="26"&&e.changeStateSlot()),c===0?e.controllers[o][r].value2.split(":")[0]===t.axis&&(e.prevButtons[o][t.axis]=c,e.prevButtons[o].buttonID=r,e.simulateInput(o,r,0)):((1===e.prevButtons[o][t.axis]&&c===-1||-1===e.prevButtons[o][t.axis]&&c===1)&&e.simulateInput(o,e.prevButtons[o].buttonID,0),e.controllers[o][r].value2.split(":")[0]===t.axis&&parseInt(e.controllers[o][r].value2.split(":")[1])===c&&(e.prevButtons[o][t.axis]=c,e.prevButtons[o].buttonID=r,l=!0,e.simulateInput(o,r,1)))}if(l)return;if(!s.elements.dialogs.gamepad.hidden&&!n.hidden)return}Math.abs(t.value)<=.1&&(t.value=0),i=t.gamepad.index,"LEFT_STICK_X"===t.axis&&(t.value>0?(e.simulateInput(i,16,32767*t.value),e.simulateInput(i,17,0)):(e.simulateInput(i,17,32767*t.value),e.simulateInput(i,16,0))),"LEFT_STICK_Y"===t.axis&&(t.value>0?(e.simulateInput(i,18,32767*t.value),e.simulateInput(i,19,0)):(e.simulateInput(i,19,32767*t.value),e.simulateInput(i,18,0))),"RIGHT_STICK_X"===t.axis&&(t.value>0?(e.simulateInput(i,20,32767*t.value),e.simulateInput(i,21,0)):(e.simulateInput(i,21,32767*t.value),e.simulateInput(i,20,0))),"RIGHT_STICK_Y"===t.axis&&(t.value>0?(e.simulateInput(i,22,32767*t.value),e.simulateInput(i,23,0)):(e.simulateInput(i,23,32767*t.value),e.simulateInput(i,22,0)))}),t.bind(m.Gamepad.Event.DISCONNECTED,function(){[0,1,2,3].forEach(function(e){var n=t.gamepads[e];o.elements.dialogs.gamepad.querySelector("#controls-".concat(e," .gamepad-name")).innerHTML=n?n.id:"n/a"})}),t.bind(m.Gamepad.Event.CONNECTED,function(){Object.keys(t.gamepads).forEach(function(e){var n=t.gamepads[e];o.elements.dialogs.gamepad.querySelector("#controls-".concat(e," .gamepad-name")).innerHTML=n?n.id:"n/a"})}))},setShader:function(t){if("disabled"===t)o.FS.unlink("/shader/shader.glslp",''),e.toggleShader&&e.toggleShader(0);else{e.toggleShader&&e.toggleShader(0);var n="/shader/".concat(t);o.FS.writeFile("/shader/shader.glslp",function(e){if(!(e instanceof Int32Array))throw new Error("uintArrayToString: Only accepts Int32Array parameter");for(var n,s='',t=0,o=e.length;t<o;t+=1){if(n=e[t],n>65535)throw new Error("Invalid value attempted to be serialised");s+=String.fromCharCode(n)}return s}(new Int32Array(o.FS.readFile(n)))),e.toggleShader&&e.toggleShader(1)}},toggleVirtualGamepad:function(j){if(o=this,null===e.virtualGamepadContainer){e.virtualGamepadContainer=c("div",{class:n({'ejs-virtual-gamepad':!0}),hidden:''}),this.elements.container.appendChild(e.virtualGamepadContainer),m="height:31px;text-align:center;border:1px solid #ccc;border-radius:5px;line-height:31px;",t='',["snes","nds"].includes(o.system)?(i={order:["X","Y","A","B"],orderCSS:["left:40px;","top:40px;","left:81px;top:40px;","left:40px;top:80px;"],LandR:!0}):["gba","gb","vb","nes"].includes(o.system)?(i={order:["B","A"],orderCSS:["left:-10px;top:70px;","left:60px;top:70px;"],LandR:o.system==="gba"}):["n64"].includes(o.system)?(i={order:["B","A"],orderCSS:["left:-10px;top:95px;","left:40px;top:150px;"],LandR:!0}):(i={order:["Y","X","B","A"],orderCSS:["left:40px;","top:40px;","left:81px;top:40px;","left:40px;top:80px;"],LandR:!0}),t+='<div class="'+n({'virtual-gamepad':!0})+'" style="display: block;">',t+='<div class="'+n({top:!0})+'">',i.LandR===!0&&(o.system==="n64"?(t+='<div class="'+n({buttons:!0,b_l:!0})+'" style="left:10px;top:-40px;'+m+'">L</div>',t+='<div class="'+n({buttons:!0,b_z:!0})+'" style="left:10px;'+m+'">Z</div>',t+='<div class="'+n({buttons:!0,b_r:!0})+'" style="right:10px;top:-40px;'+m+'">R</div>'):(t+='<div class="'+n({buttons:!0,b_l:!0})+'" style="left:10px;'+m+'">L</div>',t+='<div class="'+n({buttons:!0,b_r:!0})+'" style="right:10px;'+m+'">R</div>')),t+="</div>",t+='<div class="'+n({left:!0})+'"></div>',t+='<div class="'+n({center:!0})+'">',o.system==="n64"?t+='<div class="'+n({buttons:!0,b_start:!0})+'" style="left:40px;">'+o.localization("Start")+"</div>":(t+='<div class="'+n({buttons:!0,b_start:!0})+'" style="left:60px;">'+o.localization("Start")+"</div>",t+='<div class="'+n({buttons:!0,b_select:!0})+'" style="left:-5px;">'+o.localization("Select")+"</div>"),t+="</div>",t+='<div class="'+n({right:!0})+'">',o.system==="n64"&&(t+='<div class="'+n({buttons:!0,b_cu:!0})+'" style="left:25px;top:-65px;"></div>',t+='<div class="'+n({buttons:!0,b_cd:!0})+'" style="left:25px;top:15px;"></div>',t+='<div class="'+n({buttons:!0,b_cl:!0})+'" style="left:-15px;top:-25px;"></div>',t+='<div class="'+n({buttons:!0,b_cr:!0})+'" style="left:65px;top:-25px;"></div>');for(d=0;d<i.order.length;d++)g={buttons:!0},g["b_"+i.order[d].toLowerCase()]=!0,t+='<div class="'+n(g)+'" style="'+i.orderCSS[d]+'">'+i.order[d]+"</div>";t+="</div></div>",e.virtualGamepadContainer.innerHTML=t,a(e.virtualGamepadContainer,!j),v=eH.a.create({zone:u.call(this,".".concat(n({'ejs-virtual-gamepad':!0})," .").concat(n({left:!0}))),mode:"static",position:{left:"50%",top:"50%"},color:"red"});function s(){if(o.system==="n64"){var e;return l&&typeof l.getCoreOptionsValues=="function"&&(e=l.getCoreOptionsValues()["joystick-input"]),e==="d-pad"?{downVal:1,4:4,5:5,6:6,7:7}:{downVal:32767,4:19,5:18,6:17,7:16}}else return{downVal:1,4:4,5:5,6:6,7:7}}v.on("end",function(){e.syncInput(0,s()[4],0),e.syncInput(0,s()[5],0),e.syncInput(0,s()[6],0),e.syncInput(0,s()[7],0)}),v.on("move",function(o,n){var t=n.angle.degree;t>=30&&t<150?e.syncInput(0,s()[4],s().downVal):window.setTimeout(function(){e.syncInput(0,s()[4],0)},30),t>=210&&t<330?e.syncInput(0,s()[5],s().downVal):window.setTimeout(function(){e.syncInput(0,s()[5],0)},30),t>=120&&t<240?e.syncInput(0,s()[6],s().downVal):window.setTimeout(function(){e.syncInput(0,s()[6],0)},30),t>=300||t>=0&&t<60?e.syncInput(0,s()[7],s().downVal):window.setTimeout(function(){e.syncInput(0,s()[7],0)},30)});var t,o,i,d,m,f,g,v,_,y=n({'virtual-gamepad':!0}),p=n({touch:!0});b.isIos||r.call(this,u.call(this,".".concat(y)),"touchmove",function(e){e.stopPropagation()}),[{id:{b_a:!0},number:8},{id:{b_b:!0},number:0},{id:{b_x:!0},number:9},{id:{b_y:!0},number:1},{id:{b_l:!0},number:10},{id:{b_z:!0},number:12},{id:{b_r:!0},number:11},{id:{b_start:!0},number:3},{id:{b_select:!0},number:2},{id:{b_cu:!0},number:23},{id:{b_cd:!0},number:22},{id:{b_cl:!0},number:21},{id:{b_cr:!0},number:20}].forEach(t=>{r.call(this,u.call(this,".".concat(y," .").concat(n(t.id))),"touchstart touchend mousedown mouseup mouseout",function(n){if(n.sourceCapabilities.firesTouchEvents&&n.type.includes("mouse"))return;["touchend","mouseup","mouseout"].includes(n.type)?(h(n.target,p,!1),window.setTimeout(function(){e.syncInput(0,t.number,0)},30)):(h(n.target,p,!0),e.syncInput(0,t.number,1)),n.stopPropagation()})}),f=c("div",{class:n({ejs__widget:!0,ejs__widget_controls_toggle:!0})},''),f.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>',u.call(this,".".concat(n({ejs__widgets:!0}))).appendChild(f),r.call(this,f,"mousedown touchstart",function(e){if(e.sourceCapabilities.firesTouchEvents&&e.type.includes("mouse"))return;h(e.target,p,!0),clearTimeout(_),w.toggleControls.call(o,!0),_=setTimeout(function(){w.toggleControls.call(o,!1)},5e3)})}else a(e.virtualGamepadContainer,!j)},setup:function(){var n,i,a,t=this;this.game?((e.playerName=t.config.playerName,h(this.elements.container,this.config.classNames.type,!0),this.elements.container.setAttribute("tabindex","0"),this.color)&&(n=function(i){if(e=i.toLowerCase(),e&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(e)){if(4===e.length){for(var e,n,s,o="#",t=1;t<4;t+=1)o+=e.slice(t,t+1).concat(e.slice(t,t+1));e=o}for(s=[],n=1;n<7;n+=2)s.push(parseInt("0x".concat(e.slice(n,n+2)),16));return s}return null}(this.color),n&&this.elements.container.setAttribute("style","--ejs-primary-color: ".concat(n[0],", ").concat(n[1],", ").concat(n[2]))),(this.elements.wrapper=c("div",{class:this.config.classNames.video}),e6(this.game,this.elements.wrapper),"video"!==t.game.tagName.toLocaleLowerCase())&&(i=this.config.volume,Object.defineProperty(t.game,"volume",{get:function(){return i},set:function(e){i=e,p.call(t,t.game,"volumechange")}}),a=t.storage.get("muted"),Object.defineProperty(t.game,"muted",{get:function(){return a},set:function(e){var n=!!s.boolean(e)&&e;a=n,p.call(t,t.game,"volumechange")}})),window.addEventListener("beforeunload",function(){if(t.started){var n,s=t.startName.split("/").pop().split("."),i=s.slice(0,s.length-1).join(".");o.FS.syncfs(function(){});try{n="srm","nds"===t.system&&(n="dsv"),o.FS.unlink("/data/saves/".concat(i,".").concat(n))}catch(e){console.log("fail to save")}e.saveSavFiles(),o.FS.syncfs(function(){})}},!0)):console.warn("No game element found!")},listeners:function(){var t=this;t.elements.buttons.restart&&r.call(t,t.elements.buttons.restart,"click",function(){if(e.restartGame(),e.inputsData={},e.connected&&e.connection.isInitiator){for(var s,n=e.getStateInfo().split("|"),i=n[0]>>0,a=(n[2],new Uint8Array(i)),r=n[1]>>0,t=0;t<i;t+=1)a[t]=o.Module.getValue(r+t);s=new File([a],"0-game.state",{type:'',lastModified:new Date}),e.connection.shareFile(s),e.inputsData={},e.wait=!0,e.systemPause(1),o.Module.pauseMainLoop(),e.disableControl(!0)}}),t.elements.buttons.screenRecord&&r.call(t,t.elements.buttons.screenRecord,"click",function(){if(t.recordData||(t.recordData={started:!1,data:[],stopped:!1}),t.recordData.started)t.recordData.started&&(t.recordData.recorder.stop(),t.recordData.stopped=!0);else{if(MediaRecorder.isTypeSupported("video/webm; codecs=h264"))var s,i,e={mimeType:"video/webm; codecs=h264"};else MediaRecorder.isTypeSupported("video/webm; codecs=H264")?(e={mimeType:"video/webm; codecs=H264"}):MediaRecorder.isTypeSupported("video/webm; codecs=vp9")?(e={mimeType:"video/webm; codecs=vp9"}):MediaRecorder.isTypeSupported("video/webm; codecs=vp8")?(e={mimeType:"video/webm; codecs=vp8"}):MediaRecorder.isTypeSupported("video/webm; codecs=avc1")?(e={mimeType:"video/webm; codecs=avc1"}):MediaRecorder.isTypeSupported("video/webm; codecs=vp9.0")?(e={mimeType:"video/webm; codecs=vp9.0"}):MediaRecorder.isTypeSupported("video/webm; codecs=vp8.0")?(e={mimeType:"video/webm; codecs=vp8.0"}):(e={});function a(s){t.elements.buttons.screenRecord.querySelector(".".concat(n({ejs__tooltip:!0}))).innerHTML=t.localization("Stop Screen Recording"),t.recordData.stream=s,t.recordData.recorder=new MediaRecorder(t.recordData.stream,e),t.recordData.recorder.ondataavailable=function(o){if(o.data.size>0&&t.recordData.data.push(o.data),t.recordData.stopped){var s,e=document.createElement("a");e.href=window.URL.createObjectURL(new Blob(t.recordData.data,{type:"video/webm"})),typeof t.gameName=="string"&&(s=t.gameName),e.download=s?''.concat(s,"-recording.webm"):"record.webm",e.click(),window.URL.revokeObjectURL(e.href),delete t.recordData,t.elements.buttons.screenRecord.querySelector(".".concat(n({ejs__tooltip:!0}))).innerHTML=t.localization("Start Screen Recording")}},t.recordData.recorder.start(),t.recordData.started=!0}o.Module.pauseMainLoop(),t.playing=!1,alert('please check "share system audio" to have audio in the recording. We only need the audio stream so your entire screen will not be recorded'),s=o.Module.canvas.captureStream(30),i=setTimeout(function(){t.playing=!0,o.Module.resumeMainLoop()},2e4),navigator.mediaDevices.getDisplayMedia({audio:!0,video:{mediaSource:"screen"}}).then(function(r){try{clearTimeout(i)}catch(e){}for(var n=r.getAudioTracks(),e=0;e<n.length;e++)s.addTrack(n[e]);a(s),t.playing=!0,o.Module.resumeMainLoop()})}}),t.elements.buttons.play&&Array.from(t.elements.buttons.play).forEach(function(n){r.call(t,n,"click",function(){t.playing?(t.playing=!1,o.Module.pauseMainLoop(),e.connected&&e.connection.isInitiator&&e.connection.send(JSON.stringify({act:"pause"})),p.call(t,t.elements.container,"pause",!1,{pause:!0})):(t.playing=!0,o.Module.resumeMainLoop(),e.connected&&e.connection.isInitiator&&e.connection.send(JSON.stringify({act:"resume"})),p.call(t,t.elements.container,"pause",!1,{pause:!1}))})}),t.elements.buttons.netplay&&r.call(t,t.elements.buttons.netplay,"click",function(){e.disableControl(!0),a(t.elements.dialogs.netplay,!1),e.players.length>0?e.openRoom(t):(e.stopLoadRooms(),e.loadRoomsList()),e.playerName||O.show("modal-9de6c4e9ce2b9361",{closeByEsckey:!1})}),t.elements.buttons.cheat&&r.call(t,t.elements.buttons.cheat,"click",function(){a(t.elements.dialogs.cheat,!1)}),r.call(t,t.elements.container,"savestate",function(i){if(e.saveLoadDB.call(t,"save"))return;if(n=i.detail.state,s.function(t.config.onsavestate))t.config.onsavestate.call(null,{screenshot:i.detail.screenshot,state:n});else{var n,r,c=new Blob([n]),a=t.startName.split("/").pop().split("."),o=a.slice(0,a.length-1).join(".");typeof t.gameName=="string"&&(o=t.gameName),r=o?''.concat(o,".state"):"game.state",eE()(c,r)}t.elements.container.focus()}),t.game.stateloadField=c("input"),t.game.stateloadField.type="file",t.game.stateloadField.onchange=function s(o){var e,n=o.target.files;n.length>0&&((e=new FileReader).file_name=n[0].name,e.onload=function(){var t=new Uint8Array(e.result);EJS_loadState(t)},e.readAsArrayBuffer(n[0])),t.game.stateloadField=c("input"),t.game.stateloadField.type="file",t.game.stateloadField.onchange=s},r.call(t,t.elements.container,"loadstate",function(){if(e.saveLoadDB.call(t,"load"))return;s.function(t.config.onloadstate)?t.config.onloadstate.call(null,t.loadState):t.game.stateloadField.click(),t.elements.container.focus()}),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState?console.log("hidden"):console.log("active")})},bindFunction:function(){var n,s,a,c,d,t=this,r=t.system;o.Module&&o.Module._set_volume&&(s=o.Module.cwrap("set_volume","null",["number"]),e.setVolume=function(){var e=0;t.volume<1&&(e=0===t.volume?-80:30*t.volume-30,s(e)),t.muted&&(e=-80),s(e)}),e.setVariable=o.Module.cwrap("set_variable","null",["string","string"]),e.simulateInputFn=o.Module.cwrap("simulate_input","null",["number","number","number"]),a={0:null,1:null,2:null,3:null,4:null,5:null,6:null,7:null,8:null,9:null,10:null,11:null,12:null,13:null,14:null,15:null,16:null,17:null,18:null,19:null,20:null,21:null,22:null,23:null,24:null,25:null,26:null,27:null,28:null,29:null,30:null,31:null},e.simulateInput=function(c,n,s){if(e.connected){if(t.playing&&!e.disableInput){var r=e.connection.userid,l=e.roomMaster===r,i=e.players.indexOf(r),o=e.currentFrameNum();c>>0==0&&(a[n]!==s&&(l?(e.inputsData[o]||(e.inputsData[o]=[]),e.inputsData[o].push({index:i,key:n,status:s,frame:o}),e.simulateInputFn(i,n,s)):e.connection.send(JSON.stringify({act:"sync-control",value:[''.concat(i,"|").concat(n,"|").concat(s,"|").concat(o)]}),e.roomMaster)),a[n]=s)}}else e.disableInput||e.simulateInputFn(c,n,s)},e.syncInput=e.simulateInput,window.simulateInput=e.simulateInput,c=o.Module.cwrap("shader_enable","null",["number"]),e.toggleShader=function(e){return c(e)},e.getStateInfo=o.Module.cwrap("get_state_info","string",[]),e.saveState=function(){var t,n,a,i=e.getStateInfo().split("|"),s=i[0]>>0;if(s>0){n=new Uint8Array(s);for(a=i[1]>>0,t=0;t<s;t++)n[t]=o.Module.getValue(a+t)}return n},n=o.Module.cwrap("load_state","number",["string","number"]),e.loadState=function(h,s){c=h;try{o.FS.unlink("game.state")}catch(e){}if(o._FS.createDataFile("/","game.state",c,!0,!0),null===s&&(s=0),"arcade"===r?setTimeout(function(){e.getStateInfo(),n("game.state",s),o.FS.unlink("game.state")},10):(n("game.state",s),setTimeout(function(){o.FS.unlink("game.state")},100)),e.connected&&e.connection.isInitiator){for(var c,u,a=e.getStateInfo().split("|"),l=a[0]>>0,d=(a[2],new Uint8Array(l)),m=a[1]>>0,i=0;i<l;i+=1)d[i]=o.Module.getValue(m+i);u=new File([d],"0-game.state",{type:'',lastModified:new Date}),e.connection.shareFile(u),e.inputsData={},e.wait=!0,e.systemPause(1),o.Module.pauseMainLoop(),e.disableControl(!0)}t.elements.container.focus()},o.Module._set_cheat&&(e.setCheat=o.Module.cwrap("set_cheat","number",["number","number","string"])),o.Module._reset_cheat&&(e.resetCheat=o.Module._reset_cheat),e.quickSaveState=function(){if(t.started&&!e.connected){if(t.statesSupported===!1){t.elements.widgets.stateInfoDiv.innerHTML="CANNOT CURRENTLY SAVE STATE",clearTimeout(e.saveMsgTransitions),e.saveMsgTransitions=setTimeout(function(){t.elements.widgets.stateInfoDiv.innerHTML=''},1500);return}if(l&&typeof l.getCoreOptionsValues=="function"){var s,i,n=l.getCoreOptionsValues()["save-state-slot"];n||(n=1)}else n=1;s=n+"-quick.state";try{o.FS.unlink(s)}catch(e){}try{i=e.saveState(),o._FS.createDataFile("/",s,i,!0,!0),t.elements.widgets.stateInfoDiv.innerHTML="STATE SAVED TO SLOT "+n,clearTimeout(e.saveMsgTransitions),e.saveMsgTransitions=setTimeout(function(){t.elements.widgets.stateInfoDiv.innerHTML=''},1500)}catch(s){t.elements.widgets.stateInfoDiv.innerHTML="FAILED TO SAVE STATE TO SLOT "+n,clearTimeout(e.saveMsgTransitions),e.saveMsgTransitions=setTimeout(function(){t.elements.widgets.stateInfoDiv.innerHTML=''},1500)}}},e.saveMsgTransitions=null,e.quickLoadState=function(){if(t.started&&!e.connected){if(t.statesSupported===!1){t.elements.widgets.stateInfoDiv.innerHTML="CANNOT CURRENTLY LOAD STATE",clearTimeout(e.saveMsgTransitions),e.saveMsgTransitions=setTimeout(function(){t.elements.widgets.stateInfoDiv.innerHTML=''},1500);return}if(l&&typeof l.getCoreOptionsValues=="function"){var o,i,s=l.getCoreOptionsValues()["save-state-slot"];s||(s=1)}else s=1;o=s+"-quick.state",i=!0;try{n(o,0),"arcade"===r&&setTimeout(function(){e.getStateInfo(),n(o,0)},10)}catch(e){i=!1}i?t.elements.widgets.stateInfoDiv.innerHTML="LOADED STATE FROM SLOT "+s:t.elements.widgets.stateInfoDiv.innerHTML="FAILED TO LOAD STATE FROM SLOT "+s,clearTimeout(e.saveMsgTransitions),e.saveMsgTransitions=setTimeout(function(){t.elements.widgets.stateInfoDiv.innerHTML=''},1500)}},e.changeStateSlot=function(o){if(l&&typeof l.getCoreOptionsValues=="function"){var n,s=l.getCoreOptionsValues()["save-state-slot"];s||(s=1)}else s=1;typeof o!="number"?n=s+1:n=o,n>9&&(n=1),i.updateCoreOptions.call(t,"save-state-slot",n),t.elements.widgets.stateInfoDiv.innerHTML="SET SAVE STATE SLOT TO "+n,clearTimeout(e.saveMsgTransitions),e.saveMsgTransitions=setTimeout(function(){t.elements.widgets.stateInfoDiv.innerHTML=''},1500)},window.EJS_loadState=function(t){e.loadState(t,0),setTimeout(function(){if(e.connected){var n=new File([t],"0-game.state",{type:'',lastModified:new Date});e.connection.shareFile(n),e.inputsData={},e.wait=!0,e.systemPause(1),o.Module.pauseMainLoop(),e.disableControl(!0)}},30)},d=o.Module.cwrap("cmd_take_screenshot",'',[]),e.getScreenData=function(){return e.toggleShader(0),d(),e.toggleShader(1),o.FS.readFile("screenshot.png")},e.restartGame=o.Module.cwrap("system_restart",'',[]),e.currentFrameNum=o.Module.cwrap("get_current_frame_count",'',[]),e.saveSavFiles=o.Module.cwrap("cmd_savefiles",'',[]),o.Module._get_core_options&&(e.getGameCoreOptions=o.Module.cwrap("get_core_options","string",[])),e.systemPause=function(){return!1},e.controllers=l.storage.get("controllers"),e.controllers||(e.controllers=JSON.parse(JSON.stringify(e.defaultControllers)))}},d=e;function e$(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(r,a){var e,s,t=[],n=!0,o=!1,i=void 0;try{for(e=r[Symbol.iterator]();!(n=(s=e.next()).done)&&(t.push(s.value),!a||t.length!==a);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==e.return||e.return()}finally{if(o)throw i}}return t}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}i={storage:null,coreOptionsValues:{},contextMenu:null,normalOptions:{shader:{label:"Shader",options:{disabled:"Disabled",'2xScaleHQ.glslp':"2xScaleHQ",'4xScaleHQ.glslp':"4xScaleHQ",'crt-easymode.glslp':"CRT easymode",'crt-aperture.glslp':"CRT aperture",'crt-geom.glslp':"CRT geom"},default:"disabled"},'virtual-gamepad':{label:"Virtual Gamepad",options:{disabled:"Disabled",enabled:"Enabled"},default:"enabled"}},defaultCoreOptionsValues:function(){var e={};switch(this.system){case"pce":e={pce_nospritelimit:"enabled"};break;case"jaguar":e={virtualjaguar_doom_res_hack:"enabled"};break;case"psx":e={pcsx_rearmed_memcard2:"enabled"};break;case"nds":e={}}return e},getCoreOptionsValues:function(){var e=i.storage.get("core-options");return s.empty(e)&&(e={}),e},getCoreOptions:function(){var e={};switch(this.system){case"nes":e.fceumm_palette={label:this.localization("Color Palette"),options:{default:this.localization("Default"),asqrealc:"asqrealc",'nintendo-vc':"nintendo-vc",rgb:"rgb",'yuv-v3':"yuv-v3",'unsaturated-final':"unsaturated-final",'sony-cxa2025as-us':"sony-cxa2025as-us",pal:"pal",'bmf-final2':"bmf-final2",'bmf-final3':"bmf-final3",'smooth-fbx':"smooth-fbx",'composite-direct-fbx':"composite-direct-fbx",'pvm-style-d93-fbx':"pvm-style-d93-fbx",nescap:"nescap",'ntsc-hardware-fbx':"ntsc-hardware-fbx",'nes-classic-fbx-fs':"nes-classic-fbx-fs",wavebeam:"wavebeam"},default:"default"},e.fceumm_nospritelimit={label:this.localization("No Sprite Limit"),options:{enabled:this.localization("Enabled"),disabled:this.localization("Disabled")},default:"disabled"},e.fceumm_sndquality={label:this.localization("Sound Quality"),options:{Low:this.localization("Low"),High:this.localization("High"),'Very High':this.localization("Very High")},default:"Low"},this.lightgun||(e.system_type={label:this.localization("4 Players Support"),options:{nes:"NES",famicom:"Famicom"},default:"nes",netplay:!0}),e.fceumm_turbo_enable={label:this.localization("Turbo Enable"),options:{None:this.localization("None"),'Player 1':this.localization("Player 1"),'Player 2':this.localization("Player 2"),Both:this.localization("Both")},default:"None",netplay:!0},e.fceumm_region={label:this.localization("Region"),options:{Auto:this.localization("Auto"),NTSC:"NTSC",PAL:"PAL",Dendy:"Dendy"},default:"Auto",netplay:!0};break;case"snes":e={snes9x_next_overclock:{label:this.localization("SuperFX Overclock"),options:{disabled:this.localization("Disabled")+"(10MHz)",'40MHz':"40MHz",'60MHz':"60MHz",'80MHz':"80MHz",'100MHz':"100MHz"},default:"disabled",netplay:!0}};break;case"snes2002":case"snes2005":case"snes2010":e={};break;case"gb":e={gambatte_gb_colorization:{label:this.localization("GB Colorization"),options:{disabled:this.localization("Disabled"),auto:this.localization("auto"),internal:this.localization("internal")},default:"disabled"},gambatte_gb_internal_palette:{label:this.localization("Internal Palette"),options:{'GBC - Blue':this.localization("GBC - Blue"),'GBC - Brown':this.localization("GBC - Brown"),'GBC - Dark Blue':this.localization("GBC - Dark Blue"),'GBC - Dark Brown':this.localization("GBC - Dark Brown"),'GBC - Dark Green':this.localization("GBC - Dark Green"),'GBC - Grayscale':this.localization("GBC - Grayscale"),'GBC - Green':this.localization("GBC - Green"),'GBC - Inverted':this.localization("GBC - Inverted"),'GBC - Orange':this.localization("GBC - Orange"),'GBC - Pastel Mix':this.localization("GBC - Pastel Mix"),'GBC - Red':this.localization("GBC - Red"),'GBC - Yellow':this.localization("GBC - Yellow")},default:"GBC - Blue"}};break;case"gba":e={mgba_solar_sensor_level:{label:this.localization("Solar sensor level"),options:["0","1","2","3","4","5","6","7","8","9","10"],default:"0"},mgba_frameskip:{label:this.localization("Frameskip"),options:["0","1","2","3","4","5","6","7","8","9","10"],default:"0"}};break;case"vbanext":e={vbanext_turboenable:{label:this.localization("Enable Turbo Buttons"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"},vbanext_turbodelay:{label:this.localization("Turbo Delay in frames"),options:["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],default:"2"}};break;case"n64":e={'glupen64-aspect':{label:this.localization("Aspect Ratio (Need to refresh page)"),options:["4:3","16:9"],default:"4:3"},'glupen64-43screensize':{label:this.localization("4:3 Resolution"),options:["320x240","640x480","960x720","1280x960"],default:"320x240"},'glupen64-169screensize':{label:this.localization("16:9 Resolution"),options:["640x360","960x540","1280x720"],default:"640x360"},'glupen64-pak1':{label:this.localization("Player 1 Pak"),options:{none:this.localization("none"),memory:this.localization("memory"),rumble:this.localization("rumble")},default:"none",netplay:!0},'glupen64-pak2':{label:this.localization("Player 2 Pak"),options:{none:this.localization("none"),memory:this.localization("memory"),rumble:this.localization("rumble")},default:"none",netplay:!0},'glupen64-pak3':{label:this.localization("Player 3 Pak"),options:{none:this.localization("none"),memory:this.localization("memory"),rumble:this.localization("rumble")},default:"none",netplay:!0},'glupen64-pak4':{label:this.localization("Player 4 Pak"),options:{none:this.localization("none"),memory:this.localization("memory"),rumble:this.localization("rumble")},default:"none",netplay:!0}},d&&(d.virtualGamepadContainer!="undefined"||d.virtualGamepadContainer!==null)&&(e["joystick-input"]={label:this.localization("Joystick input keys"),options:{'d-pad':this.localization("d-pad"),'analog-stick':this.localization("Analog Stick")},default:"analog-stick",netplay:!0});break;case"nds":e={desmume_screens_layout:{label:this.localization("Screen layout"),options:{'top/bottom':this.localization("top/bottom"),'bottom/top':this.localization("bottom/top"),'left/right':this.localization("left/right"),'right/left':this.localization("right/left"),'top only':this.localization("top only"),'bottom only':this.localization("bottom only"),'quick switch':this.localization("quick switch"),'hybrid/top':this.localization("hybrid/top"),'hybrid/bottom':this.localization("hybrid/bottom")},default:"top/bottom"},screen_rotation:{label:this.localization("Screen Rotation"),options:{0:"0",90:"90",180:"180",270:"270"},default:0},desmume_frameskip:{label:this.localization("Frameskip"),options:["0","1","2","3","4","5","6","7","8","9"],default:"0"}},j.wasm||delete e.screen_rotation;break;case"vb":case"pce":e={};break;case"segaMS":case"segaGG":case"segaMD":case"segaCD":e={genesis_plus_gx_no_sprite_limit:{label:this.localization("No Sprite Limit"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"},genesis_plus_gx_overclock:{label:this.localization("CPU speed"),options:["100%","125%","150%","175%","200%"],default:"100%",netplay:!0},genesis_plus_gx_sound_output:{label:this.localization("Sound output"),options:{stereo:this.localization("stereo"),mono:this.localization("mono")},default:"stereo"}};break;case"sega32x":e={picodrive_sprlim:{label:this.localization("No sprite limit"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"}};break;case"segaSaturn":e={yabause_frameskip:{label:this.localization("Frameskip"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"}};break;case"msx":e={bluemsx_nospritelimits:{label:this.localization("No Sprite Limit"),options:{OFF:this.localization("OFF"),ON:this.localization("ON")},default:"OFF"}};break;case"ws":case"ngp":e={};break;case"jaguar":e={virtualjaguar_usefastblitter:{label:this.localization("Fast Blitter"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"},virtualjaguar_bios:{label:this.localization("Bios"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"}};break;case"psx":e={pcsx_rearmed_frameskip:{label:this.localization("Frameskip"),options:[0,1,2,3],default:0,netplay:!0},pcsx_rearmed_memcard2:{label:this.localization("Enable second memory card"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"enabled",netplay:!0},pcsx_rearmed_pad1type:{label:this.localization("Pad 1 Type"),options:{default:this.localization("default"),none:this.localization("none"),standard:this.localization("standard"),analog:this.localization("analog"),negcon:this.localization("negcon")},default:"default",netplay:!0},pcsx_rearmed_pad2type:{label:this.localization("Pad 2 Type"),options:{default:this.localization("default"),none:this.localization("none"),standard:this.localization("standard"),analog:this.localization("analog"),negcon:this.localization("negcon")},default:"default",netplay:!0},pcsx_rearmed_pad3type:{label:this.localization("Pad 3 Type"),options:{default:this.localization("default"),none:this.localization("none"),standard:this.localization("standard"),analog:this.localization("analog"),negcon:this.localization("negcon")},default:"default",netplay:!0},pcsx_rearmed_pad4type:{label:this.localization("Pad 4 Type"),options:{default:this.localization("default"),none:this.localization("none"),standard:this.localization("standard"),analog:this.localization("analog"),negcon:this.localization("negcon")},default:"default",netplay:!0},pcsx_rearmed_vibration:{label:this.localization("Enable Vibration"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"enabled",netplay:!0},pcsx_rearmed_neon_interlace_enable:{label:this.localization("Enable interlacing mode(s)"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled",netplay:!0},pcsx_rearmed_neon_enhancement_enable:{label:this.localization("Enhanced resolution (slow)"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled",netplay:!0},pcsx_rearmed_neon_enhancement_no_main:{label:this.localization("Enhanced resolution speed hack"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled",netplay:!0}};break;case"arcade":case"fba0.2.97.29":e={'fba-aspect':{label:this.localization("Aspect ratio"),options:["DAR","PAR"],default:"DAR"},'fba-frameskip':{label:this.localization("Frameskip"),options:["0","1","2","3","4","5"],default:"0",netplay:!0},'fba-cpu-speed-adjust':{label:this.localization("CPU overclock"),options:["100","110","120","130","140","150","160","170","180","190","200"],default:"100",netplay:!0},'fba-diagnostic-input':{label:this.localization("Diagnostic Input"),options:["None","Hold Start","Start + A + B","Hold Start + A + B","Start + L + R","Hold Start + L + R","Hold Select","Select + A + B","Hold Select + A + B","Select + L + R","Hold Select + L + R"],default:"None",netplay:!0},'fba-neogeo-mode':{label:this.localization("Force Neo Geo mode"),options:["MVS","AES","UNIBIOS","DIPSWITCH"],default:"MVS",netplay:!0}};break;case"mame2003":case"mame2010":case"mame":e={};break;case"dos":e={};break;default:e={},console.warn("Unsupported emulator")}return this.coreVer===2&&(e={}),this.statesSupported===!0&&(e["save-state-slot"]={label:this.localization("Save State Slot"),options:[1,2,3,4,5,6,7,8,9],default:1}),this.statesSupported===!0&&window.indexedDB&&(typeof this.gameName=="string"||!this.config.gameUrl.startsWith("blob:"))&&(e["save-state-location"]={label:this.localization("Save State Location"),options:{download:this.localization("download"),'keep in browser':this.localization("keep in browser")},default:"download"}),d.getGameCoreOptions&&d.getGameCoreOptions().split("\n").forEach(function(i){var n,o,s=i.split("; "),t=s[0];0===t.indexOf("fba-dipswitch-")&&(n=s[1].split("|"),o=t.replace(/_/g," ").replace(/.+-(.+)/,"$1"),e[t]={label:o,options:n.slice(1,-1),default:n[0].replace("(Default) ",''),netplay:!0})}),e},supportNetPlay:function(){if(this.lightgun||this.mouse)return!1;var e=window.RTCPeerConnection||window.webkitPeerConnection00||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,t=window.mozRTCIceCandidate||window.RTCIceCandidate,n=window.mozRTCSessionDescription||window.RTCSessionDescription;return!!(e&&t&&n)&&!!(e&&"createDataChannel"in e.prototype)},isNetPlay:function(){},findElements:function(){try{return this.elements.controls=u.call(this,this.config.selectors.controls.wrapper),this.elements.buttons={play:k.call(this,this.config.selectors.buttons.play),pause:u.call(this,this.config.selectors.buttons.pause),restart:u.call(this,this.config.selectors.buttons.restart),mute:u.call(this,this.config.selectors.buttons.mute),settings:u.call(this,this.config.selectors.buttons.settings),fullscreen:u.call(this,this.config.selectors.buttons.fullscreen),saveState:u.call(this,this.config.selectors.buttons.saveState),screenRecord:u.call(this,this.config.selectors.buttons.screenRecord),loadState:u.call(this,this.config.selectors.buttons.loadState),gamepad:u.call(this,this.config.selectors.buttons.gamepad),netplay:u.call(this,this.config.selectors.buttons.netplay),cheat:u.call(this,this.config.selectors.buttons.cheat)},this.elements.inputs={volume:u.call(this,this.config.selectors.inputs.volume)},!0}catch(e){return this.debug.warn("It looks like there is a problem with your custom controls HTML",e),!1}},createIcon:function(o,i){e=document.createElementNS("http://www.w3.org/2000/svg","svg"),el(e,y(i,{role:"presentation",focusable:"false"})),t=document.createElement("div"),t.innerHTML="<svg>".concat(this.icons[o],"</svg>");for(var e,t,s=t.childNodes[0].childNodes,n=0;n<s.length;n+=1)e.appendChild(s[n]);return e},createLabel:function(s){var n,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=D.get(s,this.config),t={};return t[e.class]=!0,t[this.config.classNames.hidden]=!0,n=Object.assign({},e,{class:[e.class,this.config.classNames.tooltip].filter(Boolean).join(" ")}),c("span",n,o)},createBadge:function(e){if(s.empty(e))return null;var t=c("span",{class:this.config.classNames.menu.value});return t.appendChild(c("span",{class:this.config.classNames.menu.badge},e)),t},createButton:function(m,f){var a,r,l,d,h,e=c("button"),t=Object.assign({},f),o=eW(m),u=!1;switch("type"in t||(t.type="button"),h=n({ejs__control:!0}),"class"in t?t.class.includes(h)||(t.class+=" ".concat(h)):t.class=h,m){case"play":u=!0,r="play",l="pause",a="play",d="pause";break;case"mute":u=!0,r="mute",l="unmute",a="volume",d="muted";break;case"fullscreen":u=!0,r="enterFullscreen",l="exitFullscreen",a="enter-fullscreen",d="exit-fullscreen";break;default:r=o,a=m}return u?(e.appendChild(i.createIcon.call(this,d,{class:n({'icon--pressed':!0})})),e.appendChild(i.createIcon.call(this,a,{class:n({'icon--not-pressed':!0})})),e.appendChild(i.createLabel.call(this,l,{class:n({'icon--pressed':!0})})),e.appendChild(i.createLabel.call(this,r,{class:n({'icon--not-pressed':!0})}))):(e.appendChild(i.createIcon.call(this,a)),e.appendChild(i.createLabel.call(this,r))),y(t,N(this.config.selectors.buttons[o],t)),el(e,t),"play"===o?(s.array(this.elements.buttons[o])||(this.elements.buttons[o]=[]),this.elements.buttons[o].push(e)):this.elements.buttons[o]=e,e},createRange:function(e,n){var t=c("input",y(N(this.config.selectors.inputs[e]),{type:"range",min:0,max:100,step:.1,value:0,autocomplete:"off",role:"slider",'aria-label':D.get(e,this.config),'aria-valuemin':0,'aria-valuemax':100,'aria-valuenow':0},n));return this.elements.inputs[e]=t,i.updateRangeFill.call(this,t),t},bindMenuItemShortcuts:function(e,n){var t=this;r(e,"keydown keyup",function(o){if([32,38,39,40].includes(o.which)&&(o.preventDefault(),o.stopPropagation(),"keydown"!==o.type)){var a,r=ee(e,'[role="menuitemradio"]');!r&&[32,39].includes(o.which)?i.showMenuPanel.call(t,n,!0):32!==o.which&&(40===o.which||r&&39===o.which?(a=e.nextElementSibling,s.element(a)||(a=e.parentNode.firstElementChild)):(a=e.previousElementSibling,s.element(a)||(a=e.parentNode.lastElementChild)),Y.call(t,a,!0))}},!1),r(e,"keyup",function(e){13===e.which&&i.focusFirstMenuItem.call(t,null,!0)})},createMenuItem:function(n){var u,a=this,o=n.value,v=n.list,e=n.type,g=n.title,m=n.badge,f=void 0===m?null:m,h=n.checked,p=void 0!==h&&h,l=N(this.config.selectors.inputs[e]),t=c("button",y(l,{type:"button",role:"menuitemradio",class:''.concat(this.config.classNames.control," ").concat(l.class?l.class:'').trim(),'aria-checked':p,value:o})),r=c("span");r.innerHTML=g,s.element(f)&&r.appendChild(f),t.appendChild(r),Object.defineProperty(t,"checked",{enumerable:!0,get:function(){return"true"===t.getAttribute("aria-checked")},set:function(e){e&&Array.from(t.parentNode.children).filter(function(e){return ee(e,'[role="menuitemradio"]')}).forEach(function(e){return e.setAttribute("aria-checked","false")}),t.setAttribute("aria-checked",e?"true":"false")}}),u=i.getCoreOptions.call(this),this.listeners.bind(t,"click keyup",function(n){s.keyboardEvent(n)&&32!==n.which||(n.preventDefault(),n.stopPropagation(),t.checked=!0,Object.keys(i.normalOptions).includes(e)&&i.updateNormalOptions.call(a,e,o),Object.keys(u).includes(e)&&(u[e].netplay&&d.connected?d.connection.isInitiator&&(i.updateCoreOptions.call(a,e,o),d.connection.send(JSON.stringify({act:"update-core-option",key:e,value:o,frame:d.currentFrame}))):i.updateCoreOptions.call(a,e,o)),i.showMenuPanel.call(a,"home",s.keyboardEvent(n)))},e,!1),i.bindMenuItemShortcuts.call(this,t,e),v.appendChild(t)},updateVolume:function(){s.element(this.elements.inputs.volume)&&i.setRange.call(this,this.elements.inputs.volume,this.muted?0:this.volume),s.element(this.elements.buttons.mute)&&(this.elements.buttons.mute.pressed=this.muted||0===this.volume)},setRange:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;s.element(e)&&(e.value=t,i.updateRangeFill.call(this,e))},updateRangeFill:function(t){var n,e=s.event(t)?t.target:t;s.element(e)&&"range"===e.getAttribute("type")&&(ee(e,this.config.selectors.inputs.volume)?(n=100*e.value,e.setAttribute("aria-valuenow",n),e.setAttribute("aria-valuetext",''.concat(n.toFixed(1),"%"))):e.setAttribute("aria-valuenow",e.value),b.isWebkit&&e.style.setProperty("--value",''.concat(e.value/e.max*100,"%")))},toggleMenuButton:function(e,t){a(this.elements.settings.buttons[e],!t)},updateNormalOptions:function(e,t){this.elements.settings.buttons[e].querySelector(".".concat(this.config.classNames.menu.value)).innerHTML=i.normalOptions[e].options[t];var n={};n[e]=t,i.storage.set(n),"shader"===e&&d.setShader(t),"virtual-gamepad"===e&&d.toggleVirtualGamepad.call(this,"enabled"===t)},updateCoreOptions:function(e,t){if("nds"==this.system&&!j.wasm)return!0;if(i.coreOptionsValues[e]=t,"psx"===this.system&&o.Module.pauseMainLoop(),d.setVariable(e,t),"psx"===this.system&&(setTimeout(function(){o.Module.resumeMainLoop()},100),setTimeout(function(){o.Module.resumeMainLoop()},200)),"nds"===this.system&&j.wasm&&(c=this.elements.wrapper.querySelector("canvas"),"screen_rotation"===e))switch(c.style.transform="rotate("+t+"deg)",t){case"0":d.setVariable("desmume_input_rotation","0");break;case"90":d.setVariable("desmume_input_rotation","270");break;case"180":d.setVariable("desmume_input_rotation","180");break;case"270":d.setVariable("desmume_input_rotation","90")}("arcade"===this.system||"fba0.2.97.29"===this.system)&&(n=this.elements.wrapper.querySelector("canvas"),n.height="fba-aspect"===e&&"PAR"===t?n.width/16*9:n.width/4*3);var n,r,c,l=i.getCoreOptions.call(this),a=i.storage.get("core-options");s.empty(a)&&(a={}),a[e]=t,i.storage.set({'core-options':a}),this.elements.settings.buttons[e]&&(r=this.elements.settings.buttons[e].querySelector(".".concat(this.config.classNames.menu.value)),s.object(l[e].options)?r.innerHTML=l[e].options[t]:r.innerHTML=t)},setOptionMenuItem:function(e,o){var t=this,a=this.elements.settings.panels.home.querySelector('[role="menu"]'),l=this.elements.settings.popup.children[0];Object.keys(e).forEach(function(u){var h,m,f,g,v,b,d=u,p=c("button",y(N(t.config.selectors.buttons.settings),{type:"button",class:n({ejs__control:!0,'ejs__control--forward':!0}),role:"menuitem",item:u,'aria-haspopup':!0}));r(p,"click",function(){i.showMenuPanel.call(t,d,!1)}),b=c("span",null,e[u].label),g=c("span",{class:t.config.classNames.menu.value}),s.object(o)&&(h=o[d]),s.empty(h)&&(h=e[d].default),s.object(e[d].options)?g.innerHTML=e[d].options[h]:g.innerHTML=h,b.appendChild(g),p.appendChild(b),a.appendChild(p),m=c("div",{'data-pane':escape(d),hidden:''}),f=c("button",{type:"button",class:n({ejs__control:!0,'ejs__control--back':!0})}),f.appendChild(c("span",{'aria-hidden':!0},e[u].label)),f.appendChild(c("span",{class:n({'ejs__sr-only':!0})},D.get("menuBack",t.config))),r(m,"keydown",function(e){37===e.which&&(e.preventDefault(),e.stopPropagation(),i.showMenuPanel.call(t,"home",!0))},!1),r(f,"click",function(){i.showMenuPanel.call(t,"home",!1)}),m.appendChild(f),m.appendChild(c("div",{role:"menu"})),l.appendChild(m),t.elements.settings.buttons[d]=p,t.elements.settings.panels[d]=m,v=m.querySelector('[role="menu"]'),!function(e){if(s.element(e))for(var t=e.childNodes.length;t>0;)e.removeChild(e.lastChild),t-=1}(v),s.object(e[u].options)?Object.keys(e[u].options).forEach(function(n){i.createMenuItem.call(t,{value:n,list:v,type:d,title:e[u].options[n],badge:null,checked:Boolean(h===n)})}):s.array(e[u].options)&&e[u].options.forEach(function(e){i.createMenuItem.call(t,{value:e,list:v,type:d,title:e,badge:null,checked:Boolean(h===e)})})})},setNormalOptionsMenu:function(){var n=this,e=this,t={};t.orientation=i.storage.get("orientation"),t.shader=i.storage.get("shader"),e.touch?(t["virtual-gamepad"]=i.storage.get("virtual-gamepad"),r.call(e,e.elements.container,"start-game",function(){("enabled"===t["virtual-gamepad"]||s.empty(t["virtual-gamepad"]))&&d.toggleVirtualGamepad.call(e,!0)})):delete i.normalOptions["virtual-gamepad"],i.setOptionMenuItem.call(this,i.normalOptions,t),r.call(e,e.elements.container,"start-game",function(){var s,a=n,t={};d.getGameCoreOptions&&d.getGameCoreOptions().split("\n").forEach(function(i){var n,o,s=i.split("; "),e=s[0];0===e.indexOf("fba-dipswitch-")&&(n=s[1].split("|"),o=e.replace(/_/g," ").replace(/.+-(.+)/,"$1"),t[e]={label:o,options:n.slice(1,-1),default:n[0].replace("(Default) ",''),netplay:!0})}),s=i.storage.get("core-options"),i.coreOptionsValues=s||{},i.setOptionMenuItem.call(e,t,i.coreOptionsValues),Object.keys(i.coreOptionsValues).forEach(function(e){i.updateCoreOptions.call(a,e,i.coreOptionsValues[e])}),"nds"==e.system&&(o.Module._fast_forward_2?o.Module._fast_forward_2(1):o.Module._fast_forward&&o.Module._fast_forward(1))})},updateCoreOptionMenuItems:function(){var t=this.elements.settings.panels.home.querySelector('[role="menu"]'),e=i.getCoreOptions.call(this);d.connected&&!d.connection.isInitiator?Object.keys(e).forEach(function(n){e[n].netplay&&t.querySelector('[item="'.concat(n,'"]')).setAttribute("disabled",'')}):Object.keys(e).forEach(function(e){t.querySelector('[item="'.concat(e,'"]')).removeAttribute("disabled")})},setCoreOptionsMenu:function(){this.elements.settings.panels.home.querySelector('[role="menu"]'),this.elements.settings.popup.children[0];var t=i.getCoreOptions.call(this),e=i.storage.get("core-options");i.coreOptionsValues=e||{},i.setOptionMenuItem.call(this,t,e)},checkMenu:function(){var e=this.elements.settings.buttons;!s.empty(e)&&Object.values(e).some(function(e){return!e.hidden}),a(this.elements.settings.menu,!1)},focusFirstMenuItem:function(n){var e,t,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.elements.settings.popup.hidden||(e=n,s.element(e)||(e=Object.values(this.elements.settings.panels).find(function(e){return!e.hidden})),t=e.querySelector('[role^="menuitem"]'),Y.call(this,t,o))},toggleMenu:function(e){var t,r,c,n=this.elements.settings.popup,o=this.elements.buttons.settings;if(s.element(n)&&s.element(o)){if(r=n.hidden,t=r,s.boolean(e))t=e;else if(s.keyboardEvent(e)&&27===e.which)t=!1;else if(s.event(e)&&(c=n.contains(e.target),c||!c&&e.target!==o&&t))return;o.setAttribute("aria-expanded",t),a(n,!t),h(this.elements.container,this.config.classNames.menu.open,t),t&&s.keyboardEvent(e)?i.focusFirstMenuItem.call(this,null,!0):t||r||Y.call(this,o,s.keyboardEvent(e))}},getMenuSize:function(t){e=t.cloneNode(!0),e.style.position="absolute",e.style.opacity=0,e.removeAttribute("hidden"),t.parentNode.appendChild(e);var e,n=e.scrollWidth,s=e.scrollHeight;return eh(e),{width:n,height:s}},showLoadStatePanel:function(){},showMenuPanel:function(){var e,n,o,c,d=this,h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'',l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=u.call(this,'[data-pane="'.concat(escape(h),'"]'));s.element(t)&&(e=t.parentNode,n=Array.from(e.children).find(function(e){return!e.hidden}),j.transitions&&!j.reducedMotion&&(e.style.width=''.concat(n.scrollWidth,"px"),e.style.height=''.concat(n.scrollHeight,"px"),o=i.getMenuSize.call(this,t),c=function n(t){t.target===e&&["width","height"].includes(t.propertyName)&&(e.style.width='',e.style.height='',er.call(d,e,U,n))},r.call(this,e,U,c),e.style.width=''.concat(o.width,"px"),e.style.height=''.concat(o.height,"px")),a(n,!0),a(t,!1),i.focusFirstMenuItem.call(this,t,l))},setLoadState:function(t){t.appendChild(i.createButton.call(this,"load-state",{'aria-haspopup':!0,'aria-expanded':!1}));var e=c("div",{class:n({ejs__dialog:!0,'ejs__load-state__container':!0}),hidden:''}),s=c("div");e.appendChild(s),u.call(this,".".concat(n({ejs__dialogs:!0}))).appendChild(e),this.elements.dialogs.loadState=e},setScreenRecord:function(s){if(!window.MediaRecorder)return;t=i.createButton.call(this,"screen-record",{'aria-haspopup':!0,'aria-expanded':!1,style:"margin-right:auto;"}),s.appendChild(t);var t,e=c("div",{class:n({ejs__dialog:!0,ejs__screenRecord__container:!0}),hidden:''}),o=c("div");e.appendChild(o),u.call(this,".".concat(n({ejs__dialogs:!0}))).appendChild(e),this.elements.dialogs.screenRecord=e},setGamepad:function(s){t=i.createButton.call(this,"gamepad",{'aria-haspopup':!0,'aria-expanded':!1,style:"margin-right:auto;"}),s.appendChild(t);var t,e=c("div",{class:n({ejs__dialog:!0,ejs__gamepad__container:!0}),hidden:''}),o=c("div");e.appendChild(o),u.call(this,".".concat(n({ejs__dialogs:!0}))).appendChild(e),this.elements.dialogs.gamepad=e},setCheat:function(s){t=i.createButton.call(this,"cheat",{'aria-haspopup':!0,'aria-expanded':!1,style:"margin-right:auto;"}),s.appendChild(t);var t,e=c("div",{class:n({ejs__dialog:!0,ejs__cheat__container:!0}),hidden:''}),o=c("div");e.appendChild(o),u.call(this,".".concat(n({ejs__dialogs:!0}))).appendChild(e),this.elements.dialogs.cheat=e},setStateInfoBarWidget:function(){var e=c("div",{class:n({ejs__widget:!0})}),t=c("div");t.style="color: red;font-size: 17px;padding:10px;text-align:left;text-shadow:1px 1px 1px #000",e.appendChild(t),u.call(this,".".concat(n({ejs__widgets:!0}))).appendChild(e),this.elements.widgets.stateInfo=e,this.elements.widgets.stateInfoDiv=t},setNetplayWidgets:function(){var e=c("div",{class:n({ejs__widget:!0,ejs__widget_netplay:!0})}),t=c("div");e.appendChild(t),u.call(this,".".concat(n({ejs__widgets:!0}))).appendChild(e),this.elements.widgets.netplay=e},setNetplay:function(t){t.appendChild(i.createButton.call(this,"netplay",{'aria-haspopup':!0,'aria-expanded':!1}));var e=c("div",{class:n({ejs__dialog:!0,ejs__netplay__container:!0}),hidden:''}),s=c("div");e.appendChild(s),u.call(this,".".concat(n({ejs__dialogs:!0}))).appendChild(e),this.elements.dialogs.netplay=e,i.setNetplayWidgets.call(this)},toggleContextMenu:function(s,a){if(et(s.target,n({ejs__dialogs:!0}))){var t,o,r,e=i.contextMenu.timer;this.started&&(t=u.call(this,".".concat(n({ejs__contextmenu:!0})," ul")),a?(i.contextMenu.style.display="block",i.contextMenu.style.left=''.concat(s.layerX,"px"),i.contextMenu.style.top=''.concat(s.layerY,"px"),r=k.call(this,".".concat(n({ejs__contextmenu:!0})," ul li")),null===t.getAttribute("menu")&&(o=c("li",{}),o.appendChild(c("a",{target:"_blank",href:"https://github.com/ethanaobrien/emulatorjs"},"EmulatorJS v".concat(this.version))),t.appendChild(o),t.setAttribute("menu",'')),e&&clearTimeout(e),e=setTimeout(function(){},4e3),i.contextMenu.timer=e):i.contextMenu.style.display="none")}},create:function(d){s=this,i.storage=new eu(this,"ejs_".concat(this.system,"_settings")),t=c("div",N(this.config.selectors.controls.wrapper)),i.contextMenu=c("div",{class:n({ejs__contextmenu:!0}),style:"position: absolute; display:none;z-index:9"}),h=["<ul>","</ul>"],g=[];function v(e,s,t){typeof t=="function"?g.push(t):g.push(function(){});var n=h.length-1;s?h.splice(n,0,'<li hidden><a href="#" onclick="return false">'+e+"</a></li>"):h.splice(n,0,'<li><a href="#" onclick="return false">'+e+"</a></li>")}v(s.localization("Take Screenshot"),!1,function(){var t,n,o=e.getScreenData();return typeof s.gameName=="string"&&(t=s.gameName),n=t?''.concat(t,"-screenshot.png"):"game.png",eE()(new Blob([o]),n),!1}),v(s.localization("Cache Manage"),!0,function(){if(o.romdb){a(s.elements.dialogs.cache,!1);var t=s.elements.dialogs.cache.querySelector(".".concat(e.classNames["dialog-content"]));t.innerHTML="<div>"+s.localization("Loading")+"</div>",o.romdb.getAll(function(e){if(e){var i=c("table",{style:"width:100%;padding-left:10px;text-align:left"}),n=c("tbody");e.length>0?(t.innerHTML='',e.forEach(function(e){if(e.key&&!/-part-\d+$/.test(e.key)){for(var d=Math.ceil(e.filesize/104857600),r=[e.key],i=1;i<d;i+=1)r.push(''.concat(e.key,"-part-").concat(i));var t=c("tr"),l=c("td"),a=c("td"),s=c("td");l.innerHTML=e.filename,a.innerHTML=function(e){var t=-1;do e/=1024,t++;while(e>1024)return Math.max(e,.1).toFixed(1)+[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"][t]}(e.filesize),s.innerHTML='<a href="#" onclick="return false">Remove</a>',t.appendChild(l),t.appendChild(a),t.appendChild(s),n.appendChild(t),s.querySelector("a").onclick=function(e){o.romdb.removeBatch(r);try{n.removeChild(t)}catch(e){}return e.stopPropagation(),!1}}}),i.appendChild(n),t.appendChild(i)):t.innerHTML='<div style="text-align:center">'+s.localization("Empty")+"</div>"}else t.innerHTML='<div style="text-align:center">'+s.localization("Empty")+"</div>"},function(){})}return!1}),v(s.localization("Quick Save")+" (F2)",!1,function(){e.quickSaveState(),l.contextMenu.style.display="none"}),v(s.localization("Quick Load")+" (F4)",!1,function(){e.quickLoadState(),l.contextMenu.style.display="none"}),i.contextMenu.innerHTML=h.join(''),w=i.contextMenu.getElementsByTagName("li");for(f=0;f<w.length;f++)r.call(s,w[f],"click",g[f]);this.elements.container.appendChild(i.contextMenu),j=c("div",{class:n({ejs__dialog:!0,ejs__cache__container:!0}),hidden:''}),u.call(this,".".concat(n({ejs__dialogs:!0}))).appendChild(j),this.elements.dialogs.cache=j,b=c("div",{class:n({ejs__dialog:!0,ejs__loading__container:!0}),hidden:''}),u.call(this,".".concat(n({ejs__dialogs:!0}))).appendChild(b),this.elements.dialogs.loading=b,t.appendChild(i.createButton.call(this,"restart")),t.appendChild(i.createButton.call(this,"play")),t.appendChild(i.createButton.call(this,"save-state",{'aria-expanded':!1})),i.setLoadState.call(this,t,d),i.setScreenRecord.call(this,t,d),i.supportNetPlay.call(this,t)&&parseInt(this.config.gameId,10)>0&&i.setNetplay.call(this,t,d),i.setGamepad.call(this,t,d),i.setStateInfoBarWidget.call(this,t,d),i.setCheat.call(this,t,d),t.appendChild(c("span",{style:"flex:1"})),p=c("div",{class:n({ejs__volume:!0})}),p.appendChild(i.createButton.call(this,"mute")),C={max:1,step:.01,value:this.config.volume},p.appendChild(i.createRange.call(this,"volume",y(C,{}))),this.elements.volume=p,t.appendChild(p),m=c("div",{class:n({ejs__menu:!0})}),m.appendChild(i.createButton.call(this,"settings",{'aria-haspopup':!0,'aria-expanded':!1}));var t,s,h,m,f,p,g,b,j,w,C,E,O=c("div",{class:n({ejs__menu__container:!0}),hidden:''}),x=c("div"),_=c("div",{'data-pane':"home"}),k=c("div",{role:"menu"});return _.appendChild(k),x.appendChild(_),this.elements.settings.panels.home=_,O.appendChild(x),m.appendChild(O),t.appendChild(m),this.elements.settings.popup=O,this.elements.settings.menu=m,t.appendChild(i.createButton.call(this,"fullscreen")),E=this,t.addEventListener("mousedown",function(){E.onButtonDiv=!0}),this.elements.controls=t,i.setNormalOptionsMenu.call(this),i.setCoreOptionsMenu.call(this),t},inject:function(){r=this,this.icons={'enter-fullscreen':'<path d="M10 3h3.6l-4 4L11 8.4l4-4V8h2V1h-7zM7 9.6l-4 4V10H1v7h7v-2H4.4l4-4z"/>','exit-fullscreen':'<path d="M1 12h3.6l-4 4L2 17.4l4-4V17h2v-7H1zM16 .6l-4 4V1h-2v7h7V6h-3.6l4-4z"/>',gamepad:'<svg viewBox="0 0 640 512"><path fill="currentColor" d="M480 96H160C71.6 96 0 167.6 0 256s71.6 160 160 160c44.8 0 85.2-18.4 114.2-48h91.5c29 29.6 69.5 48 114.2 48 88.4 0 160-71.6 160-160S568.4 96 480 96zM256 276c0 6.6-5.4 12-12 12h-52v52c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-52H76c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h52v-52c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h52c6.6 0 12 5.4 12 12v40zm184 68c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm80-80c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48z"/></svg>','load-state':'<svg viewBox="0 0 576 512"><path fill="currentColor" d="M572.694 292.093L500.27 416.248A63.997 63.997 0 0 1 444.989 448H45.025c-18.523 0-30.064-20.093-20.731-36.093l72.424-124.155A64 64 0 0 1 152 256h399.964c18.523 0 30.064 20.093 20.73 36.093zM152 224h328v-48c0-26.51-21.49-48-48-48H272l-64-64H48C21.49 64 0 85.49 0 112v278.046l69.077-118.418C86.214 242.25 117.989 224 152 224z"/></svg>',muted:'<path d="M12.4 12.5l2.1-2.1 2.1 2.1 1.4-1.4L15.9 9 18 6.9l-1.4-1.4-2.1 2.1-2.1-2.1L11 6.9 13.1 9 11 11.1zM3.786 6.008H.714C.286 6.008 0 6.31 0 6.76v4.512c0 .452.286.752.714.752h3.072l4.071 3.858c.5.3 1.143 0 1.143-.602V2.752c0-.601-.643-.977-1.143-.601L3.786 6.008z"/>',netplay:'<svg viewBox="0 0 512 512"><path fill="currentColor" d="M364.215 192h131.43c5.439 20.419 8.354 41.868 8.354 64s-2.915 43.581-8.354 64h-131.43c5.154-43.049 4.939-86.746 0-128zM185.214 352c10.678 53.68 33.173 112.514 70.125 151.992.221.001.44.008.661.008s.44-.008.661-.008c37.012-39.543 59.467-98.414 70.125-151.992H185.214zm174.13-192h125.385C452.802 84.024 384.128 27.305 300.95 12.075c30.238 43.12 48.821 96.332 58.394 147.925zm-27.35 32H180.006c-5.339 41.914-5.345 86.037 0 128h151.989c5.339-41.915 5.345-86.037-.001-128zM152.656 352H27.271c31.926 75.976 100.6 132.695 183.778 147.925-30.246-43.136-48.823-96.35-58.393-147.925zm206.688 0c-9.575 51.605-28.163 104.814-58.394 147.925 83.178-15.23 151.852-71.949 183.778-147.925H359.344zm-32.558-192c-10.678-53.68-33.174-112.514-70.125-151.992-.221 0-.44-.008-.661-.008s-.44.008-.661.008C218.327 47.551 195.872 106.422 185.214 160h141.572zM16.355 192C10.915 212.419 8 233.868 8 256s2.915 43.581 8.355 64h131.43c-4.939-41.254-5.154-84.951 0-128H16.355zm136.301-32c9.575-51.602 28.161-104.81 58.394-147.925C127.872 27.305 59.198 84.024 27.271 160h125.385z"/></svg>',pause:'<path d="M6 1H3c-.6 0-1 .4-1 1v14c0 .6.4 1 1 1h3c.6 0 1-.4 1-1V2c0-.6-.4-1-1-1zM12 1c-.6 0-1 .4-1 1v14c0 .6.4 1 1 1h3c.6 0 1-.4 1-1V2c0-.6-.4-1-1-1h-3z"/>',play:'<path d="M15.562 8.1L3.87.225C3.052-.337 2 .225 2 1.125v15.75c0 .9 1.052 1.462 1.87.9L15.563 9.9c.584-.45.584-1.35 0-1.8z"/>',restart:'<path d="M9.7 1.2l.7 6.4 2.1-2.1c1.9 1.9 1.9 5.1 0 7-.9 1-2.2 1.5-3.5 1.5-1.3 0-2.6-.5-3.5-1.5-1.9-1.9-1.9-5.1 0-7 .6-.6 1.4-1.1 2.3-1.3l-.6-1.9C6 2.6 4.9 3.2 4 4.1 1.3 6.8 1.3 11.2 4 14c1.3 1.3 3.1 2 4.9 2 1.9 0 3.6-.7 4.9-2 2.7-2.7 2.7-7.1 0-9.9L16 1.9l-6.3-.7z"/>','save-state':'<svg viewBox="0 0 448 512"><path fill="currentColor" d="M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"/></svg>','screen-record':'<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px",viewBox="0 0 39.989 39.989" style="enable-background:new 0 0 39.989 39.989;" xml:space="preserve"><path id="XMLID_155_" d="M19.994,0C8.952,0,0,8.952,0,19.995c0,11.043,8.952,19.994,19.994,19.994s19.995-8.952,19.995-19.994,C39.989,8.952,31.037,0,19.994,0z M19.994,27.745c-4.28,0-7.75-3.47-7.75-7.75s3.47-7.75,7.75-7.75s7.75,3.47,7.75,7.75,S24.275,27.745,19.994,27.745z"/></svg>',settings:'<path d="M16.135 7.784a2 2 0 0 1-1.23-2.969c.322-.536.225-.998-.094-1.316l-.31-.31c-.318-.318-.78-.415-1.316-.094a2 2 0 0 1-2.969-1.23C10.065 1.258 9.669 1 9.219 1h-.438c-.45 0-.845.258-.997.865a2 2 0 0 1-2.969 1.23c-.536-.322-.999-.225-1.317.093l-.31.31c-.318.318-.415.781-.093 1.317a2 2 0 0 1-1.23 2.969C1.26 7.935 1 8.33 1 8.781v.438c0 .45.258.845.865.997a2 2 0 0 1 1.23 2.969c-.322.536-.225.998.094 1.316l.31.31c.319.319.782.415 1.316.094a2 2 0 0 1 2.969 1.23c.151.607.547.865.997.865h.438c.45 0 .845-.258.997-.865a2 2 0 0 1 2.969-1.23c.535.321.997.225 1.316-.094l.31-.31c.318-.318.415-.781.094-1.316a2 2 0 0 1 1.23-2.969c.607-.151.865-.547.865-.997v-.438c0-.451-.26-.846-.865-.997zM9 12a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>',volume:'<path d="M15.5999996,3.3 C15.1999996,2.9 14.5999996,2.9 14.1999996,3.3 C13.7999996,3.7 13.7999996,4.3 14.1999996,4.7 C15.3999996,5.9 15.9999996,7.4 15.9999996,9 C15.9999996,10.6 15.3999996,12.1 14.1999996,13.3 C13.7999996,13.7 13.7999996,14.3 14.1999996,14.7 C14.3999996,14.9 14.6999996,15 14.8999996,15 C15.1999996,15 15.3999996,14.9 15.5999996,14.7 C17.0999996,13.2 17.9999996,11.2 17.9999996,9 C17.9999996,6.8 17.0999996,4.8 15.5999996,3.3 L15.5999996,3.3 Z"></path>\n            <path d="M11.2819745,5.28197449 C10.9060085,5.65794047 10.9060085,6.22188944 11.2819745,6.59785542 C12.0171538,7.33303477 12.2772954,8.05605449 12.2772954,9.00000021 C12.2772954,9.93588462 11.851678,10.9172014 11.2819745,11.4869049 C10.9060085,11.8628709 10.9060085,12.4268199 11.2819745,12.8027859 C11.4271642,12.9479755 11.9176724,13.0649528 12.2998149,12.9592565 C12.4124479,12.9281035 12.5156669,12.8776063 12.5978555,12.8027859 C13.773371,11.732654 14.1311161,10.1597914 14.1312523,9.00000021 C14.1312723,8.8299555 14.1286311,8.66015647 14.119665,8.4897429 C14.0674781,7.49784946 13.8010171,6.48513613 12.5978554,5.28197449 C12.2218894,4.9060085 11.6579405,4.9060085 11.2819745,5.28197449 Z"></path>\n            <path d="M3.78571429,6.00820648 L0.714285714,6.00820648 C0.285714286,6.00820648 0,6.30901277 0,6.76022222 L0,11.2723167 C0,11.7235261 0.285714286,12.0243324 0.714285714,12.0243324 L3.78571429,12.0243324 L7.85714286,15.8819922 C8.35714286,16.1827985 9,15.8819922 9,15.2803796 L9,2.75215925 C9,2.15054666 8.35714286,1.77453879 7.85714286,2.15054666 L3.78571429,6.00820648 Z"></path>',cheat:'<svg viewBox="0 0 496 512"><path fill="currentColor" d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm-80-216c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm4 72.6c-20.8 25-51.5 39.4-84 39.4s-63.2-14.3-84-39.4c-8.5-10.2-23.7-11.5-33.8-3.1-10.2 8.5-11.5 23.6-3.1 33.8 30 36 74.1 56.6 120.9 56.6s90.9-20.6 120.9-56.6c8.5-10.2 7.1-25.3-3.1-33.8-10.1-8.4-25.3-7.1-33.8 3.1z" class=""></path></svg>'},this.id=Math.floor(1e4*Math.random()),e=null,this.elements.controls=null;var e,t,n,o,r,c={id:this.id},a=!0;s.function(this.config.controls)&&(this.config.controls=this.config.controls.call(this.props)),this.config.controls||(this.config.controls=[]),s.element(this.config.controls)||s.string(this.config.controls)?e=this.config.controls:(e=i.create.call(this,{id:this.id,seektime:this.config.seekTime,speed:this.speed,quality:this.quality}),a=!1),o=function(t){var e=t;return Object.entries(c).forEach(function(n){var t=e$(n,2),s=t[0],o=t[1];e=H(e,"{".concat(s,"}"),o)}),e},(a&&(s.string(this.config.controls)?e=o(e):s.element(e)&&(e.innerHTML=o(e.innerHTML))),s.string(this.config.selectors.controls.container)&&(t=document.querySelector(this.config.selectors.controls.container)),s.element(t)||(t=this.elements.container),t[s.element(e)?"insertAdjacentElement":"insertAdjacentHTML"]("afterbegin",e),s.element(this.elements.controls)||i.findElements.call(this),!s.empty(this.elements.buttons))&&(n=function(e){var t=r.config.classNames.controlPressed;Object.defineProperty(e,"pressed",{enumerable:!0,get:function(){return et(e,t)},set:function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];h(e,t,n)}})},Object.values(this.elements.buttons).filter(Boolean).forEach(function(e){s.array(e)||s.nodeList(e)?Array.from(e).filter(Boolean).forEach(n):n(e)})),window.navigator.userAgent.includes("Edge")&&e0(t)}},l=i;function e3(s,n){for(var e,t=0;t<n.length;t++)e=n[t],e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(s,e.key,e)}function em(){if(this.enabled){var e=this.player.elements.buttons.fullscreen;s.element(e)&&(e.pressed=this.active),p.call(this.player,this.target,this.active?"enterfullscreen":"exitfullscreen",!0),b.isIos||eK.call(this.player,this.target,this.active)}}function e7(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e?this.scrollPosition={x:window.scrollX||0,y:window.scrollY||0}:window.scrollTo(this.scrollPosition.x,this.scrollPosition.y),document.body.style.overflow=e?"hidden":'',h(this.target,this.player.config.classNames.fullscreen.fallback,e),em.call(this)}ew=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.player=t,this.prefix=e.prefix,this.property=e.property,this.scrollPosition={x:0,y:0},r.call(this.player,document,"ms"===this.prefix?"MSFullscreenChange":''.concat(this.prefix,"fullscreenchange"),function(){em.call(n)}),this.update()}var t=e,n=[{key:"native",get:function(){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)}},{key:"prefix",get:function(){if(s.function(document.exitFullscreen))return'';var e='';return["webkit","moz","ms"].some(function(t){return!(!s.function(document[''.concat(t,"ExitFullscreen")])&&!s.function(document[''.concat(t,"CancelFullScreen")])||(e=t,0))}),e}},{key:"property",get:function(){return"moz"===this.prefix?"FullScreen":"Fullscreen"}}],o=[{key:"update",value:function(){this.enabled,h(this.player.elements.container,this.player.config.classNames.fullscreen.enabled,this.enabled)}},{key:"enter",value:function(){this.enabled&&(e.native?this.prefix?s.empty(this.prefix)||this.target[''.concat(this.prefix,"Request").concat(this.property)]():this.target.requestFullscreen():e7.call(this,!0))}},{key:"exit",value:function(){if(this.enabled)if(e.native)if(this.prefix){if(!s.empty(this.prefix)){var t="moz"===this.prefix?"Cancel":"Exit";document[''.concat(this.prefix).concat(t).concat(this.property)]()}}else(document.cancelFullScreen||document.exitFullscreen).call(document);else e7.call(this,!1)}},{key:"toggle",value:function(){this.active?this.exit():this.enter()}},{key:"enabled",get:function(){return e.native}},{key:"active",get:function(){return!!this.enabled&&(e.native?(this.prefix?document[''.concat(this.prefix).concat(this.property,"Element")]:document.fullscreenElement)===this.target:et(this.target,this.player.config.classNames.fullscreen.fallback))}},{key:"target",get:function(){return b.isEdge?this.player.game:this.player.elements.container}}];return e3(t.prototype,o),n&&e3(t,n),e}();function eX(t,r){if(Array.isArray(t))return t;var e,a,n=[],s=!0,o=!1,i=void 0;try{for(e=t[Symbol.iterator]();!(s=(a=e.next()).done)&&(n.push(a.value),!r||n.length!==r);s=!0);}catch(e){o=!0,i=e}finally{try{s||null==e.return||e.return()}finally{if(o)throw i}}return n;throw new TypeError("Invalid attempt to destructure non-iterable instance")}eO=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.emulator=t,this.lastKey=null,this.focusTimer=null,this.lastKeyDown=null,this.toggleMenu=this.toggleMenu.bind(this),this.setTabFocus=this.setTabFocus.bind(this),this.firstTouch=this.firstTouch.bind(this)}return e.prototype={toggleMenu:function(e){l.toggleMenu.call(this.emulator,e)},firstTouch:function(){var e=this.emulator,t=e.elements;e.touch=!0,h(t.container,e.config.classNames.isTouch,!0)},setTabFocus:function(e){var n,o,s=this.emulator,i=s.elements,t=s;(clearTimeout(this.focusTimer),"keydown"!==e.type||9===e.which)&&("keydown"===e.type&&(this.lastKeyDown=e.timeStamp),o=e.timeStamp-this.lastKeyDown<=20,("focus"!==e.type||o)&&(n=t.config.classNames.tabFocus,h(k.call(t,".".concat(n)),n,!1),this.focusTimer=setTimeout(function(){var e=document.activeElement;i.container.contains(e)&&h(document.activeElement,t.config.classNames.tabFocus,!0)},10)))},global:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=this.emulator,e=n;F.call(e,document.body,"click",this.toggleMenu,t),en.call(e,document.body,"touchstart",this.firstTouch),F.call(e,document.body,"keydown focus blur",this.setTabFocus,t,!1,!0),r.call(e,document.body,"keyup",function(t){e.started&&(113===t.which&&(t.shiftKey?null===e.elements.buttons.saveState.getAttribute("hidden")&&p.call(e,e.elements.buttons.saveState,"click"):d.quickSaveState()),115===t.which&&(t.shiftKey?null===e.elements.buttons.loadState.getAttribute("hidden")&&p.call(e,e.elements.buttons.loadState,"click"):d.quickLoadState()),120===t.which&&p.call(e,e.elements.buttons.mute,"click"))})},container:function(){var s,i=this.emulator,a=i.elements,e=i,t=null;r.call(e,a.container,"mousemove mouseleave touchstart touchmove enterfullscreen exitfullscreen start-game",function(t){var r,n=a.controls;if(n&&"enterfullscreen"===t.type&&(n.pressed=!1,n.hover=!1),r=0,["touchstart","touchmove","mousemove","start-game"].includes(t.type)){if(i.system=="nds"&&t.type=="mousemove"&&o&&o.Module&&o.Module.canvas&&(document.pointerLockElement===o.Module.canvas||document.mozPointerLockElement===o.Module.canvas)){w.toggleControls.call(e,!1);return}d&&(d.virtualGamepadContainer=="undefined"||d.virtualGamepadContainer===null)&&(w.toggleControls.call(e,!0),r=e.touch?3e3:2e3,clearTimeout(s),s=setTimeout(function(){return w.toggleControls.call(e,!1)},r),a.controls.setAttribute("data-timer",s))}}),r.call(e,window,"resize",function(){var t=e.elements.container.clientHeight,s=k.call(e,".".concat(n({ejs__menu__container:!0}),' [role="menu"]'));Array.from(s).forEach(function(e){e.style.maxHeight=''.concat(t-95,"px"),e.style.overflow="auto"}),o.Module&&o.Module.canvas,e.elements.container.clientWidth/e.elements.container.clientHeight<1.3?h(e.elements.container,n({portrait:!0}),!0):h(e.elements.container,n({portrait:!0}),!1)}),p.call(e,window,"resize"),r.call(e,e.elements.container,"enterfullscreen",function(){if(o.isMobileDevice&&window.screen&&screen.orientation&&typeof screen.orientation.lock=="function")try{screen.orientation.lock("landscape")}catch(e){}else if(o.isMobileDevice&&window.ScreenOrientation&&typeof ScreenOrientation.lock=="function")try{ScreenOrientation.lock("landscape")}catch(e){}if(e.coreVer===2&&o.Module){var n=50;clearInterval(t),t=setInterval(function(){o.Module.setCanvasSize(window.innerWidth,window.innerHeight),n<0&&clearInterval(t),n--},100)}setTimeout(function(){p.call(e,window,"resize")},300)}),r.call(e,e.elements.container,"exitfullscreen",function(){if(o.isMobileDevice&&window.screen&&screen.orientation&&typeof screen.orientation.unlock=="function")try{screen.orientation.unlock()}catch(e){}else if(o.isMobileDevice&&window.ScreenOrientation&&typeof ScreenOrientation.unlock=="function")try{ScreenOrientation.unlock()}catch(e){}e.coreVer===2&&o.Module&&(clearInterval(t),o.Module.setCanvasSize(800,600)),setTimeout(function(){p.call(e,window,"resize")},300)}),r.call(e,e.elements.container,"start-game",function(){var t=window.document.createEvent("UIEvents");t.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(t),h(e.elements.container,n({'game-started':!0}),!0)}),r.call(e,e.elements.container,"blur",function(t){var n=t.currentTarget;setTimeout(function(){n.contains(document.activeElement)||p.call(e,e.elements,"blurgame")},0)}),r.call(e,e.elements.container,"focus",function(t){var n=t.currentTarget;setTimeout(function(){n.contains(document.activeElement)&&p.call(e,e.elements,"focusgame")},0)})},media:function(){var s,t=this.emulator,n=t.elements,e=t;r.call(e,e.game,"volumechange",function(t){return l.updateVolume.call(e,t)}),r.call(e,n.container,"contextmenu",function(t){e.touch||e.lightgun||l.toggleContextMenu.call(e,t,!0),t.preventDefault()},!1),r.call(e,n.container,"mousewheel",function(e){e.stopPropagation()},!1),r.call(e,n.container,"mousedown",function(n){t.system=="nds"&&o&&o.Module&&o.Module.canvas&&!o.isMobileDevice&&document.pointerLockElement!==o.Module.canvas&&document.mozPointerLockElement!==o.Module.canvas&&t.started&&!t.connected&&setTimeout(function(){t.onButtonDiv!==!0&&(o.Module.canvas.requestPointerLock=o.Module.canvas.requestPointerLock||o.Module.canvas.mozRequestPointerLock,o.Module.canvas.requestPointerLock()),t.onButtonDiv=!1},100),e.touch||l.toggleContextMenu.call(e,n,!1)},!1),r.call(e,e.game,"volumechange",function(){e.storage.set({volume:e.volume,muted:e.muted}),d.setVolume&&d.setVolume()}),s=e.config.events.concat(["keyup","keydown"]).join(" "),r.call(e,e.game,s,function(t){var s=t.detail,o=void 0===s?{}:s;"error"===t.type&&(o=e.game.error),p.call(e,n.container,t.type,!0,o)})},proxy:function(t,n,a){var e=this.emulator,o=e.config.listeners[a],i=!0;s.function(o)&&(i=o.call(e,t)),i&&s.function(n)&&n.call(e,t)},bind:function(n,l,o,t){var i=this,a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],c=this.emulator,e=c,d=e.config.listeners[t],u=s.function(d);r.call(e,n,l,function(e){return i.proxy(e,o,t)},a&&!u)},controls:function(){var o,n=this,e=this.emulator,t=e.elements,s=b.isIE?"change":"input";(this.bind(t.buttons.mute,"click",function(){e.muted=!e.muted},"mute"),this.bind(t.buttons.fullscreen,"click",function(){e.fullscreen.toggle()},"fullscreen"),this.bind(t.buttons.gamepad,"click",function(){w.toggleControls.call(e,!1),a(t.dialogs.gamepad,!1)},"mute"),this.bind(t.buttons.saveState,"click",function(){p.call(e,e.elements.container,"savestate-start",!1,{});var t=d.saveState(),n=d.getScreenData();p.call(e,e.elements.container,"savestate",!1,{state:t,screenshot:n})},"mute"),this.bind(t.buttons.loadState,"click",function(){p.call(e,e.elements.container,"loadstate",!1,{})},"mute"),this.bind(t.buttons.settings,"click",function(t){t.stopPropagation(),l.toggleMenu.call(e,t)}),this.bind(t.buttons.settings,"keyup",function(t){var n=t.which;[13,32].includes(n)&&(13!==n?(t.preventDefault(),t.stopPropagation(),l.toggleMenu.call(e,t)):l.focusFirstMenuItem.call(e,null,!0))},null,!1),this.bind(t.settings.menu,"keydown",function(t){27===t.which&&l.toggleMenu.call(e,t)}),b.isIos)&&(o=k.call(e,'input[type="range"]'),Array.from(o).forEach(function(e){return n.bind(e,s,function(e){return e0(e.target)})})),b.isWebkit&&Array.from(k.call(e,'input[type="range"]')).forEach(function(t){n.bind(t,"input",function(t){return l.updateRangeFill.call(e,t.target)})}),this.bind(t.inputs.volume,s,function(t){e.volume=t.target.value},"volume"),this.bind(t.controls,"mouseenter mouseleave",function(n){"mouseleave"===n.type&&null===n.toElement?t.controls.hover=!0:t.controls.hover=!e.touch&&"mouseenter"===n.type}),this.bind(t.controls,"mousedown mouseup touchstart touchend touchcancel",function(n){if(["mousedown","touchstart"].includes(n.type)){t.controls.pressed=!0;var e,s=t.controls.getAttribute("data-timer2");clearTimeout(s)}else e=setTimeout(function(){t.controls.pressed=!1},4e3),t.controls.setAttribute("data-timer2",e)}),this.bind(t.controls,"focusin focusout",function(r){var a,i=e.config,t=e.elements,s="focusin"===r.type,o=t.controls.getAttribute("data-timer");h(t.controls,i.classNames.noTransition,s),w.toggleControls.call(e,s),s&&(setTimeout(function(){h(t.controls,i.classNames.noTransition,!1)},0),a=n.touch?3e3:4e3,clearTimeout(o),o=setTimeout(function(){return w.toggleControls.call(e,!1)},a),t.controls.setAttribute("data-timer",o))}),this.bind(t.inputs.volume,"wheel",function(t){var s,r=t.webkitDirectionInvertedFromDevice,o=eX([t.deltaX,-t.deltaY].map(function(e){return r?-e:e}),2),i=o[0],a=o[1],n=Math.sign(Math.abs(i)>Math.abs(a)?i:a);e.increaseVolume(n/50),s=e.game.volume,(1===n&&s<1||-1===n&&s>0)&&t.preventDefault()},"volume",!1),this.bind(t.controls,"contextmenu",function(e){e.stopPropagation()}),this.bind(t.contextMenu,"contextmenu",function(e){e.stopPropagation()})}},e}();function ex(s,n){for(var e,t=0;t<n.length;t++)e=n[t],e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(s,e.key,e)}ec=function(){function e(a,t){return new Promise(async function(p){var l,u,h,f,r=this,m=function(e,r){for(var e,t,c=window.location.pathname.split("/").pop(),a=window.location.pathname.substring(0,window.location.pathname.length-c.length),i=a.split("/"),s=e.split("/"),n=[],o=0;o<i.length;o++)i[o]!=''&&n.push(i[o]);if(!e.startsWith("/")&&!e.includes("://")&&!e.includes("http:")&&!e.includes("https:")&&!e.includes("file:")&&!e.includes("blob:")){for(t=0;t<s.length;t++)s[t]==''||s[t]=="."||(s[t]==".."?n.length>0&&(n=function(e){return e==="/"?"/":e.substring(0,e.length-e.split("/").pop().length)}(n.join("/")).split("/")):n.push(s[t]));e=n.join("/"),e.startsWith("/")||(e="/"+e),e=window.location.protocol+"//"+window.location.host+e}return e.startsWith("/")&&(e=window.location.protocol+"//"+window.location.host+e),!e.endsWith("/")&&r&&(e=e+"/"),e};this.version="1.2.2",this.system='',this.adUrl=null,this.gameName=null,this.loadStateOnStart=!1,this.statesSupported=!0,this.mameCore=null,this.startOnLoad=!1,this.dataPath='',this.customPaths=null,this.hash='',this.lightgun=!1,this.mouse=!1,this.multitap=!1,this.ready=!1,this.paused=!0,this.started=!1,this.touch=j.touch,this.game=a,s.string(this.game)&&(this.game=document.querySelectorAll(this.game)),(window.jQuery&&this.game instanceof jQuery||s.nodeList(this.game)||s.array(this.game))&&(this.game=this.game[0]),this.game=this.game,this.game.innerHTML='',this.config=y({},ea,e.defaults,t||{}),this.coreVer=function(e,t){if(t===!0&&window.WebAssembly){var n=["nes","snes","gb","nds"];return n.includes(e)?2:1}return 1}(this.config.system,this.config.useBeta),this.lightgun=this.config.lightgun,this.loadStateOnStart=this.config.loadStateOnStart||!1,this.adUrl=this.config.adUrl||null,this.gameName=this.config.gameName||null,this.mouse=this.config.mouse,this.multitap=this.config.multitap,this.cheats=this.config.cheats,this.cheats||(this.cheats=[]),u=function(t,e){return typeof e=="string"?e:t===!0?"https://ws.emulatorjs.com/":"https://emuserver.emulatorjs.ga/"}(this.config.oldNetplayServer,this.config.netplayUrl),this.listUrl=u,this.socketUrl=u,this.mameCore=this.config.mameCore||null,this.color=this.config.color,this.startOnLoad=this.config.startOnLoad||!1,this.statesSupported=this.config.statesSupported||!0,this.customPaths=function(e){if(!e)return{};var t,n={};for(t in e)typeof e[t]=="string"&&(n[t]=m(e[t]));return n}(this.config.paths),this.dataPath=function(e){return typeof e!="string"?function(n){var t=n,s=t.split("/").pop(),e=t.substring(0,t.length-s.length);return n=="/"?window.location.protocol+"//"+window.location.host+"/":(e.startsWith("/")&&(e=window.location.protocol+"//"+window.location.host+e),e.endsWith("/")||(e=e+"/"),e)}(window.location.href):m(e,!0)}(this.config.dataPath),this.localization=await async function(r,n,e){var s,o,a,t={};if(e&&typeof e=="string"&&e!=="en-US"){o=n&&typeof n[e+".json"]=="string"?n[e+".json"]:r+"localization/"+e+".json";try{a=await fetch(o),s=await a.text(),t=JSON.parse(s),ea.i18n=t.i18n,i.normalOptions=t.normalOptions}catch(e){console.warn("error setting localization",e)}}return function(n){return typeof t[n]=="string"?t[n]:(e&&e!=="en-US"&&"undefined"!=typeof EJS_DEBUG_XX&&!0===EJS_DEBUG_XX&&console.warn('Missing translation for "'+n+'". Language is set to "'+e+'"'),n)}}(this.dataPath,this.customPaths,this.config.lang),this.config=y({},ea,e.defaults,t||{}),Object.keys(this.config.classNames).forEach(function(e){var t,o=r;s.object(o.config.classNames[e])?Object.keys(o.config.classNames[e]).forEach(function(t){var s={};s[r.config.classNames[e][t]]=!0,r.config.classNames[e][t]=n(s)}):(t={},t[r.config.classNames[e]]=!0,r.config.classNames[e]=n(t))}),this.config.selectors.controls.wrapper=".".concat(n({ejs__controls:!0})),this.config.selectors.container=".".concat(n({ejs:!0})),this.system=this.config.system,this.elements={container:null,buttons:{},display:{},inputs:{},settings:{popup:null,menu:null,panels:{},buttons:{}},dialogs:{gamepad:null,loading:null,netplay:null},widgets:{}},this.fullscreen={active:!1},this.config.mute=!0,this.eventListeners=[],this.listeners=new eO(this),this.storage=new eu(this,"ejs_settings"),this.game.emulator=this,s.element(this.elements.container)||(this.elements.container=c("div"),e6(this.game,this.elements.container)),f=c("div",{class:n({ejs__widgets:!0})}),this.elements.container.appendChild(f),h=c("div",{class:n({ejs__dialogs:!0})}),this.elements.container.appendChild(h),w.addStyleHook.call(this),d.setup.call(this),w.build.call(this),this.listeners.container(),this.listeners.global(),this.fullscreen=new ew(this),o.create.call(this),l=document.createElement("script"),l.src=this.customPaths&&typeof this.customPaths["webrtc-adapter.js"]=="string"?this.customPaths["webrtc-adapter.js"]:this.dataPath+"webrtc-adapter.js",document.body.appendChild(l),p(this)}.bind(this))}var a,t=e,u=[{key:"setup",value:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=null;return s.string(t)?n=Array.from(document.querySelectorAll(t)):s.nodeList(t)?n=Array.from(t):s.array(t)&&(n=t.filter(s.element)),s.empty(n)?null:n.map(function(t){return new e(t,o)})}}];return a=[{key:"restart",value:function(){this.currentTime=0}},{key:"increaseVolume",value:function(e){var t=this.game.muted?0:this.volume;this.volume=t+(s.number(e)?e:0)}},{key:"decreaseVolume",value:function(e){this.increaseVolume(-e)}},{key:"toggleControls",value:function(e){if(this.started){var n=void 0===e?void 0:!e,t=h(this.elements.container,this.config.classNames.hideControls,n);return t&&l.toggleMenu.call(this,!1),!t}return!1}},{key:"setStatesSupported",value:function(e){this.statesSupported=e}},{key:"loadState",value:function(e){d.loadState(e,0)}},{key:"on",value:function(e,t){r.call(this,this.elements.container,e,t)}},{key:"once",value:function(e,t){en.call(this,this.elements.container,e,t)}},{key:"off",value:function(e,t){er(this.elements.container,e,t)}},{key:"playing",set:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Array.from(this.elements.buttons.play||[]).forEach(function(t){t.pressed=e}),this.paused=!e},get:function(){return Boolean(this.ready&&!this.paused)}},{key:"volume",set:function(t){var e=t;s.string(e)&&(e=Number(e)),s.number(e)||(e=this.storage.get("volume")),s.number(e)||(e=this.config.volume),e>1&&(e=1),e<0&&(e=0),this.config.volume=e,this.game.volume=e,!s.empty(t)&&this.muted&&e>0&&(this.muted=!1)},get:function(){return Number(this.game.volume)}},{key:"muted",set:function(t){var e=t;s.boolean(e)||(e=this.storage.get("muted")),s.boolean(e)||(e=this.config.muted),this.config.muted=e,this.game.muted=e},get:function(){return Boolean(this.game.muted)}}],ex(t.prototype,a),u&&ex(t,u),e}(),ec.defaults={},eC.default=ec}